--
-- PostgreSQL database dump
--

\restrict y9GYyt16N3z6K3SeNZvyqxufifJnge72mRDNun7qI8bBGwmfiLDFBliM3Djkrlq

-- Dumped from database version 15.15
-- Dumped by pg_dump version 15.15

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;


--
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- Name: increment_workflow_version(); Type: FUNCTION; Schema: public; Owner: n8n
--

CREATE FUNCTION public.increment_workflow_version() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
			BEGIN
				IF NEW."versionCounter" IS NOT DISTINCT FROM OLD."versionCounter" THEN
					NEW."versionCounter" = OLD."versionCounter" + 1;
				END IF;
				RETURN NEW;
			END;
			$$;


ALTER FUNCTION public.increment_workflow_version() OWNER TO n8n;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: annotation_tag_entity; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.annotation_tag_entity (
    id character varying(16) NOT NULL,
    name character varying(24) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.annotation_tag_entity OWNER TO n8n;

--
-- Name: auth_identity; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.auth_identity (
    "userId" uuid,
    "providerId" character varying(64) NOT NULL,
    "providerType" character varying(32) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.auth_identity OWNER TO n8n;

--
-- Name: auth_provider_sync_history; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.auth_provider_sync_history (
    id integer NOT NULL,
    "providerType" character varying(32) NOT NULL,
    "runMode" text NOT NULL,
    status text NOT NULL,
    "startedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    "endedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    scanned integer NOT NULL,
    created integer NOT NULL,
    updated integer NOT NULL,
    disabled integer NOT NULL,
    error text
);


ALTER TABLE public.auth_provider_sync_history OWNER TO n8n;

--
-- Name: auth_provider_sync_history_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

CREATE SEQUENCE public.auth_provider_sync_history_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.auth_provider_sync_history_id_seq OWNER TO n8n;

--
-- Name: auth_provider_sync_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: n8n
--

ALTER SEQUENCE public.auth_provider_sync_history_id_seq OWNED BY public.auth_provider_sync_history.id;


--
-- Name: chat_hub_agents; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.chat_hub_agents (
    id uuid NOT NULL,
    name character varying(256) NOT NULL,
    description character varying(512),
    "systemPrompt" text NOT NULL,
    "ownerId" uuid NOT NULL,
    "credentialId" character varying(36),
    provider character varying(16) NOT NULL,
    model character varying(64) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    tools json DEFAULT '[]'::json NOT NULL
);


ALTER TABLE public.chat_hub_agents OWNER TO n8n;

--
-- Name: COLUMN chat_hub_agents.provider; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_agents.provider IS 'ChatHubProvider enum: "openai", "anthropic", "google", "n8n"';


--
-- Name: COLUMN chat_hub_agents.model; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_agents.model IS 'Model name used at the respective Model node, ie. "gpt-4"';


--
-- Name: COLUMN chat_hub_agents.tools; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_agents.tools IS 'Tools available to the agent as JSON node definitions';


--
-- Name: chat_hub_messages; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.chat_hub_messages (
    id uuid NOT NULL,
    "sessionId" uuid NOT NULL,
    "previousMessageId" uuid,
    "revisionOfMessageId" uuid,
    "retryOfMessageId" uuid,
    type character varying(16) NOT NULL,
    name character varying(128) NOT NULL,
    content text NOT NULL,
    provider character varying(16),
    model character varying(64),
    "workflowId" character varying(36),
    "executionId" integer,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "agentId" character varying(36),
    status character varying(16) DEFAULT 'success'::character varying NOT NULL
);


ALTER TABLE public.chat_hub_messages OWNER TO n8n;

--
-- Name: COLUMN chat_hub_messages.type; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_messages.type IS 'ChatHubMessageType enum: "human", "ai", "system", "tool", "generic"';


--
-- Name: COLUMN chat_hub_messages.provider; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_messages.provider IS 'ChatHubProvider enum: "openai", "anthropic", "google", "n8n"';


--
-- Name: COLUMN chat_hub_messages.model; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_messages.model IS 'Model name used at the respective Model node, ie. "gpt-4"';


--
-- Name: COLUMN chat_hub_messages."agentId"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_messages."agentId" IS 'ID of the custom agent (if provider is "custom-agent")';


--
-- Name: COLUMN chat_hub_messages.status; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_messages.status IS 'ChatHubMessageStatus enum, eg. "success", "error", "running", "cancelled"';


--
-- Name: chat_hub_sessions; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.chat_hub_sessions (
    id uuid NOT NULL,
    title character varying(256) NOT NULL,
    "ownerId" uuid NOT NULL,
    "lastMessageAt" timestamp(3) with time zone,
    "credentialId" character varying(36),
    provider character varying(16),
    model character varying(64),
    "workflowId" character varying(36),
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "agentId" character varying(36),
    "agentName" character varying(128),
    tools json DEFAULT '[]'::json NOT NULL
);


ALTER TABLE public.chat_hub_sessions OWNER TO n8n;

--
-- Name: COLUMN chat_hub_sessions.provider; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_sessions.provider IS 'ChatHubProvider enum: "openai", "anthropic", "google", "n8n"';


--
-- Name: COLUMN chat_hub_sessions.model; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_sessions.model IS 'Model name used at the respective Model node, ie. "gpt-4"';


--
-- Name: COLUMN chat_hub_sessions."agentId"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_sessions."agentId" IS 'ID of the custom agent (if provider is "custom-agent")';


--
-- Name: COLUMN chat_hub_sessions."agentName"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_sessions."agentName" IS 'Cached name of the custom agent (if provider is "custom-agent")';


--
-- Name: COLUMN chat_hub_sessions.tools; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.chat_hub_sessions.tools IS 'Tools available to the agent as JSON node definitions';


--
-- Name: credentials_entity; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.credentials_entity (
    name character varying(128) NOT NULL,
    data text NOT NULL,
    type character varying(128) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    id character varying(36) NOT NULL,
    "isManaged" boolean DEFAULT false NOT NULL
);


ALTER TABLE public.credentials_entity OWNER TO n8n;

--
-- Name: data_table; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.data_table (
    id character varying(36) NOT NULL,
    name character varying(128) NOT NULL,
    "projectId" character varying(36) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.data_table OWNER TO n8n;

--
-- Name: data_table_column; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.data_table_column (
    id character varying(36) NOT NULL,
    name character varying(128) NOT NULL,
    type character varying(32) NOT NULL,
    index integer NOT NULL,
    "dataTableId" character varying(36) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.data_table_column OWNER TO n8n;

--
-- Name: COLUMN data_table_column.type; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.data_table_column.type IS 'Expected: string, number, boolean, or date (not enforced as a constraint)';


--
-- Name: COLUMN data_table_column.index; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.data_table_column.index IS 'Column order, starting from 0 (0 = first column)';


--
-- Name: event_destinations; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.event_destinations (
    id uuid NOT NULL,
    destination jsonb NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.event_destinations OWNER TO n8n;

--
-- Name: execution_annotation_tags; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.execution_annotation_tags (
    "annotationId" integer NOT NULL,
    "tagId" character varying(24) NOT NULL
);


ALTER TABLE public.execution_annotation_tags OWNER TO n8n;

--
-- Name: execution_annotations; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.execution_annotations (
    id integer NOT NULL,
    "executionId" integer NOT NULL,
    vote character varying(6),
    note text,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.execution_annotations OWNER TO n8n;

--
-- Name: execution_annotations_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

CREATE SEQUENCE public.execution_annotations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.execution_annotations_id_seq OWNER TO n8n;

--
-- Name: execution_annotations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: n8n
--

ALTER SEQUENCE public.execution_annotations_id_seq OWNED BY public.execution_annotations.id;


--
-- Name: execution_data; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.execution_data (
    "executionId" integer NOT NULL,
    "workflowData" json NOT NULL,
    data text NOT NULL
);


ALTER TABLE public.execution_data OWNER TO n8n;

--
-- Name: execution_entity; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.execution_entity (
    id integer NOT NULL,
    finished boolean NOT NULL,
    mode character varying NOT NULL,
    "retryOf" character varying,
    "retrySuccessId" character varying,
    "startedAt" timestamp(3) with time zone,
    "stoppedAt" timestamp(3) with time zone,
    "waitTill" timestamp(3) with time zone,
    status character varying NOT NULL,
    "workflowId" character varying(36) NOT NULL,
    "deletedAt" timestamp(3) with time zone,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.execution_entity OWNER TO n8n;

--
-- Name: execution_entity_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

CREATE SEQUENCE public.execution_entity_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.execution_entity_id_seq OWNER TO n8n;

--
-- Name: execution_entity_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: n8n
--

ALTER SEQUENCE public.execution_entity_id_seq OWNED BY public.execution_entity.id;


--
-- Name: execution_metadata; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.execution_metadata (
    id integer NOT NULL,
    "executionId" integer NOT NULL,
    key character varying(255) NOT NULL,
    value text NOT NULL
);


ALTER TABLE public.execution_metadata OWNER TO n8n;

--
-- Name: execution_metadata_temp_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

CREATE SEQUENCE public.execution_metadata_temp_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.execution_metadata_temp_id_seq OWNER TO n8n;

--
-- Name: execution_metadata_temp_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: n8n
--

ALTER SEQUENCE public.execution_metadata_temp_id_seq OWNED BY public.execution_metadata.id;


--
-- Name: folder; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.folder (
    id character varying(36) NOT NULL,
    name character varying(128) NOT NULL,
    "parentFolderId" character varying(36),
    "projectId" character varying(36) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.folder OWNER TO n8n;

--
-- Name: folder_tag; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.folder_tag (
    "folderId" character varying(36) NOT NULL,
    "tagId" character varying(36) NOT NULL
);


ALTER TABLE public.folder_tag OWNER TO n8n;

--
-- Name: insights_by_period; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.insights_by_period (
    id integer NOT NULL,
    "metaId" integer NOT NULL,
    type integer NOT NULL,
    value bigint NOT NULL,
    "periodUnit" integer NOT NULL,
    "periodStart" timestamp(0) with time zone DEFAULT CURRENT_TIMESTAMP
);


ALTER TABLE public.insights_by_period OWNER TO n8n;

--
-- Name: COLUMN insights_by_period.type; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.insights_by_period.type IS '0: time_saved_minutes, 1: runtime_milliseconds, 2: success, 3: failure';


--
-- Name: COLUMN insights_by_period."periodUnit"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.insights_by_period."periodUnit" IS '0: hour, 1: day, 2: week';


--
-- Name: insights_by_period_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

ALTER TABLE public.insights_by_period ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.insights_by_period_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: insights_metadata; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.insights_metadata (
    "metaId" integer NOT NULL,
    "workflowId" character varying(16),
    "projectId" character varying(36),
    "workflowName" character varying(128) NOT NULL,
    "projectName" character varying(255) NOT NULL
);


ALTER TABLE public.insights_metadata OWNER TO n8n;

--
-- Name: insights_metadata_metaId_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

ALTER TABLE public.insights_metadata ALTER COLUMN "metaId" ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."insights_metadata_metaId_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: insights_raw; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.insights_raw (
    id integer NOT NULL,
    "metaId" integer NOT NULL,
    type integer NOT NULL,
    value bigint NOT NULL,
    "timestamp" timestamp(0) with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


ALTER TABLE public.insights_raw OWNER TO n8n;

--
-- Name: COLUMN insights_raw.type; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.insights_raw.type IS '0: time_saved_minutes, 1: runtime_milliseconds, 2: success, 3: failure';


--
-- Name: insights_raw_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

ALTER TABLE public.insights_raw ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.insights_raw_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: installed_nodes; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.installed_nodes (
    name character varying(200) NOT NULL,
    type character varying(200) NOT NULL,
    "latestVersion" integer DEFAULT 1 NOT NULL,
    package character varying(241) NOT NULL
);


ALTER TABLE public.installed_nodes OWNER TO n8n;

--
-- Name: installed_packages; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.installed_packages (
    "packageName" character varying(214) NOT NULL,
    "installedVersion" character varying(50) NOT NULL,
    "authorName" character varying(70),
    "authorEmail" character varying(70),
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.installed_packages OWNER TO n8n;

--
-- Name: invalid_auth_token; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.invalid_auth_token (
    token character varying(512) NOT NULL,
    "expiresAt" timestamp(3) with time zone NOT NULL
);


ALTER TABLE public.invalid_auth_token OWNER TO n8n;

--
-- Name: migrations; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.migrations (
    id integer NOT NULL,
    "timestamp" bigint NOT NULL,
    name character varying NOT NULL
);


ALTER TABLE public.migrations OWNER TO n8n;

--
-- Name: migrations_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

CREATE SEQUENCE public.migrations_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE public.migrations_id_seq OWNER TO n8n;

--
-- Name: migrations_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: n8n
--

ALTER SEQUENCE public.migrations_id_seq OWNED BY public.migrations.id;


--
-- Name: oauth_access_tokens; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.oauth_access_tokens (
    token character varying NOT NULL,
    "clientId" character varying NOT NULL,
    "userId" uuid NOT NULL
);


ALTER TABLE public.oauth_access_tokens OWNER TO n8n;

--
-- Name: oauth_authorization_codes; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.oauth_authorization_codes (
    code character varying(255) NOT NULL,
    "clientId" character varying NOT NULL,
    "userId" uuid NOT NULL,
    "redirectUri" character varying NOT NULL,
    "codeChallenge" character varying NOT NULL,
    "codeChallengeMethod" character varying(255) NOT NULL,
    "expiresAt" bigint NOT NULL,
    state character varying,
    used boolean DEFAULT false NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.oauth_authorization_codes OWNER TO n8n;

--
-- Name: COLUMN oauth_authorization_codes."expiresAt"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.oauth_authorization_codes."expiresAt" IS 'Unix timestamp in milliseconds';


--
-- Name: oauth_clients; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.oauth_clients (
    id character varying NOT NULL,
    name character varying(255) NOT NULL,
    "redirectUris" json NOT NULL,
    "grantTypes" json NOT NULL,
    "clientSecret" character varying(255),
    "clientSecretExpiresAt" bigint,
    "tokenEndpointAuthMethod" character varying(255) DEFAULT 'none'::character varying NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.oauth_clients OWNER TO n8n;

--
-- Name: COLUMN oauth_clients."tokenEndpointAuthMethod"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.oauth_clients."tokenEndpointAuthMethod" IS 'Possible values: none, client_secret_basic or client_secret_post';


--
-- Name: oauth_refresh_tokens; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.oauth_refresh_tokens (
    token character varying(255) NOT NULL,
    "clientId" character varying NOT NULL,
    "userId" uuid NOT NULL,
    "expiresAt" bigint NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.oauth_refresh_tokens OWNER TO n8n;

--
-- Name: COLUMN oauth_refresh_tokens."expiresAt"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.oauth_refresh_tokens."expiresAt" IS 'Unix timestamp in milliseconds';


--
-- Name: oauth_user_consents; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.oauth_user_consents (
    id integer NOT NULL,
    "userId" uuid NOT NULL,
    "clientId" character varying NOT NULL,
    "grantedAt" bigint NOT NULL
);


ALTER TABLE public.oauth_user_consents OWNER TO n8n;

--
-- Name: COLUMN oauth_user_consents."grantedAt"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.oauth_user_consents."grantedAt" IS 'Unix timestamp in milliseconds';


--
-- Name: oauth_user_consents_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

ALTER TABLE public.oauth_user_consents ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.oauth_user_consents_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: processed_data; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.processed_data (
    "workflowId" character varying(36) NOT NULL,
    context character varying(255) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    value text NOT NULL
);


ALTER TABLE public.processed_data OWNER TO n8n;

--
-- Name: project; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.project (
    id character varying(36) NOT NULL,
    name character varying(255) NOT NULL,
    type character varying(36) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    icon json,
    description character varying(512)
);


ALTER TABLE public.project OWNER TO n8n;

--
-- Name: project_relation; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.project_relation (
    "projectId" character varying(36) NOT NULL,
    "userId" uuid NOT NULL,
    role character varying NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.project_relation OWNER TO n8n;

--
-- Name: role; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.role (
    slug character varying(128) NOT NULL,
    "displayName" text,
    description text,
    "roleType" text,
    "systemRole" boolean DEFAULT false NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.role OWNER TO n8n;

--
-- Name: COLUMN role.slug; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.role.slug IS 'Unique identifier of the role for example: "global:owner"';


--
-- Name: COLUMN role."displayName"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.role."displayName" IS 'Name used to display in the UI';


--
-- Name: COLUMN role.description; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.role.description IS 'Text describing the scope in more detail of users';


--
-- Name: COLUMN role."roleType"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.role."roleType" IS 'Type of the role, e.g., global, project, or workflow';


--
-- Name: COLUMN role."systemRole"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.role."systemRole" IS 'Indicates if the role is managed by the system and cannot be edited';


--
-- Name: role_scope; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.role_scope (
    "roleSlug" character varying(128) NOT NULL,
    "scopeSlug" character varying(128) NOT NULL
);


ALTER TABLE public.role_scope OWNER TO n8n;

--
-- Name: scope; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.scope (
    slug character varying(128) NOT NULL,
    "displayName" text,
    description text
);


ALTER TABLE public.scope OWNER TO n8n;

--
-- Name: COLUMN scope.slug; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.scope.slug IS 'Unique identifier of the scope for example: "project:create"';


--
-- Name: COLUMN scope."displayName"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.scope."displayName" IS 'Name used to display in the UI';


--
-- Name: COLUMN scope.description; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.scope.description IS 'Text describing the scope in more detail of users';


--
-- Name: settings; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.settings (
    key character varying(255) NOT NULL,
    value text NOT NULL,
    "loadOnStartup" boolean DEFAULT false NOT NULL
);


ALTER TABLE public.settings OWNER TO n8n;

--
-- Name: shared_credentials; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.shared_credentials (
    "credentialsId" character varying(36) NOT NULL,
    "projectId" character varying(36) NOT NULL,
    role text NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.shared_credentials OWNER TO n8n;

--
-- Name: shared_workflow; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.shared_workflow (
    "workflowId" character varying(36) NOT NULL,
    "projectId" character varying(36) NOT NULL,
    role text NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.shared_workflow OWNER TO n8n;

--
-- Name: tag_entity; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.tag_entity (
    name character varying(24) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    id character varying(36) NOT NULL
);


ALTER TABLE public.tag_entity OWNER TO n8n;

--
-- Name: test_case_execution; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.test_case_execution (
    id character varying(36) NOT NULL,
    "testRunId" character varying(36) NOT NULL,
    "executionId" integer,
    status character varying NOT NULL,
    "runAt" timestamp(3) with time zone,
    "completedAt" timestamp(3) with time zone,
    "errorCode" character varying,
    "errorDetails" json,
    metrics json,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    inputs json,
    outputs json
);


ALTER TABLE public.test_case_execution OWNER TO n8n;

--
-- Name: test_run; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.test_run (
    id character varying(36) NOT NULL,
    "workflowId" character varying(36) NOT NULL,
    status character varying NOT NULL,
    "errorCode" character varying,
    "errorDetails" json,
    "runAt" timestamp(3) with time zone,
    "completedAt" timestamp(3) with time zone,
    metrics json,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.test_run OWNER TO n8n;

--
-- Name: user; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public."user" (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    email character varying(255),
    "firstName" character varying(32),
    "lastName" character varying(32),
    password character varying(255),
    "personalizationAnswers" json,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    settings json,
    disabled boolean DEFAULT false NOT NULL,
    "mfaEnabled" boolean DEFAULT false NOT NULL,
    "mfaSecret" text,
    "mfaRecoveryCodes" text,
    "lastActiveAt" date,
    "roleSlug" character varying(128) DEFAULT 'global:member'::character varying NOT NULL
);


ALTER TABLE public."user" OWNER TO n8n;

--
-- Name: user_api_keys; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.user_api_keys (
    id character varying(36) NOT NULL,
    "userId" uuid NOT NULL,
    label character varying(100) NOT NULL,
    "apiKey" character varying NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    scopes json,
    audience character varying DEFAULT 'public-api'::character varying NOT NULL
);


ALTER TABLE public.user_api_keys OWNER TO n8n;

--
-- Name: variables; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.variables (
    key character varying(50) NOT NULL,
    type character varying(50) DEFAULT 'string'::character varying NOT NULL,
    value character varying(255),
    id character varying(36) NOT NULL,
    "projectId" character varying(36)
);


ALTER TABLE public.variables OWNER TO n8n;

--
-- Name: webhook_entity; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.webhook_entity (
    "webhookPath" character varying NOT NULL,
    method character varying NOT NULL,
    node character varying NOT NULL,
    "webhookId" character varying,
    "pathLength" integer,
    "workflowId" character varying(36) NOT NULL
);


ALTER TABLE public.webhook_entity OWNER TO n8n;

--
-- Name: workflow_dependency; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.workflow_dependency (
    id integer NOT NULL,
    "workflowId" character varying(36) NOT NULL,
    "workflowVersionId" integer NOT NULL,
    "dependencyType" character varying(32) NOT NULL,
    "dependencyKey" character varying(255) NOT NULL,
    "dependencyInfo" json,
    "indexVersionId" smallint DEFAULT 1 NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL
);


ALTER TABLE public.workflow_dependency OWNER TO n8n;

--
-- Name: COLUMN workflow_dependency."workflowVersionId"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.workflow_dependency."workflowVersionId" IS 'Version of the workflow';


--
-- Name: COLUMN workflow_dependency."dependencyType"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.workflow_dependency."dependencyType" IS 'Type of dependency: "credential", "nodeType", "webhookPath", or "workflowCall"';


--
-- Name: COLUMN workflow_dependency."dependencyKey"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.workflow_dependency."dependencyKey" IS 'ID or name of the dependency';


--
-- Name: COLUMN workflow_dependency."dependencyInfo"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.workflow_dependency."dependencyInfo" IS 'Additional info about the dependency, interpreted based on type';


--
-- Name: COLUMN workflow_dependency."indexVersionId"; Type: COMMENT; Schema: public; Owner: n8n
--

COMMENT ON COLUMN public.workflow_dependency."indexVersionId" IS 'Version of the index structure';


--
-- Name: workflow_dependency_id_seq; Type: SEQUENCE; Schema: public; Owner: n8n
--

ALTER TABLE public.workflow_dependency ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.workflow_dependency_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: workflow_entity; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.workflow_entity (
    name character varying(128) NOT NULL,
    active boolean NOT NULL,
    nodes json NOT NULL,
    connections json NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    settings json,
    "staticData" json,
    "pinData" json,
    "versionId" character(36) NOT NULL,
    "triggerCount" integer DEFAULT 0 NOT NULL,
    id character varying(36) NOT NULL,
    meta json,
    "parentFolderId" character varying(36) DEFAULT NULL::character varying,
    "isArchived" boolean DEFAULT false NOT NULL,
    "versionCounter" integer DEFAULT 1 NOT NULL,
    description text
);


ALTER TABLE public.workflow_entity OWNER TO n8n;

--
-- Name: workflow_history; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.workflow_history (
    "versionId" character varying(36) NOT NULL,
    "workflowId" character varying(36) NOT NULL,
    authors character varying(255) NOT NULL,
    "createdAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    "updatedAt" timestamp(3) with time zone DEFAULT CURRENT_TIMESTAMP(3) NOT NULL,
    nodes json NOT NULL,
    connections json NOT NULL,
    name character varying(128),
    autosaved boolean DEFAULT false NOT NULL,
    description text
);


ALTER TABLE public.workflow_history OWNER TO n8n;

--
-- Name: workflow_statistics; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.workflow_statistics (
    count integer DEFAULT 0,
    "latestEvent" timestamp(3) with time zone,
    name character varying(128) NOT NULL,
    "workflowId" character varying(36) NOT NULL,
    "rootCount" integer DEFAULT 0
);


ALTER TABLE public.workflow_statistics OWNER TO n8n;

--
-- Name: workflows_tags; Type: TABLE; Schema: public; Owner: n8n
--

CREATE TABLE public.workflows_tags (
    "workflowId" character varying(36) NOT NULL,
    "tagId" character varying(36) NOT NULL
);


ALTER TABLE public.workflows_tags OWNER TO n8n;

--
-- Name: auth_provider_sync_history id; Type: DEFAULT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.auth_provider_sync_history ALTER COLUMN id SET DEFAULT nextval('public.auth_provider_sync_history_id_seq'::regclass);


--
-- Name: execution_annotations id; Type: DEFAULT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_annotations ALTER COLUMN id SET DEFAULT nextval('public.execution_annotations_id_seq'::regclass);


--
-- Name: execution_entity id; Type: DEFAULT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_entity ALTER COLUMN id SET DEFAULT nextval('public.execution_entity_id_seq'::regclass);


--
-- Name: execution_metadata id; Type: DEFAULT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_metadata ALTER COLUMN id SET DEFAULT nextval('public.execution_metadata_temp_id_seq'::regclass);


--
-- Name: migrations id; Type: DEFAULT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.migrations ALTER COLUMN id SET DEFAULT nextval('public.migrations_id_seq'::regclass);


--
-- Data for Name: annotation_tag_entity; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.annotation_tag_entity (id, name, "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: auth_identity; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.auth_identity ("userId", "providerId", "providerType", "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: auth_provider_sync_history; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.auth_provider_sync_history (id, "providerType", "runMode", status, "startedAt", "endedAt", scanned, created, updated, disabled, error) FROM stdin;
\.


--
-- Data for Name: chat_hub_agents; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.chat_hub_agents (id, name, description, "systemPrompt", "ownerId", "credentialId", provider, model, "createdAt", "updatedAt", tools) FROM stdin;
\.


--
-- Data for Name: chat_hub_messages; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.chat_hub_messages (id, "sessionId", "previousMessageId", "revisionOfMessageId", "retryOfMessageId", type, name, content, provider, model, "workflowId", "executionId", "createdAt", "updatedAt", "agentId", status) FROM stdin;
\.


--
-- Data for Name: chat_hub_sessions; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.chat_hub_sessions (id, title, "ownerId", "lastMessageAt", "credentialId", provider, model, "workflowId", "createdAt", "updatedAt", "agentId", "agentName", tools) FROM stdin;
\.


--
-- Data for Name: credentials_entity; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.credentials_entity (name, data, type, "createdAt", "updatedAt", id, "isManaged") FROM stdin;
OpenAi account 2	U2FsdGVkX1+V+ZoI9tA6G8tHNt6B+C60PDthCVxVTVQzcgr9o6uu6uI45XcX1RIxms8bzit1fZn3uSSrnjJR9KqJGFtXlcsAOl4G2BHGVnZE33NyNKXTdWbvOTbh1r1wAm4/hU/u3UWXPfFANjdWqs1h49gZNu0Zb2YtEUFcmr3kHxixdq3sUDE2P5wgyrXYkuZfthXPhfp/BuYIvOqLXKFgMWXYZRvGyVJzxVB8FKEziQvDnbJBPIN/vs5To5f3F07moGKMtmLApMDC51xuwS9WqlDiKQ3BMwMUjJA5D4A=	openAiApi	2025-12-02 18:43:17.698+00	2025-12-02 18:43:17.693+00	Yz9zqfekGs09gP8P	f
OpenAi account	U2FsdGVkX18WUUyiFsAso3su3wLq6a0jksPFnHf0aHnZgVhH6jmiDRLVfXnud+5da22KBDZWB0F+YLY24jkcRKbEfWRU4ekDBxnlxaGih0ulELCJAJk/NnFAB4IBtUezFIkLTPTme2XRj3avA56vtuZqnAKfaBPhlP+o4mI2/F8qG9sad1b5JCH3IWKTptN9NlCxfcBnY+93L4V/8YIY+ZkYlGdXBZF7UtOPj5k9TUkKMQfWpxpzNJUBgsumLHveiEhYB0eJNfFTDt9GHOkf5KNeLvC5gG1bvP8xjdl8IuE=	openAiApi	2025-12-02 18:31:03.163+00	2025-12-02 19:47:04.704+00	7D2TxcTctnD2ZM7F	f
Postgres account	U2FsdGVkX1/yXLXLo4kzKuJaP02Ph8PkNhh6og2QA2Rx95eC/jp3RdZEx6YL2OfC+4/Mb3+CihKHViLVvSRHU99yQpqNrThUNiE6CI0DUXyYJPUYn75begTl3Ap9nsls	postgres	2025-12-03 18:19:19.33+00	2025-12-03 18:59:20.988+00	MheAYMt9zGq5h1to	f
\.


--
-- Data for Name: data_table; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.data_table (id, name, "projectId", "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: data_table_column; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.data_table_column (id, name, type, index, "dataTableId", "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: event_destinations; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.event_destinations (id, destination, "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: execution_annotation_tags; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.execution_annotation_tags ("annotationId", "tagId") FROM stdin;
\.


--
-- Data for Name: execution_annotations; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.execution_annotations (id, "executionId", vote, note, "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: execution_data; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.execution_data ("executionId", "workflowData", data) FROM stdin;
1	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764686337988,"source":"14"},["15"],"manual",{"startTime":1764686337994,"executionIndex":0,"source":"16","hints":"17","executionTime":5,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","sec-ch-ua":"33","sec-ch-ua-mobile":"34","sec-ch-ua-platform":"35","upgrade-insecure-requests":"36","user-agent":"37","accept":"38","sec-gpc":"36","accept-language":"39","sec-fetch-site":"40","sec-fetch-mode":"41","sec-fetch-user":"42","sec-fetch-dest":"43","accept-encoding":"44","cookie":"45"},{},{},{},"http://0.0.0.0:5678/webhook-test/ever","test","localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","none","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%2240fe84565c732e698f7c85b39d8b077ee1f15faa7fb3e1a1e75713949f161f75%23df349dde-8b62-4613-8ad1-477aef8e7f25%22%2C%22%24sesid%22%3A%5B1764678487503%2C%22019adf08-7457-70a6-90b8-a9203e973c77%22%2C1764678464592%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2Buhn3R0f90cyOFW61FX7jSj4I2SYM11jzNXdO5%2B39u6k95%2BH45sgb3uWRDqLb6m1M1kHis6cKRDg%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2BSP%2BFCVDSsmI0RVzSoHHi4DC2Xh%2Bed0eWrKGcKS7%2Fn2yBT%2FoCZTPLmW4EqvNduvu29GH%2FjgPcazbtmxSTGp%2FJCeUx5Gj1W5nrJVf8hoRevOOQr%2F9zboUMUA%2BTVYTWtE%2F4vOl%2BltAVr18EflW5w9bbcDoINgDkc3Kw%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX1%2FGw4dkUGNHqKkTms1wy2CUEprb6pw%2B9D8eq%2BWvUJsXE%2F9J0TvT6p4TytF1M%2FiMmRB8cuYJx7uzSEgQkZaPVoawe2kWQrxCu2Eu2Alfh2AzeEr%2FDnib3A5e7epJzo8g6Kw%2FAas0LUHuxWgVPUG5Bt5wXiKZd8Lk42Y%3D; rl_session=RudderEncrypt%3AU2FsdGVkX18%2BYpJvOA1%2Ba0AA615bSXDrASCw6B5641G%2F4AQ6fplRTL1wxws0%2FylrFxEhXEf%2BhVlw3y827VAQByVQKi3AXBreIu4xbnGstT2IPEUba1S54FZsQqbLBA0ucF63r0HbqaR9GSi6nLWqfg%3D%3D"]
2	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764686744960,"source":"14"},["15"],"manual",{"startTime":1764686744962,"executionIndex":0,"source":"16","hints":"17","executionTime":3,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://0.0.0.0:5678/webhook-test/ever","test","localhost:5678","keep-alive","235","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryv8D9QCA5XXnQVqsB","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","n","pabò"]
3	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764686818333,"source":"14"},["15"],"manual",{"startTime":1764686818334,"executionIndex":0,"source":"16","hints":"17","executionTime":2,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://0.0.0.0:5678/webhook-test/ever","test","localhost:5678","keep-alive","240","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarymsCpircGxK0hQIRx","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","uauaua","pabò"]
4	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764686848587,"source":"14"},["15"],"manual",{"startTime":1764686848588,"executionIndex":0,"source":"16","hints":"17","executionTime":1,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://0.0.0.0:5678/webhook-test/ever","test","localhost:5678","keep-alive","239","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryctDeLX4fDWWMnYBW","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","pablo","pabò"]
5	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764689183524,"source":"14"},["15"],"manual",{"startTime":1764689183544,"executionIndex":0,"source":"16","hints":"17","executionTime":4,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryOMFpByf6OtSoMjB7","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","e","yo"]
6	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"32cfa4bb-498f-4a0e-9639-d0f13c1ce98e","name":"AI Agent"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764699256041,"source":"14"},["15"],"manual",{"startTime":1764699256048,"executionIndex":0,"source":"16","hints":"17","executionTime":1,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","233","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarypge8dTaQ330HEDEb","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola",""]
7	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"}],"connections":{"Webhook":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764699298838,"source":"14"},["15"],"manual",{"startTime":1764699298838,"executionIndex":0,"source":"16","hints":"17","executionTime":1,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","233","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryCdYVvATSB9pEIvYB","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola",""]
8	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={\\n{{ $json.body.message }},\\n{{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"7b31b058-b36d-4223-adb0-8c89d34f01a5","name":"AI Agent"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4"],{"level":"16","tags":"17","timestamp":1764699351437,"context":"18","functionality":"19","name":"20","node":"21","messages":"22","message":"23","stack":"24"},{"Webhook":"25","AI Agent":"26"},{},{},["27"],{},{},{},{"version":1,"establishedAt":1764699351367,"source":"28"},"Webhook","warning",{},{},"regular","NodeOperationError",{"parameters":"29","type":"30","typeVersion":3,"position":"31","id":"32","name":"4"},[],"A Chat Model sub-node must be connected and enabled","NodeOperationError: A Chat Model sub-node must be connected and enabled\\n    at validateInputConfiguration (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/utils/get-input-connection-data.ts:231:11)\\n    at ExecuteContext.getInputConnectionData (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/utils/get-input-connection-data.ts:271:2)\\n    at ExecuteContext.getInputConnectionData (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/execute-context.ts:180:39)\\n    at getChatModel (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/common.ts:281:36)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:381:22)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27",["33"],["34"],{"node":"35","data":"36","source":"37"},"manual",{"aiAgentStarterCallout":"38","promptType":"39","text":"40","hasOutputParser":false,"needsFallback":false,"options":"41"},"@n8n/n8n-nodes-langchain.agent",[208,0],"7b31b058-b36d-4223-adb0-8c89d34f01a5",{"startTime":1764699298838,"executionIndex":0,"source":"42","hints":"43","executionTime":1,"executionStatus":"44","data":"45"},{"startTime":1764699351368,"executionIndex":1,"source":"46","hints":"47","executionTime":140,"executionStatus":"48","error":"49"},{"parameters":"50","type":"30","typeVersion":3,"position":"51","id":"32","name":"4"},{"main":"52"},{"main":"46"},"","define","={\\n{{ $json.body.message }},\\n{{ $json.body.user }}\\n}",{},[],[],"success",{"main":"53"},["54"],[],"error",{"level":"16","tags":"17","timestamp":1764699351437,"context":"18","functionality":"19","name":"20","node":"21","messages":"22","message":"23","stack":"24"},{"aiAgentStarterCallout":"38","promptType":"39","text":"40","hasOutputParser":false,"needsFallback":false,"options":"55"},[208,0],["56"],["57"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["58"],["59"],{"json":"60","pairedItem":"61"},{"json":"60","pairedItem":"62"},{"headers":"63","params":"64","query":"65","body":"66","webhookUrl":"67","executionMode":"68"},{"item":0},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"38"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","233","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryCdYVvATSB9pEIvYB","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola"]
9	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"}],"connections":{"Webhook":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764699543027,"source":"14"},["15"],"manual",{"startTime":1764699543040,"executionIndex":0,"source":"16","hints":"17","executionTime":5,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa",""]
10	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700284877,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700282445,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700284236,"executionTime":639,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700282448,"executionIndex":1,"source":"59","hints":"60","executionTime":2431,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700284873,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700284877,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":11,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: {\\"message\\":\\"opa\\",\\"user\\":\\"\\"}",{"lc":1,"type":"114","id":"115"},"gpt-4.1-mini",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/v1",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122","name":"123","schema":"124"},"json_schema","my_schema",{"type":"125","properties":"126","additionalProperties":false,"required":"127"},"object",{"message":"128"},["129"],{"type":"130"},"message","string"]
23	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body.message }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","lastNodeExecuted":"4","error":"6","pinData":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Webhook",{"Webhook":"14"},{"message":"15","stack":"16"},{},{},["17"],{},{},{},{"version":1,"establishedAt":1764701335384,"source":"18"},["19"],"No Respond to Webhook node found in the workflow","WorkflowConfigurationError: No Respond to Webhook node found in the workflow\\n    at checkResponseModeConfiguration (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Webhook/utils.ts:159:9)\\n    at Webhook.webhook (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Webhook/Webhook.node.ts:212:34)\\n    at WebhookService.runWebhook (/usr/local/lib/node_modules/n8n/src/webhooks/webhook.service.ts:385:21)\\n    at Object.executeWebhook (/usr/local/lib/node_modules/n8n/src/webhooks/webhook-helpers.ts:458:60)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at /usr/local/lib/node_modules/n8n/src/webhooks/test-webhooks.ts:126:25",{"node":"20","data":"21","source":null},"manual",{"startTime":1764701335385,"executionIndex":0,"source":"22","hints":"23","executionTime":1,"executionStatus":"24","error":"25"},{"parameters":"26","type":"27","typeVersion":2.1,"position":"28","id":"29","name":"4","webhookId":"30"},{"main":"31"},[],[],"error",{"message":"15","stack":"16"},{"multipleMethods":false,"httpMethod":"32","path":"33","authentication":"34","responseMode":"35","webhookNotice":"36","options":"37"},"n8n-nodes-base.webhook",[0,0],"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","3beefed2-81a6-4097-a2d6-93ee50a2a862",["38"],"POST","ever","none","responseNode","",{"allowedOrigins":"39"},["40"],"*",{"json":"41","pairedItem":"42"},{},{"item":0}]
24	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body.message }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"firstIncomingItem","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764701410100,"source":"14"},["15"],"manual",{"startTime":1764701410100,"executionIndex":0,"source":"16","hints":"17","executionTime":1,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","235","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary22g4bcJH3ODSTyHS","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","jajaaa",""]
11	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"o4-mini","mode":"list","cachedResultName":"o4-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700328423,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700327293,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700327311,"executionTime":1111,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700327294,"executionIndex":1,"source":"59","hints":"60","executionTime":1129,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700328421,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700328423,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":11,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: {\\"message\\":\\"opa\\",\\"user\\":\\"\\"}",{"lc":1,"type":"114","id":"115"},"o4-mini",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/v1",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122","name":"123","schema":"124"},"json_schema","my_schema",{"type":"125","properties":"126","additionalProperties":false,"required":"127"},"object",{"message":"128"},["129"],{"type":"130"},"message","string"]
12	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"o4-mini","mode":"list","cachedResultName":"o4-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700417833,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700417309,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700417319,"executionTime":513,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700417310,"executionIndex":1,"source":"59","hints":"60","executionTime":523,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700417831,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700417833,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":11,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: {\\"message\\":\\"opa\\",\\"user\\":\\"\\"}",{"lc":1,"type":"114","id":"115"},"o4-mini",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/v1",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122","name":"123","schema":"124"},"json_schema","my_schema",{"type":"125","properties":"126","additionalProperties":false,"required":"127"},"object",{"message":"128"},["129"],{"type":"130"},"message","string"]
13	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"o4-mini","mode":"list","cachedResultName":"o4-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700445653,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700445039,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700445052,"executionTime":599,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700445042,"executionIndex":1,"source":"59","hints":"60","executionTime":611,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700445651,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700445653,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":11,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: {\\"message\\":\\"opa\\",\\"user\\":\\"\\"}",{"lc":1,"type":"114","id":"115"},"o4-mini",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/v1",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"json_object"]
14	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"o4-mini","mode":"list","cachedResultName":"o4-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700500488,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700499955,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700499964,"executionTime":523,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700499956,"executionIndex":1,"source":"59","hints":"60","executionTime":532,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700500486,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700500488,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":11,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: {\\"message\\":\\"opa\\",\\"user\\":\\"\\"}",{"lc":1,"type":"114","id":"115"},"o4-mini",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"json_object"]
15	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700688395,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700687283,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700687314,"executionTime":1076,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700687287,"executionIndex":1,"source":"59","hints":"60","executionTime":1116,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700688390,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700688395,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":11,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: {\\"message\\":\\"opa\\",\\"user\\":\\"\\"}",{"lc":1,"type":"114","id":"115"},"gpt-4.1-nano",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"json_object"]
16	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700718675,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700718119,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700718132,"executionTime":542,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700718122,"executionIndex":1,"source":"59","hints":"60","executionTime":553,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700718674,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700718675,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":11,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: {\\"message\\":\\"opa\\",\\"user\\":\\"\\"}",{"lc":1,"type":"114","id":"115"},"gpt-4.1-nano",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"json_object"]
17	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700765817,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700764462,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700764593,"executionTime":1223,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700764470,"executionIndex":1,"source":"59","hints":"60","executionTime":1347,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","=json\\n{{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700765815,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700765817,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":8,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: json\\n[object Object]",{"lc":1,"type":"114","id":"115"},"gpt-4.1-nano",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"json_object"]
18	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700883642,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700883035,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700883048,"executionTime":592,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700883036,"executionIndex":1,"source":"59","hints":"60","executionTime":606,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","=json\\n{{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700883640,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700883642,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":8,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: json\\n[object Object]",{"lc":1,"type":"114","id":"115"},"gpt-4.1-nano",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/v1/",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"json_object"]
19	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"text","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700891975,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764700891459,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764699543040,"executionIndex":0,"source":"49","hints":"50","executionTime":5,"executionStatus":"51","data":"52"},{"startTime":1764700891469,"executionTime":506,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764700891460,"executionIndex":1,"source":"59","hints":"60","executionTime":516,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","=json\\n{{ $json.body }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764700891974,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764700891975,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":8,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","Human: json\\n[object Object]",{"lc":1,"type":"114","id":"115"},"gpt-4.1-nano",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/v1/",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"text"]
20	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"={{ $json.body }}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764700947862,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"AI Agent":"31"},{},{},{"version":1,"establishedAt":1764700947854,"source":"32"},"Webhook","OpenAI Chat Model","warning",{},"Failed to parse schema",{"itemIndex":0},"configuration-node","NodeOperationError",{"parameters":"33","type":"34","typeVersion":1.3,"position":"35","id":"36","name":"16","credentials":"37"},[],"Error in sub-node OpenAI Chat Model","NodeOperationError: Error in sub-node OpenAI Chat Model\\n    at ExecuteContext.getInputConnectionData (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/utils/get-input-connection-data.ts:376:11)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.getInputConnectionData (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/execute-context.ts:180:10)\\n    at getChatModel (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/common.ts:281:26)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:381:16)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"notice":"45","model":"46","responsesApiEnabled":true,"builtInTools":"47","options":"48"},"@n8n/n8n-nodes-langchain.lmChatOpenAi",[80,208],"9fe20951-31df-4e8f-82ca-e01008c5a8cb",{"openAiApi":"49"},{"startTime":1764699543040,"executionIndex":0,"source":"50","hints":"51","executionTime":5,"executionStatus":"52","data":"53"},{"startTime":1764700947861,"executionTime":1,"executionIndex":2,"executionStatus":"54","source":"55","error":"56"},{"startTime":1764700947854,"executionIndex":1,"source":"57","hints":"58","executionTime":9,"metadata":"59","executionStatus":"54","error":"60"},{"parameters":"61","type":"62","typeVersion":3,"position":"63","id":"64","name":"4"},{"main":"65"},{"main":"57"},{"subRun":"66"},"",{"__rl":true,"value":"67","mode":"68","cachedResultName":"67"},{},{"textFormat":"69"},{"id":"70","name":"71"},[],[],"success",{"main":"72"},"error",["73"],{"message":"19","timestamp":1764700947861,"name":"22","context":"74"},["75"],[],{"subRun":"66"},{"level":"17","tags":"18","description":"19","timestamp":1764700947862,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"76","text":"77","hasOutputParser":false,"needsFallback":false,"options":"78"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db",["79"],["80"],"gpt-4.1-nano","list",{"textOptions":"81"},"7D2TxcTctnD2ZM7F","OpenAi account",["82"],{"previousNode":"4","previousNodeRun":0},{"itemIndex":0},{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},"define","=json\\n{{ $json.body }}",{},["83"],{"node":"16","runIndex":0},{"type":"84","verbosity":"85","name":"86","schema":"87","description":"45","strict":false},["88"],{"json":"89","pairedItem":"90"},"json_schema","medium","my_schema","={{ $json.body }}",{"json":"89","pairedItem":"91"},{"headers":"92","params":"93","query":"94","body":"95","webhookUrl":"96","executionMode":"97"},{"item":0},{"item":0},{"host":"98","connection":"99","content-length":"100","sec-ch-ua-platform":"101","user-agent":"102","accept":"103","sec-ch-ua":"104","content-type":"105","sec-ch-ua-mobile":"106","sec-gpc":"107","accept-language":"108","origin":"109","sec-fetch-site":"110","sec-fetch-mode":"111","sec-fetch-dest":"112","referer":"113","accept-encoding":"114"},{},{},{"message":"115","user":"45"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa"]
21	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"={{ $json.body }}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764701000496,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"AI Agent":"31"},{},{},{"version":1,"establishedAt":1764701000487,"source":"32"},"Webhook","OpenAI Chat Model","warning",{},"Failed to parse schema",{"itemIndex":0},"configuration-node","NodeOperationError",{"parameters":"33","type":"34","typeVersion":1.3,"position":"35","id":"36","name":"16","credentials":"37"},[],"Error in sub-node OpenAI Chat Model","NodeOperationError: Error in sub-node OpenAI Chat Model\\n    at ExecuteContext.getInputConnectionData (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/utils/get-input-connection-data.ts:376:11)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.getInputConnectionData (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/execute-context.ts:180:10)\\n    at getChatModel (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/common.ts:281:26)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:381:16)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"notice":"45","model":"46","responsesApiEnabled":true,"builtInTools":"47","options":"48"},"@n8n/n8n-nodes-langchain.lmChatOpenAi",[80,208],"9fe20951-31df-4e8f-82ca-e01008c5a8cb",{"openAiApi":"49"},{"startTime":1764699543040,"executionIndex":0,"source":"50","hints":"51","executionTime":5,"executionStatus":"52","data":"53"},{"startTime":1764701000494,"executionTime":1,"executionIndex":2,"executionStatus":"54","source":"55","error":"56"},{"startTime":1764701000488,"executionIndex":1,"source":"57","hints":"58","executionTime":9,"metadata":"59","executionStatus":"54","error":"60"},{"parameters":"61","type":"62","typeVersion":3,"position":"63","id":"64","name":"4"},{"main":"65"},{"main":"57"},{"subRun":"66"},"",{"__rl":true,"value":"67","mode":"68","cachedResultName":"67"},{},{"textFormat":"69"},{"id":"70","name":"71"},[],[],"success",{"main":"72"},"error",["73"],{"message":"19","timestamp":1764701000494,"name":"22","context":"74"},["75"],[],{"subRun":"66"},{"level":"17","tags":"18","description":"19","timestamp":1764701000496,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"76","text":"77","hasOutputParser":false,"needsFallback":false,"options":"78"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db",["79"],["80"],"gpt-4.1-nano","list",{"textOptions":"81"},"Yz9zqfekGs09gP8P","OpenAi account 2",["82"],{"previousNode":"4","previousNodeRun":0},{"itemIndex":0},{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},"define","=json\\n{{ $json.body }}",{},["83"],{"node":"16","runIndex":0},{"type":"84","verbosity":"85","name":"86","schema":"87","description":"45","strict":false},["88"],{"json":"89","pairedItem":"90"},"json_schema","medium","my_schema","={{ $json.body }}",{"json":"89","pairedItem":"91"},{"headers":"92","params":"93","query":"94","body":"95","webhookUrl":"96","executionMode":"97"},{"item":0},{"item":0},{"host":"98","connection":"99","content-length":"100","sec-ch-ua-platform":"101","user-agent":"102","accept":"103","sec-ch-ua":"104","content-type":"105","sec-ch-ua-mobile":"106","sec-gpc":"107","accept-language":"108","origin":"109","sec-fetch-site":"110","sec-fetch-mode":"111","sec-fetch-dest":"112","referer":"113","accept-encoding":"114"},{},{},{"message":"115","user":"45"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa"]
22	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"onReceived","contentTypeNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764701017685,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764699543040,"executionIndex":0,"source":"25","hints":"26","executionTime":5,"executionStatus":"27","data":"28"},{"startTime":1764701017690,"executionTime":2862,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764701017686,"executionIndex":1,"source":"33","hints":"34","executionTime":2873,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsageEstimate":"65"},{"messages":"66","estimatedTokens":8,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":8,"promptTokens":8,"totalTokens":16},["89"],{"openai_api_key":"90","model":"91","timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93","use_responses_api":true},"{\\"error\\":\\"Invalid input format.\\"}","localhost:5678","keep-alive","232","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxAF9aXZmF3xcy2Fq","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","opa","",["94"],"Human: json\\n[object Object]",{"lc":1,"type":"95","id":"96"},"gpt-4o-mini",{"baseURL":"97","fetchOptions":"98"},{"text":"99"},["100"],"secret",["101"],"https://api.openai.com/v1",{},{"verbosity":"102","format":"103"},{"text":"68"},"OPENAI_API_KEY","medium",{"type":"104"},"json_object"]
25	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={{ $json.body.message }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"firstIncomingItem","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764701422366,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764701421586,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"Response input messages must contain the word 'json' in some form to use 'text.format' of type 'json_object'.",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 Response input messages must contain the word 'json' in some form to use 'text.format' of type 'json_object'.",{"startTime":1764701410100,"executionIndex":0,"source":"49","hints":"50","executionTime":1,"executionStatus":"51","data":"52"},{"startTime":1764701421599,"executionTime":766,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764701421587,"executionIndex":1,"source":"59","hints":"60","executionTime":779,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={{ $json.body.message }}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764701422365,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764701422366,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":4,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","235","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary22g4bcJH3ODSTyHS","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","jajaaa","Human: jajaaa",{"lc":1,"type":"114","id":"115"},"gpt-4o-mini",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.openai.com/v1",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"json_object"]
26	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"={\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"firstIncomingItem","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764701941863,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764701941460,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"Response input messages must contain the word 'json' in some form to use 'text.format' of type 'json_object'.",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 Response input messages must contain the word 'json' in some form to use 'text.format' of type 'json_object'.",{"startTime":1764701410100,"executionIndex":0,"source":"49","hints":"50","executionTime":1,"executionStatus":"51","data":"52"},{"startTime":1764701941494,"executionTime":368,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764701941462,"executionIndex":1,"source":"59","hints":"60","executionTime":401,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","={\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764701941861,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764701941863,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":13,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","235","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary22g4bcJH3ODSTyHS","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","jajaaa","Human: {\\n\\"response\\": jajaaa,\\n\\"user\\": \\n}",{"lc":1,"type":"114","id":"115"},"gpt-4o-mini",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.openai.com/v1",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122"},"json_object"]
27	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"firstIncomingItem","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764701977542,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764701410100,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764701977559,"executionTime":2948,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764701977543,"executionIndex":1,"source":"33","hints":"34","executionTime":2966,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsageEstimate":"65"},{"messages":"66","estimatedTokens":15,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":17,"promptTokens":15,"totalTokens":32},["89"],{"openai_api_key":"90","model":"91","timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93","use_responses_api":true},"{\\n    \\"response\\": \\"jajaaa\\",\\n    \\"user\\": null\\n}","localhost:5678","keep-alive","235","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary22g4bcJH3ODSTyHS","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","jajaaa","",["94"],"Human: json:\\n{\\n\\"response\\": jajaaa,\\n\\"user\\": \\n}",{"lc":1,"type":"95","id":"96"},"gpt-4o-mini",{"baseURL":"97","fetchOptions":"98"},{"text":"99"},["100"],"secret",["101"],"https://api.openai.com/v1",{},{"verbosity":"102","format":"103"},{"text":"68"},"OPENAI_API_KEY","medium",{"type":"104"},"json_object"]
28	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"firstIncomingItem","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764702012290,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764702012291,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764702012304,"executionTime":3202,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764702012296,"executionIndex":1,"source":"32","hints":"33","executionTime":3211,"executionStatus":"26","data":"34"},{"startTime":1764702015508,"executionIndex":3,"source":"35","hints":"36","executionTime":16,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsageEstimate":"75"},{"messages":"76","estimatedTokens":17,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":26,"promptTokens":17,"totalTokens":43},["99"],{"openai_api_key":"100","model":"101","timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103","use_responses_api":true},"{\\"response\\": \\"¿Por qué los pájaros no usan Facebook? ¡Porque ya tienen Twitter!\\", \\"user\\": \\"\\"}","localhost:5678","keep-alive","243","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary6jifigEhTt2vsqNw","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime un chiste","",["104"],"Human: json:\\n{\\n\\"response\\": dime un chiste,\\n\\"user\\": \\n}",{"lc":1,"type":"105","id":"106"},"gpt-4o-mini",{"baseURL":"107","fetchOptions":"108"},{"text":"109"},["110"],"secret",["111"],"https://api.openai.com/v1",{},{"verbosity":"112","format":"113"},{"text":"78"},"OPENAI_API_KEY","medium",{"type":"114"},"json_object"]
29	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764702078821,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764702012291,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764702078828,"executionTime":2634,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764702078821,"executionIndex":1,"source":"33","hints":"34","executionTime":2643,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsageEstimate":"65"},{"messages":"66","estimatedTokens":17,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":34,"promptTokens":17,"totalTokens":51},["89"],{"openai_api_key":"90","model":"91","timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93","use_responses_api":true},"{\\n  \\"response\\": \\"Claro, aquí va uno: ¿Por qué los pájaros no usan Facebook? Porque ya tienen Twitter.\\",\\n  \\"user\\": \\"\\"\\n}","localhost:5678","keep-alive","243","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary6jifigEhTt2vsqNw","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime un chiste","",["94"],"Human: json:\\n{\\n\\"response\\": dime un chiste,\\n\\"user\\": \\n}",{"lc":1,"type":"95","id":"96"},"gpt-4o-mini",{"baseURL":"97","fetchOptions":"98"},{"text":"99"},["100"],"secret",["101"],"https://api.openai.com/v1",{},{"verbosity":"102","format":"103"},{"text":"68"},"OPENAI_API_KEY","medium",{"type":"104"},"json_object"]
30	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764702415745,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764702012291,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764702415830,"executionTime":2606,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764702415748,"executionIndex":1,"source":"33","hints":"34","executionTime":2694,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsageEstimate":"65"},{"messages":"66","estimatedTokens":17,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":23,"promptTokens":17,"totalTokens":40},["89"],{"openai_api_key":"90","model":"91","timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93","use_responses_api":true},"{\\"response\\": \\"¿Qué le dijo una pared a la otra pared? ¡Nos encontramos en la esquina!\\"}","localhost:5678","keep-alive","243","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary6jifigEhTt2vsqNw","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime un chiste","",["94"],"Human: json:\\n{\\n\\"response\\": dime un chiste,\\n\\"user\\": \\n}",{"lc":1,"type":"95","id":"96"},"gpt-4o-mini",{"baseURL":"97","fetchOptions":"98"},{"text":"99"},["100"],"secret",["101"],"https://api.openai.com/v1",{},{"verbosity":"102","format":"103"},{"text":"68"},"OPENAI_API_KEY","medium",{"type":"104"},"json_object"]
31	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_object","verbosity":"medium"}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764702446333,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764702446334,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764702446365,"executionTime":4562,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764702446336,"executionIndex":1,"source":"32","hints":"33","executionTime":4593,"executionStatus":"26","data":"34"},{"startTime":1764702450930,"executionIndex":3,"source":"35","hints":"36","executionTime":16,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsageEstimate":"75"},{"messages":"76","estimatedTokens":16,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":25,"promptTokens":16,"totalTokens":41},["99"],{"openai_api_key":"100","model":"101","timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103","use_responses_api":true},"{\\n  \\"response\\": \\"¿Qué te parece el nombre 'Sofía'?\\",\\n  \\"user\\": null\\n}","localhost:5678","keep-alive","243","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarysTM3JYE8wRGSryJP","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime un nombre","",["104"],"Human: json:\\n{\\n\\"response\\": dime un nombre,\\n\\"user\\": \\n}",{"lc":1,"type":"105","id":"106"},"gpt-4o-mini",{"baseURL":"107","fetchOptions":"108"},{"text":"109"},["110"],"secret",["111"],"https://api.openai.com/v1",{},{"verbosity":"112","format":"113"},{"text":"78"},"OPENAI_API_KEY","medium",{"type":"114"},"json_object"]
32	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764702511886,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764702446334,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764702511899,"executionTime":2582,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764702511887,"executionIndex":1,"source":"33","hints":"34","executionTime":2596,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsageEstimate":"65"},{"messages":"66","estimatedTokens":16,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":13,"promptTokens":16,"totalTokens":29},["89"],{"openai_api_key":"90","model":"91","timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93","use_responses_api":true},"{\\"message\\":\\"¿Te gustaría un nombre masculino o femenino?\\"}","localhost:5678","keep-alive","243","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarysTM3JYE8wRGSryJP","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime un nombre","",["94"],"Human: json:\\n{\\n\\"response\\": dime un nombre,\\n\\"user\\": \\n}",{"lc":1,"type":"95","id":"96"},"gpt-4o-mini",{"baseURL":"97","fetchOptions":"98"},{"text":"99"},["100"],"secret",["101"],"https://api.openai.com/v1",{},{"verbosity":"102","format":"103"},{"text":"68"},"OPENAI_API_KEY","medium",{"type":"104","name":"105","schema":"106"},"json_schema","my_schema",{"type":"107","properties":"108","additionalProperties":false,"required":"109"},"object",{"message":"110"},["111"],{"type":"112"},"message","string"]
33	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764702554561,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764702554565,"executionIndex":0,"source":"24","hints":"25","executionTime":3,"executionStatus":"26","data":"27"},{"startTime":1764702554580,"executionTime":3050,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764702554570,"executionIndex":1,"source":"32","hints":"33","executionTime":3064,"executionStatus":"26","data":"34"},{"startTime":1764702557636,"executionIndex":3,"source":"35","hints":"36","executionTime":12,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsageEstimate":"75"},{"messages":"76","estimatedTokens":16,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":27,"promptTokens":16,"totalTokens":43},["99"],{"openai_api_key":"100","model":"101","timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103","use_responses_api":true},"{\\"message\\":\\"¿Qué número te gustaría que dijera? Puedo elegir uno al azar o tú puedes decirme un rango.\\"}","localhost:5678","keep-alive","243","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryR2OS4T6wueNr91a2","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime un numero","",["104"],"Human: json:\\n{\\n\\"response\\": dime un numero,\\n\\"user\\": \\n}",{"lc":1,"type":"105","id":"106"},"gpt-4o-mini",{"baseURL":"107","fetchOptions":"108"},{"text":"109"},["110"],"secret",["111"],"https://api.openai.com/v1",{},{"verbosity":"112","format":"113"},{"text":"78"},"OPENAI_API_KEY","medium",{"type":"114","name":"115","schema":"116"},"json_schema","my_schema",{"type":"117","properties":"118","additionalProperties":false,"required":"119"},"object",{"message":"120"},["121"],{"type":"122"},"message","string"]
34	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"error":"4","runData":"5","pinData":"6","lastNodeExecuted":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},{"level":"14","tags":"15","description":"16","timestamp":1764702707246,"context":"17","functionality":"18","name":"19","node":"20","messages":"21","message":"22","stack":"23"},{"Webhook":"24","OpenAI Chat Model":"25","AI Agent":"26"},{},"AI Agent",{},["27"],{"OpenAI Chat Model":"28"},{},{},{"version":1,"establishedAt":1764702706145,"source":"29"},"warning",{"reWrapped":true},"{'error': '/responses: Invalid model name passed in model=gpt-4o-mini. Call `/v1/models` to view available models for your key.'}",{},"regular","NodeOperationError",{"parameters":"30","type":"31","typeVersion":3,"position":"32","id":"33","name":"7"},["34"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["35"],["36"],["37"],{"node":"38","data":"39","source":"40"},["41"],"manual",{"aiAgentStarterCallout":"42","promptType":"43","text":"44","hasOutputParser":false,"needsFallback":false,"options":"45"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 {'error': '/responses: Invalid model name passed in model=gpt-4o-mini. Call `/v1/models` to view available models for your key.'}",{"startTime":1764702706146,"executionIndex":0,"source":"46","hints":"47","executionTime":1,"executionStatus":"48","data":"49"},{"startTime":1764702706156,"executionTime":1089,"executionIndex":2,"executionStatus":"50","source":"51","data":"52","inputOverride":"53","metadata":"54","error":"55"},{"startTime":1764702706147,"executionIndex":1,"source":"56","hints":"57","executionTime":1103,"executionStatus":"50","error":"58"},{"parameters":"59","type":"31","typeVersion":3,"position":"60","id":"33","name":"7"},{"main":"61","ai_languageModel":"62"},{"main":"56"},{"subRun":"63"},"","define","=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}",{},[],[],"success",{"main":"64"},"error",["65"],{"ai_languageModel":"62"},{"ai_languageModel":"62"},{"subRun":"63"},{"message":"22","timestamp":1764702707242,"name":"66","description":"16","context":"17"},["67"],[],{"level":"14","tags":"15","description":"16","timestamp":1764702707246,"context":"17","functionality":"18","name":"19","node":"20","messages":"21","message":"22","stack":"23"},{"aiAgentStarterCallout":"42","promptType":"43","text":"44","hasOutputParser":false,"needsFallback":false,"options":"68"},[208,0],["69"],["70"],["71"],["72"],{"previousNode":"7","previousNodeRun":0},"NodeApiError",{"previousNode":"73"},{},["74"],["75"],{"node":"76","runIndex":0},["77"],"Webhook",{"json":"78","pairedItem":"79"},{"json":"80"},"OpenAI Chat Model",{"json":"78","pairedItem":"81"},{"headers":"82","params":"83","query":"84","body":"85","webhookUrl":"86","executionMode":"87"},{"item":0},{"messages":"88","estimatedTokens":18,"options":"89"},{"item":0},{"host":"90","connection":"91","content-length":"92","sec-ch-ua-platform":"93","user-agent":"94","accept":"95","sec-ch-ua":"96","content-type":"97","sec-ch-ua-mobile":"98","sec-gpc":"99","accept-language":"100","origin":"101","sec-fetch-site":"102","sec-fetch-mode":"103","sec-fetch-dest":"104","referer":"105","accept-encoding":"106"},{},{},{"message":"107","user":"42"},"http://localhost:5678/webhook-test/ever","test",["108"],{"openai_api_key":"109","model":"110","timeout":60000,"max_retries":2,"configuration":"111","model_kwargs":"112","use_responses_api":true},"localhost:5678","keep-alive","253","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryOR7BsGTK7Ls340xz","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomdas?","Human: json:\\n{\\n\\"response\\": que deporte me recomdas?,\\n\\"user\\": \\n}",{"lc":1,"type":"113","id":"114"},"gpt-4o-mini",{"baseURL":"115","fetchOptions":"116"},{"text":"117"},"secret",["118"],"https://api.mammouth.ai/v1/",{},{"verbosity":"119","format":"120"},"OPENAI_API_KEY","medium",{"type":"121","name":"122","schema":"123"},"json_schema","my_schema",{"type":"124","properties":"125","additionalProperties":false,"required":"126"},"object",{"message":"127"},["128"],{"type":"129"},"message","string"]
35	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764702741666,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764702741039,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764702706146,"executionIndex":0,"source":"49","hints":"50","executionTime":1,"executionStatus":"51","data":"52"},{"startTime":1764702741047,"executionTime":618,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764702741040,"executionIndex":1,"source":"59","hints":"60","executionTime":627,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764702741664,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764702741666,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":18,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","253","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryOR7BsGTK7Ls340xz","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomdas?","Human: json:\\n{\\n\\"response\\": que deporte me recomdas?,\\n\\"user\\": \\n}",{"lc":1,"type":"114","id":"115"},"gpt-4.1-mini",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/v1/",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122","name":"123","schema":"124"},"json_schema","my_schema",{"type":"125","properties":"126","additionalProperties":false,"required":"127"},"object",{"message":"128"},["129"],{"type":"130"},"message","string"]
36	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"claude-3-5-haiku-20241022","mode":"list","cachedResultName":"claude-3-5-haiku-20241022"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","timestamp":1764702922500,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","message":"24","stack":"25"},{"Webhook":"26","OpenAI Chat Model":"27","AI Agent":"28"},{},{},["29"],{"OpenAI Chat Model":"30"},{},{},{"version":1,"establishedAt":1764702903410,"source":"31"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},{},"regular","NodeOperationError",{"parameters":"32","type":"33","typeVersion":3,"position":"34","id":"35","name":"4"},["24"],"Unexpected token 'P', \\"Parece que\\"... is not valid JSON","NodeOperationError: Unexpected token 'P', \\"Parece que\\"... is not valid JSON\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["36"],["37"],["38"],{"node":"39","data":"40","source":"41"},["42"],"manual",{"aiAgentStarterCallout":"43","promptType":"44","text":"45","hasOutputParser":false,"needsFallback":false,"options":"46"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db",{"startTime":1764702706146,"executionIndex":0,"source":"47","hints":"48","executionTime":1,"executionStatus":"49","data":"50"},{"startTime":1764702903423,"executionTime":19075,"executionIndex":2,"executionStatus":"51","source":"52","data":"53","inputOverride":"54","metadata":"55","error":"56"},{"startTime":1764702903411,"executionIndex":1,"source":"57","hints":"58","executionTime":19090,"executionStatus":"51","error":"59"},{"parameters":"60","type":"33","typeVersion":3,"position":"61","id":"35","name":"4"},{"main":"62","ai_languageModel":"63"},{"main":"57"},{"subRun":"64"},"","define","=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}",{},[],[],"success",{"main":"65"},"error",["66"],{"ai_languageModel":"63"},{"ai_languageModel":"63"},{"subRun":"64"},{"message":"24","timestamp":1764702922498,"name":"67","context":"19"},["68"],[],{"level":"17","tags":"18","timestamp":1764702922500,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","message":"24","stack":"25"},{"aiAgentStarterCallout":"43","promptType":"44","text":"45","hasOutputParser":false,"needsFallback":false,"options":"69"},[208,0],["70"],["71"],["72"],["73"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["74"],["75"],{"node":"16","runIndex":0},["76"],{"json":"77","pairedItem":"78"},{"json":"79"},{"json":"77","pairedItem":"80"},{"headers":"81","params":"82","query":"83","body":"84","webhookUrl":"85","executionMode":"86"},{"item":0},{"messages":"87","estimatedTokens":18,"options":"88"},{"item":0},{"host":"89","connection":"90","content-length":"91","sec-ch-ua-platform":"92","user-agent":"93","accept":"94","sec-ch-ua":"95","content-type":"96","sec-ch-ua-mobile":"97","sec-gpc":"98","accept-language":"99","origin":"100","sec-fetch-site":"101","sec-fetch-mode":"102","sec-fetch-dest":"103","referer":"104","accept-encoding":"105"},{},{},{"message":"106","user":"43"},"http://localhost:5678/webhook-test/ever","test",["107"],{"openai_api_key":"108","model":"109","timeout":60000,"max_retries":2,"configuration":"110","model_kwargs":"111","use_responses_api":true},"localhost:5678","keep-alive","253","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryOR7BsGTK7Ls340xz","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomdas?","Human: json:\\n{\\n\\"response\\": que deporte me recomdas?,\\n\\"user\\": \\n}",{"lc":1,"type":"112","id":"113"},"claude-3-5-haiku-20241022",{"baseURL":"114","fetchOptions":"115"},{"text":"116"},"secret",["117"],"https://api.mammouth.ai/v1/",{},{"verbosity":"118","format":"119"},"OPENAI_API_KEY","medium",{"type":"120","name":"121","schema":"122"},"json_schema","my_schema",{"type":"123","properties":"124","additionalProperties":false,"required":"125"},"object",{"message":"126"},["127"],{"type":"128"},"message","string"]
37	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764702945119,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764702944453,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764702706146,"executionIndex":0,"source":"49","hints":"50","executionTime":1,"executionStatus":"51","data":"52"},{"startTime":1764702944463,"executionTime":655,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764702944454,"executionIndex":1,"source":"59","hints":"60","executionTime":665,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764702945118,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764702945119,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":18,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","253","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryOR7BsGTK7Ls340xz","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomdas?","Human: json:\\n{\\n\\"response\\": que deporte me recomdas?,\\n\\"user\\": \\n}",{"lc":1,"type":"114","id":"115"},"gpt-4o",{"baseURL":"116","fetchOptions":"117"},{"text":"118"},"secret",["119"],"https://api.mammouth.ai/v1/",{},{"verbosity":"120","format":"121"},"OPENAI_API_KEY","medium",{"type":"122","name":"123","schema":"124"},"json_schema","my_schema",{"type":"125","properties":"126","additionalProperties":false,"required":"127"},"object",{"message":"128"},["129"],{"type":"130"},"message","string"]
38	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764702957162,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764702706146,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764702957175,"executionTime":2585,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764702957163,"executionIndex":1,"source":"33","hints":"34","executionTime":2599,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsageEstimate":"65"},{"messages":"66","estimatedTokens":18,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":50,"promptTokens":18,"totalTokens":68},["89"],{"openai_api_key":"90","model":"91","timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93","use_responses_api":true},"{\\"message\\":\\"Te recomendaría el ciclismo. Es una excelente opción para mantenerte en forma, puedes hacerlo al aire libre o en interiores, y es adaptable a diferentes niveles de habilidad. Además, es una forma divertida de explorar nuevos lugares.\\"}","localhost:5678","keep-alive","253","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryOR7BsGTK7Ls340xz","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomdas?","",["94"],"Human: json:\\n{\\n\\"response\\": que deporte me recomdas?,\\n\\"user\\": \\n}",{"lc":1,"type":"95","id":"96"},"gpt-4o-mini",{"baseURL":"97","fetchOptions":"98"},{"text":"99"},["100"],"secret",["101"],"https://api.openai.com/v1",{},{"verbosity":"102","format":"103"},{"text":"68"},"OPENAI_API_KEY","medium",{"type":"104","name":"105","schema":"106"},"json_schema","my_schema",{"type":"107","properties":"108","additionalProperties":false,"required":"109"},"object",{"message":"110"},["111"],{"type":"112"},"message","string"]
54	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=  Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Nombre: \\"Prepare Chat Input\\"\\n\\nconst message = $input.first().json.body.message || $input.item.json.message;\\nconst user = $input.first().json.body.user || $input.item.json.user || 'anonymous';\\n\\n// const body = $input.item.json.body || $input.item.json;\\n\\n\\n\\nif (!message || message.trim() === '') {\\n  throw new Error('Message is required');\\n}\\n\\n// ✅ Retorna datos limpios\\nreturn [{\\n  json: {\\n    chatInput: message.trim(),\\n    userId: user,\\n    timestamp: new Date().toISOString()\\n  }\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","Code in JavaScript":"14","OpenAI Chat Model":"15","AI Agent":"16","Respond to Webhook":"17"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"18"},{},{},{"version":1,"establishedAt":1764756644065,"source":"19"},["20"],["21"],["22"],["23"],["24"],["25"],"manual",{"startTime":1764756644081,"executionIndex":0,"source":"26","hints":"27","executionTime":9,"executionStatus":"28","data":"29"},{"startTime":1764756644098,"executionIndex":1,"source":"30","hints":"31","executionTime":97,"executionStatus":"28","data":"32"},{"startTime":1764756644400,"executionTime":1982,"executionIndex":3,"executionStatus":"28","source":"33","data":"34","inputOverride":"35","metadata":"36"},{"startTime":1764756644197,"executionIndex":2,"source":"37","hints":"38","executionTime":2197,"executionStatus":"28","data":"39"},{"startTime":1764756646396,"executionIndex":4,"source":"40","hints":"41","executionTime":13,"executionStatus":"28","data":"42"},{"subRun":"43"},[],[],"success",{"main":"44"},["45"],["46"],{"main":"47"},["48"],{"ai_languageModel":"49"},{"ai_languageModel":"50"},{"subRun":"43"},["51"],[],{"main":"52"},["53"],[],{"main":"54"},["55"],["56"],{"previousNode":"57"},{"message":"58","location":"59"},["60"],{"previousNode":"61","previousNodeRun":0},["62"],["63"],{"previousNode":"64"},["65"],{"previousNode":"61"},["66"],{"node":"67","runIndex":0},["68"],"Webhook","To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["69"],"AI Agent",["70"],["71"],"Code in JavaScript",["72"],["73"],"OpenAI Chat Model",{"json":"74","pairedItem":"75"},{"json":"76","pairedItem":"77"},{"json":"78"},{"json":"79"},{"json":"80","pairedItem":"81"},{"json":"80","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"chatInput":"89","userId":"90","timestamp":"91"},{"item":0},{"response":"92","tokenUsage":"93"},{"messages":"94","estimatedTokens":61,"options":"95"},{"output":"96"},{"item":0},{"item":0},{"host":"97","connection":"98","content-length":"99","sec-ch-ua-platform":"100","user-agent":"101","accept":"102","sec-ch-ua":"103","content-type":"104","sec-ch-ua-mobile":"105","sec-gpc":"106","accept-language":"107","origin":"108","sec-fetch-site":"109","sec-fetch-mode":"110","sec-fetch-dest":"111","referer":"112","accept-encoding":"113"},{},{},{"message":"89","user":"114"},"http://localhost:5678/webhook-test/ever","test","dime algo pala alegrarme el dia","anonymous","2025-12-03T10:10:44.191Z",{"generations":"115"},{"completionTokens":47,"promptTokens":66,"totalTokens":113},["116"],{"openai_api_key":"117","model":"118","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"119","model_kwargs":"120"},"{\\n  \\"chatInput\\": \\"dime algo pala alegrarme el dia\\",\\n  \\"userId\\": \\"anonymous\\",\\n  \\"timestamp\\": \\"2025-12-03T10:10:44.191Z\\"\\n}","localhost:5678","keep-alive","260","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","",["121"],"Human:   Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": dime algo pala alegrarme el dia,\\n\\"userId\\": anonymous,\\n\\"timestamp\\": 2025-12-03T10:10:44.191Z\\n}",{"lc":1,"type":"122","id":"123"},"gpt-4.1-nano",{"baseURL":"124","fetchOptions":"125","defaultHeaders":"126"},{"response_format":"127"},["128"],"secret",["129"],"https://api.mammouth.ai/v1",{},{"Authorization":"130"},{"type":"131"},{"text":"96","generationInfo":"132"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"133"},"stop"]
55	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=  Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}\\n\\n{{ $('Webhook').item.json.body }}\\n{{ $('Webhook').item.json.body[\\"message\\"] }}\\n{{ $('Webhook').item.json.body[\\"user\\"] }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n// 🔍 Log completo para debugging\\nconsole.log('\\\\n╔═══════════════════════════════════════╗');\\nconsole.log('║  🤖 Agent Output Analysis             ║');\\nconsole.log('╚═══════════════════════════════════════╝');\\nconsole.log(JSON.stringify(agentOutput, null, 2));\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\nconsole.log('\\\\n📨 Webhook Data:', {\\n  message: originalMessage,\\n  userId: userId\\n});\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// Remover code blocks de markdown\\ncleanedText = cleanedText.replace(/```json\\\\n?/gi, '');\\ncleanedText = cleanedText.replace(/```\\\\n?/g, '');\\n\\nconsole.log('🧹 Cleaned Text:', cleanedText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  console.log('✅ Parsed JSON:', parsedJson);\\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n  console.log('\\\\n💰 Cost Analysis:', costEstimate);\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\nconsole.log('\\\\n✅ Final Output:', JSON.stringify(output, null, 2));\\nconsole.log('═══════════════════════════════════════\\\\n');\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Code in JavaScript",["14","4"],{"Webhook":"15","Code in JavaScript":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764757624299,"source":"17"},"Webhook",["18"],["19"],"manual",{"startTime":1764756644081,"executionIndex":0,"source":"20","hints":"21","executionTime":9,"executionStatus":"22","data":"23"},{"startTime":1764757624319,"executionIndex":1,"source":"24","hints":"25","executionTime":317,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],["29"],{"main":"30"},["31"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"32","location":"33"},["34"],["35"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["36"],{"json":"37","pairedItem":"38"},{"json":"39","pairedItem":"40"},{"headers":"41","params":"42","query":"43","body":"44","webhookUrl":"45","executionMode":"46"},{"item":0},{"response":"47","userId":"48","timestamp":"49","conversationId":"50","sentiment":"51","confidence":null,"original":"52","usage":null},{"item":0},{"host":"53","connection":"54","content-length":"55","sec-ch-ua-platform":"56","user-agent":"57","accept":"58","sec-ch-ua":"59","content-type":"60","sec-ch-ua-mobile":"61","sec-gpc":"62","accept-language":"63","origin":"64","sec-fetch-site":"65","sec-fetch-mode":"66","sec-fetch-dest":"67","referer":"68","accept-encoding":"69"},{},{},{"message":"70","user":"71"},"http://localhost:5678/webhook-test/ever","test","{\\"headers\\":{\\"host\\":\\"localhost:5678\\",\\"connection\\":\\"keep-alive\\",\\"content-length\\":\\"260\\",\\"sec-ch-ua-platform\\":\\"\\\\\\"Windows\\\\\\"\\",\\"user-agent\\":\\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36\\",\\"accept\\":\\"application/json, text/plain, */*\\",\\"sec-ch-ua\\":\\"\\\\\\"Chromium\\\\\\";v=\\\\\\"142\\\\\\", \\\\\\"Brave\\\\\\";v=\\\\\\"142\\\\\\", \\\\\\"Not_A Brand\\\\\\";v=\\\\\\"99\\\\\\"\\",\\"content-type\\":\\"multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x\\",\\"sec-ch-ua-mobile\\":\\"?0\\",\\"sec-gpc\\":\\"1\\",\\"accept-language\\":\\"es-ES,es;q=0.6\\",\\"origin\\":\\"http://localhost:5050\\",\\"sec-fetch-site\\":\\"same-site\\",\\"sec-fetch-mode\\":\\"cors\\",\\"sec-fetch-dest\\":\\"empty\\",\\"referer\\":\\"http://localhost:5050/\\",\\"accept-encoding\\":\\"gzip, deflate, br, zstd\\"},\\"params\\":{},\\"query\\":{},\\"body\\":{\\"message\\":\\"dime algo pala alegrarme el dia\\",\\"user\\":\\"\\"},\\"webhookUrl\\":\\"http://localhost:5678/webhook-test/ever\\",\\"executionMode\\":\\"test\\"}","anonymous","2025-12-03T10:27:04.630Z","conv_anonymous_1764757624630","neutral",{"message":"70","timestamp":"49"},"localhost:5678","keep-alive","260","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo pala alegrarme el dia",""]
39	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}}}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764702989359,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764702989360,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764702989374,"executionTime":2796,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764702989361,"executionIndex":1,"source":"32","hints":"33","executionTime":2811,"executionStatus":"26","data":"34"},{"startTime":1764702992173,"executionIndex":3,"source":"35","hints":"36","executionTime":1,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsageEstimate":"75"},{"messages":"76","estimatedTokens":18,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":51,"promptTokens":18,"totalTokens":69},["99"],{"openai_api_key":"100","model":"101","timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103","use_responses_api":true},"{\\"message\\":\\"Te recomendaría probar el fútbol si buscas un deporte de equipo, o el yoga si prefieres una actividad más individual y relajante. También puedes considerar la natación para un ejercicio completo. ¿Qué tipo de actividad te interesa más?\\"}","localhost:5678","keep-alive","255","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryFCv0IdmBSM0mb095","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomendas?","",["104"],"Human: json:\\n{\\n\\"response\\": que deporte me recomendas?,\\n\\"user\\": \\n}",{"lc":1,"type":"105","id":"106"},"gpt-4o-mini",{"baseURL":"107","fetchOptions":"108"},{"text":"109"},["110"],"secret",["111"],"https://api.openai.com/v1",{},{"verbosity":"112","format":"113"},{"text":"78"},"OPENAI_API_KEY","medium",{"type":"114","name":"115","schema":"116"},"json_schema","my_schema",{"type":"117","properties":"118","additionalProperties":false,"required":"119"},"object",{"message":"120"},["121"],{"type":"122"},"message","string"]
40	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}},"temperature":0.7,"topP":0.5}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764703048039,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764703048040,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764703048050,"executionTime":3136,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764703048043,"executionIndex":1,"source":"32","hints":"33","executionTime":3144,"executionStatus":"26","data":"34"},{"startTime":1764703051188,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsageEstimate":"75"},{"messages":"76","estimatedTokens":19,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":82,"promptTokens":19,"totalTokens":101},["99"],{"openai_api_key":"100","model":"101","temperature":0.7,"top_p":0.5,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103","use_responses_api":true},"{\\"message\\":\\"Te recomiendo probar el ciclismo. Es una excelente forma de ejercicio, puedes hacerlo al aire libre o en interiores, y es una gran manera de explorar nuevos lugares. Además, es bajo impacto, lo que es bueno para las articulaciones. Si prefieres algo más social, el fútbol o el baloncesto son opciones divertidas. ¿Tienes alguna preferencia en cuanto a deportes?\\"}","localhost:5678","keep-alive","257","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryHPyYdFYCdABtqdTO","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomendas?\\r\\n","",["104"],"Human: json:\\n{\\n\\"response\\": que deporte me recomendas?\\r\\n,\\n\\"user\\": \\n}",{"lc":1,"type":"105","id":"106"},"gpt-4o-mini",{"baseURL":"107","fetchOptions":"108"},{"text":"109"},["110"],"secret",["111"],"https://api.openai.com/v1",{},{"verbosity":"112","format":"113"},{"text":"78"},"OPENAI_API_KEY","medium",{"type":"114","name":"115","schema":"116"},"json_schema","my_schema",{"type":"117","properties":"118","additionalProperties":false,"required":"119"},"object",{"message":"120"},["121"],{"type":"122"},"message","string"]
41	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"responsesApiEnabled":true,"builtInTools":{},"options":{"textFormat":{"textOptions":{"type":"json_schema","verbosity":"medium","name":"my_schema","schema":"{\\n  \\"type\\": \\"object\\",\\n  \\"properties\\": {\\n    \\"message\\": {\\n      \\"type\\": \\"string\\"\\n    }\\n  },\\n  \\"additionalProperties\\": false,\\n  \\"required\\": [\\"message\\"]\\n}","description":"","strict":false}},"temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764703074833,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764703074834,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764703074846,"executionTime":3401,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764703074835,"executionIndex":1,"source":"32","hints":"33","executionTime":3414,"executionStatus":"26","data":"34"},{"startTime":1764703078250,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsageEstimate":"75"},{"messages":"76","estimatedTokens":19,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":45,"promptTokens":19,"totalTokens":64},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103","use_responses_api":true},"{\\"message\\":\\"Te recomiendo probar el senderismo. Es una excelente manera de disfrutar de la naturaleza, hacer ejercicio y despejar la mente. Además, puedes adaptarlo a tu nivel de condición física y explorar diferentes rutas.\\"}","localhost:5678","keep-alive","257","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryVkMPu87NEgIBOTs5","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomendas?\\r\\n","",["104"],"Human: json:\\n{\\n\\"response\\": que deporte me recomendas?\\r\\n,\\n\\"user\\": \\n}",{"lc":1,"type":"105","id":"106"},"gpt-4o-mini",{"baseURL":"107","fetchOptions":"108"},{"text":"109"},["110"],"secret",["111"],"https://api.openai.com/v1",{},{"verbosity":"112","format":"113"},{"text":"78"},"OPENAI_API_KEY","medium",{"type":"114","name":"115","schema":"116"},"json_schema","my_schema",{"type":"117","properties":"118","additionalProperties":false,"required":"119"},"object",{"message":"120"},["121"],{"type":"122"},"message","string"]
42	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":true,"builtInTools":{},"options":{"temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764704692598,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764704692078,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[208,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException - {\\"error\\":{\\"code\\":\\"BadRequest\\",\\"message\\":\\"Azure OpenAI Responses API is enabled only for api-version 2025-03-01-preview and later\\"}}",{"startTime":1764703074834,"executionIndex":0,"source":"49","hints":"50","executionTime":1,"executionStatus":"51","data":"52"},{"startTime":1764704692093,"executionTime":502,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764704692079,"executionIndex":1,"source":"59","hints":"60","executionTime":523,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764704692591,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764704692598,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[208,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":19,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113","use_responses_api":true},"localhost:5678","keep-alive","257","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryVkMPu87NEgIBOTs5","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomendas?\\r\\n","Human: json:\\n{\\n\\"response\\": que deporte me recomendas?\\r\\n,\\n\\"user\\": \\n}",{"lc":1,"type":"114","id":"115"},"gpt-4.1-nano",{"baseURL":"116","fetchOptions":"117","defaultHeaders":"118"},{},"secret",["119"],"https://api.mammouth.ai/v1/",{},{"Authorization":"120"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA"]
163	{"id":"aGurSLzad9QHqXSa","name":"Sistema_Consultas","active":true,"isArchived":false,"createdAt":"2025-12-02T14:38:36.709Z","updatedAt":"2025-12-04T18:53:50.654Z","nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\n\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"error":"4","runData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"level":"13","tags":"14","description":"15","timestamp":1764874444669,"context":"16","functionality":"17","name":"18","node":"19","messages":"20","message":"21","stack":"22"},{"Webhook":"23","OpenAI Chat Model":"24","AI Agent":"25"},"AI Agent",{},["26"],{"OpenAI Chat Model":"27"},{},{},{"version":1,"establishedAt":1764874442293,"source":"28"},"warning",{"reWrapped":true},"litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=gpt-4.1-nano\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{},"regular","NodeOperationError",{"parameters":"29","type":"30","typeVersion":3,"position":"31","id":"32","name":"6"},["33"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["34"],["35"],["36"],{"node":"37","data":"38","source":"39"},["40"],"webhook",{"aiAgentStarterCallout":"41","promptType":"42","text":"43","hasOutputParser":true,"notice":"41","needsFallback":false,"options":"44"},"@n8n/n8n-nodes-langchain.agent",[416,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=gpt-4.1-nano\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{"startTime":1764874442294,"executionIndex":0,"source":"45","hints":"46","executionTime":0,"executionStatus":"47","data":"48"},{"startTime":1764874442314,"executionTime":2352,"executionIndex":2,"executionStatus":"49","source":"50","data":"51","inputOverride":"52","metadata":"53","error":"54"},{"startTime":1764874442294,"executionIndex":1,"source":"55","hints":"56","executionTime":2411,"executionStatus":"49","error":"57"},{"parameters":"58","type":"30","typeVersion":3,"position":"59","id":"32","name":"6"},{"main":"60","ai_languageModel":"61"},{"main":"55"},{"subRun":"62"},"","define","=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\n\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{},[],[],"success",{"main":"63"},"error",["64"],{"ai_languageModel":"61"},{"ai_languageModel":"61"},{"subRun":"62"},{"message":"21","timestamp":1764874444664,"name":"65","description":"15","context":"16"},["66"],[],{"level":"13","tags":"14","description":"15","timestamp":1764874444669,"context":"16","functionality":"17","name":"18","node":"19","messages":"20","message":"21","stack":"22"},{"aiAgentStarterCallout":"41","promptType":"42","text":"43","hasOutputParser":true,"notice":"41","needsFallback":false,"options":"67"},[416,0],["68"],["69"],["70"],["71"],{"previousNode":"6","previousNodeRun":0},"NodeApiError",{"previousNode":"72"},{},["73"],["74"],{"node":"75","runIndex":0},["76"],"Webhook",{"json":"77","pairedItem":"78"},{"json":"79"},"OpenAI Chat Model",{"json":"77","pairedItem":"80"},{"headers":"81","params":"82","query":"83","body":"84","webhookUrl":"85","executionMode":"86"},{"item":0},{"messages":"87","estimatedTokens":59,"options":"88"},{"item":0},{"host":"89","user-agent":"90","accept":"91","accept-language":"92","accept-encoding":"93","referer":"94","content-type":"95","content-length":"96","origin":"97","connection":"98","priority":"99"},{},{},{"message":"100","user":"101"},"http://10.10.0.100:5678/webhook/ever","production",["102"],{"openai_api_key":"103","model":"104","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"105","model_kwargs":"106"},"10.10.0.100:5678","Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0","*/*","es-AR,es;q=0.8,en-US;q=0.5,en;q=0.3","gzip, deflate","http://10.10.0.100:5050/","multipart/form-data; boundary=----geckoformboundary865bf091dcb8f0decd72a7295a9236e5","324","http://10.10.0.100:5050","keep-alive","u=0","QUE TENES QUE HACER","session_1764874385817_2yz8264b1","Human: Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\n\\nQUE TENES QUE HACER \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},"secret",["113"],"https://api.mammouth.ai/v1",{},{"Authorization":"114"},{"type":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object"]
164	{"id":"aGurSLzad9QHqXSa","name":"Sistema_Consultas","active":true,"isArchived":false,"createdAt":"2025-12-02T14:38:36.709Z","updatedAt":"2025-12-04T18:54:58.628Z","nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","lastNodeExecuted":"5"},{"contextData":"6","nodeExecutionStack":"7","metadata":"8","waitingExecution":"9","waitingExecutionSource":"10","runtimeData":"11"},{"Webhook":"12","OpenAI Chat Model":"13","AI Agent":"14","Respond to Webhook":"15"},"Respond to Webhook",{},[],{"OpenAI Chat Model":"16"},{},{},{"version":1,"establishedAt":1764874505007,"source":"17"},["18"],["19"],["20"],["21"],["22"],"webhook",{"startTime":1764874505008,"executionIndex":0,"source":"23","hints":"24","executionTime":1,"executionStatus":"25","data":"26"},{"startTime":1764874505028,"executionTime":3015,"executionIndex":2,"executionStatus":"25","source":"27","data":"28","inputOverride":"29","metadata":"30"},{"startTime":1764874505009,"executionIndex":1,"source":"31","hints":"32","executionTime":3035,"executionStatus":"25","data":"33"},{"startTime":1764874508044,"executionIndex":3,"source":"34","hints":"35","executionTime":2,"executionStatus":"25","data":"36"},{"subRun":"37"},[],[],"success",{"main":"38"},["39"],{"ai_languageModel":"40"},{"ai_languageModel":"41"},{"subRun":"37"},["42"],[],{"main":"43"},["44"],[],{"main":"45"},["46"],["47"],{"previousNode":"48","previousNodeRun":0},["49"],["50"],{"previousNode":"51"},["52"],{"previousNode":"48"},["53"],{"node":"54","runIndex":0},["55"],"AI Agent",["56"],["57"],"Webhook",["58"],["59"],"OpenAI Chat Model",{"json":"60","pairedItem":"61"},{"json":"62"},{"json":"63"},{"json":"64","pairedItem":"65"},{"json":"64","pairedItem":"66"},{"headers":"67","params":"68","query":"69","body":"70","webhookUrl":"71","executionMode":"72"},{"item":0},{"response":"73","tokenUsage":"74"},{"messages":"75","estimatedTokens":60,"options":"76"},{"output":"77"},{"item":0},{"item":0},{"host":"78","user-agent":"79","accept":"80","accept-language":"81","accept-encoding":"82","referer":"83","content-type":"84","content-length":"85","origin":"86","connection":"87","priority":"88"},{},{},{"message":"89","user":"90"},"http://10.10.0.100:5678/webhook/ever","production",{"generations":"91"},{"completionTokens":206,"promptTokens":65,"totalTokens":271},["92"],{"openai_api_key":"93","model":"94","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"95","model_kwargs":"96"},"{\\n  \\"response\\": \\"Como empleado del área de calidad a cargo de redactar procedimientos e instructivos tras la implementación de ISO 9001, debo: \\\\n1. Revisar los requisitos de la norma ISO 9001 aplicables a la organización.\\\\n2. Identificar los procesos clave y sus interacciones.\\\\n3. Documentar los procedimientos necesarios para cumplir con los requisitos de la norma y mejorar la gestión de calidad.\\\\n4. Redactar instructivos claros y detallados para la ejecución de tareas específicas.\\\\n5. Asegurar que la documentación sea comprensible, accesible y esté actualizada.\\\\n6. Capacitar al personal en los nuevos procedimientos e instructivos.\\\\n7. Implementar un sistema de control de documentos para gestionar versiones y cambios.\\\\n8. Realizar auditorías internas para verificar la correcta aplicación de los procedimientos.\\\\n9. Mejorar continuamente los procedimientos e instructivos en base a los resultados de las auditorías y retroalimentación del personal.\\"\\n}","10.10.0.100:5678","Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0","*/*","es-AR,es;q=0.8,en-US;q=0.5,en;q=0.3","gzip, deflate","http://10.10.0.100:5050/","multipart/form-data; boundary=----geckoformboundary41f2b6f2eae97c9d883990fce2eb193","321","http://10.10.0.100:5050","keep-alive","u=0","que tenes que hacer","session_1764874385817_2yz8264b1",["97"],"Human: Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\nque tenes que hacer \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"98","id":"99"},"gpt-4.1-nano",{"baseURL":"100","fetchOptions":"101","defaultHeaders":"102"},{"response_format":"103"},["104"],"secret",["105"],"https://api.mammouth.ai/v1",{},{"Authorization":"106"},{"type":"107"},{"text":"77","generationInfo":"108"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"109"},"stop"]
43	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764704845606,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764703074834,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764704845615,"executionTime":1119,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764704845608,"executionIndex":1,"source":"33","hints":"34","executionTime":1127,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":19,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":64,"promptTokens":24,"totalTokens":88},["89"],{"openai_api_key":"90","model":"91","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93"},"¡Hola! Para poder recomendarte un deporte, ¿podrías contarme un poco más sobre tus intereses, nivel de actividad física, si prefieres deportes en equipo o individuales, o si tienes alguna preferencia en cuanto a intensidad o tipo de ejercicio? Así podré ofrecerte una recomendación más personalizada.","localhost:5678","keep-alive","257","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryVkMPu87NEgIBOTs5","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que deporte me recomendas?\\r\\n","",["94"],"Human: json:\\n{\\n\\"response\\": que deporte me recomendas?\\r\\n,\\n\\"user\\": \\n}",{"lc":1,"type":"95","id":"96"},"gpt-4.1-nano",{"baseURL":"97","fetchOptions":"98","defaultHeaders":"99"},{},["100"],"secret",["101"],"https://api.mammouth.ai/v1",{},{"Authorization":"102"},{"text":"68","generationInfo":"103"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA",{"finish_reason":"104"},"stop"]
44	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"error":"4","runData":"5","pinData":"6","lastNodeExecuted":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},{"level":"14","tags":"15","description":"16","timestamp":1764704890842,"context":"17","functionality":"18","name":"19","node":"20","messages":"21","message":"22","stack":"23"},{"Webhook":"24","OpenAI Chat Model":"25","AI Agent":"26","Respond to Webhook":"27"},{},"Respond to Webhook",{},["28"],{"OpenAI Chat Model":"29"},{},{},{"version":1,"establishedAt":1764704889672,"source":"30"},"warning",{},"Check that the syntax of the JSON in the 'Response Body' parameter is valid",{},"regular","NodeOperationError",{"parameters":"31","type":"32","typeVersion":1.4,"position":"33","id":"34","name":"7"},[],"Invalid JSON in 'Response Body' field","NodeOperationError: Invalid JSON in 'Response Body' field\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/RespondToWebhook/RespondToWebhook.node.ts:415:14)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:31)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:22)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:38\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["35"],["36"],["37"],["38"],{"node":"39","data":"40","source":"41"},["42"],"manual",{"enableResponseOutput":false,"generalNotice":"43","respondWith":"44","webhookNotice":"43","responseBody":"45","options":"46"},"n8n-nodes-base.respondToWebhook",[560,0],"c6ec314c-e6a3-423e-90fd-5c9533ea4b08",{"startTime":1764704889673,"executionIndex":0,"source":"47","hints":"48","executionTime":1,"executionStatus":"49","data":"50"},{"startTime":1764704889692,"executionTime":1144,"executionIndex":2,"executionStatus":"49","source":"51","data":"52","inputOverride":"53","metadata":"54"},{"startTime":1764704889675,"executionIndex":1,"source":"55","hints":"56","executionTime":1163,"executionStatus":"49","data":"57"},{"startTime":1764704890839,"executionIndex":3,"source":"58","hints":"59","executionTime":18,"executionStatus":"60","error":"61"},{"parameters":"62","type":"32","typeVersion":1.4,"position":"63","id":"34","name":"7"},{"main":"64"},{"main":"58"},{"subRun":"65"},"","json","={{ $json.output }}",{},[],[],"success",{"main":"66"},["67"],{"ai_languageModel":"68"},{"ai_languageModel":"69"},{"subRun":"65"},["70"],[],{"main":"71"},["72"],[],"error",{"level":"14","tags":"15","description":"16","timestamp":1764704890842,"context":"17","functionality":"18","name":"19","node":"20","messages":"21","message":"22","stack":"23"},{"enableResponseOutput":false,"generalNotice":"43","respondWith":"44","webhookNotice":"43","responseBody":"45","options":"73"},[560,0],["74"],["75"],["76"],{"previousNode":"77","previousNodeRun":0},["78"],["79"],{"previousNode":"80"},["81"],{"previousNode":"77"},{},["82"],{"node":"83","runIndex":0},["84"],"AI Agent",["85"],["86"],"Webhook",["87"],{"json":"88","pairedItem":"89"},"OpenAI Chat Model",{"json":"90","pairedItem":"91"},{"json":"92"},{"json":"93"},{"json":"88","pairedItem":"94"},{"output":"95"},{"item":0},{"headers":"96","params":"97","query":"98","body":"99","webhookUrl":"100","executionMode":"101"},{"item":0},{"response":"102","tokenUsage":"103"},{"messages":"104","estimatedTokens":16,"options":"105"},{"item":0},"Parece que tu JSON está incompleto. Aquí tienes una versión corregida y completa:\\n\\n```json\\n{\\n  \\"response\\": \\"Dime algo bonito\\",\\n  \\"user\\": \\"¿En qué puedo ayudarte?\\"\\n}\\n```\\n\\n¿Quieres que te diga algo bonito o necesitas ayuda con algo más?",{"host":"106","connection":"107","content-length":"108","sec-ch-ua-platform":"109","user-agent":"110","accept":"111","sec-ch-ua":"112","content-type":"113","sec-ch-ua-mobile":"114","sec-gpc":"115","accept-language":"116","origin":"117","sec-fetch-site":"118","sec-fetch-mode":"119","sec-fetch-dest":"120","referer":"121","accept-encoding":"122"},{},{},{"message":"123","user":"43"},"http://localhost:5678/webhook-test/ever","test",{"generations":"124"},{"completionTokens":61,"promptTokens":21,"totalTokens":82},["125"],{"openai_api_key":"126","model":"127","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"128","model_kwargs":"129"},"localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary226xMIm8rHm97mR4","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo bonito",["130"],"Human: json:\\n{\\n\\"response\\": dime algo bonito,\\n\\"user\\": \\n}",{"lc":1,"type":"131","id":"132"},"gpt-4.1-nano",{"baseURL":"133","fetchOptions":"134","defaultHeaders":"135"},{},["136"],"secret",["137"],"https://api.mammouth.ai/v1",{},{"Authorization":"138"},{"text":"95","generationInfo":"139"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA",{"finish_reason":"140"},"stop"]
47	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764705032868,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764705032869,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764705032880,"executionTime":1521,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764705032871,"executionIndex":1,"source":"32","hints":"33","executionTime":1532,"executionStatus":"26","data":"34"},{"startTime":1764705034403,"executionIndex":3,"source":"35","hints":"36","executionTime":3,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":16,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":19,"promptTokens":21,"totalTokens":40},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"Dime algo bonito\\",\\n  \\"user\\": null\\n}","localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarySr04sHz7FARotxfH","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo bonito","",["104"],"Human: json:\\n{\\n\\"response\\": dime algo bonito,\\n\\"user\\": \\n}",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
165	{"id":"aGurSLzad9QHqXSa","name":"Sistema_Consultas","active":true,"isArchived":false,"createdAt":"2025-12-02T14:38:36.709Z","updatedAt":"2025-12-04T18:54:58.628Z","nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","lastNodeExecuted":"5"},{"contextData":"6","nodeExecutionStack":"7","metadata":"8","waitingExecution":"9","waitingExecutionSource":"10","runtimeData":"11"},{"Webhook":"12","OpenAI Chat Model":"13","AI Agent":"14","Respond to Webhook":"15"},"Respond to Webhook",{},[],{"OpenAI Chat Model":"16"},{},{},{"version":1,"establishedAt":1764874653834,"source":"17"},["18"],["19"],["20"],["21"],["22"],"webhook",{"startTime":1764874653834,"executionIndex":0,"source":"23","hints":"24","executionTime":0,"executionStatus":"25","data":"26"},{"startTime":1764874653842,"executionTime":3068,"executionIndex":2,"executionStatus":"25","source":"27","data":"28","inputOverride":"29","metadata":"30"},{"startTime":1764874653834,"executionIndex":1,"source":"31","hints":"32","executionTime":3078,"executionStatus":"25","data":"33"},{"startTime":1764874656913,"executionIndex":3,"source":"34","hints":"35","executionTime":4,"executionStatus":"25","data":"36"},{"subRun":"37"},[],[],"success",{"main":"38"},["39"],{"ai_languageModel":"40"},{"ai_languageModel":"41"},{"subRun":"37"},["42"],[],{"main":"43"},["44"],[],{"main":"45"},["46"],["47"],{"previousNode":"48","previousNodeRun":0},["49"],["50"],{"previousNode":"51"},["52"],{"previousNode":"48"},["53"],{"node":"54","runIndex":0},["55"],"AI Agent",["56"],["57"],"Webhook",["58"],["59"],"OpenAI Chat Model",{"json":"60","pairedItem":"61"},{"json":"62"},{"json":"63"},{"json":"64","pairedItem":"65"},{"json":"64","pairedItem":"66"},{"headers":"67","params":"68","query":"69","body":"70","webhookUrl":"71","executionMode":"72"},{"item":0},{"response":"73","tokenUsage":"74"},{"messages":"75","estimatedTokens":69,"options":"76"},{"output":"77"},{"item":0},{"item":0},{"host":"78","connection":"79","content-length":"80","user-agent":"81","content-type":"82","accept":"83","origin":"84","referer":"85","accept-encoding":"86","accept-language":"87"},{},{},{"message":"88","user":"89"},"http://10.10.0.100:5678/webhook/ever","production",{"generations":"90"},{"completionTokens":400,"promptTokens":74,"totalTokens":474},["91"],{"openai_api_key":"92","model":"93","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"94","model_kwargs":"95"},"{\\n  \\"response\\": \\"Para comenzar con la implementación de un sistema de gestión de calidad basado en ISO 9001, es fundamental seguir una serie de pasos estructurados que aseguren la correcta adopción y mantenimiento del sistema. A continuación, se presenta un plan inicial:\\\\n\\\\n1. Compromiso de la Dirección: Obtener el compromiso y apoyo de la alta dirección para garantizar recursos y liderazgo en la implementación.\\\\n\\\\n2. Formación y Concienciación: Capacitar al personal clave y a todos los empleados sobre los principios de ISO 9001 y la importancia del sistema de gestión de calidad.\\\\n\\\\n3. Diagnóstico Inicial: Realizar un análisis de la situación actual de la organización respecto a los requisitos de ISO 9001 para identificar brechas y áreas de mejora.\\\\n\\\\n4. Definición del Alcance: Determinar qué procesos, departamentos y productos o servicios estarán incluidos en el sistema de gestión de calidad.\\\\n\\\\n5. Documentación del Sistema: Elaborar la documentación necesaria, incluyendo la política de calidad, los procedimientos, instructivos y registros.\\\\n\\\\n6. Implementación de Procesos: Poner en marcha los procesos definidos, asegurando que todos los empleados conozcan y apliquen los procedimientos.\\\\n\\\\n7. Seguimiento y Medición: Establecer indicadores de desempeño y mecanismos de seguimiento para evaluar la eficacia del sistema.\\\\n\\\\n8. Auditorías Internas: Realizar auditorías internas periódicas para verificar el cumplimiento y la efectividad del sistema.\\\\n\\\\n9. Revisión por la Dirección: La alta dirección debe revisar periódicamente el sistema para asegurar su continua idoneidad, adecuación y eficacia.\\\\n\\\\n10. Mejora Continua: Implementar acciones correctivas y preventivas para mejorar continuamente el sistema de gestión de calidad.\\\\n\\\\nEste proceso debe documentarse en procedimientos e instructivos específicos que guíen cada etapa, asegurando la coherencia y la trazabilidad de la implementación.\\"\\n}","10.10.0.100:5678","keep-alive","326","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","multipart/form-data; boundary=----WebKitFormBoundary6vzrC1IBJklbxL5s","*/*","http://10.10.0.100:5050","http://10.10.0.100:5050/","gzip, deflate","es-ES,es;q=0.9,en;q=0.8","Comenzar con la implementacion de un sistema de gestion de calidad","session_1764874555970_i46ahp75b",["96"],"Human: Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\nComenzar con la implementacion de un sistema de gestion de calidad \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"97","id":"98"},"gpt-4.1-nano",{"baseURL":"99","fetchOptions":"100","defaultHeaders":"101"},{"response_format":"102"},["103"],"secret",["104"],"https://api.mammouth.ai/v1",{},{"Authorization":"105"},{"type":"106"},{"text":"77","generationInfo":"107"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"108"},"stop"]
45	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764704925227,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764704889673,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764704925235,"executionTime":1488,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764704925228,"executionIndex":1,"source":"33","hints":"34","executionTime":1496,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":16,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":19,"promptTokens":21,"totalTokens":40},["89"],{"openai_api_key":"90","model":"91","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93"},"{\\n  \\"response\\": \\"Dime algo bonito\\",\\n  \\"user\\": null\\n}","localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary226xMIm8rHm97mR4","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo bonito","",["94"],"Human: json:\\n{\\n\\"response\\": dime algo bonito,\\n\\"user\\": \\n}",{"lc":1,"type":"95","id":"96"},"gpt-4.1-nano",{"baseURL":"97","fetchOptions":"98","defaultHeaders":"99"},{"response_format":"100"},["101"],"secret",["102"],"https://api.mammouth.ai/v1",{},{"Authorization":"103"},{"type":"104"},{"text":"68","generationInfo":"105"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"106"},"stop"]
46	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[208,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[80,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[560,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Respond to Webhook",["14","15","4","16"],{"Webhook":"17","AI Agent":"18","Respond to Webhook":"19"},{},{},[],{},{},{},{"version":1,"establishedAt":1764704930142,"source":"20"},"Webhook","AI Agent","OpenAI Chat Model",["21"],["22"],["23"],"manual",{"startTime":1764704889673,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764704925228,"executionIndex":1,"source":"28","hints":"29","executionTime":1496,"executionStatus":"26","data":"30"},{"startTime":1764704930145,"executionIndex":2,"source":"31","hints":"32","executionTime":8,"executionStatus":"26","data":"33"},[],[],"success",{"main":"34"},["35"],[],{"main":"36"},["37"],[],{"main":"38"},["39"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["40"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["41"],["42"],["43"],["44"],{"json":"45","pairedItem":"46"},{"json":"47","pairedItem":"48"},{"json":"47","pairedItem":"49"},{"headers":"50","params":"51","query":"52","body":"53","webhookUrl":"54","executionMode":"55"},{"item":0},{"output":"56"},{"item":0},{"item":0},{"host":"57","connection":"58","content-length":"59","sec-ch-ua-platform":"60","user-agent":"61","accept":"62","sec-ch-ua":"63","content-type":"64","sec-ch-ua-mobile":"65","sec-gpc":"66","accept-language":"67","origin":"68","sec-fetch-site":"69","sec-fetch-mode":"70","sec-fetch-dest":"71","referer":"72","accept-encoding":"73"},{},{},{"message":"74","user":"75"},"http://localhost:5678/webhook-test/ever","test","{\\n  \\"response\\": \\"Dime algo bonito\\",\\n  \\"user\\": null\\n}","localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary226xMIm8rHm97mR4","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo bonito",""]
48	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Nombre: \\"Prepare Chat Input\\"\\n\\nconst userMessage = $input.first().json.body.message || $input.item.json.message;\\nconst userId = $input.first().json.body.user || $input.item.json.user || 'anonymous';\\n\\nreturn [{\\n  json: {\\n    chatInput: userMessage,  // ✅ Solo el mensaje, NO un objeto\\n    userId: userId,\\n    timestamp: new Date().toISOString()\\n  }\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Code in JavaScript",["14","4"],{"Webhook":"15","Code in JavaScript":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764705320830,"source":"17"},"Webhook",["18"],["19"],"manual",{"startTime":1764705032869,"executionIndex":0,"source":"20","hints":"21","executionTime":1,"executionStatus":"22","data":"23"},{"startTime":1764705320833,"executionIndex":1,"source":"24","hints":"25","executionTime":81,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],["29"],{"main":"30"},["31"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"32","location":"33"},["34"],["35"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["36"],{"json":"37","pairedItem":"38"},{"json":"39","pairedItem":"40"},{"headers":"41","params":"42","query":"43","body":"44","webhookUrl":"45","executionMode":"46"},{"item":0},{"chatInput":"47","userId":"48","timestamp":"49"},{"item":0},{"host":"50","connection":"51","content-length":"52","sec-ch-ua-platform":"53","user-agent":"54","accept":"55","sec-ch-ua":"56","content-type":"57","sec-ch-ua-mobile":"58","sec-gpc":"59","accept-language":"60","origin":"61","sec-fetch-site":"62","sec-fetch-mode":"63","sec-fetch-dest":"64","referer":"65","accept-encoding":"66"},{},{},{"message":"47","user":"67"},"http://localhost:5678/webhook-test/ever","test","dime algo bonito","anonymous","2025-12-02T19:55:20.913Z","localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarySr04sHz7FARotxfH","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",""]
49	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json:\\n{\\n\\"response\\": {{ $json.body.message }},\\n\\"user\\": {{ $json.body.user }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Nombre: \\"Prepare Chat Input\\"\\n\\nconst userMessage = $input.first().json.body.message || $input.item.json.message;\\nconst userId = $input.first().json.body.user || $input.item.json.user || 'anonymous';\\n\\nreturn [{\\n  json: {\\n    chatInput: userMessage,  // ✅ Solo el mensaje, NO un objeto\\n    userId: userId,\\n    timestamp: new Date().toISOString()\\n  }\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","15","4","16"],{"Webhook":"17","Code in JavaScript":"18","OpenAI Chat Model":"19","AI Agent":"20"},{},{},[],{"OpenAI Chat Model":"21"},{},{},{"version":1,"establishedAt":1764705326903,"source":"22"},"Webhook","Code in JavaScript","OpenAI Chat Model",["23"],["24"],["25"],["26"],["27"],"manual",{"startTime":1764705032869,"executionIndex":0,"source":"28","hints":"29","executionTime":1,"executionStatus":"30","data":"31"},{"startTime":1764705320833,"executionIndex":1,"source":"32","hints":"33","executionTime":81,"executionStatus":"30","data":"34"},{"startTime":1764705326920,"executionTime":1625,"executionIndex":3,"executionStatus":"30","source":"35","data":"36","inputOverride":"37","metadata":"38"},{"startTime":1764705326904,"executionIndex":2,"source":"39","hints":"40","executionTime":1646,"executionStatus":"30","data":"41"},{"subRun":"42"},[],[],"success",{"main":"43"},["44"],["45"],{"main":"46"},["47"],{"ai_languageModel":"48"},{"ai_languageModel":"49"},{"subRun":"42"},["50"],[],{"main":"51"},["52"],["53"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"54","location":"55"},["56"],{"previousNode":"4","previousNodeRun":0},["57"],["58"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["59"],{"node":"16","runIndex":0},["60"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["61"],["62"],["63"],["64"],{"json":"65","pairedItem":"66"},{"json":"67","pairedItem":"68"},{"json":"69"},{"json":"70"},{"json":"71","pairedItem":"72"},{"headers":"73","params":"74","query":"75","body":"76","webhookUrl":"77","executionMode":"78"},{"item":0},{"chatInput":"79","userId":"80","timestamp":"81"},{"item":0},{"response":"82","tokenUsage":"83"},{"messages":"84","estimatedTokens":13,"options":"85"},{"output":"86"},{"item":0},{"host":"87","connection":"88","content-length":"89","sec-ch-ua-platform":"90","user-agent":"91","accept":"92","sec-ch-ua":"93","content-type":"94","sec-ch-ua-mobile":"95","sec-gpc":"96","accept-language":"97","origin":"98","sec-fetch-site":"99","sec-fetch-mode":"100","sec-fetch-dest":"101","referer":"102","accept-encoding":"103"},{},{},{"message":"79","user":"104"},"http://localhost:5678/webhook-test/ever","test","dime algo bonito","anonymous","2025-12-02T19:55:20.913Z",{"generations":"105"},{"completionTokens":42,"promptTokens":18,"totalTokens":60},["106"],{"openai_api_key":"107","model":"108","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"109","model_kwargs":"110"},"{\\n  \\"response\\": \\"It looks like your JSON is incomplete. Please provide the full JSON data so I can assist you better.\\",\\n  \\"user\\": \\"Could you help me fix this JSON?\\"\\n}","localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarySr04sHz7FARotxfH","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","",["111"],"Human: json:\\n{\\n\\"response\\": ,\\n\\"user\\": \\n}",{"lc":1,"type":"112","id":"113"},"gpt-4.1-nano",{"baseURL":"114","fetchOptions":"115","defaultHeaders":"116"},{"response_format":"117"},["118"],"secret",["119"],"https://api.mammouth.ai/v1",{},{"Authorization":"120"},{"type":"121"},{"text":"86","generationInfo":"122"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"123"},"stop"]
50	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=\\n[{ \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}]","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Nombre: \\"Prepare Chat Input\\"\\n\\nconst userMessage = $input.first().json.body.message || $input.item.json.message;\\nconst userId = $input.first().json.body.user || $input.item.json.user || 'anonymous';\\n\\nreturn [{\\n  json: {\\n    chatInput: userMessage,  // ✅ Solo el mensaje, NO un objeto\\n    userId: userId,\\n    timestamp: new Date().toISOString()\\n  }\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764705420194,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","message":"26","stack":"27"},{"Webhook":"28","Code in JavaScript":"29","OpenAI Chat Model":"30","AI Agent":"31"},{},{},["32"],{"OpenAI Chat Model":"33"},{},{},{"version":1,"establishedAt":1764705417847,"source":"34"},"Webhook","Code in JavaScript","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=gpt-4.1-nano\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{},"regular","NodeOperationError",{"parameters":"35","type":"36","typeVersion":3,"position":"37","id":"38","name":"4"},["39"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},["47"],"manual",{"aiAgentStarterCallout":"48","promptType":"49","text":"50","hasOutputParser":false,"needsFallback":false,"options":"51"},"@n8n/n8n-nodes-langchain.agent",[416,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=gpt-4.1-nano\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{"startTime":1764705032869,"executionIndex":0,"source":"52","hints":"53","executionTime":1,"executionStatus":"54","data":"55"},{"startTime":1764705320833,"executionIndex":1,"source":"56","hints":"57","executionTime":81,"executionStatus":"54","data":"58"},{"startTime":1764705417893,"executionTime":2299,"executionIndex":3,"executionStatus":"59","source":"60","data":"61","inputOverride":"62","metadata":"63","error":"64"},{"startTime":1764705417849,"executionIndex":2,"source":"65","hints":"66","executionTime":2348,"executionStatus":"59","error":"67"},{"parameters":"68","type":"36","typeVersion":3,"position":"69","id":"38","name":"4"},{"main":"70","ai_languageModel":"71"},{"main":"65"},{"subRun":"72"},"","define","=\\n[{ \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}]",{},[],[],"success",{"main":"73"},["74"],["75"],{"main":"76"},"error",["77"],{"ai_languageModel":"71"},{"ai_languageModel":"71"},{"subRun":"72"},{"message":"26","timestamp":1764705420190,"name":"78","description":"20","context":"21"},["79"],[],{"level":"18","tags":"19","description":"20","timestamp":1764705420194,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","message":"26","stack":"27"},{"aiAgentStarterCallout":"48","promptType":"49","text":"50","hasOutputParser":false,"needsFallback":false,"options":"80"},[416,0],["81"],["82"],["83"],["84"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{"message":"85","location":"86"},["87"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{},["88"],["89"],{"node":"17","runIndex":0},["90"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["91"],{"json":"92","pairedItem":"93"},{"json":"94"},{"json":"95","pairedItem":"96"},{"json":"92","pairedItem":"97"},{"chatInput":"98","userId":"99","timestamp":"100"},{"item":0},{"messages":"101","estimatedTokens":39,"options":"102"},{"headers":"103","params":"104","query":"105","body":"106","webhookUrl":"107","executionMode":"108"},{"item":0},{"item":0},"dime algo bonito","anonymous","2025-12-02T19:55:20.913Z",["109"],{"openai_api_key":"110","model":"111","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113"},{"host":"114","connection":"115","content-length":"116","sec-ch-ua-platform":"117","user-agent":"118","accept":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","sec-gpc":"123","accept-language":"124","origin":"125","sec-fetch-site":"126","sec-fetch-mode":"127","sec-fetch-dest":"128","referer":"129","accept-encoding":"130"},{},{},{"message":"98","user":"48"},"http://localhost:5678/webhook-test/ever","test","Human: \\n[{ \\n\\"chatInput\\": dime algo bonito,\\n\\"userId\\": anonymous,\\n\\"timestamp\\": 2025-12-02T19:55:20.913Z\\n}]",{"lc":1,"type":"131","id":"132"},"gpt-4.1-nano",{"baseURL":"133","fetchOptions":"134","defaultHeaders":"135"},{"response_format":"136"},"localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarySr04sHz7FARotxfH","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","secret",["137"],"https://api.mammouth.ai/v1",{},{"Authorization":"138"},{"type":"139"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object"]
51	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n[{ \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}]","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Nombre: \\"Prepare Chat Input\\"\\n\\nconst userMessage = $input.first().json.body.message || $input.item.json.message;\\nconst userId = $input.first().json.body.user || $input.item.json.user || 'anonymous';\\n\\nreturn [{\\n  json: {\\n    chatInput: userMessage,  // ✅ Solo el mensaje, NO un objeto\\n    userId: userId,\\n    timestamp: new Date().toISOString()\\n  }\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","15","4","16"],{"Webhook":"17","Code in JavaScript":"18","OpenAI Chat Model":"19","AI Agent":"20"},{},{},[],{"OpenAI Chat Model":"21"},{},{},{"version":1,"establishedAt":1764705522128,"source":"22"},"Webhook","Code in JavaScript","OpenAI Chat Model",["23"],["24"],["25"],["26"],["27"],"manual",{"startTime":1764705032869,"executionIndex":0,"source":"28","hints":"29","executionTime":1,"executionStatus":"30","data":"31"},{"startTime":1764705320833,"executionIndex":1,"source":"32","hints":"33","executionTime":81,"executionStatus":"30","data":"34"},{"startTime":1764705522182,"executionTime":1773,"executionIndex":3,"executionStatus":"30","source":"35","data":"36","inputOverride":"37","metadata":"38"},{"startTime":1764705522135,"executionIndex":2,"source":"39","hints":"40","executionTime":1822,"executionStatus":"30","data":"41"},{"subRun":"42"},[],[],"success",{"main":"43"},["44"],["45"],{"main":"46"},["47"],{"ai_languageModel":"48"},{"ai_languageModel":"49"},{"subRun":"42"},["50"],[],{"main":"51"},["52"],["53"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"54","location":"55"},["56"],{"previousNode":"4","previousNodeRun":0},["57"],["58"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["59"],{"node":"16","runIndex":0},["60"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["61"],["62"],["63"],["64"],{"json":"65","pairedItem":"66"},{"json":"67","pairedItem":"68"},{"json":"69"},{"json":"70"},{"json":"71","pairedItem":"72"},{"headers":"73","params":"74","query":"75","body":"76","webhookUrl":"77","executionMode":"78"},{"item":0},{"chatInput":"79","userId":"80","timestamp":"81"},{"item":0},{"response":"82","tokenUsage":"83"},{"messages":"84","estimatedTokens":40,"options":"85"},{"output":"86"},{"item":0},{"host":"87","connection":"88","content-length":"89","sec-ch-ua-platform":"90","user-agent":"91","accept":"92","sec-ch-ua":"93","content-type":"94","sec-ch-ua-mobile":"95","sec-gpc":"96","accept-language":"97","origin":"98","sec-fetch-site":"99","sec-fetch-mode":"100","sec-fetch-dest":"101","referer":"102","accept-encoding":"103"},{},{},{"message":"79","user":"104"},"http://localhost:5678/webhook-test/ever","test","dime algo bonito","anonymous","2025-12-02T19:55:20.913Z",{"generations":"105"},{"completionTokens":26,"promptTokens":45,"totalTokens":71},["106"],{"openai_api_key":"107","model":"108","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"109","model_kwargs":"110"},"{\\"error\\": \\"El campo 'chatInput' debe estar entre comillas. Por favor, proporciona un JSON válido.\\"}","localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarySr04sHz7FARotxfH","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","",["111"],"Human: json\\n[{ \\n\\"chatInput\\": dime algo bonito,\\n\\"userId\\": anonymous,\\n\\"timestamp\\": 2025-12-02T19:55:20.913Z\\n}]",{"lc":1,"type":"112","id":"113"},"gpt-4.1-nano",{"baseURL":"114","fetchOptions":"115","defaultHeaders":"116"},{"response_format":"117"},["118"],"secret",["119"],"https://api.mammouth.ai/v1",{},{"Authorization":"120"},{"type":"121"},{"text":"86","generationInfo":"122"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"123"},"stop"]
52	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=  Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Nombre: \\"Prepare Chat Input\\"\\n\\nconst message = $input.first().json.body.message || $input.item.json.message;\\nconst user = $input.first().json.body.user || $input.item.json.user || 'anonymous';\\n\\n// const body = $input.item.json.body || $input.item.json;\\n\\n\\n\\nif (!message || message.trim() === '') {\\n  throw new Error('Message is required');\\n}\\n\\n// ✅ Retorna datos limpios\\nreturn [{\\n  json: {\\n    chatInput: message.trim(),\\n    userId: user,\\n    timestamp: new Date().toISOString()\\n  }\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Code in JavaScript",["14","4"],{"Webhook":"15","Code in JavaScript":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764705816674,"source":"17"},"Webhook",["18"],["19"],"manual",{"startTime":1764705032869,"executionIndex":0,"source":"20","hints":"21","executionTime":1,"executionStatus":"22","data":"23"},{"startTime":1764705816676,"executionIndex":1,"source":"24","hints":"25","executionTime":19,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],["29"],{"main":"30"},["31"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"32","location":"33"},["34"],["35"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["36"],{"json":"37","pairedItem":"38"},{"json":"39","pairedItem":"40"},{"headers":"41","params":"42","query":"43","body":"44","webhookUrl":"45","executionMode":"46"},{"item":0},{"chatInput":"47","userId":"48","timestamp":"49"},{"item":0},{"host":"50","connection":"51","content-length":"52","sec-ch-ua-platform":"53","user-agent":"54","accept":"55","sec-ch-ua":"56","content-type":"57","sec-ch-ua-mobile":"58","sec-gpc":"59","accept-language":"60","origin":"61","sec-fetch-site":"62","sec-fetch-mode":"63","sec-fetch-dest":"64","referer":"65","accept-encoding":"66"},{},{},{"message":"47","user":"67"},"http://localhost:5678/webhook-test/ever","test","dime algo bonito","anonymous","2025-12-02T20:03:36.694Z","localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarySr04sHz7FARotxfH","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",""]
53	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=  Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Nombre: \\"Prepare Chat Input\\"\\n\\nconst message = $input.first().json.body.message || $input.item.json.message;\\nconst user = $input.first().json.body.user || $input.item.json.user || 'anonymous';\\n\\n// const body = $input.item.json.body || $input.item.json;\\n\\n\\n\\nif (!message || message.trim() === '') {\\n  throw new Error('Message is required');\\n}\\n\\n// ✅ Retorna datos limpios\\nreturn [{\\n  json: {\\n    chatInput: message.trim(),\\n    userId: user,\\n    timestamp: new Date().toISOString()\\n  }\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","15","4","16"],{"Webhook":"17","Code in JavaScript":"18","OpenAI Chat Model":"19","AI Agent":"20"},{},{},[],{"OpenAI Chat Model":"21"},{},{},{"version":1,"establishedAt":1764705819754,"source":"22"},"Webhook","Code in JavaScript","OpenAI Chat Model",["23"],["24"],["25"],["26"],["27"],"manual",{"startTime":1764705032869,"executionIndex":0,"source":"28","hints":"29","executionTime":1,"executionStatus":"30","data":"31"},{"startTime":1764705816676,"executionIndex":1,"source":"32","hints":"33","executionTime":19,"executionStatus":"30","data":"34"},{"startTime":1764705819793,"executionTime":1878,"executionIndex":3,"executionStatus":"30","source":"35","data":"36","inputOverride":"37","metadata":"38"},{"startTime":1764705819757,"executionIndex":2,"source":"39","hints":"40","executionTime":1917,"executionStatus":"30","data":"41"},{"subRun":"42"},[],[],"success",{"main":"43"},["44"],["45"],{"main":"46"},["47"],{"ai_languageModel":"48"},{"ai_languageModel":"49"},{"subRun":"42"},["50"],[],{"main":"51"},["52"],["53"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"54","location":"55"},["56"],{"previousNode":"4","previousNodeRun":0},["57"],["58"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["59"],{"node":"16","runIndex":0},["60"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["61"],["62"],["63"],["64"],{"json":"65","pairedItem":"66"},{"json":"67","pairedItem":"68"},{"json":"69"},{"json":"70"},{"json":"71","pairedItem":"72"},{"headers":"73","params":"74","query":"75","body":"76","webhookUrl":"77","executionMode":"78"},{"item":0},{"chatInput":"79","userId":"80","timestamp":"81"},{"item":0},{"response":"82","tokenUsage":"83"},{"messages":"84","estimatedTokens":57,"options":"85"},{"output":"86"},{"item":0},{"host":"87","connection":"88","content-length":"89","sec-ch-ua-platform":"90","user-agent":"91","accept":"92","sec-ch-ua":"93","content-type":"94","sec-ch-ua-mobile":"95","sec-gpc":"96","accept-language":"97","origin":"98","sec-fetch-site":"99","sec-fetch-mode":"100","sec-fetch-dest":"101","referer":"102","accept-encoding":"103"},{},{},{"message":"79","user":"104"},"http://localhost:5678/webhook-test/ever","test","dime algo bonito","anonymous","2025-12-02T20:03:36.694Z",{"generations":"105"},{"completionTokens":43,"promptTokens":62,"totalTokens":105},["106"],{"openai_api_key":"107","model":"108","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"109","model_kwargs":"110"},"{\\n  \\"chatInput\\": \\"dime algo bonito\\",\\n  \\"userId\\": \\"anonymous\\",\\n  \\"timestamp\\": \\"2025-12-02T20:03:36.694Z\\"\\n}","localhost:5678","keep-alive","245","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarySr04sHz7FARotxfH","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","",["111"],"Human:   Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": dime algo bonito,\\n\\"userId\\": anonymous,\\n\\"timestamp\\": 2025-12-02T20:03:36.694Z\\n}",{"lc":1,"type":"112","id":"113"},"gpt-4.1-nano",{"baseURL":"114","fetchOptions":"115","defaultHeaders":"116"},{"response_format":"117"},["118"],"secret",["119"],"https://api.mammouth.ai/v1",{},{"Authorization":"120"},{"type":"121"},{"text":"86","generationInfo":"122"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"123"},"stop"]
56	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=  Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}\\n\\n{{ $('Webhook').item.json.body }}\\n{{ $('Webhook').item.json.body[\\"message\\"] }}\\n{{ $('Webhook').item.json.body[\\"user\\"] }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Code in JavaScript",["14","4"],{"Webhook":"15","Code in JavaScript":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764757668330,"source":"17"},"Webhook",["18"],["19"],"manual",{"startTime":1764756644081,"executionIndex":0,"source":"20","hints":"21","executionTime":9,"executionStatus":"22","data":"23"},{"startTime":1764757668331,"executionIndex":1,"source":"24","hints":"25","executionTime":35,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],["29"],{"main":"30"},["31"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"32","location":"33"},["34"],["35"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["36"],{"json":"37","pairedItem":"38"},{"json":"39","pairedItem":"40"},{"headers":"41","params":"42","query":"43","body":"44","webhookUrl":"45","executionMode":"46"},{"item":0},{"response":"47","userId":"48","timestamp":"49","conversationId":"50","sentiment":"51","confidence":null,"original":"52","usage":null},{"item":0},{"host":"53","connection":"54","content-length":"55","sec-ch-ua-platform":"56","user-agent":"57","accept":"58","sec-ch-ua":"59","content-type":"60","sec-ch-ua-mobile":"61","sec-gpc":"62","accept-language":"63","origin":"64","sec-fetch-site":"65","sec-fetch-mode":"66","sec-fetch-dest":"67","referer":"68","accept-encoding":"69"},{},{},{"message":"70","user":"71"},"http://localhost:5678/webhook-test/ever","test","{\\"headers\\":{\\"host\\":\\"localhost:5678\\",\\"connection\\":\\"keep-alive\\",\\"content-length\\":\\"260\\",\\"sec-ch-ua-platform\\":\\"\\\\\\"Windows\\\\\\"\\",\\"user-agent\\":\\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36\\",\\"accept\\":\\"application/json, text/plain, */*\\",\\"sec-ch-ua\\":\\"\\\\\\"Chromium\\\\\\";v=\\\\\\"142\\\\\\", \\\\\\"Brave\\\\\\";v=\\\\\\"142\\\\\\", \\\\\\"Not_A Brand\\\\\\";v=\\\\\\"99\\\\\\"\\",\\"content-type\\":\\"multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x\\",\\"sec-ch-ua-mobile\\":\\"?0\\",\\"sec-gpc\\":\\"1\\",\\"accept-language\\":\\"es-ES,es;q=0.6\\",\\"origin\\":\\"http://localhost:5050\\",\\"sec-fetch-site\\":\\"same-site\\",\\"sec-fetch-mode\\":\\"cors\\",\\"sec-fetch-dest\\":\\"empty\\",\\"referer\\":\\"http://localhost:5050/\\",\\"accept-encoding\\":\\"gzip, deflate, br, zstd\\"},\\"params\\":{},\\"query\\":{},\\"body\\":{\\"message\\":\\"dime algo pala alegrarme el dia\\",\\"user\\":\\"\\"},\\"webhookUrl\\":\\"http://localhost:5678/webhook-test/ever\\",\\"executionMode\\":\\"test\\"}","anonymous","2025-12-03T10:27:48.362Z","conv_anonymous_1764757668362","neutral",{"message":"70","timestamp":"49"},"localhost:5678","keep-alive","260","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo pala alegrarme el dia",""]
57	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=  Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": {{ $json.chatInput }},\\n\\"userId\\": {{ $json.userId }},\\n\\"timestamp\\": {{ $json.timestamp }}\\n}\\n\\n{{ $('Webhook').item.json.body }}\\n{{ $('Webhook').item.json.body[\\"message\\"] }}\\n{{ $('Webhook').item.json.body[\\"user\\"] }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764757804621,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764756644081,"executionIndex":0,"source":"25","hints":"26","executionTime":9,"executionStatus":"27","data":"28"},{"startTime":1764757804954,"executionTime":1949,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764757804622,"executionIndex":1,"source":"33","hints":"34","executionTime":2288,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":50,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":46,"promptTokens":55,"totalTokens":101},["89"],{"openai_api_key":"90","model":"91","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93"},"{\\n  \\"chatInput\\": \\"dime algo pala alegrarme el dia\\",\\n  \\"userId\\": \\"user123\\",\\n  \\"timestamp\\": \\"2024-04-27T12:00:00Z\\"\\n}","localhost:5678","keep-alive","260","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo pala alegrarme el dia","",["94"],"Human:   Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n  { \\n\\"chatInput\\": ,\\n\\"userId\\": ,\\n\\"timestamp\\": \\n}\\n\\n[object Object]\\ndime algo pala alegrarme el dia\\n",{"lc":1,"type":"95","id":"96"},"gpt-4.1-nano",{"baseURL":"97","fetchOptions":"98","defaultHeaders":"99"},{"response_format":"100"},["101"],"secret",["102"],"https://api.mammouth.ai/v1",{},{"Authorization":"103"},{"type":"104"},{"text":"68","generationInfo":"105"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"106"},"stop"]
58	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=  Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n\\nal modelo solo pasale esta informacion\\n{{ $json.body.message }}\\n\\ny al webhook response pasale la respuesta del modelo","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764757895678,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764756644081,"executionIndex":0,"source":"25","hints":"26","executionTime":9,"executionStatus":"27","data":"28"},{"startTime":1764757895717,"executionTime":1989,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764757895679,"executionIndex":1,"source":"33","hints":"34","executionTime":2029,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":47,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":60,"promptTokens":52,"totalTokens":112},["89"],{"openai_api_key":"90","model":"91","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93"},"{\\n  \\"al_modelo\\": \\"dime algo pala alegrarme el dia\\",\\n  \\"webhook_response\\": \\"¡Recuerda que cada día es una nueva oportunidad para sonreír y hacer algo que te haga feliz! ¡Tú tienes el poder de alegrar tu día!\\"\\n}","localhost:5678","keep-alive","260","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo pala alegrarme el dia","",["94"],"Human:   Eres un asistente útil.\\n  Responde en formato JSON con esta estructura:\\n\\nal modelo solo pasale esta informacion\\ndime algo pala alegrarme el dia\\n\\ny al webhook response pasale la respuesta del modelo",{"lc":1,"type":"95","id":"96"},"gpt-4.1-nano",{"baseURL":"97","fetchOptions":"98","defaultHeaders":"99"},{"response_format":"100"},["101"],"secret",["102"],"https://api.mammouth.ai/v1",{},{"Authorization":"103"},{"type":"104"},{"text":"68","generationInfo":"105"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"106"},"stop"]
59	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"AI Agent",["15","4","16"],{"level":"17","tags":"18","description":"19","timestamp":1764757959383,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"Webhook":"27","OpenAI Chat Model":"28","AI Agent":"29"},{},{},["30"],{"OpenAI Chat Model":"31"},{},{},{"version":1,"establishedAt":1764757957579,"source":"32"},"Webhook","OpenAI Chat Model","warning",{"reWrapped":true},"litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=gpt-4.1-nano\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":3,"position":"35","id":"36","name":"4"},["37"],"Bad request - please check your parameters","NodeOperationError: Bad request - please check your parameters\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:583:12\\n    at Array.forEach (<anonymous>)\\n    at ExecuteContext.toolsAgentExecute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/agents/ToolsAgent/V3/execute.ts:572:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/@n8n+n8n-nodes-langchain@file+packages+@n8n+nodes-langchain_20900c8302166d11a7199f732c8d7bf5/node_modules/@n8n/n8n-nodes-langchain/nodes/agents/Agent/V3/AgentV3.node.ts:130:10)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},["44"],"manual",{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"48"},"@n8n/n8n-nodes-langchain.agent",[416,0],"d02c1622-0182-4b4d-90ee-c3772dd7f4db","400 litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=gpt-4.1-nano\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.BadRequestError: AzureException BadRequestError - 'messages' must contain the word 'json' in some form, to use 'response_format' of type 'json_object'.No fallback model group found for original model_group=gpt-4.1-nano. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{"startTime":1764756644081,"executionIndex":0,"source":"49","hints":"50","executionTime":9,"executionStatus":"51","data":"52"},{"startTime":1764757957601,"executionTime":1777,"executionIndex":2,"executionStatus":"53","source":"54","data":"55","inputOverride":"56","metadata":"57","error":"58"},{"startTime":1764757957580,"executionIndex":1,"source":"59","hints":"60","executionTime":1825,"executionStatus":"53","error":"61"},{"parameters":"62","type":"34","typeVersion":3,"position":"63","id":"36","name":"4"},{"main":"64","ai_languageModel":"65"},{"main":"59"},{"subRun":"66"},"","define","=\\n{{ $json.body.message }}\\n",{},[],[],"success",{"main":"67"},"error",["68"],{"ai_languageModel":"65"},{"ai_languageModel":"65"},{"subRun":"66"},{"message":"25","timestamp":1764757959373,"name":"69","description":"19","context":"20"},["70"],[],{"level":"17","tags":"18","description":"19","timestamp":1764757959383,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","message":"25","stack":"26"},{"aiAgentStarterCallout":"45","promptType":"46","text":"47","hasOutputParser":false,"needsFallback":false,"options":"71"},[416,0],["72"],["73"],["74"],["75"],{"previousNode":"4","previousNodeRun":0},"NodeApiError",{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{},["76"],["77"],{"node":"16","runIndex":0},["78"],{"json":"79","pairedItem":"80"},{"json":"81"},{"json":"79","pairedItem":"82"},{"headers":"83","params":"84","query":"85","body":"86","webhookUrl":"87","executionMode":"88"},{"item":0},{"messages":"89","estimatedTokens":12,"options":"90"},{"item":0},{"host":"91","connection":"92","content-length":"93","sec-ch-ua-platform":"94","user-agent":"95","accept":"96","sec-ch-ua":"97","content-type":"98","sec-ch-ua-mobile":"99","sec-gpc":"100","accept-language":"101","origin":"102","sec-fetch-site":"103","sec-fetch-mode":"104","sec-fetch-dest":"105","referer":"106","accept-encoding":"107"},{},{},{"message":"108","user":"45"},"http://localhost:5678/webhook-test/ever","test",["109"],{"openai_api_key":"110","model":"111","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"112","model_kwargs":"113"},"localhost:5678","keep-alive","260","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo pala alegrarme el dia","Human: \\ndime algo pala alegrarme el dia\\n",{"lc":1,"type":"114","id":"115"},"gpt-4.1-nano",{"baseURL":"116","fetchOptions":"117","defaultHeaders":"118"},{"response_format":"119"},"secret",["120"],"https://api.mammouth.ai/v1",{},{"Authorization":"121"},{"type":"122"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object"]
60	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764757972374,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764756644081,"executionIndex":0,"source":"25","hints":"26","executionTime":9,"executionStatus":"27","data":"28"},{"startTime":1764757972406,"executionTime":1916,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764757972379,"executionIndex":1,"source":"33","hints":"34","executionTime":1944,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":13,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":59,"promptTokens":18,"totalTokens":77},["89"],{"openai_api_key":"90","model":"91","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93"},"{\\"mensaje\\": \\"¡Recuerda que cada día es una nueva oportunidad para sonreír y agradecer! Aquí tienes una frase para alegrarte el día: 'La felicidad no es algo hecho. Viene de tus propias acciones.' ¡Que tengas un día maravilloso lleno de momentos felices!\\"}","localhost:5678","keep-alive","260","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryYNnN5Mv4VucmOo2x","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo pala alegrarme el dia","",["94"],"Human: json\\ndime algo pala alegrarme el dia\\n",{"lc":1,"type":"95","id":"96"},"gpt-4.1-nano",{"baseURL":"97","fetchOptions":"98","defaultHeaders":"99"},{"response_format":"100"},["101"],"secret",["102"],"https://api.mammouth.ai/v1",{},{"Authorization":"103"},{"type":"104"},{"text":"68","generationInfo":"105"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"106"},"stop"]
61	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764758049506,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764758049506,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764758049520,"executionTime":1848,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764758049507,"executionIndex":1,"source":"32","hints":"33","executionTime":1862,"executionStatus":"26","data":"34"},{"startTime":1764758051371,"executionIndex":3,"source":"35","hints":"36","executionTime":6,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":14,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":40,"promptTokens":19,"totalTokens":59},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\"mensaje\\": \\"Recuerda que cada día es una nueva oportunidad para sonreír y encontrar belleza en las pequeñas cosas. ¡Tu alegría puede iluminar el mundo que te rodea!\\"}","localhost:5678","keep-alive","267","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryvplP2BGWuIJykT3o","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dime algo bonito para alegrarme el dia","",["104"],"Human: json\\ndime algo bonito para alegrarme el dia\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
62	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764774171788,"source":"14"},["15"],"manual",{"startTime":1764774171800,"executionIndex":0,"source":"16","hints":"17","executionTime":4,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","sessionId":"49","timestamp":"50","userId":"51"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","124","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola","session_1764774149809_brc7npp26","2025-12-03T15:02:51.327Z","anonymous"]
63	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764774191842,"source":"14"},["15"],"manual",{"startTime":1764774191843,"executionIndex":0,"source":"16","hints":"17","executionTime":1,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","accept":"36","sec-ch-ua":"37","content-type":"38","sec-ch-ua-mobile":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","sessionId":"49","timestamp":"50","userId":"51"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","132","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","estas bien¡","session_1764774149809_brc7npp26","2025-12-03T15:03:11.780Z","anonymous"]
64	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764774241121,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764774241122,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764774242900,"executionTime":2155,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764774241126,"executionIndex":1,"source":"32","hints":"33","executionTime":3937,"executionStatus":"26","data":"34"},{"startTime":1764774245064,"executionIndex":3,"source":"35","hints":"36","executionTime":16,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":7,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":27,"promptTokens":12,"totalTokens":39},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"respuesta\\": \\"Lo siento, no entiendo tu pregunta. ¿Podrías proporcionar más detalles o aclarar qué necesitas?\\"}","localhost:5678","keep-alive","130","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","estas bin?","session_1764774149809_brc7npp26","2025-12-03T15:04:01.048Z","anonymous",["106"],"Human: json\\nestas bin?\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
65	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Respond to Webhook",["14","15","4","16"],{"Webhook":"17","AI Agent":"18","Respond to Webhook":"19"},{},{},[],{},{},{},{"version":1,"establishedAt":1764774382437,"source":"20"},"Webhook","AI Agent","OpenAI Chat Model",["21"],["22"],["23"],"manual",{"startTime":1764774241122,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764774241126,"executionIndex":1,"source":"28","hints":"29","executionTime":3937,"executionStatus":"26","data":"30"},{"startTime":1764774382441,"executionIndex":2,"source":"31","hints":"32","executionTime":4,"executionStatus":"26","data":"33"},[],[],"success",{"main":"34"},["35"],[],{"main":"36"},["37"],[],{"main":"38"},["39"],{"previousNode":"14"},["40"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["41"],["42"],["43"],["44"],{"json":"45","pairedItem":"46"},{"json":"47","pairedItem":"48"},{"json":"47","pairedItem":"49"},{"headers":"50","params":"51","query":"52","body":"53","webhookUrl":"54","executionMode":"55"},{"item":0},{"output":"56"},{"item":0},{"item":0},{"host":"57","connection":"58","content-length":"59","sec-ch-ua-platform":"60","user-agent":"61","accept":"62","sec-ch-ua":"63","content-type":"64","sec-ch-ua-mobile":"65","sec-gpc":"66","accept-language":"67","origin":"68","sec-fetch-site":"69","sec-fetch-mode":"70","sec-fetch-dest":"71","referer":"72","accept-encoding":"73"},{},{},{"message":"74","sessionId":"75","timestamp":"76","userId":"77"},"http://localhost:5678/webhook-test/ever","test","{\\"respuesta\\": \\"Lo siento, no entiendo tu pregunta. ¿Podrías proporcionar más detalles o aclarar qué necesitas?\\"}","localhost:5678","keep-alive","130","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","estas bin?","session_1764774149809_brc7npp26","2025-12-03T15:04:01.048Z","anonymous"]
66	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764774412142,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764774412143,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764774412166,"executionTime":5307,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764774412145,"executionIndex":1,"source":"32","hints":"33","executionTime":5330,"executionStatus":"26","data":"34"},{"startTime":1764774417476,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":12,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":30,"promptTokens":17,"totalTokens":47},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"respuesta\\": \\"¡Por supuesto! ¿Podrías decirme para qué necesitas el color? Así puedo ayudarte a elegir el mejor.\\"}","localhost:5678","keep-alive","149","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","me ayudas a elegir un color¿","session_1764774149809_brc7npp26","2025-12-03T15:06:52.077Z","anonymous",["106"],"Human: json\\nme ayudas a elegir un color¿\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
67	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764774472159,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764774472161,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764774472173,"executionTime":1048,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764774472162,"executionIndex":1,"source":"32","hints":"33","executionTime":1063,"executionStatus":"26","data":"34"},{"startTime":1764774473226,"executionIndex":3,"source":"35","hints":"36","executionTime":3,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":6,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":36,"promptTokens":11,"totalTokens":47},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"error\\": \\"Your message appears to be incomplete or contains only a single character. Could you please provide more details or clarify your request so I can assist you better?\\"}","localhost:5678","keep-alive","121","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","e","session_1764774149809_brc7npp26","2025-12-03T15:07:52.066Z","anonymous",["106"],"Human: json\\ne\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
68	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764774537630,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764774537630,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764774537644,"executionTime":21808,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764774537632,"executionIndex":1,"source":"32","hints":"33","executionTime":21822,"executionStatus":"26","data":"34"},{"startTime":1764774559455,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":8,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":16,"promptTokens":13,"totalTokens":29},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"mensaje\\": \\"¡Hola! ¿En qué puedo ayudarte hoy?\\"}","localhost:5678","keep-alive","127","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hablame","session_1764774149809_brc7npp26","2025-12-03T15:08:57.557Z","anonymous",["106"],"Human: json\\nhablame\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
69	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764774606993,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764774606994,"executionIndex":0,"source":"24","hints":"25","executionTime":2,"executionStatus":"26","data":"27"},{"startTime":1764774607004,"executionTime":1633,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764774606996,"executionIndex":1,"source":"32","hints":"33","executionTime":1643,"executionStatus":"26","data":"34"},{"startTime":1764774608640,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":8,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":11,"promptTokens":13,"totalTokens":24},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"país más grande\\": \\"Rusia\\"}","localhost:5678","keep-alive","135","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","pais mas grande","session_1764774149809_brc7npp26","2025-12-03T15:10:06.913Z","anonymous",["106"],"Human: json\\npais mas grande\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
70	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={\\n  \\"response\\": \\"{{ $json.output }}\\",\\n  \\"status\\": \\"success\\"\\n}\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Respond to Webhook",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764774789918,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","message":"26","stack":"27"},{"Webhook":"28","AI Agent":"29","Respond to Webhook":"30"},{},{},["31"],{},{},{},{"version":1,"establishedAt":1764774789812,"source":"32"},"Webhook","AI Agent","OpenAI Chat Model","warning",{},"Check that the syntax of the JSON in the 'Response Body' parameter is valid",{},"regular","NodeOperationError",{"parameters":"33","type":"34","typeVersion":1.4,"position":"35","id":"36","name":"4"},[],"Invalid JSON in 'Response Body' field","NodeOperationError: Invalid JSON in 'Response Body' field\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/RespondToWebhook/RespondToWebhook.node.ts:415:14)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:31)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:22)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:38\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["37"],["38"],["39"],{"node":"40","data":"41","source":"42"},"manual",{"enableResponseOutput":false,"generalNotice":"43","respondWith":"44","webhookNotice":"43","responseBody":"45","options":"46"},"n8n-nodes-base.respondToWebhook",[768,0],"c6ec314c-e6a3-423e-90fd-5c9533ea4b08",{"startTime":1764774606994,"executionIndex":0,"source":"47","hints":"48","executionTime":2,"executionStatus":"49","data":"50"},{"startTime":1764774606996,"executionIndex":1,"source":"51","hints":"52","executionTime":1643,"executionStatus":"49","data":"53"},{"startTime":1764774789814,"executionIndex":2,"source":"54","hints":"55","executionTime":301,"executionStatus":"56","error":"57"},{"parameters":"58","type":"34","typeVersion":1.4,"position":"59","id":"36","name":"4"},{"main":"60"},{"main":"54"},"","json","={\\n  \\"response\\": \\"{{ $json.output }}\\",\\n  \\"status\\": \\"success\\"\\n}\\n",{},[],[],"success",{"main":"61"},["62"],[],{"main":"63"},["64"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764774789918,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","message":"26","stack":"27"},{"enableResponseOutput":false,"generalNotice":"43","respondWith":"44","webhookNotice":"43","responseBody":"45","options":"65"},[768,0],["66"],["67"],{"previousNode":"15"},["68"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{},["69"],["70"],["71"],{"json":"72","pairedItem":"73"},{"json":"74","pairedItem":"75"},{"json":"72","pairedItem":"76"},{"output":"77"},{"item":0},{"headers":"78","params":"79","query":"80","body":"81","webhookUrl":"82","executionMode":"83"},{"item":0},{"item":0},"{\\"país más grande\\": \\"Rusia\\"}",{"host":"84","connection":"85","content-length":"86","sec-ch-ua-platform":"87","user-agent":"88","accept":"89","sec-ch-ua":"90","content-type":"91","sec-ch-ua-mobile":"92","sec-gpc":"93","accept-language":"94","origin":"95","sec-fetch-site":"96","sec-fetch-mode":"97","sec-fetch-dest":"98","referer":"99","accept-encoding":"100"},{},{},{"message":"101","sessionId":"102","timestamp":"103","userId":"104"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","135","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","pais mas grande","session_1764774149809_brc7npp26","2025-12-03T15:10:06.913Z","anonymous"]
71	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={\\n  \\"response\\": \\"{{ TypeOf($json.output) }}\\",\\n  \\"status\\": \\"success\\"\\n}\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","executionTimeout":-1,"availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764775166972,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764775166982,"executionIndex":0,"source":"24","hints":"25","executionTime":7,"executionStatus":"26","data":"27"},{"startTime":1764775167103,"executionTime":3430,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764775166994,"executionIndex":1,"source":"32","hints":"33","executionTime":3550,"executionStatus":"26","data":"34"},{"startTime":1764775170545,"executionIndex":3,"source":"35","hints":"36","executionTime":86,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":6,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":19,"promptTokens":11,"totalTokens":30},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"error\\": \\"Invalid JSON format. Please provide a valid JSON object or array.\\"}","localhost:5678","keep-alive","122","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hi","session_1764774149809_brc7npp26","2025-12-03T15:19:26.788Z","anonymous",["106"],"Human: json\\nhi\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
72	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764775260272,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764775260277,"executionIndex":0,"source":"24","hints":"25","executionTime":2,"executionStatus":"26","data":"27"},{"startTime":1764775260314,"executionTime":1651,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764775260279,"executionIndex":1,"source":"32","hints":"33","executionTime":1690,"executionStatus":"26","data":"34"},{"startTime":1764775261969,"executionIndex":3,"source":"35","hints":"36","executionTime":29,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":6,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":20,"promptTokens":11,"totalTokens":31},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"error\\": \\"No valid JSON data provided. Please provide a properly formatted JSON object.\\"}","localhost:5678","keep-alive","124","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola","session_1764774149809_brc7npp26","2025-12-03T15:21:00.118Z","anonymous",["106"],"Human: json\\nhola\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
73	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}\\n","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764775431588,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764775431590,"executionIndex":0,"source":"24","hints":"25","executionTime":2,"executionStatus":"26","data":"27"},{"startTime":1764775431626,"executionTime":1704,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764775431594,"executionIndex":1,"source":"32","hints":"33","executionTime":1738,"executionStatus":"26","data":"34"},{"startTime":1764775433333,"executionIndex":3,"source":"35","hints":"36","executionTime":1,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":6,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":19,"promptTokens":11,"totalTokens":30},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"error\\": \\"Invalid JSON format. Please provide a valid JSON object or array.\\"}","localhost:5678","keep-alive","122","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","12","session_1764774149809_brc7npp26","2025-12-03T15:23:51.493Z","anonymous",["106"],"Human: json\\n12\\n",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
74	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{\\"message\\" : {{ $json.body.message }}}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764775581853,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764775431590,"executionIndex":0,"source":"25","hints":"26","executionTime":2,"executionStatus":"27","data":"28"},{"startTime":1764775581888,"executionTime":12306,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764775581854,"executionIndex":1,"source":"33","hints":"34","executionTime":12342,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":11,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","sessionId":"87","timestamp":"88","userId":"89"},"http://localhost:5678/webhook-test/ever","test",{"generations":"90"},{"completionTokens":10,"promptTokens":16,"totalTokens":26},["91"],{"openai_api_key":"92","model":"93","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"94","model_kwargs":"95"},"{\\n  \\"message\\": 12\\n}","localhost:5678","keep-alive","122","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","12","session_1764774149809_brc7npp26","2025-12-03T15:23:51.493Z","anonymous",["96"],"Human: json\\n{\\"message\\" : 12}",{"lc":1,"type":"97","id":"98"},"gpt-4.1-nano",{"baseURL":"99","fetchOptions":"100","defaultHeaders":"101"},{"response_format":"102"},["103"],"secret",["104"],"https://api.mammouth.ai/v1",{},{"Authorization":"105"},{"type":"106"},{"text":"68","generationInfo":"107"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"108"},"stop"]
75	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764775609302,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764775431590,"executionIndex":0,"source":"25","hints":"26","executionTime":2,"executionStatus":"27","data":"28"},{"startTime":1764775609335,"executionTime":1011,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764775609304,"executionIndex":1,"source":"33","hints":"34","executionTime":1044,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":5,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","sessionId":"87","timestamp":"88","userId":"89"},"http://localhost:5678/webhook-test/ever","test",{"generations":"90"},{"completionTokens":28,"promptTokens":10,"totalTokens":38},["91"],{"openai_api_key":"92","model":"93","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"94","model_kwargs":"95"},"{\\"error\\": \\"Your message appears to contain only the number 12. Could you please provide more details or clarify your request?\\"}","localhost:5678","keep-alive","122","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","12","session_1764774149809_brc7npp26","2025-12-03T15:23:51.493Z","anonymous",["96"],"Human: json\\n12",{"lc":1,"type":"97","id":"98"},"gpt-4.1-nano",{"baseURL":"99","fetchOptions":"100","defaultHeaders":"101"},{"response_format":"102"},["103"],"secret",["104"],"https://api.mammouth.ai/v1",{},{"Authorization":"105"},{"type":"106"},{"text":"68","generationInfo":"107"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"108"},"stop"]
76	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764775628499,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764775628500,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764775628506,"executionTime":59118,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764775628500,"executionIndex":1,"source":"32","hints":"33","executionTime":59126,"executionStatus":"26","data":"34"},{"startTime":1764775687627,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":8,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":9,"promptTokens":13,"totalTokens":22},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{ \\"nombre\\": \\"Carlos\\" }","localhost:5678","keep-alive","134","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dame un nombre","session_1764774149809_brc7npp26","2025-12-03T15:27:08.413Z","anonymous",["106"],"Human: json\\ndame un nombre",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
77	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764775743219,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764775743219,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764775743227,"executionTime":2719,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764775743220,"executionIndex":1,"source":"32","hints":"33","executionTime":2727,"executionStatus":"26","data":"34"},{"startTime":1764775745947,"executionIndex":3,"source":"35","hints":"36","executionTime":1,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":9,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":77,"promptTokens":14,"totalTokens":91},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"respuesta\\": \\"Un martillo es una herramienta manual utilizada para golpear objetos o clavar clavos. Está compuesto por una cabeza, generalmente de metal, y un mango, que puede ser de madera, fibra de vidrio o metal. Los martillos se emplean en carpintería, construcción, metalurgia y otros oficios para tareas que requieren fuerza y precisión.\\"}","localhost:5678","keep-alive","137","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que es un martill","session_1764774149809_brc7npp26","2025-12-03T15:29:03.133Z","anonymous",["106"],"Human: json\\nque es un martill",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
112	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook - Chat",{"Webhook - Chat":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764788932089,"source":"14"},["15"],"manual",{"startTime":1764788932091,"executionIndex":0,"source":"16","hints":"17","executionTime":1,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","sec-ch-ua":"36","content-type":"37","sec-ch-ua-mobile":"38","accept":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","262","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary8IZSqi0HGY2qRNXf","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","sl","session_1764788865859_vbqy9tjnr"]
166	{"id":"aGurSLzad9QHqXSa","name":"Sistema_Consultas","active":true,"isArchived":false,"createdAt":"2025-12-02T14:38:36.709Z","updatedAt":"2025-12-04T18:54:58.628Z","nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","lastNodeExecuted":"5"},{"contextData":"6","nodeExecutionStack":"7","metadata":"8","waitingExecution":"9","waitingExecutionSource":"10","runtimeData":"11"},{"Webhook":"12","OpenAI Chat Model":"13","AI Agent":"14","Respond to Webhook":"15"},"Respond to Webhook",{},[],{"OpenAI Chat Model":"16"},{},{},{"version":1,"establishedAt":1764875097260,"source":"17"},["18"],["19"],["20"],["21"],["22"],"webhook",{"startTime":1764875097261,"executionIndex":0,"source":"23","hints":"24","executionTime":0,"executionStatus":"25","data":"26"},{"startTime":1764875097269,"executionTime":2204,"executionIndex":2,"executionStatus":"25","source":"27","data":"28","inputOverride":"29","metadata":"30"},{"startTime":1764875097262,"executionIndex":1,"source":"31","hints":"32","executionTime":2212,"executionStatus":"25","data":"33"},{"startTime":1764875099474,"executionIndex":3,"source":"34","hints":"35","executionTime":2,"executionStatus":"25","data":"36"},{"subRun":"37"},[],[],"success",{"main":"38"},["39"],{"ai_languageModel":"40"},{"ai_languageModel":"41"},{"subRun":"37"},["42"],[],{"main":"43"},["44"],[],{"main":"45"},["46"],["47"],{"previousNode":"48","previousNodeRun":0},["49"],["50"],{"previousNode":"51"},["52"],{"previousNode":"48"},["53"],{"node":"54","runIndex":0},["55"],"AI Agent",["56"],["57"],"Webhook",["58"],["59"],"OpenAI Chat Model",{"json":"60","pairedItem":"61"},{"json":"62"},{"json":"63"},{"json":"64","pairedItem":"65"},{"json":"64","pairedItem":"66"},{"headers":"67","params":"68","query":"69","body":"70","webhookUrl":"71","executionMode":"72"},{"item":0},{"response":"73","tokenUsage":"74"},{"messages":"75","estimatedTokens":76,"options":"76"},{"output":"77"},{"item":0},{"item":0},{"host":"78","user-agent":"79","accept":"80","accept-language":"81","accept-encoding":"82","referer":"83","content-type":"84","content-length":"85","origin":"86","connection":"87","priority":"88"},{},{},{"message":"89","user":"90"},"http://10.10.0.100:5678/webhook/ever","production",{"generations":"91"},{"completionTokens":103,"promptTokens":81,"totalTokens":184},["92"],{"openai_api_key":"93","model":"94","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"95","model_kwargs":"96"},"{\\n  \\"response\\": \\"Para que pueda ayudarte a redactar un instructivo, necesito que me proporciones la información específica sobre el proceso o actividad que deseas documentar, incluyendo los pasos clave, responsables, recursos necesarios, y cualquier requisito o norma aplicable. También sería útil que me indiques el alcance del instructivo y si hay formatos o plantillas existentes que deba seguir. Con estos datos, puedo elaborar un instructivo claro y alineado con los requisitos de la ISO 9001.\\"\\n}","10.10.0.100:5678","Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0","*/*","es-AR,es;q=0.8,en-US;q=0.5,en;q=0.3","gzip, deflate","http://10.10.0.100:5050/","multipart/form-data; boundary=----geckoformboundary61a44c71e9c873e2c66bb2e71cea4873","367","http://10.10.0.100:5050","keep-alive","u=0","COMO FUNCIONAS? QUE TE DEBO PASAR PARA OBTENER UN INSTRUCTIVO?","session_1764874385817_2yz8264b1",["97"],"Human: Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\nCOMO FUNCIONAS? QUE TE DEBO PASAR PARA OBTENER UN INSTRUCTIVO? \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"98","id":"99"},"gpt-4.1-nano",{"baseURL":"100","fetchOptions":"101","defaultHeaders":"102"},{"response_format":"103"},["104"],"secret",["105"],"https://api.mammouth.ai/v1",{},{"Authorization":"106"},{"type":"107"},{"text":"77","generationInfo":"108"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"109"},"stop"]
78	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764775838901,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764775838902,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764775838917,"executionTime":1708,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764775838903,"executionIndex":1,"source":"32","hints":"33","executionTime":1725,"executionStatus":"26","data":"34"},{"startTime":1764775840629,"executionIndex":3,"source":"35","hints":"36","executionTime":3,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":9,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":8,"promptTokens":14,"totalTokens":22},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"animal\\": \\"Perro\\"}","localhost:5678","keep-alive","133","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dame 1 animal","session_1764775828617_yd6ovh4gy","2025-12-03T15:30:38.817Z","anonymous",["106"],"Human: json\\ndame 1 animal",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
79	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }}","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764775913539,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764775913540,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764775913550,"executionTime":30145,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764775913541,"executionIndex":1,"source":"32","hints":"33","executionTime":30155,"executionStatus":"26","data":"34"},{"startTime":1764775943697,"executionIndex":3,"source":"35","hints":"36","executionTime":3,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":5,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":33,"promptTokens":10,"totalTokens":43},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"error\\": \\"No se proporcionó una estructura JSON válida o una solicitud clara. Por favor, proporciona un JSON válido o especifica cómo puedo ayudarte.\\"}","localhost:5678","keep-alive","124","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola","session_1764775828617_yd6ovh4gy","2025-12-03T15:31:53.438Z","anonymous",["106"],"Human: json\\nhola",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
80	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{\\"response\\" :{{ $json.body.message }} }","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764776080100,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764775913540,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764776080537,"executionTime":20775,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764776080101,"executionIndex":1,"source":"33","hints":"34","executionTime":21214,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":10,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","sessionId":"87","timestamp":"88","userId":"89"},"http://localhost:5678/webhook-test/ever","test",{"generations":"90"},{"completionTokens":27,"promptTokens":15,"totalTokens":42},["91"],{"openai_api_key":"92","model":"93","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"94","model_kwargs":"95"},"{\\n  \\"error\\": \\"Invalid JSON format. The value for 'response' should be a string enclosed in double quotes.\\"\\n}","localhost:5678","keep-alive","124","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola","session_1764775828617_yd6ovh4gy","2025-12-03T15:31:53.438Z","anonymous",["96"],"Human: json\\n{\\"response\\" :hola }",{"lc":1,"type":"97","id":"98"},"gpt-4.1-nano",{"baseURL":"99","fetchOptions":"100","defaultHeaders":"101"},{"response_format":"102"},["103"],"secret",["104"],"https://api.mammouth.ai/v1",{},{"Authorization":"105"},{"type":"106"},{"text":"68","generationInfo":"107"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"108"},"stop"]
81	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} ","hasOutputParser":false,"needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764776129069,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764775913540,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764776129086,"executionTime":1170,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764776129070,"executionIndex":1,"source":"33","hints":"34","executionTime":1187,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":6,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","sessionId":"87","timestamp":"88","userId":"89"},"http://localhost:5678/webhook-test/ever","test",{"generations":"90"},{"completionTokens":27,"promptTokens":11,"totalTokens":38},["91"],{"openai_api_key":"92","model":"93","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"94","model_kwargs":"95"},"{\\"error\\": \\"El contenido proporcionado no es un JSON válido. Por favor, proporciona un JSON correcto para poder ayudarte.\\"}","localhost:5678","keep-alive","124","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola","session_1764775828617_yd6ovh4gy","2025-12-03T15:31:53.438Z","anonymous",["96"],"Human: json\\nhola ",{"lc":1,"type":"97","id":"98"},"gpt-4.1-nano",{"baseURL":"99","fetchOptions":"100","defaultHeaders":"101"},{"response_format":"102"},["103"],"secret",["104"],"https://api.mammouth.ai/v1",{},{"Authorization":"105"},{"type":"106"},{"text":"68","generationInfo":"107"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"108"},"stop"]
82	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} ","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764776141447,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764775913540,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764776141459,"executionTime":1287,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764776141451,"executionIndex":1,"source":"33","hints":"34","executionTime":1297,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":6,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","accept":"74","sec-ch-ua":"75","content-type":"76","sec-ch-ua-mobile":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","sessionId":"87","timestamp":"88","userId":"89"},"http://localhost:5678/webhook-test/ever","test",{"generations":"90"},{"completionTokens":27,"promptTokens":11,"totalTokens":38},["91"],{"openai_api_key":"92","model":"93","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"94","model_kwargs":"95"},"{\\"error\\": \\"El contenido proporcionado no es un JSON válido. Por favor, proporciona un JSON correcto para poder ayudarte.\\"}","localhost:5678","keep-alive","124","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","hola","session_1764775828617_yd6ovh4gy","2025-12-03T15:31:53.438Z","anonymous",["96"],"Human: json\\nhola ",{"lc":1,"type":"97","id":"98"},"gpt-4.1-nano",{"baseURL":"99","fetchOptions":"100","defaultHeaders":"101"},{"response_format":"102"},["103"],"secret",["104"],"https://api.mammouth.ai/v1",{},{"Authorization":"105"},{"type":"106"},{"text":"68","generationInfo":"107"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"108"},"stop"]
83	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} ","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764776532850,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764776532851,"executionIndex":0,"source":"24","hints":"25","executionTime":3,"executionStatus":"26","data":"27"},{"startTime":1764776532870,"executionTime":1834,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764776532857,"executionIndex":1,"source":"32","hints":"33","executionTime":1848,"executionStatus":"26","data":"34"},{"startTime":1764776534706,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":8,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":34,"promptTokens":13,"totalTokens":47},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"respuesta\\": \\"Parece que tu mensaje está incompleto o no es claro. ¿Podrías proporcionar más detalles o explicar mejor en qué necesitas ayuda?\\"}","localhost:5678","keep-alive","129","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","no se che","session_1764775828617_yd6ovh4gy","2025-12-03T15:42:12.774Z","anonymous",["106"],"Human: json\\nno se che ",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
84	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} ","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764776558845,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764776558846,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764776558856,"executionTime":1671,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764776558846,"executionIndex":1,"source":"32","hints":"33","executionTime":1682,"executionStatus":"26","data":"34"},{"startTime":1764776560528,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":10,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":14,"promptTokens":15,"totalTokens":29},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"numeros\\": [5, 12, 7]}","localhost:5678","keep-alive","134","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dame 3 numeros","session_1764775828617_yd6ovh4gy","2025-12-03T15:42:38.771Z","anonymous",["106"],"Human: json\\ndame 3 numeros ",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
85	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} ","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764776622174,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764776622175,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764776622183,"executionTime":976,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764776622176,"executionIndex":1,"source":"32","hints":"33","executionTime":985,"executionStatus":"26","data":"34"},{"startTime":1764776623161,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":10,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","accept":"84","sec-ch-ua":"85","content-type":"86","sec-ch-ua-mobile":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","sessionId":"97","timestamp":"98","userId":"99"},"http://localhost:5678/webhook-test/ever","test",{"generations":"100"},{"completionTokens":8,"promptTokens":15,"totalTokens":23},["101"],{"openai_api_key":"102","model":"103","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"104","model_kwargs":"105"},"{\\"animal\\": \\"perro\\"}","localhost:5678","keep-alive","133","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","application/json, text/plain, */*","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","application/json","?0","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dame 1 animal","session_1764775828617_yd6ovh4gy","2025-12-03T15:43:42.096Z","anonymous",["106"],"Human: json\\ndame 1 animal ",{"lc":1,"type":"107","id":"108"},"gpt-4.1-nano",{"baseURL":"109","fetchOptions":"110","defaultHeaders":"111"},{"response_format":"112"},["113"],"secret",["114"],"https://api.mammouth.ai/v1",{},{"Authorization":"115"},{"type":"116"},{"text":"78","generationInfo":"117"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"118"},"stop"]
86	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} ","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764776890716,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764776890719,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764776890763,"executionTime":3124,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764776890721,"executionIndex":1,"source":"32","hints":"33","executionTime":3172,"executionStatus":"26","data":"34"},{"startTime":1764776893894,"executionIndex":3,"source":"35","hints":"36","executionTime":4,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":9,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":48,"promptTokens":14,"totalTokens":62},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\"nombre\\": \\"Hiedra\\", \\"tipo\\": \\"planta de interior\\", \\"características\\": \\"Es una planta trepadora de hojas verdes y brillantes, fácil de cuidar y ideal para decorar espacios interiores.\\"}","localhost:5678","keep-alive","275","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarydaQDg6U7CIpyiqkp","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dame una planta","session_1764776885055_y5bo2f4u7",["104"],"Human: json\\ndame una planta ",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
87	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"AI Agent",["14","4","15"],{"Webhook":"16","OpenAI Chat Model":"17","AI Agent":"18"},{},{},[],{"OpenAI Chat Model":"19"},{},{},{"version":1,"establishedAt":1764776999137,"source":"20"},"Webhook","OpenAI Chat Model",["21"],["22"],["23"],["24"],"manual",{"startTime":1764776890719,"executionIndex":0,"source":"25","hints":"26","executionTime":1,"executionStatus":"27","data":"28"},{"startTime":1764776999225,"executionTime":1648,"executionIndex":2,"executionStatus":"27","source":"29","data":"30","inputOverride":"31","metadata":"32"},{"startTime":1764776999138,"executionIndex":1,"source":"33","hints":"34","executionTime":1741,"executionStatus":"27","data":"35"},{"subRun":"36"},[],[],"success",{"main":"37"},["38"],{"ai_languageModel":"39"},{"ai_languageModel":"40"},{"subRun":"36"},["41"],[],{"main":"42"},["43"],["44"],{"previousNode":"4","previousNodeRun":0},["45"],["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"node":"15","runIndex":0},["48"],["49"],["50"],["51"],{"json":"52","pairedItem":"53"},{"json":"54"},{"json":"55"},{"json":"56","pairedItem":"57"},{"headers":"58","params":"59","query":"60","body":"61","webhookUrl":"62","executionMode":"63"},{"item":0},{"response":"64","tokenUsage":"65"},{"messages":"66","estimatedTokens":27,"options":"67"},{"output":"68"},{"item":0},{"host":"69","connection":"70","content-length":"71","sec-ch-ua-platform":"72","user-agent":"73","sec-ch-ua":"74","content-type":"75","sec-ch-ua-mobile":"76","accept":"77","sec-gpc":"78","accept-language":"79","origin":"80","sec-fetch-site":"81","sec-fetch-mode":"82","sec-fetch-dest":"83","referer":"84","accept-encoding":"85"},{},{},{"message":"86","user":"87"},"http://localhost:5678/webhook-test/ever","test",{"generations":"88"},{"completionTokens":21,"promptTokens":32,"totalTokens":53},["89"],{"openai_api_key":"90","model":"91","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"92","model_kwargs":"93"},"{\\n  \\"response\\": \\"La planta que te recomiendo es la suculenta Aloe Vera.\\"\\n}","localhost:5678","keep-alive","275","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarydaQDg6U7CIpyiqkp","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dame una planta","session_1764776885055_y5bo2f4u7",["94"],"Human: json\\ndame una planta \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"95","id":"96"},"gpt-4.1-nano",{"baseURL":"97","fetchOptions":"98","defaultHeaders":"99"},{"response_format":"100"},["101"],"secret",["102"],"https://api.mammouth.ai/v1",{},{"Authorization":"103"},{"type":"104"},{"text":"68","generationInfo":"105"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"106"},"stop"]
88	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Respond to Webhook",["14","15","4","16"],{"Webhook":"17","AI Agent":"18","Respond to Webhook":"19"},{},{},[],{},{},{},{"version":1,"establishedAt":1764777006392,"source":"20"},"Webhook","AI Agent","OpenAI Chat Model",["21"],["22"],["23"],"manual",{"startTime":1764776890719,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764776999138,"executionIndex":1,"source":"28","hints":"29","executionTime":1741,"executionStatus":"26","data":"30"},{"startTime":1764777006392,"executionIndex":2,"source":"31","hints":"32","executionTime":2,"executionStatus":"26","data":"33"},[],[],"success",{"main":"34"},["35"],[],{"main":"36"},["37"],[],{"main":"38"},["39"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["40"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["41"],["42"],["43"],["44"],{"json":"45","pairedItem":"46"},{"json":"47","pairedItem":"48"},{"json":"47","pairedItem":"49"},{"headers":"50","params":"51","query":"52","body":"53","webhookUrl":"54","executionMode":"55"},{"item":0},{"output":"56"},{"item":0},{"item":0},{"host":"57","connection":"58","content-length":"59","sec-ch-ua-platform":"60","user-agent":"61","sec-ch-ua":"62","content-type":"63","sec-ch-ua-mobile":"64","accept":"65","sec-gpc":"66","accept-language":"67","origin":"68","sec-fetch-site":"69","sec-fetch-mode":"70","sec-fetch-dest":"71","referer":"72","accept-encoding":"73"},{},{},{"message":"74","user":"75"},"http://localhost:5678/webhook-test/ever","test","{\\n  \\"response\\": \\"La planta que te recomiendo es la suculenta Aloe Vera.\\"\\n}","localhost:5678","keep-alive","275","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarydaQDg6U7CIpyiqkp","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dame una planta","session_1764776885055_y5bo2f4u7"]
89	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764777019599,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764777019600,"executionIndex":0,"source":"24","hints":"25","executionTime":2,"executionStatus":"26","data":"27"},{"startTime":1764777019617,"executionTime":1452,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764777019602,"executionIndex":1,"source":"32","hints":"33","executionTime":1469,"executionStatus":"26","data":"34"},{"startTime":1764777021072,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":29,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":61,"promptTokens":34,"totalTokens":95},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"Sí, hay muchas plantas comestibles como el trigo, el arroz, la avena, la espinaca, la lechuga, la zanahoria, la remolacha, el tomate, la papa, la cebolla, y muchas más.\\"\\n}","localhost:5678","keep-alive","279","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarya3hkSCGyBNwFtQwE","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","planta comestible¿","session_1764776885055_y5bo2f4u7",["104"],"Human: json\\nplanta comestible¿ \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
90	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764777113600,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764777113600,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764777113613,"executionTime":1669,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764777113601,"executionIndex":1,"source":"32","hints":"33","executionTime":1684,"executionStatus":"26","data":"34"},{"startTime":1764777115286,"executionIndex":3,"source":"35","hints":"36","executionTime":4,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":28,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":14,"promptTokens":33,"totalTokens":47},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"animal no comestible\\"\\n}","localhost:5678","keep-alive","280","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarymNDF1SBBCFxijtKH","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","animal no comestible","session_1764776885055_y5bo2f4u7",["104"],"Human: json\\nanimal no comestible \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
91	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764777149679,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764777149680,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764777149696,"executionTime":64038,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764777149681,"executionIndex":1,"source":"32","hints":"33","executionTime":64055,"executionStatus":"26","data":"34"},{"startTime":1764777213736,"executionIndex":3,"source":"35","hints":"36","executionTime":1,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":32,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":12,"promptTokens":37,"totalTokens":49},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"elefante\\"\\n}","localhost:5678","keep-alive","290","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryDg7N6ZMriJ8BpKDr","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dame un animal no comestible\\r\\n","session_1764776885055_y5bo2f4u7",["104"],"Human: json\\ndame un animal no comestible\\r\\n \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
92	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764777327058,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764777327059,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764777327082,"executionTime":1963,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764777327062,"executionIndex":1,"source":"32","hints":"33","executionTime":1985,"executionStatus":"26","data":"34"},{"startTime":1764777329047,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":28,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":85,"promptTokens":33,"totalTokens":118},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"El baloncesto, conocido en algunos países como básquet o basket, es un deporte de equipo en el que dos conjuntos de cinco jugadores cada uno intentan anotar puntos lanzando un balón a través del aro del equipo contrario. Se juega en una cancha rectangular con un aro en cada extremo y requiere habilidades como el tiro, el pase, la dribla y la defensa.\\"\\n}","localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary23BCNBJuJo4dGVFt","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","QUE ES BASQUET","session_1764777317645_yu0usyiuw",["104"],"Human: json\\nQUE ES BASQUET \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
93	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764777496641,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764777496642,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764777496666,"executionTime":15426,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764777496643,"executionIndex":1,"source":"32","hints":"33","executionTime":15452,"executionStatus":"26","data":"34"},{"startTime":1764777512097,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":29,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":67,"promptTokens":34,"totalTokens":101},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"Los arañas se comen en su propio hábitat, generalmente en lugares oscuros y protegidos como rincones, esquinas, techos, o en lugares donde puedan cazar insectos. No se comen, sino que cazan y se alimentan de otros pequeños insectos.\\"\\n}","localhost:5678","keep-alive","282","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundarytpxHqGDERMLm5XgP","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","dende se comen araños","session_1764777317645_yu0usyiuw",["104"],"Human: json\\ndende se comen araños \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
94	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764777678899,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764777678899,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764777678909,"executionTime":25410,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764777678900,"executionIndex":1,"source":"32","hints":"33","executionTime":25420,"executionStatus":"26","data":"34"},{"startTime":1764777704321,"executionIndex":3,"source":"35","hints":"36","executionTime":1,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":27,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":62,"promptTokens":32,"totalTokens":94},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"La sombra es la proyección de un objeto que bloquea la luz, creando una zona oscura en el espacio donde la luz no llega. También puede referirse a la figura o silueta que se forma en la superficie cuando un objeto bloquea la luz.\\"\\n}","localhost:5678","keep-alive","276","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryubhjEXjrLDAjHtxV","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","que es la sombra","session_1764777317645_yu0usyiuw",["104"],"Human: json\\nque es la sombra \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
95	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764778016000,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764778016005,"executionIndex":0,"source":"24","hints":"25","executionTime":2,"executionStatus":"26","data":"27"},{"startTime":1764778016092,"executionTime":4868,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764778016008,"executionIndex":1,"source":"32","hints":"33","executionTime":4954,"executionStatus":"26","data":"34"},{"startTime":1764778020962,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":31,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":34,"promptTokens":36,"totalTokens":70},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"Lo siento, no tengo suficiente información para determinar tu signo zodiacal. Por favor, comparte tu fecha de nacimiento para poder ayudarte.\\"\\n}","localhost:5678","keep-alive","283","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary3TjjLkiAryWBBtiT","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","algun signo zoodiacal¿","session_1764777317645_yu0usyiuw",["104"],"Human: json\\nalgun signo zoodiacal¿ \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
96	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764778173811,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764778173813,"executionIndex":0,"source":"24","hints":"25","executionTime":2,"executionStatus":"26","data":"27"},{"startTime":1764778173857,"executionTime":22015,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764778173816,"executionIndex":1,"source":"32","hints":"33","executionTime":22057,"executionStatus":"26","data":"34"},{"startTime":1764778195873,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":29,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":33,"promptTokens":34,"totalTokens":67},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"¿Podrías especificar qué personaje de Disney te gustaría conocer o sobre qué tema en particular? Así puedo ayudarte mejor.\\"\\n}","localhost:5678","keep-alive","279","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryxlE1JFFfgFzBrsUI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","personaje de disnep","session_1764777317645_yu0usyiuw",["104"],"Human: json\\npersonaje de disnep \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
135	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"OpenAI - Generar Embedding",["14","15","4"],{"Webhook - Chat":"16","Extraer Query":"17","OpenAI - Generar Embedding":"18"},{},{},[],{},{},{},{"version":1,"establishedAt":1764846762575,"source":"19"},"Webhook - Chat","Extraer Query",["20"],["21"],["22"],"manual",{"startTime":1764846750890,"executionIndex":0,"source":"23","hints":"24","executionTime":2,"executionStatus":"25","data":"26"},{"startTime":1764846758592,"executionIndex":1,"source":"27","hints":"28","executionTime":23,"executionStatus":"25","data":"29"},{"startTime":1764846762579,"executionIndex":2,"source":"30","hints":"31","executionTime":149,"executionStatus":"25","data":"32"},[],[],"success",{"main":"33"},["34"],[],{"main":"35"},["36"],[],{"main":"37"},["38"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["39"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["40"],["41"],["42"],["43"],{"json":"44","pairedItem":"45"},{"json":"46","pairedItem":"47"},{"json":"48","pairedItem":"49"},{"headers":"50","params":"51","query":"52","body":"53","webhookUrl":"54","executionMode":"55"},{"item":0},{"headers":"56","params":"57","query":"58","body":"59","webhookUrl":"54","executionMode":"55","myNewField":1},{"item":0},{"message":"60"},{"item":0},{"host":"61","connection":"62","content-length":"63","sec-ch-ua-platform":"64","user-agent":"65","sec-ch-ua":"66","content-type":"67","sec-ch-ua-mobile":"68","accept":"69","sec-gpc":"70","accept-language":"71","origin":"72","sec-fetch-site":"73","sec-fetch-mode":"74","sec-fetch-dest":"75","referer":"76","accept-encoding":"77"},{},{},{"message":"78","user":"79"},"http://localhost:5678/webhook-test/ever","test",{"host":"61","connection":"62","content-length":"63","sec-ch-ua-platform":"64","user-agent":"65","sec-ch-ua":"66","content-type":"67","sec-ch-ua-mobile":"68","accept":"69","sec-gpc":"70","accept-language":"71","origin":"72","sec-fetch-site":"73","sec-fetch-mode":"74","sec-fetch-dest":"75","referer":"76","accept-encoding":"77"},{},{},{"message":"78","user":"79"},"Welcome to the OpenAI API! Documentation is available at https://platform.openai.com/docs/api-reference","localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7"]
136	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"OpenAI - Generar Embedding",["14","15","4"],{"Webhook - Chat":"16","Extraer Query":"17","OpenAI - Generar Embedding":"18"},{},{},[],{},{},{},{"version":1,"establishedAt":1764846769281,"source":"19"},"Webhook - Chat","Extraer Query",["20"],["21"],["22"],"manual",{"startTime":1764846750890,"executionIndex":0,"source":"23","hints":"24","executionTime":2,"executionStatus":"25","data":"26"},{"startTime":1764846758592,"executionIndex":1,"source":"27","hints":"28","executionTime":23,"executionStatus":"25","data":"29"},{"startTime":1764846769283,"executionIndex":2,"source":"30","hints":"31","executionTime":1137,"executionStatus":"25","data":"32"},[],[],"success",{"main":"33"},["34"],[],{"main":"35"},["36"],[],{"main":"37"},["38"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["39"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["40"],["41"],["42"],["43"],{"json":"44","pairedItem":"45"},{"json":"46","pairedItem":"47"},{"json":"48","pairedItem":"49"},{"headers":"50","params":"51","query":"52","body":"53","webhookUrl":"54","executionMode":"55"},{"item":0},{"headers":"56","params":"57","query":"58","body":"59","webhookUrl":"54","executionMode":"55","myNewField":1},{"item":0},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"host":"60","connection":"61","content-length":"62","sec-ch-ua-platform":"63","user-agent":"64","sec-ch-ua":"65","content-type":"66","sec-ch-ua-mobile":"67","accept":"68","sec-gpc":"69","accept-language":"70","origin":"71","sec-fetch-site":"72","sec-fetch-mode":"73","sec-fetch-dest":"74","referer":"75","accept-encoding":"76"},{},{},{"message":"77","user":"78"},"http://localhost:5678/webhook-test/ever","test",{"host":"60","connection":"61","content-length":"62","sec-ch-ua-platform":"63","user-agent":"64","sec-ch-ua":"65","content-type":"66","sec-ch-ua-mobile":"67","accept":"68","sec-gpc":"69","accept-language":"70","origin":"71","sec-fetch-site":"72","sec-fetch-mode":"73","sec-fetch-dest":"74","referer":"75","accept-encoding":"76"},{},{},{"message":"77","user":"78"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7"]
97	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764778805984,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764778805995,"executionIndex":0,"source":"24","hints":"25","executionTime":5,"executionStatus":"26","data":"27"},{"startTime":1764778806145,"executionTime":47447,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764778806005,"executionIndex":1,"source":"32","hints":"33","executionTime":47593,"executionStatus":"26","data":"34"},{"startTime":1764778853599,"executionIndex":3,"source":"35","hints":"36","executionTime":4,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":25,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":19,"promptTokens":30,"totalTokens":49},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"Sí, estoy aquí. ¿En qué puedo ayudarte?\\"\\n}","localhost:5678","keep-alive","266","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryuZ4qlC3HhdXk0jbB","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","estas?","session_1764778786301_2hi4t1blx",["104"],"Human: json\\nestas? \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
98	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764779004477,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764779004479,"executionIndex":0,"source":"24","hints":"25","executionTime":3,"executionStatus":"26","data":"27"},{"startTime":1764779004520,"executionTime":2961,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764779004483,"executionIndex":1,"source":"32","hints":"33","executionTime":3001,"executionStatus":"26","data":"34"},{"startTime":1764779007486,"executionIndex":3,"source":"35","hints":"36","executionTime":3,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":26,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":248,"promptTokens":31,"totalTokens":279},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"Para correr un archivo JSON, primero debes entender que JSON es un formato de datos y no un programa ejecutable. Si quieres usar los datos en un programa, debes cargar el archivo JSON en un lenguaje de programación como Python, JavaScript, etc. Por ejemplo, en Python puedes usar la librería `json` para cargar y manipular los datos. Aquí tienes un ejemplo básico:\\\\n\\\\n```python\\\\nimport json\\\\n\\\\n# Cargar datos desde un archivo JSON\\\\nwith open('archivo.json', 'r') as file:\\\\n    datos = json.load(file)\\\\n\\\\n# Ahora puedes usar la variable 'datos' en tu programa\\\\nprint(datos)\\\\n```\\\\n\\\\nEn JavaScript, puedes usar `fetch` o `require` (en entornos Node.js) para cargar y usar JSON. Por ejemplo:\\\\n\\\\n```javascript\\\\n// En un entorno de navegador\\\\nfetch('archivo.json')\\\\n  .then(response => response.json())\\\\n  .then(data => {\\\\n    console.log(data);\\\\n  });\\\\n```\\\\n\\\\nRecuerda que JSON solo es un formato de datos, no un programa que puedas 'ejecutar' directamente.\\"\\n}","localhost:5678","keep-alive","273","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryCt1gSiZdBFsBj4Bx","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","como se corre","session_1764778921727_1k352wqy6",["104"],"Human: json\\ncomo se corre \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
99	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764779131121,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764779131133,"executionIndex":0,"source":"24","hints":"25","executionTime":3,"executionStatus":"26","data":"27"},{"startTime":1764779131197,"executionTime":2620,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764779131140,"executionIndex":1,"source":"32","hints":"33","executionTime":2682,"executionStatus":"26","data":"34"},{"startTime":1764779133822,"executionIndex":3,"source":"35","hints":"36","executionTime":6,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":27,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":93,"promptTokens":32,"totalTokens":125},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"La palabra 'naranja' se refiere tanto al color como a la fruta, y su origen proviene del sánscrito 'nāraṅga', que a su vez llegó al español a través del árabe y el latín. La fruta recibió este nombre por su color característico, que es un tono entre rojo y amarillo, y con el tiempo el término se asoció también con el color mismo.\\"\\n}","localhost:5678","keep-alive","285","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryQq5OKAqlShYYm7Zn","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","porque naranja es naranja","session_1764779120537_ngh9uve5a",["104"],"Human: json\\nporque naranja es naranja \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
100	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764779523361,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764779523377,"executionIndex":0,"source":"24","hints":"25","executionTime":6,"executionStatus":"26","data":"27"},{"startTime":1764779523515,"executionTime":23526,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764779523387,"executionIndex":1,"source":"32","hints":"33","executionTime":23664,"executionStatus":"26","data":"34"},{"startTime":1764779547053,"executionIndex":3,"source":"35","hints":"36","executionTime":5,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":28,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":128,"promptTokens":33,"totalTokens":161},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"El cielo es azul debido a un fenómeno llamado dispersión de Rayleigh. La luz del sol, que es blanca, está compuesta por diferentes colores que tienen diferentes longitudes de onda. Cuando la luz solar entra en la atmósfera de la Tierra, las moléculas de aire dispersan más eficazmente la luz de onda corta, como el azul y el violeta. Sin embargo, nuestros ojos son más sensibles al azul, y la mayor parte de la luz dispersada en todas las direcciones es azul, lo que hace que el cielo nos parezca de ese color durante el día.\\"\\n}","localhost:5678","keep-alive","283","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryhZlYPFl2jvdVGQ6y","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","porque el cielo es azul","session_1764779120537_ngh9uve5a",["104"],"Human: json\\nporque el cielo es azul \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
101	{"id":"aGurSLzad9QHqXSa","name":"My workflow","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764784192338,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764784192353,"executionIndex":0,"source":"24","hints":"25","executionTime":6,"executionStatus":"26","data":"27"},{"startTime":1764784192499,"executionTime":21988,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764784192366,"executionIndex":1,"source":"32","hints":"33","executionTime":22134,"executionStatus":"26","data":"34"},{"startTime":1764784214501,"executionIndex":3,"source":"35","hints":"36","executionTime":12,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":27,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","connection":"80","content-length":"81","sec-ch-ua-platform":"82","user-agent":"83","sec-ch-ua":"84","content-type":"85","sec-ch-ua-mobile":"86","accept":"87","sec-gpc":"88","accept-language":"89","origin":"90","sec-fetch-site":"91","sec-fetch-mode":"92","sec-fetch-dest":"93","referer":"94","accept-encoding":"95"},{},{},{"message":"96","user":"97"},"http://localhost:5678/webhook-test/ever","test",{"generations":"98"},{"completionTokens":70,"promptTokens":32,"totalTokens":102},["99"],{"openai_api_key":"100","model":"101","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"102","model_kwargs":"103"},"{\\n  \\"response\\": \\"¡Claro! ¿Sabías que las abejas son responsables de polinizar aproximadamente un tercio de los cultivos que consumimos? Sin ellas, muchas frutas, verduras y nueces serían mucho más difíciles de conseguir. Además, su papel en el ecosistema es fundamental para mantener la biodiversidad.\\"\\n}","localhost:5678","keep-alive","273","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary3emrquYGJkno7IBQ","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","cuentame algo","session_1764779120537_ngh9uve5a",["104"],"Human: json\\ncuentame algo \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"105","id":"106"},"gpt-4.1-nano",{"baseURL":"107","fetchOptions":"108","defaultHeaders":"109"},{"response_format":"110"},["111"],"secret",["112"],"https://api.mammouth.ai/v1",{},{"Authorization":"113"},{"type":"114"},{"text":"78","generationInfo":"115"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"116"},"stop"]
102	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido)","active":false,"nodes":[{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"","notice":""},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"oldVersionNotice":"","resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};","notice":""},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}],"connections":{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"error":"4","runData":"5","pinData":"6","lastNodeExecuted":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},{"level":"14","tags":"15","description":"16","node":"17","message":"18","stack":"19"},{"Webhook - Chat1":"20","Extraer Query":"21"},{},"Extraer Query",{},["22"],{},{},{},{"version":1,"establishedAt":1764786376178,"source":"23"},"error",{},"Please return an array of objects, one for each item you would like to output.",{"parameters":"24","id":"25","name":"7","type":"26","typeVersion":2,"position":"27"},"Code doesn't return items properly","Error: Code doesn't return items properly\\n    at validateRunCodeAllItems (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Code/result-validation.ts:132:9)\\n    at JavaScriptSandbox.validateRunCodeAllItems (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Code/Sandbox.ts:74:33)\\n    at JavaScriptSandbox.runCodeAllItems (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Code/JavaScriptSandbox.ts:98:15)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Code/Code.node.ts:198:14)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["28"],["29"],{"node":"30","data":"31","source":"32"},"manual",{"mode":"33","language":"34","jsCode":"35","notice":"35"},"75f4ff61-7fc1-439a-b995-455dd623ef93","n8n-nodes-base.code",[384,304],{"startTime":1764786376182,"executionIndex":0,"source":"36","hints":"37","executionTime":5,"executionStatus":"38","data":"39"},{"startTime":1764786376190,"executionIndex":1,"source":"40","hints":"41","executionTime":171,"executionStatus":"14","error":"42"},{"parameters":"43","id":"25","name":"7","type":"26","typeVersion":2,"position":"44"},{"main":"45"},{"main":"40"},"runOnceForAllItems","javaScript","",[],[],"success",{"main":"46"},["47"],[],{"level":"14","tags":"15","description":"16","node":"17","message":"18","stack":"19"},{"mode":"33","language":"34","jsCode":"35","notice":"35"},[384,304],["48"],["49"],{"previousNode":"50"},["51"],["52"],"Webhook - Chat1",{"json":"53","pairedItem":"54"},{"json":"53","pairedItem":"55"},{"headers":"56","params":"57","query":"58","body":"59","webhookUrl":"60","executionMode":"61"},{"item":0},{"item":0},{"host":"62","connection":"63","sec-ch-ua":"64","sec-ch-ua-mobile":"65","sec-ch-ua-platform":"66","upgrade-insecure-requests":"67","user-agent":"68","accept":"69","sec-gpc":"67","accept-language":"70","sec-fetch-site":"71","sec-fetch-mode":"72","sec-fetch-user":"73","sec-fetch-dest":"74","accept-encoding":"75","cookie":"76"},{},{},{},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","none","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX19D%2F8pCwcj4ZxSklImec3gUy0%2BJZ%2BQlx%2FbLYeSiD3NhyCAI%2FeV3JByN%2FiVbiIaM7zd%2Bgwpldebn8yMY5bEsit50xyrizkxDJmAOR8QjLnlQuxSFF%2FzSLO%2By8l1pTZj5YQTz%2Fo5bN1zrUQ%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764786327163%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D"]
103	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido)","active":false,"nodes":[{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"oldVersionNotice":"","resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};","notice":""},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}],"connections":{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Extraer Query",["14","4"],{"Webhook - Chat1":"15","Extraer Query":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764786404601,"source":"17"},"Webhook - Chat1",["18"],["19"],"manual",{"startTime":1764786376182,"executionIndex":0,"source":"20","hints":"21","executionTime":5,"executionStatus":"22","data":"23"},{"startTime":1764786404602,"executionIndex":1,"source":"24","hints":"25","executionTime":23,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],[],{"main":"29"},["30"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["31"],["32"],["33"],{"json":"34","pairedItem":"35"},{"json":"36","pairedItem":"37"},{"headers":"38","params":"39","query":"40","body":"41","webhookUrl":"42","executionMode":"43"},{"item":0},{"headers":"44","params":"45","query":"46","body":"47","webhookUrl":"42","executionMode":"43","myNewField":1},{"item":0},{"host":"48","connection":"49","sec-ch-ua":"50","sec-ch-ua-mobile":"51","sec-ch-ua-platform":"52","upgrade-insecure-requests":"53","user-agent":"54","accept":"55","sec-gpc":"53","accept-language":"56","sec-fetch-site":"57","sec-fetch-mode":"58","sec-fetch-user":"59","sec-fetch-dest":"60","accept-encoding":"61","cookie":"62"},{},{},{},"http://localhost:5678/webhook-test/ever","test",{"host":"48","connection":"49","sec-ch-ua":"50","sec-ch-ua-mobile":"51","sec-ch-ua-platform":"52","upgrade-insecure-requests":"53","user-agent":"54","accept":"55","sec-gpc":"53","accept-language":"56","sec-fetch-site":"57","sec-fetch-mode":"58","sec-fetch-user":"59","sec-fetch-dest":"60","accept-encoding":"61","cookie":"62"},{},{},{},"localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","none","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX19D%2F8pCwcj4ZxSklImec3gUy0%2BJZ%2BQlx%2FbLYeSiD3NhyCAI%2FeV3JByN%2FiVbiIaM7zd%2Bgwpldebn8yMY5bEsit50xyrizkxDJmAOR8QjLnlQuxSFF%2FzSLO%2By8l1pTZj5YQTz%2Fo5bN1zrUQ%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764786327163%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D"]
104	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido)","active":false,"nodes":[{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"oldVersionNotice":"","resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};","notice":""},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}],"connections":{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"error":"4","runData":"5","pinData":"6","lastNodeExecuted":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},{"level":"14","tags":"15","description":"16","timestamp":1764786415299,"context":"17","functionality":"18","name":"19","node":"20","messages":"21","httpCode":"22","message":"23","stack":"24"},{"Webhook - Chat1":"25","Extraer Query":"26","OpenAI - Generar Embedding":"27","Qdrant - Buscar Candidatos1":"28"},{},"Qdrant - Buscar Candidatos1",{},["29","30"],{},{},{},{"version":1,"establishedAt":1764786410027,"source":"31"},"warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: invalid type: string \\\\\\\\\\\\\\"5\\\\\\\\\\\\\\", expected usize at line 1 column 59\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"32"},"regular","NodeApiError",{"parameters":"33","id":"34","name":"7","type":"35","typeVersion":4.1,"position":"36"},["16"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["37"],["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","n8n-nodes-base.httpRequest",[816,208],{"startTime":1764786410028,"executionIndex":0,"source":"57","hints":"58","executionTime":1,"executionStatus":"59","data":"60"},{"startTime":1764786410029,"executionIndex":1,"source":"61","hints":"62","executionTime":5,"executionStatus":"59","data":"63"},{"startTime":1764786410035,"executionIndex":2,"source":"64","hints":"65","executionTime":4753,"executionStatus":"59","data":"66"},{"startTime":1764786414790,"executionIndex":3,"source":"67","hints":"68","executionTime":709,"executionStatus":"69","error":"70"},{"parameters":"71","id":"34","name":"7","type":"35","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"parameters":"74","id":"75","name":"76","type":"35","typeVersion":4.1,"position":"77"},{"main":"78"},{"main":"79"},{"limit":"80","score_threshold":"81","with_payload":"82"},{"accept":"83"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"84"},{},[],[],"success",{"main":"85"},["86"],[],{"main":"87"},["88"],[],{"main":"89"},["90"],[],"error",{"level":"14","tags":"15","description":"16","timestamp":1764786415299,"context":"17","functionality":"18","name":"19","node":"20","messages":"21","httpCode":"22","message":"23","stack":"24"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"91","options":"92","infoMessage":"51"},[816,208],["93"],{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"94","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"95","options":"96","infoMessage":"51"},"19460c59-9c1f-4605-a302-7080babde4c7","Qdrant - Buscar Puestos1",[816,416],["97"],["98"],"5","0.7","true","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["99","100","101","102"],["103"],{"previousNode":"104"},["105"],{"previousNode":"106"},["97"],{"previousNode":"107"},{"parameters":"108"},{},["109"],"http://qdrant:6333/collections/puestos/points/search",{"parameters":"110"},{},["111"],{"previousNode":"107"},{"name":"112","value":"113"},{"name":"114","value":"80"},{"name":"115","value":"81"},{"name":"116","value":"82"},["117"],"Webhook - Chat1",["118"],"Extraer Query","OpenAI - Generar Embedding",["119","120","121","122"],{"json":"123","pairedItem":"124"},["125","126","127","128"],{"json":"123","pairedItem":"129"},"vector","={{ $json.data[0].embedding }}","limit","score_threshold","with_payload",{"json":"130","pairedItem":"131"},{"json":"132","pairedItem":"133"},{"name":"112","value":"113"},{"name":"114","value":"80"},{"name":"115","value":"81"},{"name":"116","value":"82"},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"name":"112","value":"134"},{"name":"114","value":"135"},{"name":"115","value":"81"},{"name":"116","value":"82"},{"item":0},{"headers":"136","params":"137","query":"138","body":"139","webhookUrl":"140","executionMode":"141"},{"item":0},{"headers":"142","params":"143","query":"144","body":"145","webhookUrl":"140","executionMode":"141","myNewField":1},{"item":0},"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}","3",{"host":"146","connection":"147","sec-ch-ua":"148","sec-ch-ua-mobile":"149","sec-ch-ua-platform":"150","upgrade-insecure-requests":"151","user-agent":"152","accept":"153","sec-gpc":"151","accept-language":"154","sec-fetch-site":"52","sec-fetch-mode":"155","sec-fetch-user":"156","sec-fetch-dest":"157","accept-encoding":"158","cookie":"159"},{},{},{},"http://localhost:5678/webhook-test/ever","test",{"host":"146","connection":"147","sec-ch-ua":"148","sec-ch-ua-mobile":"149","sec-ch-ua-platform":"150","upgrade-insecure-requests":"151","user-agent":"152","accept":"153","sec-gpc":"151","accept-language":"154","sec-fetch-site":"52","sec-fetch-mode":"155","sec-fetch-user":"156","sec-fetch-dest":"157","accept-encoding":"158","cookie":"159"},{},{},{},"localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX19PjKUbV1bnDAQZIs7W4PlkO9n6%2B2oErIFknfLCDL1UqiCkMrswmgpbmEhv8Ng6u5iW14uWP%2FXG8mFKzaf9i2hhThpUtNdbKS4vaJ8F4XjJ2ac3gOMhA4qXYFSIbJejNs5qOJ90XoAv8A%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764786407400%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D"]
105	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido)","active":false,"nodes":[{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"oldVersionNotice":"","resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};","notice":""},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}],"connections":{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook - Chat1",{"Webhook - Chat1":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764786514489,"source":"14"},["15"],"manual",{"startTime":1764786514490,"executionIndex":0,"source":"16","hints":"17","executionTime":1,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","sec-ch-ua":"33","sec-ch-ua-mobile":"34","sec-ch-ua-platform":"35","upgrade-insecure-requests":"36","user-agent":"37","accept":"38","sec-gpc":"36","accept-language":"39","sec-fetch-site":"40","sec-fetch-mode":"41","sec-fetch-user":"42","sec-fetch-dest":"43","accept-encoding":"44","cookie":"45"},{},{"name":"46"},{},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","none","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX183JSP0urarcNUUNeDUgqHbyEsJQK3MzJEOBAJIvOm8VTSadNHKGmrvyDcTiD87USD7qRAIw77K30xEdzMUVsE9HcFGm%2B5T2nDQJxiY63jwvRS%2FLrR4KC2EipEjWbARG2p0CdBFyZnqkg%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764786512560%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D","aeueo"]
106	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido)","active":false,"nodes":[{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"oldVersionNotice":"","resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};","notice":""},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}],"connections":{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Extraer Query",["14","4"],{"Webhook - Chat1":"15","Extraer Query":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764786529478,"source":"17"},"Webhook - Chat1",["18"],["19"],"manual",{"startTime":1764786514490,"executionIndex":0,"source":"20","hints":"21","executionTime":1,"executionStatus":"22","data":"23"},{"startTime":1764786529480,"executionIndex":1,"source":"24","hints":"25","executionTime":18,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],[],{"main":"29"},["30"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["31"],["32"],["33"],{"json":"34","pairedItem":"35"},{"json":"36","pairedItem":"37"},{"headers":"38","params":"39","query":"40","body":"41","webhookUrl":"42","executionMode":"43"},{"item":0},{"headers":"44","params":"45","query":"46","body":"47","webhookUrl":"42","executionMode":"43","myNewField":1},{"item":0},{"host":"48","connection":"49","sec-ch-ua":"50","sec-ch-ua-mobile":"51","sec-ch-ua-platform":"52","upgrade-insecure-requests":"53","user-agent":"54","accept":"55","sec-gpc":"53","accept-language":"56","sec-fetch-site":"57","sec-fetch-mode":"58","sec-fetch-user":"59","sec-fetch-dest":"60","accept-encoding":"61","cookie":"62"},{},{"name":"63"},{},"http://localhost:5678/webhook-test/ever","test",{"host":"48","connection":"49","sec-ch-ua":"50","sec-ch-ua-mobile":"51","sec-ch-ua-platform":"52","upgrade-insecure-requests":"53","user-agent":"54","accept":"55","sec-gpc":"53","accept-language":"56","sec-fetch-site":"57","sec-fetch-mode":"58","sec-fetch-user":"59","sec-fetch-dest":"60","accept-encoding":"61","cookie":"62"},{},{"name":"63"},{},"localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","none","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX183JSP0urarcNUUNeDUgqHbyEsJQK3MzJEOBAJIvOm8VTSadNHKGmrvyDcTiD87USD7qRAIw77K30xEdzMUVsE9HcFGm%2B5T2nDQJxiY63jwvRS%2FLrR4KC2EipEjWbARG2p0CdBFyZnqkg%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764786512560%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D","aeueo"]
107	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido)","active":false,"nodes":[{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"oldVersionNotice":"","resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};","notice":""},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}],"connections":{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"OpenAI - Generar Embedding",["14","15","4"],{"Webhook - Chat1":"16","Extraer Query":"17","OpenAI - Generar Embedding":"18"},{},{},[],{},{},{},{"version":1,"establishedAt":1764786533927,"source":"19"},"Webhook - Chat1","Extraer Query",["20"],["21"],["22"],"manual",{"startTime":1764786514490,"executionIndex":0,"source":"23","hints":"24","executionTime":1,"executionStatus":"25","data":"26"},{"startTime":1764786529480,"executionIndex":1,"source":"27","hints":"28","executionTime":18,"executionStatus":"25","data":"29"},{"startTime":1764786533928,"executionIndex":2,"source":"30","hints":"31","executionTime":3583,"executionStatus":"25","data":"32"},[],[],"success",{"main":"33"},["34"],[],{"main":"35"},["36"],[],{"main":"37"},["38"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["39"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["40"],["41"],["42"],["43"],{"json":"44","pairedItem":"45"},{"json":"46","pairedItem":"47"},{"json":"48","pairedItem":"49"},{"headers":"50","params":"51","query":"52","body":"53","webhookUrl":"54","executionMode":"55"},{"item":0},{"headers":"56","params":"57","query":"58","body":"59","webhookUrl":"54","executionMode":"55","myNewField":1},{"item":0},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"host":"60","connection":"61","sec-ch-ua":"62","sec-ch-ua-mobile":"63","sec-ch-ua-platform":"64","upgrade-insecure-requests":"65","user-agent":"66","accept":"67","sec-gpc":"65","accept-language":"68","sec-fetch-site":"69","sec-fetch-mode":"70","sec-fetch-user":"71","sec-fetch-dest":"72","accept-encoding":"73","cookie":"74"},{},{"name":"75"},{},"http://localhost:5678/webhook-test/ever","test",{"host":"60","connection":"61","sec-ch-ua":"62","sec-ch-ua-mobile":"63","sec-ch-ua-platform":"64","upgrade-insecure-requests":"65","user-agent":"66","accept":"67","sec-gpc":"65","accept-language":"68","sec-fetch-site":"69","sec-fetch-mode":"70","sec-fetch-user":"71","sec-fetch-dest":"72","accept-encoding":"73","cookie":"74"},{},{"name":"75"},{},"localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","none","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX183JSP0urarcNUUNeDUgqHbyEsJQK3MzJEOBAJIvOm8VTSadNHKGmrvyDcTiD87USD7qRAIw77K30xEdzMUVsE9HcFGm%2B5T2nDQJxiY63jwvRS%2FLrR4KC2EipEjWbARG2p0CdBFyZnqkg%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764786512560%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D","aeueo"]
108	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido)","active":false,"nodes":[{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"oldVersionNotice":"","resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};","notice":""},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}],"connections":{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos1",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764786544384,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat1":"29","Extraer Query":"30","OpenAI - Generar Embedding":"31","Qdrant - Buscar Candidatos1":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764786544318,"source":"34"},"Webhook - Chat1","OpenAI - Generar Embedding","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: invalid type: string \\\\\\\\\\\\\\"5\\\\\\\\\\\\\\", expected usize at line 1 column 59\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","n8n-nodes-base.httpRequest",[816,208],{"startTime":1764786514490,"executionIndex":0,"source":"57","hints":"58","executionTime":1,"executionStatus":"59","data":"60"},{"startTime":1764786529480,"executionIndex":1,"source":"61","hints":"62","executionTime":18,"executionStatus":"59","data":"63"},{"startTime":1764786533928,"executionIndex":2,"source":"64","hints":"65","executionTime":3583,"executionStatus":"59","data":"66"},{"startTime":1764786544319,"executionIndex":3,"source":"67","hints":"68","executionTime":67,"executionStatus":"69","error":"70"},{"parameters":"71","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"limit":"74","score_threshold":"75","with_payload":"76"},{"accept":"77"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"78"},{},[],[],"success",{"main":"79"},["80"],[],{"main":"81"},["82"],[],{"main":"83"},["84"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764786544384,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"85","options":"86","infoMessage":"51"},[816,208],["87"],"5","0.7","true","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["88","89","90","91"],["92"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["93"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},["94"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"95"},{},["96"],{"name":"97","value":"98"},{"name":"99","value":"74"},{"name":"100","value":"75"},{"name":"101","value":"76"},["102"],["103"],["104"],["105","106","107","108"],{"json":"109","pairedItem":"110"},"vector","={{ $json.data[0].embedding }}","limit","score_threshold","with_payload",{"json":"111","pairedItem":"112"},{"json":"113","pairedItem":"114"},{"json":"109","pairedItem":"115"},{"name":"97","value":"98"},{"name":"99","value":"74"},{"name":"100","value":"75"},{"name":"101","value":"76"},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"headers":"116","params":"117","query":"118","body":"119","webhookUrl":"120","executionMode":"121"},{"item":0},{"headers":"122","params":"123","query":"124","body":"125","webhookUrl":"120","executionMode":"121","myNewField":1},{"item":0},{"item":0},{"host":"126","connection":"127","sec-ch-ua":"128","sec-ch-ua-mobile":"129","sec-ch-ua-platform":"130","upgrade-insecure-requests":"131","user-agent":"132","accept":"133","sec-gpc":"131","accept-language":"134","sec-fetch-site":"52","sec-fetch-mode":"135","sec-fetch-user":"136","sec-fetch-dest":"137","accept-encoding":"138","cookie":"139"},{},{"name":"140"},{},"http://localhost:5678/webhook-test/ever","test",{"host":"126","connection":"127","sec-ch-ua":"128","sec-ch-ua-mobile":"129","sec-ch-ua-platform":"130","upgrade-insecure-requests":"131","user-agent":"132","accept":"133","sec-gpc":"131","accept-language":"134","sec-fetch-site":"52","sec-fetch-mode":"135","sec-fetch-user":"136","sec-fetch-dest":"137","accept-encoding":"138","cookie":"139"},{},{"name":"140"},{},"localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX183JSP0urarcNUUNeDUgqHbyEsJQK3MzJEOBAJIvOm8VTSadNHKGmrvyDcTiD87USD7qRAIw77K30xEdzMUVsE9HcFGm%2B5T2nDQJxiY63jwvRS%2FLrR4KC2EipEjWbARG2p0CdBFyZnqkg%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764786512560%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D","aeueo"]
109	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido)","active":false,"nodes":[{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"oldVersionNotice":"","resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};","notice":""},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}],"connections":{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Puestos1",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764786548841,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat1":"29","Extraer Query":"30","OpenAI - Generar Embedding":"31","Qdrant - Buscar Puestos1":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764786548792,"source":"34"},"Webhook - Chat1","OpenAI - Generar Embedding","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: invalid type: string \\\\\\\\\\\\\\"3\\\\\\\\\\\\\\", expected usize at line 1 column 59\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"19460c59-9c1f-4605-a302-7080babde4c7","n8n-nodes-base.httpRequest",[816,416],{"startTime":1764786514490,"executionIndex":0,"source":"57","hints":"58","executionTime":1,"executionStatus":"59","data":"60"},{"startTime":1764786529480,"executionIndex":1,"source":"61","hints":"62","executionTime":18,"executionStatus":"59","data":"63"},{"startTime":1764786533928,"executionIndex":2,"source":"64","hints":"65","executionTime":3583,"executionStatus":"59","data":"66"},{"startTime":1764786548793,"executionIndex":3,"source":"67","hints":"68","executionTime":49,"executionStatus":"69","error":"70"},{"parameters":"71","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"limit":"74","score_threshold":"75","with_payload":"76"},{"accept":"77"},"POST","http://qdrant:6333/collections/puestos/points/search","","none","json","keypair",{"parameters":"78"},{},[],[],"success",{"main":"79"},["80"],[],{"main":"81"},["82"],[],{"main":"83"},["84"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764786548841,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"85","options":"86","infoMessage":"51"},[816,416],["87"],"3","0.7","true","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["88","89","90","91"],["92"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["93"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},["94"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"95"},{},["96"],{"name":"97","value":"98"},{"name":"99","value":"74"},{"name":"100","value":"75"},{"name":"101","value":"76"},["102"],["103"],["104"],["105","106","107","108"],{"json":"109","pairedItem":"110"},"vector","={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}","limit","score_threshold","with_payload",{"json":"111","pairedItem":"112"},{"json":"113","pairedItem":"114"},{"json":"109","pairedItem":"115"},{"name":"97","value":"98"},{"name":"99","value":"74"},{"name":"100","value":"75"},{"name":"101","value":"76"},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"headers":"116","params":"117","query":"118","body":"119","webhookUrl":"120","executionMode":"121"},{"item":0},{"headers":"122","params":"123","query":"124","body":"125","webhookUrl":"120","executionMode":"121","myNewField":1},{"item":0},{"item":0},{"host":"126","connection":"127","sec-ch-ua":"128","sec-ch-ua-mobile":"129","sec-ch-ua-platform":"130","upgrade-insecure-requests":"131","user-agent":"132","accept":"133","sec-gpc":"131","accept-language":"134","sec-fetch-site":"52","sec-fetch-mode":"135","sec-fetch-user":"136","sec-fetch-dest":"137","accept-encoding":"138","cookie":"139"},{},{"name":"140"},{},"http://localhost:5678/webhook-test/ever","test",{"host":"126","connection":"127","sec-ch-ua":"128","sec-ch-ua-mobile":"129","sec-ch-ua-platform":"130","upgrade-insecure-requests":"131","user-agent":"132","accept":"133","sec-gpc":"131","accept-language":"134","sec-fetch-site":"52","sec-fetch-mode":"135","sec-fetch-user":"136","sec-fetch-dest":"137","accept-encoding":"138","cookie":"139"},{},{"name":"140"},{},"localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX183JSP0urarcNUUNeDUgqHbyEsJQK3MzJEOBAJIvOm8VTSadNHKGmrvyDcTiD87USD7qRAIw77K30xEdzMUVsE9HcFGm%2B5T2nDQJxiY63jwvRS%2FLrR4KC2EipEjWbARG2p0CdBFyZnqkg%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764786512560%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D","aeueo"]
110	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook - Chat",{"Webhook - Chat":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764788564491,"source":"14"},["15"],"manual",{"startTime":1764788564492,"executionIndex":0,"source":"16","hints":"17","executionTime":0,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","sec-ch-ua":"33","sec-ch-ua-mobile":"34","sec-ch-ua-platform":"35","upgrade-insecure-requests":"36","user-agent":"37","accept":"38","sec-gpc":"36","accept-language":"39","sec-fetch-site":"40","sec-fetch-mode":"41","sec-fetch-user":"42","sec-fetch-dest":"43","accept-encoding":"44","cookie":"45","if-none-match":"46"},{},{"name":"47"},{},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","none","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2BokvEQwUCCfXw3iFxgxjjw1AvD%2BrjljHZxYq4%2FPU1yXDza3p4WXZmANTUkBkyfo3eFvh21WofGBw%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B6DNPUzP9Ly%2FBvkXYV749MJGmPrQ8XtyGNdb4obcXf317V5YKmzRFzBPd8iVxgHJIgazm7Cj3eN3s3JEfGsJA%2FlOH56fyP19YENvAZ03isQtlS7W%2FwJcrj0c0Tx8z36jj62X5tB5GizN9%2BqVML9q6wIr8ep8b1mvc%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JkJZHPNc8RkUr8KhCbVorg5QWlcudAZ2nxX%2F0F9%2Buj%2BWnpJzSQdNoAi1ey25Yp7sUsz0h4H2u46yx3WeHJfu6EETlzY%2BIDka5ExwDBpaUGyi5ZRGSfE%2B%2FaaKp89wjcVrUzpGXFlpyfeV%2BXFpvrwqdDwkxhLQD7Hg%3D; rl_session=RudderEncrypt%3AU2FsdGVkX1%2FPWtPBbVbpHHl50%2BnGF8RhxXMYFikZsujtgms1BXyEdiLq7Mpl6YvJqk1B9m38bXL0EcKBzkno8s1OUa%2BSVZtFrhkhfVKpcLK3W4FrVkvW0PNdtct8Sdp6bgtupQsfUJPO4GPGUCmyTQ%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764788450479%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D","W/\\"88c-b1fnJEGOati+xhGdf5r/+1mTK28\\"","aeueo"]
111	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"GET","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook - Chat",{"Webhook - Chat":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764788909180,"source":"14"},["15"],"manual",{"startTime":1764788909183,"executionIndex":0,"source":"16","hints":"17","executionTime":2,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","sec-ch-ua":"33","sec-ch-ua-mobile":"34","sec-ch-ua-platform":"35","upgrade-insecure-requests":"36","user-agent":"37","accept":"38","sec-gpc":"36","accept-language":"39","sec-fetch-site":"40","sec-fetch-mode":"41","sec-fetch-user":"42","sec-fetch-dest":"43","accept-encoding":"44","cookie":"45"},{},{},{},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","?0","\\"Windows\\"","1","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","es-ES,es;q=0.6","none","navigate","?1","document","gzip, deflate, br, zstd","rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2BmMYISTaoQEOV50860GGFlcnPk%2FUi3Md8%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FRyH8Ys2o1QPzmRvjcSX5YYpsfv3FczYk%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2Bf5uz3uWcwJ%2BG%2BRZu4MC%2F6%2FfuOYbODZhp9KnM1%2BfVCjAql43U20CTx%2FO5UB5SYfQJRin63YFlRNg%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX18wXn2zY0%2BFQF9yPOvFC189H85L3f5BNylL24L9TfB7LBG7KKBRglV1xwJseJGMyyFvyWtSKDBsNVt%2Bd%2Bbkp%2B%2F5KngQ35Smp9%2FLAggXmJIYz56whU%2FKgaZcRk%2FHoCA99A9t2kjRqdN07XKVOvQZQFMnRkzZeAdZ81k%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX1%2BaUF8jPDzPEopRej0Z98EtUz78BoqrzBhgRf7aNZxhvocc8IhKA%2BjajojHgiW2%2Bmch2ZBOZnGSMDhkRoz1KJTwXvA%2FZsGFOqMeB6np7QppRNtcIQ%2BRf660Tq7Mu3PqtRIY71A2Xb4QVDabnKfeWcEEnCEdJFl2tIs%3D; rl_session=RudderEncrypt%3AU2FsdGVkX19Wg9smkha4paF9sUGxjR6JpxMo964QplwpdMweZH7MUJf01QnZcfCvT8fncH%2B0iT5ecpUEKGhV6SVac1auRCHvnzKrvONl4yztV%2FrxrcdocAitLp1I%2FPZ02aJby01mCkHqv9B1Wo%2FiIw%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%22c73792bf178a05aa46c5c68a89c00bd871775266f99c923fb8fb90bf6c936a46%232b15051f-dee3-494f-91b5-2ede498cb491%22%2C%22%24sesid%22%3A%5B1764788874970%2C%22019ae555-9579-7ac3-9b45-df1bcfd2a8ee%22%2C1764784182637%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22http%3A%2F%2Flocalhost%3A5678%2Fhome%2Fworkflows%22%7D%7D"]
113	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"error":"4","runData":"5","pinData":"6","lastNodeExecuted":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},{"level":"14","tags":"15","description":"16","node":"17","message":"18","stack":"19"},{"Webhook - Chat":"20","Extraer Query":"21"},{},"Extraer Query",{},["22"],{},{},{},{"version":1,"establishedAt":1764788947785,"source":"23"},"error",{},"Please return an array of objects, one for each item you would like to output.",{"parameters":"24","id":"25","name":"7","type":"26","typeVersion":2,"position":"27"},"Code doesn't return items properly","Error: Code doesn't return items properly\\n    at validateRunCodeAllItems (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Code/result-validation.ts:132:9)\\n    at JavaScriptSandbox.validateRunCodeAllItems (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Code/Sandbox.ts:74:33)\\n    at JavaScriptSandbox.runCodeAllItems (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Code/JavaScriptSandbox.ts:98:15)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Code/Code.node.ts:198:14)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["28"],["29"],{"node":"30","data":"31","source":"32"},"manual",{"mode":"33","language":"34","jsCode":"35","notice":"35"},"c32769b5-42d9-4ed7-8b18-316495da8709","n8n-nodes-base.code",[-1824,-96],{"startTime":1764788947787,"executionIndex":0,"source":"36","hints":"37","executionTime":0,"executionStatus":"38","data":"39"},{"startTime":1764788947789,"executionIndex":1,"source":"40","hints":"41","executionTime":92,"executionStatus":"14","error":"42"},{"parameters":"43","id":"25","name":"7","type":"26","typeVersion":2,"position":"44"},{"main":"45"},{"main":"40"},"runOnceForAllItems","javaScript","",[],[],"success",{"main":"46"},["47"],[],{"level":"14","tags":"15","description":"16","node":"17","message":"18","stack":"19"},{"mode":"33","language":"34","jsCode":"35","notice":"35"},[-1824,-96],["48"],["49"],{"previousNode":"50"},["51"],["52"],"Webhook - Chat",{"json":"53","pairedItem":"54"},{"json":"53","pairedItem":"55"},{"headers":"56","params":"57","query":"58","body":"59","webhookUrl":"60","executionMode":"61"},{"item":0},{"item":0},{"host":"62","connection":"63","content-length":"64","sec-ch-ua-platform":"65","user-agent":"66","sec-ch-ua":"67","content-type":"68","sec-ch-ua-mobile":"69","accept":"70","sec-gpc":"71","accept-language":"72","origin":"73","sec-fetch-site":"74","sec-fetch-mode":"75","sec-fetch-dest":"76","referer":"77","accept-encoding":"78"},{},{},{"message":"79","user":"80"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","quien es mejor","session_1764788865859_vbqy9tjnr"]
114	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Obtenemos todos los items de entrada\\nconst items = $input.all();\\n\\nconst output = items.map((item) => {\\n  const body = item.json.body || {};\\n\\n  // Adaptamos al naming real que viene del frontend\\n  const query =\\n    body.message      // lo que estás mandando hoy desde React\\n    || body.query     // fallback por si luego cambias el frontend\\n    || '';\\n\\n  if (!query) {\\n    throw new Error(\\n      'No se encontró la query en el body. ' +\\n      'Esperaba un campo \\"message\\" o \\"query\\" en item.json.body.'\\n    );\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      timestamp: new Date().toISOString(),\\n      // si quieres conservar todo el body original:\\n      rawBody: body,\\n      // si quieres conservar headers para debug:\\n      headers: item.json.headers ?? {},\\n    },\\n  };\\n});\\n\\n// Devolvemos SIEMPRE un array de objetos { json: ... }\\nreturn output;\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Extraer Query",["14","4"],{"Webhook - Chat":"15","Extraer Query":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764789335360,"source":"17"},"Webhook - Chat",["18"],["19"],"manual",{"startTime":1764788947787,"executionIndex":0,"source":"20","hints":"21","executionTime":0,"executionStatus":"22","data":"23"},{"startTime":1764789335364,"executionIndex":1,"source":"24","hints":"25","executionTime":47,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],["29"],{"main":"30"},["31"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"32","location":"33"},["34"],["35"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["36"],{"json":"37","pairedItem":"38"},{"json":"39","pairedItem":"40"},{"headers":"41","params":"42","query":"43","body":"44","webhookUrl":"45","executionMode":"46"},{"item":0},{"query":"47","user":"48","timestamp":"49","rawBody":"50","headers":"51"},{"item":0},{"host":"52","connection":"53","content-length":"54","sec-ch-ua-platform":"55","user-agent":"56","sec-ch-ua":"57","content-type":"58","sec-ch-ua-mobile":"59","accept":"60","sec-gpc":"61","accept-language":"62","origin":"63","sec-fetch-site":"64","sec-fetch-mode":"65","sec-fetch-dest":"66","referer":"67","accept-encoding":"68"},{},{},{"message":"47","user":"48"},"http://localhost:5678/webhook-test/ever","test","quien es mejor","session_1764788865859_vbqy9tjnr","2025-12-03T19:15:35.404Z",{"message":"47","user":"48"},{"host":"52","connection":"53","content-length":"54","sec-ch-ua-platform":"55","user-agent":"56","sec-ch-ua":"57","content-type":"58","sec-ch-ua-mobile":"59","accept":"60","sec-gpc":"61","accept-language":"62","origin":"63","sec-fetch-site":"64","sec-fetch-mode":"65","sec-fetch-dest":"66","referer":"67","accept-encoding":"68"},"localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
115	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Obtenemos todos los items de entrada\\nconst items = $input.all();\\n\\nconst output = items.map((item) => {\\n  const body = item.json.body || {};\\n\\n  // Adaptamos al naming real que viene del frontend\\n  const query =\\n    body.message      // lo que estás mandando hoy desde React\\n    || body.query     // fallback por si luego cambias el frontend\\n    || '';\\n\\n  if (!query) {\\n    throw new Error(\\n      'No se encontró la query en el body. ' +\\n      'Esperaba un campo \\"message\\" o \\"query\\" en item.json.body.'\\n    );\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      timestamp: new Date().toISOString(),\\n      // si quieres conservar todo el body original:\\n      rawBody: body,\\n      // si quieres conservar headers para debug:\\n      headers: item.json.headers ?? {},\\n    },\\n  };\\n});\\n\\n// Devolvemos SIEMPRE un array de objetos { json: ... }\\nreturn output;\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"OpenAI - Generar Embedding",["14","15","4"],{"Webhook - Chat":"16","Extraer Query":"17","OpenAI - Generar Embedding":"18"},{},{},[],{},{},{},{"version":1,"establishedAt":1764789348961,"source":"19"},"Webhook - Chat","Extraer Query",["20"],["21"],["22"],"manual",{"startTime":1764788947787,"executionIndex":0,"source":"23","hints":"24","executionTime":0,"executionStatus":"25","data":"26"},{"startTime":1764789335364,"executionIndex":1,"source":"27","hints":"28","executionTime":47,"executionStatus":"25","data":"29"},{"startTime":1764789348962,"executionIndex":2,"source":"30","hints":"31","executionTime":194,"executionStatus":"25","data":"32"},[],[],"success",{"main":"33"},["34"],["35"],{"main":"36"},["37"],[],{"main":"38"},["39"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"40","location":"41"},["42"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["43"],["44"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["45"],["46"],{"json":"47","pairedItem":"48"},{"json":"49","pairedItem":"50"},{"json":"51","pairedItem":"52"},{"headers":"53","params":"54","query":"55","body":"56","webhookUrl":"57","executionMode":"58"},{"item":0},{"query":"59","user":"60","timestamp":"61","rawBody":"62","headers":"63"},{"item":0},{"message":"64"},{"item":0},{"host":"65","connection":"66","content-length":"67","sec-ch-ua-platform":"68","user-agent":"69","sec-ch-ua":"70","content-type":"71","sec-ch-ua-mobile":"72","accept":"73","sec-gpc":"74","accept-language":"75","origin":"76","sec-fetch-site":"77","sec-fetch-mode":"78","sec-fetch-dest":"79","referer":"80","accept-encoding":"81"},{},{},{"message":"59","user":"60"},"http://localhost:5678/webhook-test/ever","test","quien es mejor","session_1764788865859_vbqy9tjnr","2025-12-03T19:15:35.404Z",{"message":"59","user":"60"},{"host":"65","connection":"66","content-length":"67","sec-ch-ua-platform":"68","user-agent":"69","sec-ch-ua":"70","content-type":"71","sec-ch-ua-mobile":"72","accept":"73","sec-gpc":"74","accept-language":"75","origin":"76","sec-fetch-site":"77","sec-fetch-mode":"78","sec-fetch-dest":"79","referer":"80","accept-encoding":"81"},"Welcome to the OpenAI API! Documentation is available at https://platform.openai.com/docs/api-reference","localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
116	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Obtenemos todos los items de entrada\\nconst items = $input.all();\\n\\nconst output = items.map((item) => {\\n  const body = item.json.body || {};\\n\\n  // Adaptamos al naming real que viene del frontend\\n  const query =\\n    body.message      // lo que estás mandando hoy desde React\\n    || body.query     // fallback por si luego cambias el frontend\\n    || '';\\n\\n  if (!query) {\\n    throw new Error(\\n      'No se encontró la query en el body. ' +\\n      'Esperaba un campo \\"message\\" o \\"query\\" en item.json.body.'\\n    );\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      timestamp: new Date().toISOString(),\\n      // si quieres conservar todo el body original:\\n      rawBody: body,\\n      // si quieres conservar headers para debug:\\n      headers: item.json.headers ?? {},\\n    },\\n  };\\n});\\n\\n// Devolvemos SIEMPRE un array de objetos { json: ... }\\nreturn output;\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764789353154,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","OpenAI - Generar Embedding":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764789352924,"source":"34"},"Webhook - Chat","OpenAI - Generar Embedding","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: missing field `vector` at line 1 column 7\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764788947787,"executionIndex":0,"source":"57","hints":"58","executionTime":0,"executionStatus":"59","data":"60"},{"startTime":1764789335364,"executionIndex":1,"source":"61","hints":"62","executionTime":47,"executionStatus":"59","data":"63"},{"startTime":1764789348962,"executionIndex":2,"source":"64","hints":"65","executionTime":194,"executionStatus":"59","data":"66"},{"startTime":1764789352925,"executionIndex":3,"source":"67","hints":"68","executionTime":259,"executionStatus":"69","error":"70"},{"parameters":"71","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"":"51"},{"accept":"74"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"75"},{},[],[],"success",{"main":"76"},["77"],["78"],{"main":"79"},["80"],[],{"main":"81"},["82"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764789353154,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"83","options":"84","infoMessage":"51"},[-1392,-208],["85"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["86"],["87"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{"message":"88","location":"89"},["90"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},["91"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"92"},{},["93"],{"name":"51","value":"51"},["94"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["95"],["96"],["97"],{"json":"98","pairedItem":"99"},{"json":"100","pairedItem":"101"},{"json":"102","pairedItem":"103"},{"json":"98","pairedItem":"104"},{"name":"51","value":"51"},{"message":"105"},{"item":0},{"headers":"106","params":"107","query":"108","body":"109","webhookUrl":"110","executionMode":"111"},{"item":0},{"query":"112","user":"113","timestamp":"114","rawBody":"115","headers":"116"},{"item":0},{"item":0},"Welcome to the OpenAI API! Documentation is available at https://platform.openai.com/docs/api-reference",{"host":"117","connection":"118","content-length":"119","sec-ch-ua-platform":"120","user-agent":"121","sec-ch-ua":"122","content-type":"123","sec-ch-ua-mobile":"124","accept":"125","sec-gpc":"126","accept-language":"127","origin":"128","sec-fetch-site":"129","sec-fetch-mode":"130","sec-fetch-dest":"131","referer":"132","accept-encoding":"133"},{},{},{"message":"112","user":"113"},"http://localhost:5678/webhook-test/ever","test","quien es mejor","session_1764788865859_vbqy9tjnr","2025-12-03T19:15:35.404Z",{"message":"112","user":"113"},{"host":"117","connection":"118","content-length":"119","sec-ch-ua-platform":"120","user-agent":"121","sec-ch-ua":"122","content-type":"123","sec-ch-ua-mobile":"124","accept":"125","sec-gpc":"126","accept-language":"127","origin":"128","sec-fetch-site":"129","sec-fetch-mode":"130","sec-fetch-dest":"131","referer":"132","accept-encoding":"133"},"localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
117	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Extraer Query",["14","4"],{"Webhook - Chat":"15","Extraer Query":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764789475791,"source":"17"},"Webhook - Chat",["18"],["19"],"manual",{"startTime":1764788947787,"executionIndex":0,"source":"20","hints":"21","executionTime":0,"executionStatus":"22","data":"23"},{"startTime":1764789475793,"executionIndex":1,"source":"24","hints":"25","executionTime":7,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],["29"],{"main":"30"},["31"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"32","location":"33"},["34"],["35"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["36"],{"json":"37","pairedItem":"38"},{"json":"39","pairedItem":"40"},{"headers":"41","params":"42","query":"43","body":"44","webhookUrl":"45","executionMode":"46"},{"item":0},{"query":"47","user":"48","rawBody":"49"},{"item":0},{"host":"50","connection":"51","content-length":"52","sec-ch-ua-platform":"53","user-agent":"54","sec-ch-ua":"55","content-type":"56","sec-ch-ua-mobile":"57","accept":"58","sec-gpc":"59","accept-language":"60","origin":"61","sec-fetch-site":"62","sec-fetch-mode":"63","sec-fetch-dest":"64","referer":"65","accept-encoding":"66"},{},{},{"message":"47","user":"48"},"http://localhost:5678/webhook-test/ever","test","quien es mejor","session_1764788865859_vbqy9tjnr",{"message":"47","user":"48"},"localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
118	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"OpenAI - Generar Embedding",["14","15","4"],{"Webhook - Chat":"16","Extraer Query":"17","OpenAI - Generar Embedding":"18"},{},{},[],{},{},{},{"version":1,"establishedAt":1764789480811,"source":"19"},"Webhook - Chat","Extraer Query",["20"],["21"],["22"],"manual",{"startTime":1764788947787,"executionIndex":0,"source":"23","hints":"24","executionTime":0,"executionStatus":"25","data":"26"},{"startTime":1764789475793,"executionIndex":1,"source":"27","hints":"28","executionTime":7,"executionStatus":"25","data":"29"},{"startTime":1764789480812,"executionIndex":2,"source":"30","hints":"31","executionTime":125,"executionStatus":"25","data":"32"},[],[],"success",{"main":"33"},["34"],["35"],{"main":"36"},["37"],[],{"main":"38"},["39"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"40","location":"41"},["42"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["43"],["44"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["45"],["46"],{"json":"47","pairedItem":"48"},{"json":"49","pairedItem":"50"},{"json":"51","pairedItem":"52"},{"headers":"53","params":"54","query":"55","body":"56","webhookUrl":"57","executionMode":"58"},{"item":0},{"query":"59","user":"60","rawBody":"61"},{"item":0},{"message":"62"},{"item":0},{"host":"63","connection":"64","content-length":"65","sec-ch-ua-platform":"66","user-agent":"67","sec-ch-ua":"68","content-type":"69","sec-ch-ua-mobile":"70","accept":"71","sec-gpc":"72","accept-language":"73","origin":"74","sec-fetch-site":"75","sec-fetch-mode":"76","sec-fetch-dest":"77","referer":"78","accept-encoding":"79"},{},{},{"message":"59","user":"60"},"http://localhost:5678/webhook-test/ever","test","quien es mejor","session_1764788865859_vbqy9tjnr",{"message":"59","user":"60"},"Welcome to the OpenAI API! Documentation is available at https://platform.openai.com/docs/api-reference","localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
119	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764789483683,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","OpenAI - Generar Embedding":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764789483661,"source":"34"},"Webhook - Chat","OpenAI - Generar Embedding","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: missing field `vector` at line 1 column 7\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764788947787,"executionIndex":0,"source":"57","hints":"58","executionTime":0,"executionStatus":"59","data":"60"},{"startTime":1764789475793,"executionIndex":1,"source":"61","hints":"62","executionTime":7,"executionStatus":"59","data":"63"},{"startTime":1764789480812,"executionIndex":2,"source":"64","hints":"65","executionTime":125,"executionStatus":"59","data":"66"},{"startTime":1764789483662,"executionIndex":3,"source":"67","hints":"68","executionTime":22,"executionStatus":"69","error":"70"},{"parameters":"71","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"":"51"},{"accept":"74"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"75"},{},[],[],"success",{"main":"76"},["77"],["78"],{"main":"79"},["80"],[],{"main":"81"},["82"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764789483683,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"83","options":"84","infoMessage":"51"},[-1392,-208],["85"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["86"],["87"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{"message":"88","location":"89"},["90"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},["91"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"92"},{},["93"],{"name":"51","value":"51"},["94"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["95"],["96"],["97"],{"json":"98","pairedItem":"99"},{"json":"100","pairedItem":"101"},{"json":"102","pairedItem":"103"},{"json":"98","pairedItem":"104"},{"name":"51","value":"51"},{"message":"105"},{"item":0},{"headers":"106","params":"107","query":"108","body":"109","webhookUrl":"110","executionMode":"111"},{"item":0},{"query":"112","user":"113","rawBody":"114"},{"item":0},{"item":0},"Welcome to the OpenAI API! Documentation is available at https://platform.openai.com/docs/api-reference",{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"112","user":"113"},"http://localhost:5678/webhook-test/ever","test","quien es mejor","session_1764788865859_vbqy9tjnr",{"message":"112","user":"113"},"localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
120	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"OpenAI - Generar Embedding",["14","15","4"],{"Webhook - Chat":"16","Extraer Query":"17","OpenAI - Generar Embedding":"18"},{},{},[],{},{},{},{"version":1,"establishedAt":1764789598639,"source":"19"},"Webhook - Chat","Extraer Query",["20"],["21"],["22"],"manual",{"startTime":1764788947787,"executionIndex":0,"source":"23","hints":"24","executionTime":0,"executionStatus":"25","data":"26"},{"startTime":1764789475793,"executionIndex":1,"source":"27","hints":"28","executionTime":7,"executionStatus":"25","data":"29"},{"startTime":1764789598641,"executionIndex":2,"source":"30","hints":"31","executionTime":1224,"executionStatus":"25","data":"32"},[],[],"success",{"main":"33"},["34"],["35"],{"main":"36"},["37"],[],{"main":"38"},["39"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"40","location":"41"},["42"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["43"],["44"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["45"],["46"],{"json":"47","pairedItem":"48"},{"json":"49","pairedItem":"50"},{"json":"51","pairedItem":"52"},{"headers":"53","params":"54","query":"55","body":"56","webhookUrl":"57","executionMode":"58"},{"item":0},{"query":"59","user":"60","rawBody":"61"},{"item":0},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"host":"62","connection":"63","content-length":"64","sec-ch-ua-platform":"65","user-agent":"66","sec-ch-ua":"67","content-type":"68","sec-ch-ua-mobile":"69","accept":"70","sec-gpc":"71","accept-language":"72","origin":"73","sec-fetch-site":"74","sec-fetch-mode":"75","sec-fetch-dest":"76","referer":"77","accept-encoding":"78"},{},{},{"message":"59","user":"60"},"http://localhost:5678/webhook-test/ever","test","quien es mejor","session_1764788865859_vbqy9tjnr",{"message":"59","user":"60"},"localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
121	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764789607383,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","OpenAI - Generar Embedding":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764789607346,"source":"34"},"Webhook - Chat","OpenAI - Generar Embedding","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: missing field `vector` at line 1 column 7\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764788947787,"executionIndex":0,"source":"57","hints":"58","executionTime":0,"executionStatus":"59","data":"60"},{"startTime":1764789475793,"executionIndex":1,"source":"61","hints":"62","executionTime":7,"executionStatus":"59","data":"63"},{"startTime":1764789598641,"executionIndex":2,"source":"64","hints":"65","executionTime":1224,"executionStatus":"59","data":"66"},{"startTime":1764789607347,"executionIndex":3,"source":"67","hints":"68","executionTime":37,"executionStatus":"69","error":"70"},{"parameters":"71","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"":"51"},{"accept":"74"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"75"},{},[],[],"success",{"main":"76"},["77"],["78"],{"main":"79"},["80"],[],{"main":"81"},["82"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764789607383,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"83","options":"84","infoMessage":"51"},[-1392,-208],["85"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["86"],["87"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{"message":"88","location":"89"},["90"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},["91"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"92"},{},["93"],{"name":"51","value":"51"},["94"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["95"],["96"],["97"],{"json":"98","pairedItem":"99"},{"json":"100","pairedItem":"101"},{"json":"102","pairedItem":"103"},{"json":"98","pairedItem":"104"},{"name":"51","value":"51"},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"headers":"105","params":"106","query":"107","body":"108","webhookUrl":"109","executionMode":"110"},{"item":0},{"query":"111","user":"112","rawBody":"113"},{"item":0},{"item":0},{"host":"114","connection":"115","content-length":"116","sec-ch-ua-platform":"117","user-agent":"118","sec-ch-ua":"119","content-type":"120","sec-ch-ua-mobile":"121","accept":"122","sec-gpc":"123","accept-language":"124","origin":"125","sec-fetch-site":"126","sec-fetch-mode":"127","sec-fetch-dest":"128","referer":"129","accept-encoding":"130"},{},{},{"message":"111","user":"112"},"http://localhost:5678/webhook-test/ever","test","quien es mejor","session_1764788865859_vbqy9tjnr",{"message":"111","user":"112"},"localhost:5678","keep-alive","274","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryg7oVWYjk0eDXW73e","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
122	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"error":"4","runData":"5","pinData":"6","lastNodeExecuted":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},{"level":"14","tags":"15","description":"16","timestamp":1764789626019,"context":"17","functionality":"18","name":"19","node":"20","messages":"21","httpCode":"22","message":"23","stack":"24"},{"Webhook - Chat":"25","Extraer Query":"26","OpenAI - Generar Embedding":"27","Qdrant - Buscar Candidatos":"28"},{},"Qdrant - Buscar Candidatos",{},["29","30"],{},{},{},{"version":1,"establishedAt":1764789624872,"source":"31"},"warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: missing field `vector` at line 1 column 7\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"32"},"regular","NodeApiError",{"parameters":"33","id":"34","name":"7","type":"35","typeVersion":4.1,"position":"36"},["16"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["37"],["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764789624873,"executionIndex":0,"source":"57","hints":"58","executionTime":1,"executionStatus":"59","data":"60"},{"startTime":1764789624876,"executionIndex":1,"source":"61","hints":"62","executionTime":6,"executionStatus":"59","data":"63"},{"startTime":1764789624883,"executionIndex":2,"source":"64","hints":"65","executionTime":1111,"executionStatus":"59","data":"66"},{"startTime":1764789625996,"executionIndex":3,"source":"67","hints":"68","executionTime":26,"executionStatus":"69","error":"70"},{"parameters":"71","id":"34","name":"7","type":"35","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"parameters":"74","id":"75","name":"76","type":"35","typeVersion":4.1,"position":"77"},{"main":"78"},{"main":"79"},{"":"51"},{"accept":"80"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"81"},{},[],[],"success",{"main":"82"},["83"],["84"],{"main":"85"},["86"],[],{"main":"87"},["88"],[],"error",{"level":"14","tags":"15","description":"16","timestamp":1764789626019,"context":"17","functionality":"18","name":"19","node":"20","messages":"21","httpCode":"22","message":"23","stack":"24"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"89","options":"90","infoMessage":"51"},[-1392,-208],["91"],{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"92","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"93","options":"94","infoMessage":"51"},"64b3c225-1461-4f83-8a9a-c1ef6f386a72","Qdrant - Buscar Puestos",[-1392,0],["95"],["96"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["97"],["98"],{"previousNode":"99"},{"message":"100","location":"101"},["102"],{"previousNode":"103"},["95"],{"previousNode":"104"},{"parameters":"105"},{},["106"],"http://qdrant:6333/collections/puestos/points/search",{"parameters":"107"},{},["108"],{"previousNode":"104"},{"name":"51","value":"51"},["109"],"Webhook - Chat","To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["110"],"Extraer Query","OpenAI - Generar Embedding",["111"],{"json":"112","pairedItem":"113"},["114"],{"json":"112","pairedItem":"115"},{"json":"116","pairedItem":"117"},{"json":"118","pairedItem":"119"},{"name":"51","value":"51"},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"name":"51","value":"51"},{"item":0},{"headers":"120","params":"121","query":"122","body":"123","webhookUrl":"124","executionMode":"125"},{"item":0},{"query":"126","user":"127","rawBody":"128"},{"item":0},{"host":"129","connection":"130","content-length":"131","sec-ch-ua-platform":"132","user-agent":"133","sec-ch-ua":"134","content-type":"135","sec-ch-ua-mobile":"136","accept":"137","sec-gpc":"138","accept-language":"139","origin":"140","sec-fetch-site":"141","sec-fetch-mode":"142","sec-fetch-dest":"143","referer":"144","accept-encoding":"145"},{},{},{"message":"126","user":"127"},"http://localhost:5678/webhook-test/ever","test","que es mejor","session_1764788865859_vbqy9tjnr",{"message":"126","user":"127"},"localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
123	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"OpenAI - Generar Embedding",["14","15","4"],{"Webhook - Chat":"16","Extraer Query":"17","OpenAI - Generar Embedding":"18"},{},{},[],{},{},{},{"version":1,"establishedAt":1764789769472,"source":"19"},"Webhook - Chat","Extraer Query",["20"],["21"],["22"],"manual",{"startTime":1764789624873,"executionIndex":0,"source":"23","hints":"24","executionTime":1,"executionStatus":"25","data":"26"},{"startTime":1764789624876,"executionIndex":1,"source":"27","hints":"28","executionTime":6,"executionStatus":"25","data":"29"},{"startTime":1764789769474,"executionIndex":2,"source":"30","hints":"31","executionTime":138,"executionStatus":"25","data":"32"},[],[],"success",{"main":"33"},["34"],["35"],{"main":"36"},["37"],[],{"main":"38"},["39"],{"previousNode":"14"},{"message":"40","location":"41"},["42"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["43"],["44"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["45"],["46"],{"json":"47","pairedItem":"48"},{"json":"49","pairedItem":"50"},{"json":"51","pairedItem":"52"},{"headers":"53","params":"54","query":"55","body":"56","webhookUrl":"57","executionMode":"58"},{"item":0},{"query":"59","user":"60","rawBody":"61"},{"item":0},{"message":"62"},{"item":0},{"host":"63","connection":"64","content-length":"65","sec-ch-ua-platform":"66","user-agent":"67","sec-ch-ua":"68","content-type":"69","sec-ch-ua-mobile":"70","accept":"71","sec-gpc":"72","accept-language":"73","origin":"74","sec-fetch-site":"75","sec-fetch-mode":"76","sec-fetch-dest":"77","referer":"78","accept-encoding":"79"},{},{},{"message":"59","user":"60"},"http://localhost:5678/webhook-test/ever","test","que es mejor","session_1764788865859_vbqy9tjnr",{"message":"59","user":"60"},"Welcome to the OpenAI API! Documentation is available at https://platform.openai.com/docs/api-reference","localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
124	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"complete","model":"text-embedding-3-small","prompt":"","simplifyOutput":true,"options":{},"requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"OpenAI - Generar Embedding",["15","16","4"],{"level":"17","tags":"18","description":"19","errorResponse":"20","timestamp":1764789891910,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","OpenAI - Generar Embedding":"31"},{},{},["32"],{},{},{},{"version":1,"establishedAt":1764789890365,"source":"33"},"Webhook - Chat","Extraer Query","warning",{},"litellm.BadRequestError: OpenAIException - The chatCompletion operation does not work with the specified model, text-embedding-3-small. Please choose different model and try again. You can learn more about which models can be used with each operation here: https://go.microsoft.com/fwlink/?linkid=2197993.No fallback model group found for original model_group=text-embedding-3-small. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=text-embedding-3-small\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.BadRequestError: OpenAIException - The chatCompletion operation does not work with the specified model, text-embedding-3-small. Please choose different model and try again. You can learn more about which models can be used with each operation here: https://go.microsoft.com/fwlink/?linkid=2197993.No fallback model group found for original model_group=text-embedding-3-small. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{"body":"34","headers":"35","statusCode":400,"statusMessage":"36"},{"itemIndex":0,"runIndex":0},"regular","NodeApiError",{"parameters":"37","id":"38","name":"4","type":"39","typeVersion":1,"position":"40","credentials":"41"},[],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteSingleContext.sendErrorPostReceive (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/OpenAi/GenericFunctions.ts:15:9)\\n    at RoutingNode.runPostReceiveAction (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:309:24)\\n    at RoutingNode.postProcessResponseData (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:494:30)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:732:17\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at RoutingNode.makeRequest (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:725:19)\\n    at async Promise.allSettled (index 0)\\n    at RoutingNode.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:234:29)\\n    at ExecuteContext.versionedNodeType.execute (/usr/local/lib/node_modules/n8n/src/node-types.ts:60:18)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)",["42"],["43"],["44"],{"node":"45","data":"46","source":"47"},"manual",{"error":"48"},{"date":"49","content-type":"50","content-length":"51","connection":"52","strict-transport-security":"53","cf-cache-status":"54","nel":"55","report-to":"56","server":"57","cf-ray":"58","alt-svc":"59"},"Bad Request",{"oldVersionNotice":"60","resource":"61","operation":"62","model":"63","prompt":"60","simplifyOutput":true,"options":"64","requestOptions":"65"},"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","n8n-nodes-base.openAi",[-1600,-96],{"openAiApi":"66"},{"startTime":1764789624873,"executionIndex":0,"source":"67","hints":"68","executionTime":1,"executionStatus":"69","data":"70"},{"startTime":1764789624876,"executionIndex":1,"source":"71","hints":"72","executionTime":6,"executionStatus":"69","data":"73"},{"startTime":1764789890368,"executionIndex":2,"source":"74","hints":"75","executionTime":1571,"executionStatus":"76","error":"77"},{"parameters":"78","id":"38","name":"4","type":"39","typeVersion":1,"position":"79","credentials":"80"},{"main":"81"},{"main":"74"},{"message":"19","type":null,"param":null,"code":"26"},"Wed, 03 Dec 2025 19:24:51 GMT","application/json","2732","close","max-age=31536000; includeSubDomains","DYNAMIC","{\\"report_to\\":\\"cf-nel\\",\\"success_fraction\\":0.0,\\"max_age\\":604800}","{\\"group\\":\\"cf-nel\\",\\"max_age\\":604800,\\"endpoints\\":[{\\"url\\":\\"https://a.nel.cloudflare.com/report/v4?s=2qzJwyYPnmNHoQy8q7yUGVxsczJwPOeZVt0Wn4cIyhgqgevaqj7YLgVMLbfziMeQVBjlylEyB%2F6qCqDDQCAoZUDvW5aeJlfqTdRoZw%3D%3D\\"}]}","cloudflare","9a85724fe891634f-EZE","h3=\\":443\\"; ma=86400","","text","complete","text-embedding-3-small",{},{},{"id":"82","name":"83"},[],[],"success",{"main":"84"},["85"],["86"],{"main":"87"},["88"],[],"error",{"level":"17","tags":"18","description":"19","errorResponse":"20","timestamp":1764789891910,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"oldVersionNotice":"60","resource":"61","operation":"62","model":"63","prompt":"60","simplifyOutput":true,"options":"89","requestOptions":"90"},[-1600,-96],{"openAiApi":"91"},["92"],"7D2TxcTctnD2ZM7F","OpenAi account",["93"],{"previousNode":"15"},{"message":"94","location":"95"},["96"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{},{},{"id":"82","name":"83"},["97"],["98"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["99"],{"json":"100","pairedItem":"101"},{"json":"102","pairedItem":"103"},{"json":"100","pairedItem":"104"},{"query":"105","user":"106","rawBody":"107"},{"item":0},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113"},{"item":0},{"item":0},"que es mejor","session_1764788865859_vbqy9tjnr",{"message":"105","user":"106"},{"host":"114","connection":"115","content-length":"116","sec-ch-ua-platform":"117","user-agent":"118","sec-ch-ua":"119","content-type":"120","sec-ch-ua-mobile":"121","accept":"122","sec-gpc":"123","accept-language":"124","origin":"125","sec-fetch-site":"126","sec-fetch-mode":"127","sec-fetch-dest":"128","referer":"129","accept-encoding":"130"},{},{},{"message":"105","user":"106"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
125	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"complete","model":"text-embedding-3-small","prompt":"={{ $json.query }}","simplifyOutput":true,"options":{},"requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"OpenAI - Generar Embedding",["15","16","4"],{"level":"17","tags":"18","description":"19","errorResponse":"20","timestamp":1764789915744,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","OpenAI - Generar Embedding":"31"},{},{},["32"],{},{},{},{"version":1,"establishedAt":1764789913319,"source":"33"},"Webhook - Chat","Extraer Query","warning",{},"litellm.BadRequestError: OpenAIException - The chatCompletion operation does not work with the specified model, text-embedding-3-small. Please choose different model and try again. You can learn more about which models can be used with each operation here: https://go.microsoft.com/fwlink/?linkid=2197993.No fallback model group found for original model_group=text-embedding-3-small. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=text-embedding-3-small\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.BadRequestError: OpenAIException - The chatCompletion operation does not work with the specified model, text-embedding-3-small. Please choose different model and try again. You can learn more about which models can be used with each operation here: https://go.microsoft.com/fwlink/?linkid=2197993.No fallback model group found for original model_group=text-embedding-3-small. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{"body":"34","headers":"35","statusCode":400,"statusMessage":"36"},{"itemIndex":0,"runIndex":0},"regular","NodeApiError",{"parameters":"37","id":"38","name":"4","type":"39","typeVersion":1,"position":"40","credentials":"41"},[],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteSingleContext.sendErrorPostReceive (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/OpenAi/GenericFunctions.ts:15:9)\\n    at RoutingNode.runPostReceiveAction (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:309:24)\\n    at RoutingNode.postProcessResponseData (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:494:30)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:732:17\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at RoutingNode.makeRequest (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:725:19)\\n    at async Promise.allSettled (index 0)\\n    at RoutingNode.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/routing-node.ts:234:29)\\n    at ExecuteContext.versionedNodeType.execute (/usr/local/lib/node_modules/n8n/src/node-types.ts:60:18)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)",["42"],["43"],["44"],{"node":"45","data":"46","source":"47"},"manual",{"error":"48"},{"date":"49","content-type":"50","content-length":"51","connection":"52","strict-transport-security":"53","cf-cache-status":"54","nel":"55","report-to":"56","server":"57","cf-ray":"58","alt-svc":"59"},"Bad Request",{"oldVersionNotice":"60","resource":"61","operation":"62","model":"63","prompt":"64","simplifyOutput":true,"options":"65","requestOptions":"66"},"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","n8n-nodes-base.openAi",[-1600,-96],{"openAiApi":"67"},{"startTime":1764789624873,"executionIndex":0,"source":"68","hints":"69","executionTime":1,"executionStatus":"70","data":"71"},{"startTime":1764789624876,"executionIndex":1,"source":"72","hints":"73","executionTime":6,"executionStatus":"70","data":"74"},{"startTime":1764789913320,"executionIndex":2,"source":"75","hints":"76","executionTime":2424,"executionStatus":"77","error":"78"},{"parameters":"79","id":"38","name":"4","type":"39","typeVersion":1,"position":"80","credentials":"81"},{"main":"82"},{"main":"75"},{"message":"19","type":null,"param":null,"code":"26"},"Wed, 03 Dec 2025 19:25:15 GMT","application/json","2732","close","max-age=31536000; includeSubDomains","DYNAMIC","{\\"report_to\\":\\"cf-nel\\",\\"success_fraction\\":0.0,\\"max_age\\":604800}","{\\"group\\":\\"cf-nel\\",\\"max_age\\":604800,\\"endpoints\\":[{\\"url\\":\\"https://a.nel.cloudflare.com/report/v4?s=fO9HNcPAjx0EjP%2FyKMVSSBn9lekrMEc8BLIKy%2BEbTIa1WmwZAxjVmfLhh1PmHYUGZZbPbXJsnikVWJWraXAWrGG%2B1CTAvZfXd08iFGzS\\"}]}","cloudflare","9a8572df6bae1522-EZE","h3=\\":443\\"; ma=86400","","text","complete","text-embedding-3-small","={{ $json.query }}",{},{},{"id":"83","name":"84"},[],[],"success",{"main":"85"},["86"],["87"],{"main":"88"},["89"],[],"error",{"level":"17","tags":"18","description":"19","errorResponse":"20","timestamp":1764789915744,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"oldVersionNotice":"60","resource":"61","operation":"62","model":"63","prompt":"64","simplifyOutput":true,"options":"90","requestOptions":"91"},[-1600,-96],{"openAiApi":"92"},["93"],"7D2TxcTctnD2ZM7F","OpenAi account",["94"],{"previousNode":"15"},{"message":"95","location":"96"},["97"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{},{},{"id":"83","name":"84"},["98"],["99"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["100"],{"json":"101","pairedItem":"102"},{"json":"103","pairedItem":"104"},{"json":"101","pairedItem":"105"},{"query":"106","user":"107","rawBody":"108"},{"item":0},{"headers":"109","params":"110","query":"111","body":"112","webhookUrl":"113","executionMode":"114"},{"item":0},{"item":0},"que es mejor","session_1764788865859_vbqy9tjnr",{"message":"106","user":"107"},{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"106","user":"107"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
126	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"__CUSTOM_API_CALL__","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-176],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"public":false,"availableInChat":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[-1248,48],"id":"79808b00-b5e7-4ec7-8719-da15b5e00795","name":"When chat message received","webhookId":"ecab7e15-843e-4da9-8220-0d33b86f728f"},{"parameters":{"notice":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"messages":{},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1040,48],"id":"365b311c-04f1-477c-876f-8ac28b49b84d","name":"Basic LLM Chain"},{"parameters":{"notice":"","model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1616,-32],"id":"e13c4606-08ed-4614-a4ed-9583d7676b00","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"OpenAI - Generar Embedding",["14","15","4"],{"Webhook - Chat":"16","Extraer Query":"17","OpenAI - Generar Embedding":"18"},{},{},[],{},{},{},{"version":1,"establishedAt":1764791179881,"source":"19"},"Webhook - Chat","Extraer Query",["20"],["21"],["22"],"manual",{"startTime":1764789624873,"executionIndex":0,"source":"23","hints":"24","executionTime":1,"executionStatus":"25","data":"26"},{"startTime":1764789624876,"executionIndex":1,"source":"27","hints":"28","executionTime":6,"executionStatus":"25","data":"29"},{"startTime":1764791179885,"executionIndex":2,"source":"30","hints":"31","executionTime":1093,"executionStatus":"25","data":"32"},[],[],"success",{"main":"33"},["34"],["35"],{"main":"36"},["37"],[],{"main":"38"},["39"],{"previousNode":"14"},{"message":"40","location":"41"},["42"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["43"],["44"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["45"],["46"],{"json":"47","pairedItem":"48"},{"json":"49","pairedItem":"50"},{"json":"51","pairedItem":"52"},{"headers":"53","params":"54","query":"55","body":"56","webhookUrl":"57","executionMode":"58"},{"item":0},{"query":"59","user":"60","rawBody":"61"},{"item":0},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"host":"62","connection":"63","content-length":"64","sec-ch-ua-platform":"65","user-agent":"66","sec-ch-ua":"67","content-type":"68","sec-ch-ua-mobile":"69","accept":"70","sec-gpc":"71","accept-language":"72","origin":"73","sec-fetch-site":"74","sec-fetch-mode":"75","sec-fetch-dest":"76","referer":"77","accept-encoding":"78"},{},{},{"message":"59","user":"60"},"http://localhost:5678/webhook-test/ever","test","que es mejor","session_1764788865859_vbqy9tjnr",{"message":"59","user":"60"},"localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
127	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"__CUSTOM_API_CALL__","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-176],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"public":false,"availableInChat":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[-1248,48],"id":"79808b00-b5e7-4ec7-8719-da15b5e00795","name":"When chat message received","webhookId":"ecab7e15-843e-4da9-8220-0d33b86f728f"},{"parameters":{"notice":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"messages":{},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1040,48],"id":"365b311c-04f1-477c-876f-8ac28b49b84d","name":"Basic LLM Chain"},{"parameters":{"notice":"","model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1616,-32],"id":"e13c4606-08ed-4614-a4ed-9583d7676b00","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764791198227,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","OpenAI - Generar Embedding":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764791198142,"source":"34"},"Webhook - Chat","OpenAI - Generar Embedding","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: missing field `vector` at line 1 column 7\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764789624873,"executionIndex":0,"source":"57","hints":"58","executionTime":1,"executionStatus":"59","data":"60"},{"startTime":1764789624876,"executionIndex":1,"source":"61","hints":"62","executionTime":6,"executionStatus":"59","data":"63"},{"startTime":1764791179885,"executionIndex":2,"source":"64","hints":"65","executionTime":1093,"executionStatus":"59","data":"66"},{"startTime":1764791198143,"executionIndex":3,"source":"67","hints":"68","executionTime":85,"executionStatus":"69","error":"70"},{"parameters":"71","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"":"51"},{"accept":"74"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"75"},{},[],[],"success",{"main":"76"},["77"],["78"],{"main":"79"},["80"],[],{"main":"81"},["82"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764791198227,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"83","options":"84","infoMessage":"51"},[-1392,-208],["85"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["86"],["87"],{"previousNode":"15"},{"message":"88","location":"89"},["90"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},["91"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"92"},{},["93"],{"name":"51","value":"51"},["94"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["95"],["96"],["97"],{"json":"98","pairedItem":"99"},{"json":"100","pairedItem":"101"},{"json":"102","pairedItem":"103"},{"json":"98","pairedItem":"104"},{"name":"51","value":"51"},"\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <link type=\\"text/css\\" rel=\\"stylesheet\\" href=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css\\">\\n    <link rel=\\"shortcut icon\\" href=\\"https://fastapi.tiangolo.com/img/favicon.png\\">\\n    <title>MAMMOUTH API - Swagger UI</title>\\n    </head>\\n    <body>\\n    <div id=\\"swagger-ui\\">\\n    </div>\\n    <script src=\\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\\"></script>\\n    <!-- `SwaggerUIBundle` is now available on the page -->\\n    <script>\\n    const ui = SwaggerUIBundle({\\n        url: '/openapi.json',\\n    \\"dom_id\\": \\"#swagger-ui\\",\\n\\"layout\\": \\"BaseLayout\\",\\n\\"deepLinking\\": true,\\n\\"showExtensions\\": true,\\n\\"showCommonExtensions\\": true,\\noauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',\\n    presets: [\\n        SwaggerUIBundle.presets.apis,\\n        SwaggerUIBundle.SwaggerUIStandalonePreset\\n        ],\\n    })\\n    </script>\\n    </body>\\n    </html>\\n    ",{"item":0},{"headers":"105","params":"106","query":"107","body":"108","webhookUrl":"109","executionMode":"110"},{"item":0},{"query":"111","user":"112","rawBody":"113"},{"item":0},{"item":0},{"host":"114","connection":"115","content-length":"116","sec-ch-ua-platform":"117","user-agent":"118","sec-ch-ua":"119","content-type":"120","sec-ch-ua-mobile":"121","accept":"122","sec-gpc":"123","accept-language":"124","origin":"125","sec-fetch-site":"126","sec-fetch-mode":"127","sec-fetch-dest":"128","referer":"129","accept-encoding":"130"},{},{},{"message":"111","user":"112"},"http://localhost:5678/webhook-test/ever","test","que es mejor","session_1764788865859_vbqy9tjnr",{"message":"111","user":"112"},"localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
128	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const items = $input.all();\\n\\nreturn items.map(item => {\\n  const body = item.json.body || {};\\n  \\n  const query =\\n    body.message  // lo que manda tu frontend hoy\\n    || body.query // por si luego cambias el nombre\\n    || '';\\n\\n  if (!query) {\\n    throw new Error('No se encontró la query en el body (message/query vacío).');\\n  }\\n\\n  return {\\n    json: {\\n      query,\\n      user: body.user ?? null,\\n      rawBody: body,\\n    },\\n  };\\n});\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"__CUSTOM_API_CALL__","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1888,-384],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"public":false,"availableInChat":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[-1248,48],"id":"79808b00-b5e7-4ec7-8719-da15b5e00795","name":"When chat message received","webhookId":"ecab7e15-843e-4da9-8220-0d33b86f728f"},{"parameters":{"notice":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"messages":{},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1008,80],"id":"365b311c-04f1-477c-876f-8ac28b49b84d","name":"Basic LLM Chain"},{"parameters":{"notice":"","model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1568,-320],"id":"e13c4606-08ed-4614-a4ed-9583d7676b00","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4"],{"level":"17","tags":"18","description":"19","timestamp":1764791392635,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","Qdrant - Buscar Candidatos":"30"},{},{},["31"],{},{},{},{"version":1,"establishedAt":1764791392569,"source":"32"},"Webhook - Chat","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: missing field `vector` at line 1 column 7\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"33"},"regular","NodeApiError",{"parameters":"34","id":"35","name":"4","type":"36","typeVersion":4.1,"position":"37"},["19"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},"manual",{"body":"44","headers":"45","method":"46","uri":"47","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"48","curlImport":"48","method":"46","url":"47","authentication":"49","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"50","specifyBody":"51","bodyParameters":"52","options":"53","infoMessage":"48"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764789624873,"executionIndex":0,"source":"54","hints":"55","executionTime":1,"executionStatus":"56","data":"57"},{"startTime":1764789624876,"executionIndex":1,"source":"58","hints":"59","executionTime":6,"executionStatus":"56","data":"60"},{"startTime":1764791392575,"executionIndex":2,"source":"61","hints":"62","executionTime":61,"executionStatus":"63","error":"64"},{"parameters":"65","id":"35","name":"4","type":"36","typeVersion":4.1,"position":"66"},{"main":"67"},{"main":"61"},{"":"48"},{"accept":"68"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"69"},{},[],[],"success",{"main":"70"},["71"],["72"],{"main":"73"},["74"],[],"error",{"level":"17","tags":"18","description":"19","timestamp":1764791392635,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"48","curlImport":"48","method":"46","url":"47","authentication":"49","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"50","specifyBody":"51","bodyParameters":"75","options":"76","infoMessage":"48"},[-1392,-208],["77"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["78"],["79"],{"previousNode":"15"},{"message":"80","location":"81"},["82"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"83"},{},["84"],{"name":"48","value":"48"},["85"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["86"],["87"],{"json":"88","pairedItem":"89"},{"json":"90","pairedItem":"91"},{"json":"88","pairedItem":"92"},{"name":"48","value":"48"},{"query":"93","user":"94","rawBody":"95"},{"item":0},{"headers":"96","params":"97","query":"98","body":"99","webhookUrl":"100","executionMode":"101"},{"item":0},{"item":0},"que es mejor","session_1764788865859_vbqy9tjnr",{"message":"93","user":"94"},{"host":"102","connection":"103","content-length":"104","sec-ch-ua-platform":"105","user-agent":"106","sec-ch-ua":"107","content-type":"108","sec-ch-ua-mobile":"109","accept":"110","sec-gpc":"111","accept-language":"112","origin":"113","sec-fetch-site":"114","sec-fetch-mode":"115","sec-fetch-dest":"116","referer":"117","accept-encoding":"118"},{},{},{"message":"93","user":"94"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd"]
129	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Ejemplo: tomás \\"query\\" del webhook o lo hardcodeás para probar\\nreturn [\\n  {\\n    json: {\\n      query: $input.first().json.body.message\\n    }\\n  }\\n];\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"__CUSTOM_API_CALL__","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1888,-384],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"public":false,"availableInChat":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[-1248,48],"id":"79808b00-b5e7-4ec7-8719-da15b5e00795","name":"When chat message received","webhookId":"ecab7e15-843e-4da9-8220-0d33b86f728f"},{"parameters":{"notice":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"messages":{},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1008,80],"id":"365b311c-04f1-477c-876f-8ac28b49b84d","name":"Basic LLM Chain"},{"parameters":{"notice":"","model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1568,-320],"id":"e13c4606-08ed-4614-a4ed-9583d7676b00","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Extraer Query",["14","4"],{"Webhook - Chat":"15","Extraer Query":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764791432837,"source":"17"},"Webhook - Chat",["18"],["19"],"manual",{"startTime":1764789624873,"executionIndex":0,"source":"20","hints":"21","executionTime":1,"executionStatus":"22","data":"23"},{"startTime":1764791432838,"executionIndex":1,"source":"24","hints":"25","executionTime":25,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],["29"],{"main":"30"},["31"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},{"message":"32","location":"33"},["34"],["35"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["36"],{"json":"37","pairedItem":"38"},{"json":"39","pairedItem":"40"},{"headers":"41","params":"42","query":"43","body":"44","webhookUrl":"45","executionMode":"46"},{"item":0},{"query":"47"},{"item":0},{"host":"48","connection":"49","content-length":"50","sec-ch-ua-platform":"51","user-agent":"52","sec-ch-ua":"53","content-type":"54","sec-ch-ua-mobile":"55","accept":"56","sec-gpc":"57","accept-language":"58","origin":"59","sec-fetch-site":"60","sec-fetch-mode":"61","sec-fetch-dest":"62","referer":"63","accept-encoding":"64"},{},{},{"message":"47","user":"65"},"http://localhost:5678/webhook-test/ever","test","que es mejor","localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764788865859_vbqy9tjnr"]
130	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Ejemplo: tomás \\"query\\" del webhook o lo hardcodeás para probar\\nreturn [\\n  {\\n    json: {\\n      query: $input.first().json.body.message\\n    }\\n  }\\n];\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"__CUSTOM_API_CALL__","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1888,-384],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"public":false,"availableInChat":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[-1248,48],"id":"79808b00-b5e7-4ec7-8719-da15b5e00795","name":"When chat message received","webhookId":"ecab7e15-843e-4da9-8220-0d33b86f728f"},{"parameters":{"notice":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"messages":{},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1008,80],"id":"365b311c-04f1-477c-876f-8ac28b49b84d","name":"Basic LLM Chain"},{"parameters":{"notice":"","model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1568,-320],"id":"e13c4606-08ed-4614-a4ed-9583d7676b00","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4"],{"level":"17","tags":"18","description":"19","timestamp":1764791438123,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","Qdrant - Buscar Candidatos":"30"},{},{},["31"],{},{},{},{"version":1,"establishedAt":1764791438095,"source":"32"},"Webhook - Chat","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: missing field `vector` at line 1 column 7\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"33"},"regular","NodeApiError",{"parameters":"34","id":"35","name":"4","type":"36","typeVersion":4.1,"position":"37"},["19"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},"manual",{"body":"44","headers":"45","method":"46","uri":"47","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"48","curlImport":"48","method":"46","url":"47","authentication":"49","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"50","specifyBody":"51","bodyParameters":"52","options":"53","infoMessage":"48"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764789624873,"executionIndex":0,"source":"54","hints":"55","executionTime":1,"executionStatus":"56","data":"57"},{"startTime":1764791432838,"executionIndex":1,"source":"58","hints":"59","executionTime":25,"executionStatus":"56","data":"60"},{"startTime":1764791438097,"executionIndex":2,"source":"61","hints":"62","executionTime":27,"executionStatus":"63","error":"64"},{"parameters":"65","id":"35","name":"4","type":"36","typeVersion":4.1,"position":"66"},{"main":"67"},{"main":"61"},{"":"48"},{"accept":"68"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"69"},{},[],[],"success",{"main":"70"},["71"],["72"],{"main":"73"},["74"],[],"error",{"level":"17","tags":"18","description":"19","timestamp":1764791438123,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"48","curlImport":"48","method":"46","url":"47","authentication":"49","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"50","specifyBody":"51","bodyParameters":"75","options":"76","infoMessage":"48"},[-1392,-208],["77"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["78"],["79"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{"message":"80","location":"81"},["82"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"83"},{},["84"],{"name":"48","value":"48"},["85"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["86"],["87"],{"json":"88","pairedItem":"89"},{"json":"90","pairedItem":"91"},{"json":"88","pairedItem":"92"},{"name":"48","value":"48"},{"query":"93"},{"item":0},{"headers":"94","params":"95","query":"96","body":"97","webhookUrl":"98","executionMode":"99"},{"item":0},{"item":0},"que es mejor",{"host":"100","connection":"101","content-length":"102","sec-ch-ua-platform":"103","user-agent":"104","sec-ch-ua":"105","content-type":"106","sec-ch-ua-mobile":"107","accept":"108","sec-gpc":"109","accept-language":"110","origin":"111","sec-fetch-site":"112","sec-fetch-mode":"113","sec-fetch-dest":"114","referer":"115","accept-encoding":"116"},{},{},{"message":"93","user":"117"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764788865859_vbqy9tjnr"]
131	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Ejemplo: tomás \\"query\\" del webhook o lo hardcodeás para probar\\nreturn [\\n  {\\n    json: {\\n      query: $input.first().json.body.message\\n    }\\n  }\\n];\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"__CUSTOM_API_CALL__","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1888,-384],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"Authorization","value":"Bearer sk-cgOP97ddcHyM5alqeV7ieA"},{"name":"Content-Type","value":"application/json"}]},"options":{"response":{"response":{"fullResponse":true,"neverError":false,"responseFormat":"json"}}},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"public":false,"availableInChat":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[-1248,48],"id":"79808b00-b5e7-4ec7-8719-da15b5e00795","name":"When chat message received","webhookId":"ecab7e15-843e-4da9-8220-0d33b86f728f"},{"parameters":{"notice":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"messages":{},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1008,80],"id":"365b311c-04f1-477c-876f-8ac28b49b84d","name":"Basic LLM Chain"},{"parameters":{"notice":"","model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1568,-320],"id":"e13c4606-08ed-4614-a4ed-9583d7676b00","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"Authorization","value":""}]},"sendBody":false,"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1632,32],"id":"953afc85-3db4-45cb-8d99-a639adf3e807","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4"],{"level":"17","tags":"18","description":"19","timestamp":1764791949523,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","Qdrant - Buscar Candidatos":"30"},{},{},["31"],{},{},{},{"version":1,"establishedAt":1764791949373,"source":"32"},"Webhook - Chat","Extraer Query","warning",{},"400 - {\\"status\\":{\\"error\\":\\"Format error in JSON body: missing field `vector` at line 1 column 86\\"},\\"time\\":0}",{"itemIndex":0,"request":"33"},"regular","NodeApiError",{"parameters":"34","id":"35","name":"4","type":"36","typeVersion":4.1,"position":"37"},["19"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["38"],["39"],["40"],{"node":"41","data":"42","source":"43"},"manual",{"body":"44","headers":"45","method":"46","uri":"47","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"json":true},{"preBuiltAgentsCalloutHttpRequest":"48","curlImport":"48","method":"46","url":"47","authentication":"49","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"50","specifyBody":"51","bodyParameters":"52","options":"53","infoMessage":"48"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764789624873,"executionIndex":0,"source":"54","hints":"55","executionTime":1,"executionStatus":"56","data":"57"},{"startTime":1764791432838,"executionIndex":1,"source":"58","hints":"59","executionTime":25,"executionStatus":"56","data":"60"},{"startTime":1764791949388,"executionIndex":2,"source":"61","hints":"62","executionTime":146,"executionStatus":"63","error":"64"},{"parameters":"65","id":"35","name":"4","type":"36","typeVersion":4.1,"position":"66"},{"main":"67"},{"main":"61"},{"Authorization":"68","Content-Type":"69"},{"accept":"70","content-type":"69"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"71"},{"response":"72"},[],[],"success",{"main":"73"},["74"],["75"],{"main":"76"},["77"],[],"error",{"level":"17","tags":"18","description":"19","timestamp":1764791949523,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"48","curlImport":"48","method":"46","url":"47","authentication":"49","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"50","specifyBody":"51","bodyParameters":"78","options":"79","infoMessage":"48"},[-1392,-208],["80"],"Bearer sk-cgOP97ddcHyM5alqeV7ieA","application/json","application/json,text/*;q=0.99",["81","82"],{"response":"83"},["84"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{"message":"85","location":"86"},["87"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"88"},{"response":"89"},["90"],{"name":"91","value":"68"},{"name":"92","value":"69"},{"fullResponse":true,"neverError":false,"responseFormat":"50"},["93"],"To make sure expressions after this node work, return the input items that produced each output item. <a target=\\"_blank\\" href=\\"https://docs.n8n.io/data/data-mapping/data-item-linking/item-linking-code-node/\\">More info</a>","outputPane",["94"],["95","96"],{"response":"97"},{"json":"98","pairedItem":"99"},"Authorization","Content-Type",{"json":"100","pairedItem":"101"},{"json":"98","pairedItem":"102"},{"name":"91","value":"68"},{"name":"92","value":"69"},{"fullResponse":true,"neverError":false,"responseFormat":"50"},{"query":"103"},{"item":0},{"headers":"104","params":"105","query":"106","body":"107","webhookUrl":"108","executionMode":"109"},{"item":0},{"item":0},"que es mejor",{"host":"110","connection":"111","content-length":"112","sec-ch-ua-platform":"113","user-agent":"114","sec-ch-ua":"115","content-type":"116","sec-ch-ua-mobile":"117","accept":"118","sec-gpc":"119","accept-language":"120","origin":"121","sec-fetch-site":"122","sec-fetch-mode":"123","sec-fetch-dest":"124","referer":"125","accept-encoding":"126"},{},{},{"message":"103","user":"127"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","272","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundaryqs0jlKRcazRSoBmI","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764788865859_vbqy9tjnr"]
161	{"id":"aGurSLzad9QHqXSa","name":"Sistema_Consultas","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764874220519,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764874220520,"executionIndex":0,"source":"24","hints":"25","executionTime":0,"executionStatus":"26","data":"27"},{"startTime":1764874220539,"executionTime":1474,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764874220521,"executionIndex":1,"source":"32","hints":"33","executionTime":1494,"executionStatus":"26","data":"34"},{"startTime":1764874222016,"executionIndex":3,"source":"35","hints":"36","executionTime":2,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":33,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","user-agent":"80","accept":"81","accept-language":"82","accept-encoding":"83","referer":"84","content-type":"85","content-length":"86","origin":"87","connection":"88","priority":"89"},{},{},{"message":"90","user":"91"},"http://10.10.0.100:5678/webhook-test/ever","test",{"generations":"92"},{"completionTokens":25,"promptTokens":38,"totalTokens":63},["93"],{"openai_api_key":"94","model":"95","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"96","model_kwargs":"97"},"{\\n  \\"response\\": \\"Entendido, responderé solo dentro de la llave response sin agregar nuevas llaves.\\"\\n}","10.10.0.100:5678","Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0","*/*","es-AR,es;q=0.8,en-US;q=0.5,en;q=0.3","gzip, deflate","http://10.10.0.100:5050/","multipart/form-data; boundary=----geckoformboundary8971deee189b198bb7527ed713d0505b","343","http://10.10.0.100:5050","keep-alive","u=0","no me devuelvas el mensaje, contestalo","session_1764874127689_p0hebhhh9",["98"],"Human: json\\nno me devuelvas el mensaje, contestalo \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"99","id":"100"},"gpt-4.1-nano",{"baseURL":"101","fetchOptions":"102","defaultHeaders":"103"},{"response_format":"104"},["105"],"secret",["106"],"https://api.mammouth.ai/v1",{},{"Authorization":"107"},{"type":"108"},{"text":"78","generationInfo":"109"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"110"},"stop"]
132	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Ejemplo: tomás \\"query\\" del webhook o lo hardcodeás para probar\\nreturn [\\n  {\\n    json: {\\n      query: $input.first().json.body.message\\n    }\\n  }\\n];\\n","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"__CUSTOM_API_CALL__","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1888,-384],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"Authorization","value":"Bearer sk-cgOP97ddcHyM5alqeV7ieA"},{"name":"Content-Type","value":"application/json"}]},"options":{"response":{"response":{"fullResponse":true,"neverError":false,"responseFormat":"json"}}},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"public":false,"availableInChat":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.4,"position":[-1248,48],"id":"79808b00-b5e7-4ec7-8719-da15b5e00795","name":"When chat message received","webhookId":"ecab7e15-843e-4da9-8220-0d33b86f728f"},{"parameters":{"notice":"","promptType":"auto","text":"={{ $json.chatInput }}","hasOutputParser":false,"needsFallback":false,"messages":{},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[-1008,80],"id":"365b311c-04f1-477c-876f-8ac28b49b84d","name":"Basic LLM Chain"},{"parameters":{"notice":"","model":"text-embedding-3-small","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1568,-320],"id":"e13c4606-08ed-4614-a4ed-9583d7676b00","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"Authorization","value":"Brear sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":false,"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1632,32],"id":"953afc85-3db4-45cb-8d99-a639adf3e807","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["4"],{"level":"15","tags":"16","description":"17","timestamp":1764791985451,"context":"18","functionality":"19","name":"20","node":"21","messages":"22","httpCode":"23","message":"24","stack":"25"},{"HTTP Request":"26"},{},{},["27"],{},{},{},{"version":1,"establishedAt":1764791984305,"source":"28"},"warning",{},"Not Found",{"itemIndex":0,"request":"29"},"regular","NodeApiError",{"parameters":"30","type":"31","typeVersion":4.3,"position":"32","id":"33","name":"4"},["34"],"404","The resource you are requesting could not be found","NodeApiError: The resource you are requesting could not be found\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["35"],{"node":"36","data":"37","source":null},"manual",{"headers":"38","method":"39","uri":"40","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"41","curlImport":"41","method":"39","url":"40","authentication":"42","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"43","headerParameters":"44","sendBody":false,"options":"45","infoMessage":"41"},"n8n-nodes-base.httpRequest",[-1632,32],"953afc85-3db4-45cb-8d99-a639adf3e807","404 - \\"{\\\\\\"detail\\\\\\":\\\\\\"Not Found\\\\\\"}\\"",{"startTime":1764791984306,"executionIndex":0,"source":"46","hints":"47","executionTime":1146,"executionStatus":"48","error":"49"},{"parameters":"50","type":"31","typeVersion":4.3,"position":"51","id":"33","name":"4"},{"main":"52"},{"authorization":"53","accept":"54"},"POST","https://api.mammouth.ai/v1","","none","keypair",{"parameters":"55"},{},[],[],"error",{"level":"15","tags":"16","description":"17","timestamp":1764791985451,"context":"18","functionality":"19","name":"20","node":"21","messages":"22","httpCode":"23","message":"24","stack":"25"},{"preBuiltAgentsCalloutHttpRequest":"41","curlImport":"41","method":"39","url":"40","authentication":"42","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"43","headerParameters":"56","sendBody":false,"options":"57","infoMessage":"41"},[-1632,32],["58"],"**hidden**","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["59"],{"parameters":"60"},{},["61"],{"name":"62","value":"63"},["64"],{"json":"65","pairedItem":"66"},"Authorization","Brear sk-cgOP97ddcHyM5alqeV7ieA",{"name":"62","value":"63"},{},{"item":0}]
133	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook - Chat",{"Webhook - Chat":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764846750886,"source":"14"},["15"],"manual",{"startTime":1764846750890,"executionIndex":0,"source":"16","hints":"17","executionTime":2,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","connection":"32","content-length":"33","sec-ch-ua-platform":"34","user-agent":"35","sec-ch-ua":"36","content-type":"37","sec-ch-ua-mobile":"38","accept":"39","sec-gpc":"40","accept-language":"41","origin":"42","sec-fetch-site":"43","sec-fetch-mode":"44","sec-fetch-dest":"45","referer":"46","accept-encoding":"47"},{},{},{"message":"48","user":"49"},"http://localhost:5678/webhook-test/ever","test","localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7"]
134	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Extraer Query",["14","4"],{"Webhook - Chat":"15","Extraer Query":"16"},{},{},[],{},{},{},{"version":1,"establishedAt":1764846758591,"source":"17"},"Webhook - Chat",["18"],["19"],"manual",{"startTime":1764846750890,"executionIndex":0,"source":"20","hints":"21","executionTime":2,"executionStatus":"22","data":"23"},{"startTime":1764846758592,"executionIndex":1,"source":"24","hints":"25","executionTime":23,"executionStatus":"22","data":"26"},[],[],"success",{"main":"27"},["28"],[],{"main":"29"},["30"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["31"],["32"],["33"],{"json":"34","pairedItem":"35"},{"json":"36","pairedItem":"37"},{"headers":"38","params":"39","query":"40","body":"41","webhookUrl":"42","executionMode":"43"},{"item":0},{"headers":"44","params":"45","query":"46","body":"47","webhookUrl":"42","executionMode":"43","myNewField":1},{"item":0},{"host":"48","connection":"49","content-length":"50","sec-ch-ua-platform":"51","user-agent":"52","sec-ch-ua":"53","content-type":"54","sec-ch-ua-mobile":"55","accept":"56","sec-gpc":"57","accept-language":"58","origin":"59","sec-fetch-site":"60","sec-fetch-mode":"61","sec-fetch-dest":"62","referer":"63","accept-encoding":"64"},{},{},{"message":"65","user":"66"},"http://localhost:5678/webhook-test/ever","test",{"host":"48","connection":"49","content-length":"50","sec-ch-ua-platform":"51","user-agent":"52","sec-ch-ua":"53","content-type":"54","sec-ch-ua-mobile":"55","accept":"56","sec-gpc":"57","accept-language":"58","origin":"59","sec-fetch-site":"60","sec-fetch-mode":"61","sec-fetch-dest":"62","referer":"63","accept-encoding":"64"},{},{},{"message":"65","user":"66"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7"]
137	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/chat/completions","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"message","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["15","16","4"],{"level":"17","tags":"18","description":"19","timestamp":1764847362896,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","HTTP Request":"30"},{},{},["31"],{},{},{},{"version":1,"establishedAt":1764847361548,"source":"32"},"Webhook - Chat","Extraer Query","warning",{},"Router.acompletion() missing 1 required positional argument: 'messages'",{"itemIndex":0,"request":"33"},"regular","NodeApiError",{"parameters":"34","type":"35","typeVersion":4.3,"position":"36","id":"37","name":"4","credentials":"38"},["39"],"500","The service was not able to process your request","NodeApiError: The service was not able to process your request\\n    at ExecuteContext.requestWithAuthentication (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/utils/request-helper-functions.ts:1498:10)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.requestWithAuthentication (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/utils/request-helper-functions.ts:1798:11)",["40"],["41"],["42"],{"node":"43","data":"44","source":"45"},"manual",{"body":"46","headers":"47","method":"48","uri":"49","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","nodeCredentialType":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"50"},"n8n-nodes-base.httpRequest",[-1664,-352],"7375640d-f95b-4963-8c07-483a4d1132f9",{"openAiApi":"57"},"500 - \\"{\\\\\\"error\\\\\\":{\\\\\\"message\\\\\\":\\\\\\"Router.acompletion() missing 1 required positional argument: 'messages'\\\\\\",\\\\\\"type\\\\\\":\\\\\\"None\\\\\\",\\\\\\"param\\\\\\":\\\\\\"None\\\\\\",\\\\\\"code\\\\\\":\\\\\\"500\\\\\\"}}\\"",{"startTime":1764846750890,"executionIndex":0,"source":"58","hints":"59","executionTime":2,"executionStatus":"60","data":"61"},{"startTime":1764846758592,"executionIndex":1,"source":"62","hints":"63","executionTime":23,"executionStatus":"60","data":"64"},{"startTime":1764847361553,"executionIndex":2,"source":"65","hints":"66","executionTime":1348,"executionStatus":"67","error":"68"},{"parameters":"69","type":"35","typeVersion":4.3,"position":"70","id":"37","name":"4","credentials":"71"},{"main":"72"},{"main":"65"},{"model":"73","message":"74"},{"accept":"75","Authorization":"76","OpenAI-Organization":"77"},"POST","https://api.mammouth.ai/v1/chat/completions","","predefinedCredentialType","openAiApi","json","keypair",{"parameters":"78"},{},{"id":"79","name":"80"},[],[],"success",{"main":"81"},["82"],[],{"main":"83"},["84"],[],"error",{"level":"17","tags":"18","description":"19","timestamp":1764847362896,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","nodeCredentialType":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"85","options":"86","infoMessage":"50"},[-1664,-352],{"openAiApi":"87"},["88"],"text-embedding-3-small",",AO","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7","**hidden**","mammouth",["89","90"],"7D2TxcTctnD2ZM7F","OpenAi account",["91"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["92"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"93"},{},{"id":"79","name":"80"},["94"],{"name":"95","value":"96"},{"name":"97","value":"98"},["99"],["100"],["101","102"],{"json":"103","pairedItem":"104"},"model","=text-embedding-3-small","message","={{ $json.body.message }}",{"json":"105","pairedItem":"106"},{"json":"103","pairedItem":"107"},{"name":"95","value":"96"},{"name":"97","value":"98"},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113","myNewField":1},{"item":0},{"headers":"114","params":"115","query":"116","body":"117","webhookUrl":"112","executionMode":"113"},{"item":0},{"item":0},{"host":"118","connection":"119","content-length":"120","sec-ch-ua-platform":"121","user-agent":"122","sec-ch-ua":"123","content-type":"124","sec-ch-ua-mobile":"125","accept":"126","sec-gpc":"127","accept-language":"128","origin":"129","sec-fetch-site":"130","sec-fetch-mode":"131","sec-fetch-dest":"132","referer":"133","accept-encoding":"134"},{},{},{"message":"74","user":"135"},"http://localhost:5678/webhook-test/ever","test",{"host":"118","connection":"119","content-length":"120","sec-ch-ua-platform":"121","user-agent":"122","sec-ch-ua":"123","content-type":"124","sec-ch-ua-mobile":"125","accept":"126","sec-gpc":"127","accept-language":"128","origin":"129","sec-fetch-site":"130","sec-fetch-mode":"131","sec-fetch-dest":"132","referer":"133","accept-encoding":"134"},{},{},{"message":"74","user":"135"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764846651458_012qvnrh7"]
138	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/chat/completions","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"messages","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request","credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["15","16","4"],{"level":"17","tags":"18","description":"19","timestamp":1764847372466,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","HTTP Request":"30"},{},{},["31"],{},{},{},{"version":1,"establishedAt":1764847371266,"source":"32"},"Webhook - Chat","Extraer Query","warning",{},"litellm.APIConnectionError: AzureException APIConnectionError - 'str' object has no attribute 'get'\\nTraceback (most recent call last):\\n  File \\"/usr/lib/python3.13/site-packages/litellm/main.py\\", line 516, in acompletion\\n    init_response = await loop.run_in_executor(None, func_with_context)\\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\"/usr/lib/python3.13/concurrent/futures/thread.py\\", line 59, in run\\n    result = self.fn(*self.args, **self.kwargs)\\n  File \\"/usr/lib/python3.13/site-packages/litellm/utils.py\\", line 1020, in wrapper\\n    result = original_function(*args, **kwargs)\\n  File \\"/usr/lib/python3.13/site-packages/litellm/main.py\\", line 919, in completion\\n    messages = validate_and_fix_openai_messages(messages=messages)\\n  File \\"/usr/lib/python3.13/site-packages/litellm/utils.py\\", line 6382, in validate_and_fix_openai_messages\\n    if not message.get(\\"role\\"):\\n           ^^^^^^^^^^^\\nAttributeError: 'str' object has no attribute 'get'\\nNo fallback model group found for original model_group=text-embedding-3-small. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=text-embedding-3-small\\nAvailable Model Group Fallbacks=None\\nError doing the fallback: litellm.APIConnectionError: AzureException APIConnectionError - 'str' object has no attribute 'get'\\nTraceback (most recent call last):\\n  File \\"/usr/lib/python3.13/site-packages/litellm/main.py\\", line 516, in acompletion\\n    init_response = await loop.run_in_executor(None, func_with_context)\\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \\"/usr/lib/python3.13/concurrent/futures/thread.py\\", line 59, in run\\n    result = self.fn(*self.args, **self.kwargs)\\n  File \\"/usr/lib/python3.13/site-packages/litellm/utils.py\\", line 1020, in wrapper\\n    result = original_function(*args, **kwargs)\\n  File \\"/usr/lib/python3.13/site-packages/litellm/main.py\\", line 919, in completion\\n    messages = validate_and_fix_openai_messages(messages=messages)\\n  File \\"/usr/lib/python3.13/site-packages/litellm/utils.py\\", line 6382, in validate_and_fix_openai_messages\\n    if not message.get(\\"role\\"):\\n           ^^^^^^^^^^^\\nAttributeError: 'str' object has no attribute 'get'\\nNo fallback model group found for original model_group=text-embedding-3-small. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2",{"itemIndex":0,"request":"33"},"regular","NodeApiError",{"parameters":"34","type":"35","typeVersion":4.3,"position":"36","id":"37","name":"4","credentials":"38"},["39"],"500","The service was not able to process your request","NodeApiError: The service was not able to process your request\\n    at ExecuteContext.requestWithAuthentication (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/utils/request-helper-functions.ts:1498:10)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at ExecuteContext.requestWithAuthentication (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/node-execution-context/utils/request-helper-functions.ts:1798:11)",["40"],["41"],["42"],{"node":"43","data":"44","source":"45"},"manual",{"body":"46","headers":"47","method":"48","uri":"49","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","nodeCredentialType":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"50"},"n8n-nodes-base.httpRequest",[-1664,-352],"7375640d-f95b-4963-8c07-483a4d1132f9",{"openAiApi":"57"},"500 - \\"{\\\\\\"error\\\\\\":{\\\\\\"message\\\\\\":\\\\\\"litellm.APIConnectionError: AzureException APIConnectionError - 'str' object has no attribute 'get'\\\\\\\\nTraceback (most recent call last):\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/site-packages/litellm/main.py\\\\\\\\\\\\\\", line 516, in acompletion\\\\\\\\n    init_response = await loop.run_in_executor(None, func_with_context)\\\\\\\\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/concurrent/futures/thread.py\\\\\\\\\\\\\\", line 59, in run\\\\\\\\n    result = self.fn(*self.args, **self.kwargs)\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/site-packages/litellm/utils.py\\\\\\\\\\\\\\", line 1020, in wrapper\\\\\\\\n    result = original_function(*args, **kwargs)\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/site-packages/litellm/main.py\\\\\\\\\\\\\\", line 919, in completion\\\\\\\\n    messages = validate_and_fix_openai_messages(messages=messages)\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/site-packages/litellm/utils.py\\\\\\\\\\\\\\", line 6382, in validate_and_fix_openai_messages\\\\\\\\n    if not message.get(\\\\\\\\\\\\\\"role\\\\\\\\\\\\\\"):\\\\\\\\n           ^^^^^^^^^^^\\\\\\\\nAttributeError: 'str' object has no attribute 'get'\\\\\\\\nNo fallback model group found for original model_group=text-embedding-3-small. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}]. Received Model Group=text-embedding-3-small\\\\\\\\nAvailable Model Group Fallbacks=None\\\\\\\\nError doing the fallback: litellm.APIConnectionError: AzureException APIConnectionError - 'str' object has no attribute 'get'\\\\\\\\nTraceback (most recent call last):\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/site-packages/litellm/main.py\\\\\\\\\\\\\\", line 516, in acompletion\\\\\\\\n    init_response = await loop.run_in_executor(None, func_with_context)\\\\\\\\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/concurrent/futures/thread.py\\\\\\\\\\\\\\", line 59, in run\\\\\\\\n    result = self.fn(*self.args, **self.kwargs)\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/site-packages/litellm/utils.py\\\\\\\\\\\\\\", line 1020, in wrapper\\\\\\\\n    result = original_function(*args, **kwargs)\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/site-packages/litellm/main.py\\\\\\\\\\\\\\", line 919, in completion\\\\\\\\n    messages = validate_and_fix_openai_messages(messages=messages)\\\\\\\\n  File \\\\\\\\\\\\\\"/usr/lib/python3.13/site-packages/litellm/utils.py\\\\\\\\\\\\\\", line 6382, in validate_and_fix_openai_messages\\\\\\\\n    if not message.get(\\\\\\\\\\\\\\"role\\\\\\\\\\\\\\"):\\\\\\\\n           ^^^^^^^^^^^\\\\\\\\nAttributeError: 'str' object has no attribute 'get'\\\\\\\\nNo fallback model group found for original model_group=text-embedding-3-small. Fallbacks=[{'gpt-5': ['gpt-5-mini', 'gpt-5-nano', 'gpt-5-chat', 'gpt-4.1']}, {'gpt-5-mini': ['gpt-5-nano', 'gpt-4.1', 'gpt-4.1-mini']}, {'gpt-5-nano': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'gpt-5-chat': ['gpt-4.1-mini', 'gpt-4.1-nano']}, {'mistral-medium-3.1': ['mistral-medium-3', 'mistral-small-3.2-24b-instruct']}, {'mistral-medium-3': ['mistral-small-3.2-24b-instruct']}, {'claude-4-sonnet-20250522': ['claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-opus-4-1-20250805': ['claude-4-sonnet-20250522', 'claude-3-7-sonnet-20250219', 'claude-3-5-sonnet-20241022']}, {'claude-3-7-sonnet-20250219': ['claude-3-5-sonnet-20241022']}, {'deepseek-v3.1': ['deepseek-v3.1-terminus', 'deepseek-v3-0324']}, {'deepseek-v3.1-terminus': ['deepseek-v3.1', 'deepseek-v3-0324']}, {'deepseek-v3.2-exp': ['deepseek-v3.1-terminus', 'deepseek-v3.1', 'deepseek-v3-0324']}] LiteLLM Retried: 1 times, LiteLLM Max Retries: 2\\\\\\",\\\\\\"type\\\\\\":null,\\\\\\"param\\\\\\":null,\\\\\\"code\\\\\\":\\\\\\"500\\\\\\"}}\\"",{"startTime":1764846750890,"executionIndex":0,"source":"58","hints":"59","executionTime":2,"executionStatus":"60","data":"61"},{"startTime":1764846758592,"executionIndex":1,"source":"62","hints":"63","executionTime":23,"executionStatus":"60","data":"64"},{"startTime":1764847371266,"executionIndex":2,"source":"65","hints":"66","executionTime":1206,"executionStatus":"67","error":"68"},{"parameters":"69","type":"35","typeVersion":4.3,"position":"70","id":"37","name":"4","credentials":"71"},{"main":"72"},{"main":"65"},{"model":"73","messages":"74"},{"accept":"75","Authorization":"76","OpenAI-Organization":"77"},"POST","https://api.mammouth.ai/v1/chat/completions","","predefinedCredentialType","openAiApi","json","keypair",{"parameters":"78"},{},{"id":"79","name":"80"},[],[],"success",{"main":"81"},["82"],[],{"main":"83"},["84"],[],"error",{"level":"17","tags":"18","description":"19","timestamp":1764847372466,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","nodeCredentialType":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"85","options":"86","infoMessage":"50"},[-1664,-352],{"openAiApi":"87"},["88"],"text-embedding-3-small",",AO","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7","**hidden**","mammouth",["89","90"],"7D2TxcTctnD2ZM7F","OpenAi account",["91"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["92"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"93"},{},{"id":"79","name":"80"},["94"],{"name":"95","value":"96"},{"name":"97","value":"98"},["99"],["100"],["101","102"],{"json":"103","pairedItem":"104"},"model","=text-embedding-3-small","messages","={{ $json.body.message }}",{"json":"105","pairedItem":"106"},{"json":"103","pairedItem":"107"},{"name":"95","value":"96"},{"name":"97","value":"98"},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113","myNewField":1},{"item":0},{"headers":"114","params":"115","query":"116","body":"117","webhookUrl":"112","executionMode":"113"},{"item":0},{"item":0},{"host":"118","connection":"119","content-length":"120","sec-ch-ua-platform":"121","user-agent":"122","sec-ch-ua":"123","content-type":"124","sec-ch-ua-mobile":"125","accept":"126","sec-gpc":"127","accept-language":"128","origin":"129","sec-fetch-site":"130","sec-fetch-mode":"131","sec-fetch-dest":"132","referer":"133","accept-encoding":"134"},{},{},{"message":"74","user":"135"},"http://localhost:5678/webhook-test/ever","test",{"host":"118","connection":"119","content-length":"120","sec-ch-ua-platform":"121","user-agent":"122","sec-ch-ua":"123","content-type":"124","sec-ch-ua-mobile":"125","accept":"126","sec-gpc":"127","accept-language":"128","origin":"129","sec-fetch-site":"130","sec-fetch-mode":"131","sec-fetch-dest":"132","referer":"133","accept-encoding":"134"},{},{},{"message":"74","user":"135"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764846651458_012qvnrh7"]
139	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"==Bearer sk-cgOP97ddcHyM5alqeV7ieA","value":"Authorization"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small\\""},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["15","16","4"],{"level":"17","tags":"18","timestamp":1764848235060,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","httpCode":"24","message":"25","stack":"26"},{"Webhook - Chat":"27","Extraer Query":"28","HTTP Request":"29"},{},{},["30"],{},{},{},{"version":1,"establishedAt":1764848235026,"source":"31"},"Webhook - Chat","Extraer Query","warning",{},{"itemIndex":0,"request":"32"},"regular","NodeApiError",{"parameters":"33","type":"34","typeVersion":4.3,"position":"35","id":"36","name":"4"},["25"],"ERR_INVALID_HTTP_TOKEN","Header name must be a valid HTTP token [\\"=bearer sk-cgop97ddchym5alqev7iea\\"]","NodeApiError: Header name must be a valid HTTP token [\\"=bearer sk-cgop97ddchym5alqev7iea\\"]\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["37"],["38"],["39"],{"node":"40","data":"41","source":"42"},"manual",{"body":"43","headers":"44","method":"45","uri":"46","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"47","curlImport":"47","method":"45","url":"46","authentication":"48","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"49","headerParameters":"50","sendBody":true,"contentType":"51","specifyBody":"49","bodyParameters":"52","options":"53","infoMessage":"47"},"n8n-nodes-base.httpRequest",[-1664,-352],"7375640d-f95b-4963-8c07-483a4d1132f9",{"startTime":1764846750890,"executionIndex":0,"source":"54","hints":"55","executionTime":2,"executionStatus":"56","data":"57"},{"startTime":1764846758592,"executionIndex":1,"source":"58","hints":"59","executionTime":23,"executionStatus":"56","data":"60"},{"startTime":1764848235028,"executionIndex":2,"source":"61","hints":"62","executionTime":138,"executionStatus":"63","error":"64"},{"parameters":"65","type":"34","typeVersion":4.3,"position":"66","id":"36","name":"4"},{"main":"67"},{"main":"61"},{"model":"68","input":"69"},{"=bearer sk-cgop97ddchym5alqev7iea":"70","accept":"71"},"POST","https://api.mammouth.ai/v1/embeddings","","none","keypair",{"parameters":"72"},"json",{"parameters":"73"},{},[],[],"success",{"main":"74"},["75"],[],{"main":"76"},["77"],[],"error",{"level":"17","tags":"18","timestamp":1764848235060,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","httpCode":"24","message":"25","stack":"26"},{"preBuiltAgentsCalloutHttpRequest":"47","curlImport":"47","method":"45","url":"46","authentication":"48","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"49","headerParameters":"78","sendBody":true,"contentType":"51","specifyBody":"49","bodyParameters":"79","options":"80","infoMessage":"47"},[-1664,-352],["81"],"text-embedding-3-small\\"",",AO","Authorization","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["82"],["83","84"],["85"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["86"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"87"},{"parameters":"88"},{},["89"],{"name":"90","value":"70"},{"name":"91","value":"92"},{"name":"93","value":"94"},["95"],["96"],["97"],["98","99"],{"json":"100","pairedItem":"101"},"==Bearer sk-cgOP97ddcHyM5alqeV7ieA","model","=text-embedding-3-small\\"","input","={{ $json.body.message }}",{"json":"102","pairedItem":"103"},{"json":"100","pairedItem":"104"},{"name":"90","value":"70"},{"name":"91","value":"92"},{"name":"93","value":"94"},{"headers":"105","params":"106","query":"107","body":"108","webhookUrl":"109","executionMode":"110","myNewField":1},{"item":0},{"headers":"111","params":"112","query":"113","body":"114","webhookUrl":"109","executionMode":"110"},{"item":0},{"item":0},{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"69","user":"132"},"http://localhost:5678/webhook-test/ever","test",{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"69","user":"132"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764846651458_012qvnrh7"]
140	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=\\"=Bearer sk-cgOP97ddcHyM5alqeV7ieA\\"","value":"Authorization"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small\\""},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["15","16","4"],{"level":"17","tags":"18","timestamp":1764848256911,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","httpCode":"24","message":"25","stack":"26"},{"Webhook - Chat":"27","Extraer Query":"28","HTTP Request":"29"},{},{},["30"],{},{},{},{"version":1,"establishedAt":1764848256903,"source":"31"},"Webhook - Chat","Extraer Query","warning",{},{"itemIndex":0,"request":"32"},"regular","NodeApiError",{"parameters":"33","type":"34","typeVersion":4.3,"position":"35","id":"36","name":"4"},["25"],"ERR_INVALID_HTTP_TOKEN","Header name must be a valid HTTP token [\\"\\"=bearer sk-cgop97ddchym5alqev7iea\\"\\"]","NodeApiError: Header name must be a valid HTTP token [\\"\\"=bearer sk-cgop97ddchym5alqev7iea\\"\\"]\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["37"],["38"],["39"],{"node":"40","data":"41","source":"42"},"manual",{"body":"43","headers":"44","method":"45","uri":"46","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"47","curlImport":"47","method":"45","url":"46","authentication":"48","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"49","headerParameters":"50","sendBody":true,"contentType":"51","specifyBody":"49","bodyParameters":"52","options":"53","infoMessage":"47"},"n8n-nodes-base.httpRequest",[-1664,-352],"7375640d-f95b-4963-8c07-483a4d1132f9",{"startTime":1764846750890,"executionIndex":0,"source":"54","hints":"55","executionTime":2,"executionStatus":"56","data":"57"},{"startTime":1764846758592,"executionIndex":1,"source":"58","hints":"59","executionTime":23,"executionStatus":"56","data":"60"},{"startTime":1764848256905,"executionIndex":2,"source":"61","hints":"62","executionTime":8,"executionStatus":"63","error":"64"},{"parameters":"65","type":"34","typeVersion":4.3,"position":"66","id":"36","name":"4"},{"main":"67"},{"main":"61"},{"model":"68","input":"69"},{"\\"=bearer sk-cgop97ddchym5alqev7iea\\"":"70","accept":"71"},"POST","https://api.mammouth.ai/v1/embeddings","","none","keypair",{"parameters":"72"},"json",{"parameters":"73"},{},[],[],"success",{"main":"74"},["75"],[],{"main":"76"},["77"],[],"error",{"level":"17","tags":"18","timestamp":1764848256911,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","httpCode":"24","message":"25","stack":"26"},{"preBuiltAgentsCalloutHttpRequest":"47","curlImport":"47","method":"45","url":"46","authentication":"48","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"49","headerParameters":"78","sendBody":true,"contentType":"51","specifyBody":"49","bodyParameters":"79","options":"80","infoMessage":"47"},[-1664,-352],["81"],"text-embedding-3-small\\"",",AO","Authorization","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["82"],["83","84"],["85"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["86"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"87"},{"parameters":"88"},{},["89"],{"name":"90","value":"70"},{"name":"91","value":"92"},{"name":"93","value":"94"},["95"],["96"],["97"],["98","99"],{"json":"100","pairedItem":"101"},"=\\"=Bearer sk-cgOP97ddcHyM5alqeV7ieA\\"","model","=text-embedding-3-small\\"","input","={{ $json.body.message }}",{"json":"102","pairedItem":"103"},{"json":"100","pairedItem":"104"},{"name":"90","value":"70"},{"name":"91","value":"92"},{"name":"93","value":"94"},{"headers":"105","params":"106","query":"107","body":"108","webhookUrl":"109","executionMode":"110","myNewField":1},{"item":0},{"headers":"111","params":"112","query":"113","body":"114","webhookUrl":"109","executionMode":"110"},{"item":0},{"item":0},{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"69","user":"132"},"http://localhost:5678/webhook-test/ever","test",{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"69","user":"132"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764846651458_012qvnrh7"]
141	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=\\"=Bearer sk-cgOP97ddcHyM5alqeV7ieA\\"","value":"Authorization"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small\\""},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["15","16","4"],{"level":"17","tags":"18","timestamp":1764848263478,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","httpCode":"24","message":"25","stack":"26"},{"Webhook - Chat":"27","Extraer Query":"28","HTTP Request":"29"},{},{},["30"],{},{},{},{"version":1,"establishedAt":1764848263471,"source":"31"},"Webhook - Chat","Extraer Query","warning",{},{"itemIndex":0,"request":"32"},"regular","NodeApiError",{"parameters":"33","type":"34","typeVersion":4.3,"position":"35","id":"36","name":"4"},["25"],"ERR_INVALID_HTTP_TOKEN","Header name must be a valid HTTP token [\\"\\"=bearer sk-cgop97ddchym5alqev7iea\\"\\"]","NodeApiError: Header name must be a valid HTTP token [\\"\\"=bearer sk-cgop97ddchym5alqev7iea\\"\\"]\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["37"],["38"],["39"],{"node":"40","data":"41","source":"42"},"manual",{"body":"43","headers":"44","method":"45","uri":"46","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"47","curlImport":"47","method":"45","url":"46","authentication":"48","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"49","headerParameters":"50","sendBody":true,"contentType":"51","specifyBody":"49","bodyParameters":"52","options":"53","infoMessage":"47"},"n8n-nodes-base.httpRequest",[-1664,-352],"7375640d-f95b-4963-8c07-483a4d1132f9",{"startTime":1764846750890,"executionIndex":0,"source":"54","hints":"55","executionTime":2,"executionStatus":"56","data":"57"},{"startTime":1764846758592,"executionIndex":1,"source":"58","hints":"59","executionTime":23,"executionStatus":"56","data":"60"},{"startTime":1764848263473,"executionIndex":2,"source":"61","hints":"62","executionTime":5,"executionStatus":"63","error":"64"},{"parameters":"65","type":"34","typeVersion":4.3,"position":"66","id":"36","name":"4"},{"main":"67"},{"main":"61"},{"model":"68","input":"69"},{"\\"=bearer sk-cgop97ddchym5alqev7iea\\"":"70","accept":"71"},"POST","https://api.mammouth.ai/v1/embeddings","","none","keypair",{"parameters":"72"},"json",{"parameters":"73"},{},[],[],"success",{"main":"74"},["75"],[],{"main":"76"},["77"],[],"error",{"level":"17","tags":"18","timestamp":1764848263478,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","httpCode":"24","message":"25","stack":"26"},{"preBuiltAgentsCalloutHttpRequest":"47","curlImport":"47","method":"45","url":"46","authentication":"48","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"49","headerParameters":"78","sendBody":true,"contentType":"51","specifyBody":"49","bodyParameters":"79","options":"80","infoMessage":"47"},[-1664,-352],["81"],"text-embedding-3-small\\"",",AO","Authorization","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["82"],["83","84"],["85"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["86"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"87"},{"parameters":"88"},{},["89"],{"name":"90","value":"70"},{"name":"91","value":"92"},{"name":"93","value":"94"},["95"],["96"],["97"],["98","99"],{"json":"100","pairedItem":"101"},"=\\"=Bearer sk-cgOP97ddcHyM5alqeV7ieA\\"","model","=text-embedding-3-small\\"","input","={{ $json.body.message }}",{"json":"102","pairedItem":"103"},{"json":"100","pairedItem":"104"},{"name":"90","value":"70"},{"name":"91","value":"92"},{"name":"93","value":"94"},{"headers":"105","params":"106","query":"107","body":"108","webhookUrl":"109","executionMode":"110","myNewField":1},{"item":0},{"headers":"111","params":"112","query":"113","body":"114","webhookUrl":"109","executionMode":"110"},{"item":0},{"item":0},{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"69","user":"132"},"http://localhost:5678/webhook-test/ever","test",{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"69","user":"132"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764846651458_012qvnrh7"]
142	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA","value":"Authorization"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small\\""},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["15","16","4"],{"level":"17","tags":"18","timestamp":1764848272274,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","httpCode":"24","message":"25","stack":"26"},{"Webhook - Chat":"27","Extraer Query":"28","HTTP Request":"29"},{},{},["30"],{},{},{},{"version":1,"establishedAt":1764848272268,"source":"31"},"Webhook - Chat","Extraer Query","warning",{},{"itemIndex":0,"request":"32"},"regular","NodeApiError",{"parameters":"33","type":"34","typeVersion":4.3,"position":"35","id":"36","name":"4"},["25"],"ERR_INVALID_HTTP_TOKEN","Header name must be a valid HTTP token [\\"bearer sk-cgop97ddchym5alqev7iea\\"]","NodeApiError: Header name must be a valid HTTP token [\\"bearer sk-cgop97ddchym5alqev7iea\\"]\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["37"],["38"],["39"],{"node":"40","data":"41","source":"42"},"manual",{"body":"43","headers":"44","method":"45","uri":"46","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"47","curlImport":"47","method":"45","url":"46","authentication":"48","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"49","headerParameters":"50","sendBody":true,"contentType":"51","specifyBody":"49","bodyParameters":"52","options":"53","infoMessage":"47"},"n8n-nodes-base.httpRequest",[-1664,-352],"7375640d-f95b-4963-8c07-483a4d1132f9",{"startTime":1764846750890,"executionIndex":0,"source":"54","hints":"55","executionTime":2,"executionStatus":"56","data":"57"},{"startTime":1764846758592,"executionIndex":1,"source":"58","hints":"59","executionTime":23,"executionStatus":"56","data":"60"},{"startTime":1764848272269,"executionIndex":2,"source":"61","hints":"62","executionTime":6,"executionStatus":"63","error":"64"},{"parameters":"65","type":"34","typeVersion":4.3,"position":"66","id":"36","name":"4"},{"main":"67"},{"main":"61"},{"model":"68","input":"69"},{"bearer sk-cgop97ddchym5alqev7iea":"70","accept":"71"},"POST","https://api.mammouth.ai/v1/embeddings","","none","keypair",{"parameters":"72"},"json",{"parameters":"73"},{},[],[],"success",{"main":"74"},["75"],[],{"main":"76"},["77"],[],"error",{"level":"17","tags":"18","timestamp":1764848272274,"context":"19","functionality":"20","name":"21","node":"22","messages":"23","httpCode":"24","message":"25","stack":"26"},{"preBuiltAgentsCalloutHttpRequest":"47","curlImport":"47","method":"45","url":"46","authentication":"48","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"49","headerParameters":"78","sendBody":true,"contentType":"51","specifyBody":"49","bodyParameters":"79","options":"80","infoMessage":"47"},[-1664,-352],["81"],"text-embedding-3-small\\"",",AO","Authorization","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["82"],["83","84"],["85"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["86"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"87"},{"parameters":"88"},{},["89"],{"name":"90","value":"70"},{"name":"91","value":"92"},{"name":"93","value":"94"},["95"],["96"],["97"],["98","99"],{"json":"100","pairedItem":"101"},"=Bearer sk-cgOP97ddcHyM5alqeV7ieA","model","=text-embedding-3-small\\"","input","={{ $json.body.message }}",{"json":"102","pairedItem":"103"},{"json":"100","pairedItem":"104"},{"name":"90","value":"70"},{"name":"91","value":"92"},{"name":"93","value":"94"},{"headers":"105","params":"106","query":"107","body":"108","webhookUrl":"109","executionMode":"110","myNewField":1},{"item":0},{"headers":"111","params":"112","query":"113","body":"114","webhookUrl":"109","executionMode":"110"},{"item":0},{"item":0},{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"69","user":"132"},"http://localhost:5678/webhook-test/ever","test",{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"69","user":"132"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764846651458_012qvnrh7"]
143	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Authorization","value":"==Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small\\""},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["15","16","4"],{"level":"17","tags":"18","description":"19","timestamp":1764848362477,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","HTTP Request":"30"},{},{},["31"],{},{},{},{"version":1,"establishedAt":1764848361355,"source":"32"},"Webhook - Chat","Extraer Query","warning",{},"Authentication Error, Malformed API Key passed in. Ensure Key has `Bearer ` prefix. Passed in: =Bearer sk-cgOP97ddcHyM5alqeV7ieA",{"itemIndex":0,"request":"33"},"regular","NodeApiError",{"parameters":"34","type":"35","typeVersion":4.3,"position":"36","id":"37","name":"4"},["38"],"401","Authorization failed - please check your credentials","NodeApiError: Authorization failed - please check your credentials\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["39"],["40"],["41"],{"node":"42","data":"43","source":"44"},"manual",{"body":"45","headers":"46","method":"47","uri":"48","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"49","curlImport":"49","method":"47","url":"48","authentication":"50","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"51","headerParameters":"52","sendBody":true,"contentType":"53","specifyBody":"51","bodyParameters":"54","options":"55","infoMessage":"49"},"n8n-nodes-base.httpRequest",[-1664,-352],"7375640d-f95b-4963-8c07-483a4d1132f9","401 - \\"{\\\\\\"error\\\\\\":{\\\\\\"message\\\\\\":\\\\\\"Authentication Error, Malformed API Key passed in. Ensure Key has `Bearer ` prefix. Passed in: =Bearer sk-cgOP97ddcHyM5alqeV7ieA\\\\\\",\\\\\\"type\\\\\\":\\\\\\"auth_error\\\\\\",\\\\\\"param\\\\\\":\\\\\\"None\\\\\\",\\\\\\"code\\\\\\":\\\\\\"401\\\\\\"}}\\"",{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848361356,"executionIndex":2,"source":"63","hints":"64","executionTime":1121,"executionStatus":"65","error":"66"},{"parameters":"67","type":"35","typeVersion":4.3,"position":"68","id":"37","name":"4"},{"main":"69"},{"main":"63"},{"model":"70","input":"71"},{"authorization":"72","accept":"73"},"POST","https://api.mammouth.ai/v1/embeddings","","none","keypair",{"parameters":"74"},"json",{"parameters":"75"},{},[],[],"success",{"main":"76"},["77"],[],{"main":"78"},["79"],[],"error",{"level":"17","tags":"18","description":"19","timestamp":1764848362477,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"49","curlImport":"49","method":"47","url":"48","authentication":"50","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"51","headerParameters":"80","sendBody":true,"contentType":"53","specifyBody":"51","bodyParameters":"81","options":"82","infoMessage":"49"},[-1664,-352],["83"],"text-embedding-3-small\\"",",AO","**hidden**","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["84"],["85","86"],["87"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["88"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"89"},{"parameters":"90"},{},["91"],{"name":"92","value":"93"},{"name":"94","value":"95"},{"name":"96","value":"97"},["98"],["99"],["100"],["101","102"],{"json":"103","pairedItem":"104"},"=Authorization","==Bearer sk-cgOP97ddcHyM5alqeV7ieA","model","=text-embedding-3-small\\"","input","={{ $json.body.message }}",{"json":"105","pairedItem":"106"},{"json":"103","pairedItem":"107"},{"name":"92","value":"93"},{"name":"94","value":"95"},{"name":"96","value":"97"},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113","myNewField":1},{"item":0},{"headers":"114","params":"115","query":"116","body":"117","webhookUrl":"112","executionMode":"113"},{"item":0},{"item":0},{"host":"118","connection":"119","content-length":"120","sec-ch-ua-platform":"121","user-agent":"122","sec-ch-ua":"123","content-type":"124","sec-ch-ua-mobile":"125","accept":"126","sec-gpc":"127","accept-language":"128","origin":"129","sec-fetch-site":"130","sec-fetch-mode":"131","sec-fetch-dest":"132","referer":"133","accept-encoding":"134"},{},{},{"message":"71","user":"135"},"http://localhost:5678/webhook-test/ever","test",{"host":"118","connection":"119","content-length":"120","sec-ch-ua-platform":"121","user-agent":"122","sec-ch-ua":"123","content-type":"124","sec-ch-ua-mobile":"125","accept":"126","sec-gpc":"127","accept-language":"128","origin":"129","sec-fetch-site":"130","sec-fetch-mode":"131","sec-fetch-dest":"132","referer":"133","accept-encoding":"134"},{},{},{"message":"71","user":"135"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764846651458_012qvnrh7"]
144	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small\\""},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"HTTP Request",["15","16","4"],{"level":"17","tags":"18","description":"19","timestamp":1764848507830,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","HTTP Request":"30"},{},{},["31"],{},{},{},{"version":1,"establishedAt":1764848506577,"source":"32"},"Webhook - Chat","Extraer Query","warning",{},"/embeddings: Invalid model name passed in model=text-embedding-3-small\\". Call `/v1/models` to view available models for your key.",{"itemIndex":0,"request":"33"},"regular","NodeApiError",{"parameters":"34","type":"35","typeVersion":4.3,"position":"36","id":"37","name":"4"},["38"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["39"],["40"],["41"],{"node":"42","data":"43","source":"44"},"manual",{"body":"45","headers":"46","method":"47","uri":"48","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"49","curlImport":"49","method":"47","url":"48","authentication":"50","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"51","headerParameters":"52","sendBody":true,"contentType":"53","specifyBody":"51","bodyParameters":"54","options":"55","infoMessage":"49"},"n8n-nodes-base.httpRequest",[-1664,-352],"7375640d-f95b-4963-8c07-483a4d1132f9","400 - \\"{\\\\\\"error\\\\\\":{\\\\\\"message\\\\\\":\\\\\\"{\\\\\\\\\\\\\\"error\\\\\\\\\\\\\\": \\\\\\\\\\\\\\"/embeddings: Invalid model name passed in model=text-embedding-3-small\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\". Call `/v1/models` to view available models for your key.\\\\\\\\\\\\\\"}\\\\\\",\\\\\\"type\\\\\\":\\\\\\"None\\\\\\",\\\\\\"param\\\\\\":\\\\\\"None\\\\\\",\\\\\\"code\\\\\\":\\\\\\"400\\\\\\"}}\\"",{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848506578,"executionIndex":2,"source":"63","hints":"64","executionTime":1252,"executionStatus":"65","error":"66"},{"parameters":"67","type":"35","typeVersion":4.3,"position":"68","id":"37","name":"4"},{"main":"69"},{"main":"63"},{"model":"70","input":"71"},{"content-type":"72","authorization":"73","accept":"74"},"POST","https://api.mammouth.ai/v1/embeddings","","none","keypair",{"parameters":"75"},"json",{"parameters":"76"},{},[],[],"success",{"main":"77"},["78"],[],{"main":"79"},["80"],[],"error",{"level":"17","tags":"18","description":"19","timestamp":1764848507830,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"49","curlImport":"49","method":"47","url":"48","authentication":"50","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"51","headerParameters":"81","sendBody":true,"contentType":"53","specifyBody":"51","bodyParameters":"82","options":"83","infoMessage":"49"},[-1664,-352],["84"],"text-embedding-3-small\\"",",AO","application/json","**hidden**","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["85","86"],["87","88"],["89"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["90"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"91"},{"parameters":"92"},{},["93"],{"name":"94","value":"95"},{"name":"96","value":"97"},{"name":"98","value":"99"},{"name":"100","value":"101"},["102"],["103"],["104","105"],["106","107"],{"json":"108","pairedItem":"109"},"=Content-Type","=application/json","Authorization","=Bearer sk-cgOP97ddcHyM5alqeV7ieA","model","=text-embedding-3-small\\"","input","={{ $json.body.message }}",{"json":"110","pairedItem":"111"},{"json":"108","pairedItem":"112"},{"name":"94","value":"95"},{"name":"96","value":"97"},{"name":"98","value":"99"},{"name":"100","value":"101"},{"headers":"113","params":"114","query":"115","body":"116","webhookUrl":"117","executionMode":"118","myNewField":1},{"item":0},{"headers":"119","params":"120","query":"121","body":"122","webhookUrl":"117","executionMode":"118"},{"item":0},{"item":0},{"host":"123","connection":"124","content-length":"125","sec-ch-ua-platform":"126","user-agent":"127","sec-ch-ua":"128","content-type":"129","sec-ch-ua-mobile":"130","accept":"131","sec-gpc":"132","accept-language":"133","origin":"134","sec-fetch-site":"135","sec-fetch-mode":"136","sec-fetch-dest":"137","referer":"138","accept-encoding":"139"},{},{},{"message":"71","user":"140"},"http://localhost:5678/webhook-test/ever","test",{"host":"123","connection":"124","content-length":"125","sec-ch-ua-platform":"126","user-agent":"127","sec-ch-ua":"128","content-type":"129","sec-ch-ua-mobile":"130","accept":"131","sec-gpc":"132","accept-language":"133","origin":"134","sec-fetch-site":"135","sec-fetch-mode":"136","sec-fetch-dest":"137","referer":"138","accept-encoding":"139"},{},{},{"message":"71","user":"140"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd","session_1764846651458_012qvnrh7"]
145	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1664,-352],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"runData":"6","pinData":"7","lastNodeExecuted":"4"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"HTTP Request",["14","15","4"],{"Webhook - Chat":"16","Extraer Query":"17","HTTP Request":"18"},{},{"node:HTTP Request":"19"},[],{},{},{},{"version":1,"establishedAt":1764848532273,"source":"20"},"Webhook - Chat","Extraer Query",["21"],["22"],["23"],{"response":"24"},"manual",{"startTime":1764846750890,"executionIndex":0,"source":"25","hints":"26","executionTime":2,"executionStatus":"27","data":"28"},{"startTime":1764846758592,"executionIndex":1,"source":"29","hints":"30","executionTime":23,"executionStatus":"27","data":"31"},{"startTime":1764848532274,"executionIndex":2,"source":"32","hints":"33","executionTime":798,"executionStatus":"27","data":"34"},{"body":"35"},[],[],"success",{"main":"36"},["37"],[],{"main":"38"},["39"],["40"],{"main":"41"},{"model":"42","data":"43","object":"44","usage":"45"},["46"],{"previousNode":"14","previousNodeOutput":0,"previousNodeRun":0},["47"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},{"message":"48","location":"49"},["50"],"text-embedding-3-small",["51"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},["52"],["53"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["54"],{"embedding":"55","index":0,"object":"56"},{"json":"57","pairedItem":"58"},{"json":"59","pairedItem":"60"},{"json":"35","pairedItem":"61"},[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"embedding",{"headers":"62","params":"63","query":"64","body":"65","webhookUrl":"66","executionMode":"67"},{"item":0},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"66","executionMode":"67","myNewField":1},{"item":0},{"item":0},{"host":"72","connection":"73","content-length":"74","sec-ch-ua-platform":"75","user-agent":"76","sec-ch-ua":"77","content-type":"78","sec-ch-ua-mobile":"79","accept":"80","sec-gpc":"81","accept-language":"82","origin":"83","sec-fetch-site":"84","sec-fetch-mode":"85","sec-fetch-dest":"86","referer":"87","accept-encoding":"88"},{},{},{"message":"89","user":"90"},"http://localhost:5678/webhook-test/ever","test",{"host":"72","connection":"73","content-length":"74","sec-ch-ua-platform":"75","user-agent":"76","sec-ch-ua":"77","content-type":"78","sec-ch-ua-mobile":"79","accept":"80","sec-gpc":"81","accept-language":"82","origin":"83","sec-fetch-site":"84","sec-fetch-mode":"85","sec-fetch-dest":"86","referer":"87","accept-encoding":"88"},{},{},{"message":"89","user":"90"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7"]
146	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764848545261,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","HTTP Request":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764848545215,"source":"34"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: missing field `vector` at line 1 column 7\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764846750890,"executionIndex":0,"source":"57","hints":"58","executionTime":2,"executionStatus":"59","data":"60"},{"startTime":1764846758592,"executionIndex":1,"source":"61","hints":"62","executionTime":23,"executionStatus":"59","data":"63"},{"startTime":1764848532274,"executionIndex":2,"source":"64","hints":"65","executionTime":798,"executionStatus":"59","data":"66"},{"startTime":1764848545219,"executionIndex":3,"source":"67","hints":"68","executionTime":42,"executionStatus":"69","error":"70"},{"parameters":"71","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"":"51"},{"accept":"74"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"75"},{},[],[],"success",{"main":"76"},["77"],[],{"main":"78"},["79"],["80"],{"main":"81"},["82"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764848545261,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"83","options":"84","infoMessage":"51"},[-1392,-208],["85"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["86"],["87"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["88"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"89","location":"90"},["91"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"92"},{},["93"],{"name":"51","value":"51"},["94"],["95"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["96"],["97"],{"json":"98","pairedItem":"99"},{"json":"100","pairedItem":"101"},{"json":"102","pairedItem":"103"},{"json":"98","pairedItem":"104"},{"name":"51","value":"51"},{"model":"105","data":"106","object":"107","usage":"108"},{"item":0},{"headers":"109","params":"110","query":"111","body":"112","webhookUrl":"113","executionMode":"114"},{"item":0},{"headers":"115","params":"116","query":"117","body":"118","webhookUrl":"113","executionMode":"114","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["119"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"120","connection":"121","content-length":"122","sec-ch-ua-platform":"123","user-agent":"124","sec-ch-ua":"125","content-type":"126","sec-ch-ua-mobile":"127","accept":"128","sec-gpc":"129","accept-language":"130","origin":"131","sec-fetch-site":"132","sec-fetch-mode":"133","sec-fetch-dest":"134","referer":"135","accept-encoding":"136"},{},{},{"message":"137","user":"138"},"http://localhost:5678/webhook-test/ever","test",{"host":"120","connection":"121","content-length":"122","sec-ch-ua-platform":"123","user-agent":"124","sec-ch-ua":"125","content-type":"126","sec-ch-ua-mobile":"127","accept":"128","sec-gpc":"129","accept-language":"130","origin":"131","sec-fetch-site":"132","sec-fetch-mode":"133","sec-fetch-dest":"134","referer":"135","accept-encoding":"136"},{},{},{"message":"137","user":"138"},{"embedding":"139","index":0,"object":"140"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7",[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"embedding"]
147	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764848819652,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","HTTP Request":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764848819542,"source":"34"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: invalid type: string \\\\\\\\\\\\\\"5\\\\\\\\\\\\\\", expected usize at line 1 column 32780\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764846750890,"executionIndex":0,"source":"57","hints":"58","executionTime":2,"executionStatus":"59","data":"60"},{"startTime":1764846758592,"executionIndex":1,"source":"61","hints":"62","executionTime":23,"executionStatus":"59","data":"63"},{"startTime":1764848532274,"executionIndex":2,"source":"64","hints":"65","executionTime":798,"executionStatus":"59","data":"66"},{"startTime":1764848819562,"executionIndex":3,"source":"67","hints":"68","executionTime":91,"executionStatus":"69","error":"70"},{"parameters":"71","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"vector":"74","limit":"75","with_payload":"76"},{"accept":"77"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"78"},{},[],[],"success",{"main":"79"},["80"],[],{"main":"81"},["82"],["83"],{"main":"84"},["85"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764848819652,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"86","options":"87","infoMessage":"51"},[-1392,-208],["88"],[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"5","true","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["89","90","91"],["92"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["93"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"94","location":"95"},["96"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"97"},{},["98"],{"name":"99","value":"100"},{"name":"101","value":"75"},{"name":"102","value":"76"},["103"],["104"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["105"],["106","107","108"],{"json":"109","pairedItem":"110"},"vector","={{ $json.data[0].embedding }}","limit","with_payload",{"json":"111","pairedItem":"112"},{"json":"113","pairedItem":"114"},{"json":"109","pairedItem":"115"},{"name":"99","value":"100"},{"name":"101","value":"75"},{"name":"102","value":"76"},{"model":"116","data":"117","object":"118","usage":"119"},{"item":0},{"headers":"120","params":"121","query":"122","body":"123","webhookUrl":"124","executionMode":"125"},{"item":0},{"headers":"126","params":"127","query":"128","body":"129","webhookUrl":"124","executionMode":"125","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["130"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"131","connection":"132","content-length":"133","sec-ch-ua-platform":"134","user-agent":"135","sec-ch-ua":"136","content-type":"137","sec-ch-ua-mobile":"138","accept":"139","sec-gpc":"140","accept-language":"141","origin":"142","sec-fetch-site":"143","sec-fetch-mode":"144","sec-fetch-dest":"145","referer":"146","accept-encoding":"147"},{},{},{"message":"148","user":"149"},"http://localhost:5678/webhook-test/ever","test",{"host":"131","connection":"132","content-length":"133","sec-ch-ua-platform":"134","user-agent":"135","sec-ch-ua":"136","content-type":"137","sec-ch-ua-mobile":"138","accept":"139","sec-gpc":"140","accept-language":"141","origin":"142","sec-fetch-site":"143","sec-fetch-mode":"144","sec-fetch-dest":"145","referer":"146","accept-encoding":"147"},{},{},{"message":"148","user":"149"},{"embedding":"74","index":0,"object":"150"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7","embedding"]
148	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://localhost:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"with_payload","value":"true"}]},"options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","timestamp":1764848970578,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","HTTP Request":"30","Qdrant - Buscar Candidatos":"31"},{},{},["32"],{},{},{},{"version":1,"establishedAt":1764848970552,"source":"33"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},{"itemIndex":0,"request":"34"},"regular","NodeApiError",{"parameters":"35","id":"36","name":"4","type":"37","typeVersion":4.1,"position":"38"},["39","39"],"ECONNREFUSED","The service refused the connection - perhaps it is offline","NodeApiError: The service refused the connection - perhaps it is offline\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"55","options":"56","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],"connect ECONNREFUSED ::1:6333",{"startTime":1764846750890,"executionIndex":0,"source":"57","hints":"58","executionTime":2,"executionStatus":"59","data":"60"},{"startTime":1764846758592,"executionIndex":1,"source":"61","hints":"62","executionTime":23,"executionStatus":"59","data":"63"},{"startTime":1764848532274,"executionIndex":2,"source":"64","hints":"65","executionTime":798,"executionStatus":"59","data":"66"},{"startTime":1764848970554,"executionIndex":3,"source":"67","hints":"68","executionTime":25,"executionStatus":"69","error":"70"},{"parameters":"71","id":"36","name":"4","type":"37","typeVersion":4.1,"position":"72"},{"main":"73"},{"main":"67"},{"vector":"74","limit":"75","with_payload":"76"},{"accept":"77"},"POST","http://localhost:6333/collections/candidatos/points/search","","none","json","keypair",{"parameters":"78"},{},[],[],"success",{"main":"79"},["80"],[],{"main":"81"},["82"],["83"],{"main":"84"},["85"],[],"error",{"level":"18","tags":"19","timestamp":1764848970578,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"54","bodyParameters":"86","options":"87","infoMessage":"51"},[-1392,-208],["88"],[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"5","true","application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["89","90","91"],["92"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["93"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"94","location":"95"},["96"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"97"},{},["98"],{"name":"99","value":"100"},{"name":"101","value":"75"},{"name":"102","value":"76"},["103"],["104"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["105"],["106","107","108"],{"json":"109","pairedItem":"110"},"vector","={{ $json.data[0].embedding }}","limit","with_payload",{"json":"111","pairedItem":"112"},{"json":"113","pairedItem":"114"},{"json":"109","pairedItem":"115"},{"name":"99","value":"100"},{"name":"101","value":"75"},{"name":"102","value":"76"},{"model":"116","data":"117","object":"118","usage":"119"},{"item":0},{"headers":"120","params":"121","query":"122","body":"123","webhookUrl":"124","executionMode":"125"},{"item":0},{"headers":"126","params":"127","query":"128","body":"129","webhookUrl":"124","executionMode":"125","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["130"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"131","connection":"132","content-length":"133","sec-ch-ua-platform":"134","user-agent":"135","sec-ch-ua":"136","content-type":"137","sec-ch-ua-mobile":"138","accept":"139","sec-gpc":"140","accept-language":"141","origin":"142","sec-fetch-site":"143","sec-fetch-mode":"144","sec-fetch-dest":"145","referer":"146","accept-encoding":"147"},{},{},{"message":"148","user":"149"},"http://localhost:5678/webhook-test/ever","test",{"host":"131","connection":"132","content-length":"133","sec-ch-ua-platform":"134","user-agent":"135","sec-ch-ua":"136","content-type":"137","sec-ch-ua-mobile":"138","accept":"139","sec-gpc":"140","accept-language":"141","origin":"142","sec-fetch-site":"143","sec-fetch-mode":"144","sec-fetch-dest":"145","referer":"146","accept-encoding":"147"},{},{},{"message":"148","user":"149"},{"embedding":"74","index":0,"object":"150"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7","embedding"]
149	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://localhost:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}\\n","bodyParameters":{"parameters":[{"name":"","value":""}]},"jsonBody":"","body":"","options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","timestamp":1764849109892,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"Webhook - Chat":"28","Extraer Query":"29","HTTP Request":"30","Qdrant - Buscar Candidatos":"31"},{},{},["32"],{},{},{},{"version":1,"establishedAt":1764849109865,"source":"33"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},{"itemIndex":0,"request":"34"},"regular","NodeApiError",{"parameters":"35","id":"36","name":"4","type":"37","typeVersion":4.1,"position":"38"},["39","39"],"ECONNREFUSED","The service refused the connection - perhaps it is offline","NodeApiError: The service refused the connection - perhaps it is offline\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"headers":"47","method":"48","uri":"49","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"54","jsonBody":"50","body":"50","options":"55","infoMessage":"50"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],"connect ECONNREFUSED ::1:6333",{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848532274,"executionIndex":2,"source":"63","hints":"64","executionTime":798,"executionStatus":"58","data":"65"},{"startTime":1764849109868,"executionIndex":3,"source":"66","hints":"67","executionTime":25,"executionStatus":"68","error":"69"},{"parameters":"70","id":"36","name":"4","type":"37","typeVersion":4.1,"position":"71"},{"main":"72"},{"main":"66"},{"accept":"73"},"POST","http://localhost:6333/collections/candidatos/points/search","","none","json","={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}\\n",{"parameters":"74"},{},[],[],"success",{"main":"75"},["76"],[],{"main":"77"},["78"],["79"],{"main":"80"},["81"],[],"error",{"level":"18","tags":"19","timestamp":1764849109892,"context":"20","functionality":"21","name":"22","node":"23","messages":"24","httpCode":"25","message":"26","stack":"27"},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"82","jsonBody":"50","body":"50","options":"83","infoMessage":"50"},[-1392,-208],["84"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["85"],["86"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["87"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"88","location":"89"},["90"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"91"},{},["92"],{"name":"50","value":"50"},["93"],["94"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["95"],["96"],{"json":"97","pairedItem":"98"},{"json":"99","pairedItem":"100"},{"json":"101","pairedItem":"102"},{"json":"97","pairedItem":"103"},{"name":"50","value":"50"},{"model":"104","data":"105","object":"106","usage":"107"},{"item":0},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113"},{"item":0},{"headers":"114","params":"115","query":"116","body":"117","webhookUrl":"112","executionMode":"113","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["118"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},"http://localhost:5678/webhook-test/ever","test",{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},{"embedding":"138","index":0,"object":"139"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7",[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"embedding"]
150	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}\\n","bodyParameters":{"parameters":[{"name":"","value":""}]},"jsonBody":"","body":"","options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764849117847,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","HTTP Request":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764849117839,"source":"34"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: EOF while parsing a value at line 1 column 0\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"headers":"47","method":"48","uri":"49","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"54","jsonBody":"50","body":"50","options":"55","infoMessage":"50"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848532274,"executionIndex":2,"source":"63","hints":"64","executionTime":798,"executionStatus":"58","data":"65"},{"startTime":1764849117840,"executionIndex":3,"source":"66","hints":"67","executionTime":7,"executionStatus":"68","error":"69"},{"parameters":"70","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"71"},{"main":"72"},{"main":"66"},{"accept":"73"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}\\n",{"parameters":"74"},{},[],[],"success",{"main":"75"},["76"],[],{"main":"77"},["78"],["79"],{"main":"80"},["81"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764849117847,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"82","jsonBody":"50","body":"50","options":"83","infoMessage":"50"},[-1392,-208],["84"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["85"],["86"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["87"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"88","location":"89"},["90"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"91"},{},["92"],{"name":"50","value":"50"},["93"],["94"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["95"],["96"],{"json":"97","pairedItem":"98"},{"json":"99","pairedItem":"100"},{"json":"101","pairedItem":"102"},{"json":"97","pairedItem":"103"},{"name":"50","value":"50"},{"model":"104","data":"105","object":"106","usage":"107"},{"item":0},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113"},{"item":0},{"headers":"114","params":"115","query":"116","body":"117","webhookUrl":"112","executionMode":"113","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["118"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},"http://localhost:5678/webhook-test/ever","test",{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},{"embedding":"138","index":0,"object":"139"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7",[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"embedding"]
151	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}\\n","bodyParameters":{"parameters":[{"name":"","value":""}]},"jsonBody":"","body":"","options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764849167292,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","HTTP Request":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764849167254,"source":"34"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: EOF while parsing a value at line 1 column 0\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"headers":"47","method":"48","uri":"49","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"54","jsonBody":"50","body":"50","options":"55","infoMessage":"50"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848532274,"executionIndex":2,"source":"63","hints":"64","executionTime":798,"executionStatus":"58","data":"65"},{"startTime":1764849167257,"executionIndex":3,"source":"66","hints":"67","executionTime":35,"executionStatus":"68","error":"69"},{"parameters":"70","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"71"},{"main":"72"},{"main":"66"},{"accept":"73"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}\\n",{"parameters":"74"},{},[],[],"success",{"main":"75"},["76"],[],{"main":"77"},["78"],["79"],{"main":"80"},["81"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764849167292,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"82","jsonBody":"50","body":"50","options":"83","infoMessage":"50"},[-1392,-208],["84"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["85"],["86"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["87"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"88","location":"89"},["90"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"91"},{},["92"],{"name":"50","value":"50"},["93"],["94"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["95"],["96"],{"json":"97","pairedItem":"98"},{"json":"99","pairedItem":"100"},{"json":"101","pairedItem":"102"},{"json":"97","pairedItem":"103"},{"name":"50","value":"50"},{"model":"104","data":"105","object":"106","usage":"107"},{"item":0},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113"},{"item":0},{"headers":"114","params":"115","query":"116","body":"117","webhookUrl":"112","executionMode":"113","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["118"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},"http://localhost:5678/webhook-test/ever","test",{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},{"embedding":"138","index":0,"object":"139"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7",[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"embedding"]
152	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"={{\\n  {\\n    \\"vector\\": $json.data[0].embedding,\\n    \\"limit\\": 5,\\n    \\"with_payload\\": true\\n  }\\n}}\\n","bodyParameters":{"parameters":[{"name":"","value":""}]},"jsonBody":"","body":"","options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764849339545,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","HTTP Request":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764849339520,"source":"34"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: EOF while parsing a value at line 1 column 0\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"headers":"47","method":"48","uri":"49","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"54","jsonBody":"50","body":"50","options":"55","infoMessage":"50"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848532274,"executionIndex":2,"source":"63","hints":"64","executionTime":798,"executionStatus":"58","data":"65"},{"startTime":1764849339522,"executionIndex":3,"source":"66","hints":"67","executionTime":24,"executionStatus":"68","error":"69"},{"parameters":"70","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"71"},{"main":"72"},{"main":"66"},{"accept":"73"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","={{\\n  {\\n    \\"vector\\": $json.data[0].embedding,\\n    \\"limit\\": 5,\\n    \\"with_payload\\": true\\n  }\\n}}\\n",{"parameters":"74"},{},[],[],"success",{"main":"75"},["76"],[],{"main":"77"},["78"],["79"],{"main":"80"},["81"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764849339545,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"82","jsonBody":"50","body":"50","options":"83","infoMessage":"50"},[-1392,-208],["84"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["85"],["86"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["87"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"88","location":"89"},["90"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"91"},{},["92"],{"name":"50","value":"50"},["93"],["94"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["95"],["96"],{"json":"97","pairedItem":"98"},{"json":"99","pairedItem":"100"},{"json":"101","pairedItem":"102"},{"json":"97","pairedItem":"103"},{"name":"50","value":"50"},{"model":"104","data":"105","object":"106","usage":"107"},{"item":0},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113"},{"item":0},{"headers":"114","params":"115","query":"116","body":"117","webhookUrl":"112","executionMode":"113","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["118"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},"http://localhost:5678/webhook-test/ever","test",{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},{"embedding":"138","index":0,"object":"139"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7",[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"embedding"]
153	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"={{\\n  {\\n    \\"vector\\": $json.data[0].embedding,\\n    \\"limit\\": 5,\\n    \\"with_payload\\": true\\n  }\\n}}\\n","bodyParameters":{"parameters":[{"name":"","value":""}]},"jsonBody":"","body":"","options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764849340043,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","HTTP Request":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764849340011,"source":"34"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Format error in JSON body: EOF while parsing a value at line 1 column 0\\\\\\"},\\\\\\"time\\\\\\":0.0}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"headers":"47","method":"48","uri":"49","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"54","jsonBody":"50","body":"50","options":"55","infoMessage":"50"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848532274,"executionIndex":2,"source":"63","hints":"64","executionTime":798,"executionStatus":"58","data":"65"},{"startTime":1764849340014,"executionIndex":3,"source":"66","hints":"67","executionTime":29,"executionStatus":"68","error":"69"},{"parameters":"70","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"71"},{"main":"72"},{"main":"66"},{"accept":"73"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","={{\\n  {\\n    \\"vector\\": $json.data[0].embedding,\\n    \\"limit\\": 5,\\n    \\"with_payload\\": true\\n  }\\n}}\\n",{"parameters":"74"},{},[],[],"success",{"main":"75"},["76"],[],{"main":"77"},["78"],["79"],{"main":"80"},["81"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764849340043,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"50","curlImport":"50","method":"48","url":"49","authentication":"51","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"52","specifyBody":"53","bodyParameters":"82","jsonBody":"50","body":"50","options":"83","infoMessage":"50"},[-1392,-208],["84"],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["85"],["86"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["87"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"88","location":"89"},["90"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{"parameters":"91"},{},["92"],{"name":"50","value":"50"},["93"],["94"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["95"],["96"],{"json":"97","pairedItem":"98"},{"json":"99","pairedItem":"100"},{"json":"101","pairedItem":"102"},{"json":"97","pairedItem":"103"},{"name":"50","value":"50"},{"model":"104","data":"105","object":"106","usage":"107"},{"item":0},{"headers":"108","params":"109","query":"110","body":"111","webhookUrl":"112","executionMode":"113"},{"item":0},{"headers":"114","params":"115","query":"116","body":"117","webhookUrl":"112","executionMode":"113","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["118"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},"http://localhost:5678/webhook-test/ever","test",{"host":"119","connection":"120","content-length":"121","sec-ch-ua-platform":"122","user-agent":"123","sec-ch-ua":"124","content-type":"125","sec-ch-ua-mobile":"126","accept":"127","sec-gpc":"128","accept-language":"129","origin":"130","sec-fetch-site":"131","sec-fetch-mode":"132","sec-fetch-dest":"133","referer":"134","accept-encoding":"135"},{},{},{"message":"136","user":"137"},{"embedding":"138","index":0,"object":"139"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7",[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"embedding"]
154	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"json","jsonBody":"={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}","options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764849476694,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","HTTP Request":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764849476679,"source":"34"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},"404 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Not found: Collection `candidatos` doesn't exist!\\\\\\"},\\\\\\"time\\\\\\":0.000056154}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"404","The resource you are requesting could not be found","NodeApiError: The resource you are requesting could not be found\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"53","jsonBody":"54","options":"55","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848532274,"executionIndex":2,"source":"63","hints":"64","executionTime":798,"executionStatus":"58","data":"65"},{"startTime":1764849476681,"executionIndex":3,"source":"66","hints":"67","executionTime":13,"executionStatus":"68","error":"69"},{"parameters":"70","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"71"},{"main":"72"},{"main":"66"},{"vector":"73","limit":5,"with_payload":true},{"accept":"74"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}",{},[],[],"success",{"main":"75"},["76"],[],{"main":"77"},["78"],["79"],{"main":"80"},["81"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764849476694,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"53","jsonBody":"54","options":"82","infoMessage":"51"},[-1392,-208],["83"],[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["84"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["85"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"86","location":"87"},["88"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{},["89"],["90"],["91"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["92"],{"json":"93","pairedItem":"94"},{"json":"95","pairedItem":"96"},{"json":"97","pairedItem":"98"},{"json":"93","pairedItem":"99"},{"model":"100","data":"101","object":"102","usage":"103"},{"item":0},{"headers":"104","params":"105","query":"106","body":"107","webhookUrl":"108","executionMode":"109"},{"item":0},{"headers":"110","params":"111","query":"112","body":"113","webhookUrl":"108","executionMode":"109","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["114"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"132","user":"133"},"http://localhost:5678/webhook-test/ever","test",{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"132","user":"133"},{"embedding":"73","index":0,"object":"134"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7","embedding"]
155	{"id":"e7jupm7IudExE7xe","name":"RAG - Sistema de Consultas (Corregido v2)","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"lastNode","responseCode":200,"responseData":"firstEntryJson","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();","notice":""},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"json","jsonBody":"={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}","options":{},"infoMessage":""},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"","value":""}]},"options":{},"infoMessage":""},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };","notice":""},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"oldVersionNotice":"","resource":"text","operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};","notice":""},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"resource":"database","operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"preBuiltAgentsCalloutHttpRequest":"","curlImport":"","method":"POST","url":"https://api.mammouth.ai/v1/embeddings","authentication":"none","provideSslCertificates":false,"sendQuery":false,"sendHeaders":true,"specifyHeaders":"keypair","headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"contentType":"json","specifyBody":"keypair","bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{},"infoMessage":""},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}],"connections":{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4","runNodeFilter":"5"},{"error":"6","runData":"7","pinData":"8","lastNodeExecuted":"4"},{"contextData":"9","nodeExecutionStack":"10","metadata":"11","waitingExecution":"12","waitingExecutionSource":"13","runtimeData":"14"},"Qdrant - Buscar Candidatos",["15","16","4","17"],{"level":"18","tags":"19","description":"20","timestamp":1764850844771,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"Webhook - Chat":"29","Extraer Query":"30","HTTP Request":"31","Qdrant - Buscar Candidatos":"32"},{},{},["33"],{},{},{},{"version":1,"establishedAt":1764850844686,"source":"34"},"Webhook - Chat","HTTP Request","Extraer Query","warning",{},"400 - \\"{\\\\\\"status\\\\\\":{\\\\\\"error\\\\\\":\\\\\\"Wrong input: Vectors are not configured in this collection\\\\\\"},\\\\\\"time\\\\\\":0.004573205}\\"",{"itemIndex":0,"request":"35"},"regular","NodeApiError",{"parameters":"36","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"39"},["20"],"400","Bad request - please check your parameters","NodeApiError: Bad request - please check your parameters\\n    at ExecuteContext.execute (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/HttpRequest/V3/HttpRequestV3.node.ts:858:16)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at WorkflowExecute.executeNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1074:8)\\n    at WorkflowExecute.runNode (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1255:11)\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:1691:27\\n    at /usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-core@file+packages+core_@opentelemetry+api@1.9.0_@opentelemetry+sdk-trace-base@1.30_08b575bec2313d5d8a4cc75358971443/node_modules/n8n-core/src/execution-engine/workflow-execute.ts:2307:11",["40"],["41"],["42"],["43"],{"node":"44","data":"45","source":"46"},"manual",{"body":"47","headers":"48","method":"49","uri":"50","gzip":true,"rejectUnauthorized":true,"followRedirect":true,"resolveWithFullResponse":true,"followAllRedirects":true,"timeout":300000,"encoding":null,"json":false,"useStream":true},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"53","jsonBody":"54","options":"55","infoMessage":"51"},"2001a88c-f095-4449-8664-7b8353481b4a","n8n-nodes-base.httpRequest",[-1392,-208],{"startTime":1764846750890,"executionIndex":0,"source":"56","hints":"57","executionTime":2,"executionStatus":"58","data":"59"},{"startTime":1764846758592,"executionIndex":1,"source":"60","hints":"61","executionTime":23,"executionStatus":"58","data":"62"},{"startTime":1764848532274,"executionIndex":2,"source":"63","hints":"64","executionTime":798,"executionStatus":"58","data":"65"},{"startTime":1764850844697,"executionIndex":3,"source":"66","hints":"67","executionTime":79,"executionStatus":"68","error":"69"},{"parameters":"70","id":"37","name":"4","type":"38","typeVersion":4.1,"position":"71"},{"main":"72"},{"main":"66"},{"vector":"73","limit":5,"with_payload":true},{"accept":"74"},"POST","http://qdrant:6333/collections/candidatos/points/search","","none","json","={{\\n  {\\n    vector: $json.data[0].embedding,\\n    limit: 5,\\n    with_payload: true\\n  }\\n}}",{},[],[],"success",{"main":"75"},["76"],[],{"main":"77"},["78"],["79"],{"main":"80"},["81"],[],"error",{"level":"18","tags":"19","description":"20","timestamp":1764850844771,"context":"21","functionality":"22","name":"23","node":"24","messages":"25","httpCode":"26","message":"27","stack":"28"},{"preBuiltAgentsCalloutHttpRequest":"51","curlImport":"51","method":"49","url":"50","authentication":"52","provideSslCertificates":false,"sendQuery":false,"sendHeaders":false,"sendBody":true,"contentType":"53","specifyBody":"53","jsonBody":"54","options":"82","infoMessage":"51"},[-1392,-208],["83"],[0.011469349265098572,-0.022770648822188377,0.0029828709084540606,0.04476827010512352,-0.023375624790787697,0.024299895390868187,-0.020266717299818993,-0.0022077446337789297,-0.021325426176190376,-0.02339242957532406,0.02710631489753723,-0.027929754927754402,-0.008217599242925644,0.011469349265098572,0.009419150650501251,-0.015964660793542862,-0.006369059439748526,0.007478183601051569,0.02761046215891838,-0.024703212082386017,0.012595277279615402,0.03313927724957466,-0.026215653866529465,-0.01278013177216053,-0.008612514473497868,-0.06315284222364426,0.013351498171687126,-0.040029287338256836,0.018065275624394417,-0.027627266943454742,0.08093243092298508,-0.041541729122400284,-0.009696431457996368,0.013830438256263733,-0.004281050059944391,0.014132926240563393,-0.003111008321866393,-0.01461186632514,0.04577656462788582,-0.019964229315519333,0.046852078288793564,-0.028484316542744637,-0.038584064692258835,0.02218247763812542,0.015200038440525532,-0.0007478183251805604,0.011284494772553444,-0.009856077842414379,-0.023661307990550995,-0.026702996343374252,-0.010461054742336273,0.07965525984764099,-0.002491327468305826,0.048935890197753906,-0.002186738420277834,0.011057628318667412,0.002245555631816387,0.018838301301002502,0.06644660234451294,0.0038231161888688803,-0.014384999871253967,0.0029912733007222414,0.009183881804347038,0.032450273633003235,-0.04695291072130203,-0.02952622063457966,-0.010906384326517582,0.026602167636156082,0.000946851447224617,0.00039307726547122,-0.025526653975248337,0.0004941693041473627,0.011334909126162529,-0.0063942670822143555,0.02811460942029953,-0.03278637304902077,-0.04244919493794441,0.02024991251528263,-0.03569362312555313,-0.010318213142454624,-0.053809311240911484,0.07326938956975937,-0.015973063185811043,0.0024934280663728714,0.0476251058280468,-0.07394158840179443,-0.09229254722595215,0.019157594069838524,-0.012838948518037796,-0.007759665604680777,-0.0480620339512825,0.007066463120281696,-0.030416881665587425,-0.018166104331612587,0.01828373782336712,0.0045121172443032265,-0.040634263306856155,-0.026938265189528465,0.03935709223151207,0.01625034399330616,-0.009637613780796528,-0.05938854068517685,0.027879340574145317,0.0451715886592865,-0.008415057323873043,0.018216518685221672,-0.0015281961532309651,-0.040130116045475006,-0.024568773806095123,0.01021738350391388,0.0081167696043849,-0.022753844037652016,-0.024165455251932144,0.01534288004040718,0.012368411757051945,-0.003098404733464122,0.007423567585647106,-0.0026362696662545204,0.0392562635242939,-0.06829514354467392,-0.02730797417461872,0.03784465044736862,0.012998594902455807,-0.044432174414396286,-0.006562315858900547,0.06563996523618698,-0.04722178727388382,-0.0101753706112504,-0.033475372940301895,-0.023056332021951675,0.05189355090260506,-0.0407014824450016,-0.005486802197992802,-0.03851684555411339,-0.010620701126754284,0.021325426176190376,-0.003636161796748638,0.00007640980766154826,-0.01789722591638565,0.010839165188372135,0.07212665677070618,0.017149407416582108,-0.011234080418944359,0.01606549136340618,-0.013729608617722988,-0.022232891991734505,-0.03955874964594841,-0.009293113835155964,0.053506821393966675,-0.014485829509794712,-0.007877299562096596,-0.014595061540603638,-0.014569854363799095,-0.022316915914416313,0.014595061540603638,-0.027442412450909615,-0.0011091238120570779,-0.007251317147165537,0.013662389479577541,0.021594304591417313,-0.007440372370183468,-0.021006133407354355,-0.006965633947402239,0.012225569225847721,-0.022333720698952675,0.04782676324248314,-0.041743386536836624,-0.022316915914416313,-0.05384292080998421,-0.01314143743366003,-0.024467945098876953,0.014847135171294212,-0.05609477683901787,0.002879940904676914,-0.010276200249791145,-0.06513582170009613,0.015452112071216106,-0.006671547889709473,-0.028887635096907616,0.003274856135249138,0.01910717971622944,0.044936321675777435,0.000011413879292376805,0.008364642038941383,-0.004793599713593721,0.023997407406568527,-0.025845946744084358,-0.0021825372241437435,0.005427984986454248,0.04745705798268318,0.08946932107210159,0.02260259911417961,0.0255434587597847,0.003875631606206298,0.02628287486732006,-0.05928771197795868,-0.014880744740366936,0.0081167696043849,-0.004713776521384716,-0.02024991251528263,0.04107119143009186,-0.02083808369934559,0.03697079420089722,-0.08294901996850967,0.010427444241940975,0.012317996472120285,0.0412728525698185,0.004232735838741064,0.029929539188742638,-0.007251317147165537,0.05199437960982323,-0.044297732412815094,0.06943787634372711,0.05236408859491348,-0.02729116939008236,-0.05243130773305893,0.010713128373026848,-0.005028868559747934,-0.006356455851346254,0.025929970666766167,-0.022669818252325058,0.02871958538889885,0.02710631489753723,0.0737399309873581,-0.0210733525454998,0.013922865502536297,0.008263813331723213,-0.022720234468579292,0.004524721298366785,-0.08173906803131104,-0.010771945118904114,0.026450922712683678,-0.03690357506275177,-0.03108907677233219,0.003287459956482053,-0.001510340953245759,-0.02922373265028,-0.008587307296693325,-0.04476827010512352,-0.023140355944633484,-0.028803609311580658,-0.021140573546290398,0.015922648832201958,0.026518143713474274,-0.014376597478985786,-0.008591508492827415,0.047692324966192245,-0.014964769594371319,0.020384352654218674,-0.003234944539144635,0.03325691074132919,0.00749078718945384,0.005978345405310392,-0.0220816470682621,-0.018569421023130417,0.03559279069304466,-0.008062154054641724,0.024165455251932144,-0.04221392422914505,-0.019846593961119652,-0.024888066574931145,0.0018989545060321689,-0.011410531587898731,0.015015183947980404,-0.020182693377137184,0.05048194155097008,0.044936321675777435,-0.002722394885495305,-0.019661741331219673,0.03814713656902313,-0.008898197673261166,-0.0032517495565116405,0.033895496279001236,0.0021184685174375772,-0.021896792575716972,0.02401421219110489,0.025224164128303528,0.01656963862478733,-0.03801269829273224,0.0372396744787693,0.02023310773074627,0.03097144328057766,0.02813141420483589,0.015006781555712223,-0.02779531478881836,-0.0030563923064619303,-0.03401312977075577,-0.03965957835316658,0.01380523107945919,0.006600127089768648,0.015031988732516766,-0.004060485400259495,0.015561343170702457,-0.017359469085931778,-0.028585147112607956,-0.019241617992520332,-0.027677681297063828,-0.04167616739869118,0.0045583308674395084,-0.0035164267756044865,0.12260860204696655,0.03418118134140968,0.00817978847771883,0.004734782502055168,-0.0012708710273727775,0.03791186958551407,0.01932564191520214,0.03801269829273224,0.015620160847902298,0.00764203118160367,0.020417962223291397,0.05905244126915932,0.02883722074329853,0.016418393701314926,-0.040835924446582794,-0.037777431309223175,0.010309809818863869,0.007994933985173702,0.018787885084748268,0.03928987309336662,0.009889687411487103,-0.03241666406393051,-0.026854241266846657,-0.05142301321029663,-0.00854109413921833,0.006923621520400047,0.05132218450307846,0.011108043603599072,0.006667346693575382,-0.023980602622032166,0.0043398672714829445,-0.028568342328071594,0.03740772232413292,0.050145842134952545,0.018989544361829758,0.04853257164359093,0.018149299547076225,0.02934136800467968,0.025308189913630486,0.029895929619669914,-0.06009434536099434,-0.014208548702299595,-0.05179272219538689,0.008763758465647697,-0.04631432145833969,-0.00027675580349750817,-0.008730148896574974,-0.017964445054531097,0.018855106085538864,0.01595625840127468,0.024585578590631485,0.013494339771568775,0.016830114647746086,0.00817558728158474,-0.003722286783158779,-0.009192284196615219,0.009839273057878017,-0.059556588530540466,0.007558006793260574,0.06903455406427383,-0.00401007104665041,-0.02290508709847927,0.01176343485713005,-0.015351282432675362,0.004650758113712072,0.015208440832793713,-0.005516210570931435,-0.006675749085843563,0.021123766899108887,0.0014525741571560502,-0.0230899415910244,0.037777431309223175,-0.024988897144794464,-0.02710631489753723,-0.02495528571307659,0.04752427712082863,0.01624194160103798,0.01542690396308899,0.008234404027462006,0.022653013467788696,-0.02843390218913555,-0.00008875091589288786,0.03349217772483826,-0.027627266943454742,0.023123551160097122,0.018149299547076225,0.006835395935922861,-0.013838840648531914,-0.041138410568237305,0.015443709678947926,0.006612730678170919,-0.010973604395985603,-0.008469672873616219,0.04436495527625084,-0.028265852481126785,-0.016712479293346405,0.00290094711817801,0.055859509855508804,0.006637938320636749,-0.005373368971049786,-0.01155337318778038,-0.017830006778240204,-0.0029807703103870153,0.002514434279873967,-0.019544105976819992,0.00712948152795434,-0.058749955147504807,-0.011360117234289646,0.014695891179144382,0.012074325233697891,0.052196040749549866,-0.06207732483744621,0.05663253739476204,0.03939070180058479,0.0020186894107609987,0.0006816490204073489,-0.016527626663446426,-0.008440264500677586,-0.034584496170282364,0.02799697406589985,-0.010595493949949741,0.04668403044342995,0.022350525483489037,-0.01994742453098297,0.003942851442843676,0.013259071856737137,0.03734050318598747,-0.036130551248788834,-0.008247007615864277,-0.0574391707777977,0.040130116045475006,0.034618109464645386,-0.039323482662439346,0.005747278220951557,-0.025593873113393784,-0.02218247763812542,-0.022737039253115654,-0.00305219111032784,0.033576205372810364,-0.005301948171108961,-0.029576634988188744,0.028383487835526466,-0.0386848971247673,-0.07790754735469818,-0.04601183533668518,-0.0013086821418255568,-0.011234080418944359,-0.003480716375634074,-0.010713128373026848,0.009755248203873634,-0.010788749903440475,0.012956582941114902,-0.0006443631136789918,0.018233323469758034,0.012242374941706657,-0.009805663488805294,0.04476827010512352,-0.014427012763917446,-0.003190831746906042,0.019997838884592056,0.03895377367734909,-0.008578904904425144,0.0077848732471466064,0.0023715924471616745,0.02853473089635372,-0.030820198357105255,-0.036769136786460876,0.0033042647410184145,-0.025493044406175613,0.002686684485524893,-0.04204587638378143,0.032769568264484406,0.005423783790320158,-0.023946991190314293,-0.00955358985811472,-0.0441632941365242,0.06446362286806107,0.0035584389697760344,-0.026131629943847656,-0.06459806114435196,0.009898089803755283,-0.05068359896540642,-0.029879124835133553,0.02014908380806446,-0.02115737833082676,0.03616416081786156,-0.0023295802529901266,-0.0028043189086019993,-0.08086521178483963,-0.0040373788215219975,-0.01861983723938465,-0.008730148896574974,0.026450922712683678,-0.024383919313549995,0.02125820703804493,-0.03495420515537262,0.030232027173042297,-0.040634263306856155,0.008738551288843155,-0.043692756444215775,0.027946559712290764,0.00166053487919271,-0.012973387725651264,0.012099532410502434,0.04752427712082863,-0.005419582594186068,0.015527733601629734,0.005402777343988419,0.03955874964594841,-0.02083808369934559,0.013376705348491669,0.06937065720558167,-0.010662713088095188,-0.018569421023130417,-0.037474941462278366,-0.014200146310031414,0.01072993315756321,0.02393018640577793,0.021695135161280632,-0.01277172937989235,0.01707378588616848,0.012586874887347221,0.052296869456768036,-0.0065371086820960045,0.0034429053775966167,-0.0032727555371820927,-0.009528381749987602,-0.023123551160097122,-0.022568989545106888,-0.0066505419090390205,0.01872066594660282,-0.015023586340248585,-0.0658080130815506,0.021896792575716972,-0.01799805462360382,-0.007553805597126484,-0.007410963997244835,-0.04221392422914505,-0.013763218186795712,-0.008511684834957123,0.018266933038830757,-0.004730581305921078,0.007263920735567808,-0.03187890723347664,0.00869653932750225,0.0018821496050804853,0.006877407897263765,-0.012528058141469955,0.02740880288183689,0.025929970666766167,-0.025711506605148315,-0.03764298930764198,-0.008406654931604862,0.006776578724384308,0.00341349677182734,0.0238125529140234,-0.02228330634534359,-0.03683635592460632,-0.0020480980165302753,-0.01848539710044861,-0.006961432751268148,0.0029513617046177387,0.013586767017841339,-0.0176787618547678,0.015174830332398415,0.01747710257768631,-0.0004595091741066426,-0.03157642111182213,0.029895929619669914,-0.04396163672208786,-0.028030583634972572,0.014023694209754467,-0.04732261598110199,0.02176235429942608,-0.004852416925132275,0.007734458427876234,0.021913599222898483,0.011175262741744518,0.019560910761356354,-0.018350958824157715,-0.0007940318319015205,-0.008612514473497868,-0.011889471672475338,0.026434117928147316,-0.03855045512318611,-0.004886026494204998,0.005461594555526972,0.040533434599637985,0.015720989555120468,0.004365074448287487,0.025845946744084358,-0.00237789424136281,-0.012662497349083424,-0.009906492196023464,-0.0235268697142601,-0.023325210437178612,-0.013822035863995552,0.012007106095552444,-0.004377678036689758,0.005327155347913504,-0.006864804308861494,-0.011805446818470955,0.01676289364695549,0.01656123623251915,0.011066030710935593,-0.029274147003889084,-0.005843906197696924,-0.006591724697500467,0.021930404007434845,-0.0011920980177819729,0.05149023234844208,0.01564536802470684,0.027257557958364487,-0.023560479283332825,-0.056800585240125656,0.05616199970245361,-0.015048793517053127,0.01037702988833189,0.023056332021951675,-0.004022674635052681,-0.037273284047842026,-0.012233972549438477,0.02455196902155876,0.022938698530197144,0.019376058131456375,0.014511036686599255,0.013124631717801094,0.008889795280992985,0.00664213951677084,-0.010914786718785763,0.005121295340359211,-0.03149239346385002,-0.012864155694842339,0.03045049123466015,-0.0027013886719942093,0.013116229325532913,0.01696455292403698,-0.04937281459569931,0.0016878427704796195,-0.03261832520365715,-0.00018446010653860867,0.045742955058813095,0.02083808369934559,0.0017235532868653536,0.038584064692258835,-0.008427660912275314,0.02534179948270321,0.019460082054138184,-0.05374209210276604,-0.03549196198582649,0.024199064821004868,-0.030500905588269234,-0.0038252167869359255,-0.005558222997933626,-0.004583538509905338,-0.027156729251146317,-0.008599910885095596,0.02577872760593891,-0.0019199606031179428,0.014174939133226871,-0.020619619637727737,-0.04970891401171684,0.035122256726026535,-0.032046958804130554,0.009797260165214539,0.016275553032755852,-0.006074973847717047,-0.0018275335896760225,0.028954854235053062,-0.008268014527857304,0.008196593262255192,0.010435846634209156,-0.0015922648599371314,0.021543890237808228,0.047289006412029266,-0.004503714852035046,-0.008620916865766048,-0.027980169281363487,-0.05461594834923744,-0.017964445054531097,0.01227598451077938,-0.0034050941467285156,-0.012502850964665413,-0.019997838884592056,0.013502742163836956,-0.01170461717993021,0.04365914687514305,0.0035752439871430397,0.004209629260003567,-0.001171091920696199,-0.03518947586417198,0.03549196198582649,0.0386848971247673,-0.0023589888587594032,0.03549196198582649,0.019577715545892715,-0.002514434279873967,0.01951049640774727,-0.006906816735863686,-0.005301948171108961,0.03354259207844734,-0.008305825293064117,0.009536784142255783,-0.012023910880088806,-0.06695074588060379,-0.027358388528227806,-0.0013370404485613108,0.04365914687514305,0.01688052900135517,0.024098236113786697,-0.019560910761356354,0.017813201993703842,-0.001432618242688477,0.03401312977075577,-0.004902831744402647,0.01119206752628088,-0.010553481057286263,0.009032637812197208,-0.03087061271071434,-0.007705049589276314,0.02883722074329853,0.04591100662946701,-0.012175154872238636,0.004377678036689758,-0.035424742847681046,-0.021728744730353355,0.0037159849889576435,-0.00544058857485652,-0.018888715654611588,0.023577284067869186,-0.012175154872238636,-0.02761046215891838,-0.013418718241155148,-0.017409883439540863,-0.015258855186402798,0.020989328622817993,-0.036231379956007004,0.020384352654218674,-0.016376381739974022,-0.000544058857485652,0.040029287338256836,-0.013578364625573158,0.005671656224876642,0.0009331975015811622,-0.014141328632831573,0.046045444905757904,-0.037138842046260834,0.004995258525013924,0.0003024883335456252,0.030786588788032532,-0.015620160847902298,0.015973063185811043,-0.002541742054745555,-0.007003444712609053,-0.01169621478766203,-0.01902315393090248,0.025072921067476273,-0.001657383982092142,-0.024400724098086357,0.023644503206014633,0.019779374822974205,0.017031772062182426,-0.009788857772946358,0.016788102686405182,0.021896792575716972,-0.013864047825336456,-0.0029492611065506935,-0.010091346688568592,0.023661307990550995,-0.016115905717015266,-0.002178336028009653,0.04745705798268318,0.00290094711817801,-0.03250068798661232,-0.028165023773908615,0.012998594902455807,-0.03273595869541168,-0.01666206493973732,-0.018838301301002502,-0.004747386090457439,0.009402344934642315,-0.011318104341626167,-0.024770433083176613,0.04957447573542595,-0.0003476515121292323,-0.003598350565880537,0.0412728525698185,0.004287351854145527,0.014401804655790329,-0.009444357827305794,0.015821820124983788,0.0067555722780525684,0.01981298439204693,-0.0005960490088909864,0.010108151473104954,0.027627266943454742,0.0003662944654934108,-0.06708518415689468,-0.011141653172671795,0.007717653177678585,0.004470105282962322,-0.001261418336071074,0.005881717428565025,-0.0011857962235808372,0.041642557829618454,0.006390065886080265,-0.015208440832793713,0.0009573545539751649,-0.030232027173042297,-0.01518323365598917,-0.046986520290374756,0.03697079420089722,-0.02658536285161972,0.005738875828683376,-0.0017550624907016754,0.018317347392439842,0.016914138570427895,-0.01789722591638565,-0.008499081246554852,0.038281578570604324,0.030904224142432213,-0.003999567590653896,0.01993061974644661,0.018989544361829758,0.04823008179664612,0.007591616827994585,-0.034786157310009,0.012511253356933594,0.018367763608694077,0.028601951897144318,0.03004717268049717,-0.029576634988188744,0.01430937834084034,-0.0038945372216403484,0.03465171903371811,0.016006672754883766,-0.029055682942271233,-0.0490703284740448,-0.051053307950496674,0.007898306474089622,0.015510928817093372,0.048196472227573395,-0.038079917430877686,-0.003522728569805622,-0.02666938677430153,-0.0326855443418026,-0.0002671717666089535,-0.00782688520848751,-0.01861983723938465,0.0066967555321753025,-0.020804474130272865,-0.029559830203652382,-0.016636857762932777,-0.030803393572568893,0.0022896684240549803,0.011721422895789146,-0.04601183533668518,0.004495312459766865,0.032853592187166214,-0.010914786718785763,-0.038886554539203644,0.01120046991854906,-0.010780347511172295,-0.0162335392087698,0.045843783766031265,-0.03325691074132919,0.029072487726807594,0.017863616347312927,-0.04097036272287369,-0.023678112775087357,0.018871910870075226,0.04873422905802727,-0.04836452007293701,0.0055414182133972645,-0.0038798328023403883,0.001328637939877808,-0.027072705328464508,0.04980974271893501,-0.035727232694625854,0.009091454558074474,0.03875211626291275,0.007280725985765457,0.0005624392069876194,-0.021443061530590057,-0.005465795751661062,-0.020401157438755035,-0.01818290911614895,0.011771837249398232,0.0015502526657655835,0.02268662489950657,0.006953030358999968,0.007427768781781197,-0.01380523107945919,-0.0029135507065802813,-0.009116661734879017,-0.009948505088686943,-0.00788150168955326,0.023173965513706207,0.00374539359472692,-0.010469457134604454,-0.014082511886954308,-0.01830054260790348,-0.021947208791971207,-0.02577872760593891,-0.02616523951292038,-0.012477642856538296,0.02004825323820114,-0.0011049226159229875,-0.006763975135982037,-0.005932132247835398,0.01675449125468731,-0.005755680613219738,0.0505155511200428,-0.01962813176214695,0.07367271184921265,0.0203507412225008,0.02085488848388195,-0.056800585240125656,-0.0010151213500648737,0.022048037499189377,-0.002514434279873967,-0.01964493654668331,-0.03036646731197834,-0.012956582941114902,-0.013267474249005318,0.007427768781781197,0.014300975948572159,0.015662172809243202,0.014889147132635117,-0.05653170496225357,-0.02391338162124157,-0.01665366254746914,-0.025224164128303528,-0.01614111289381981,0.01727544330060482,-0.0004828785022255033,-0.000801909132860601,0.023980602622032166,0.0015481520676985383,-0.01124248281121254,-0.02461918815970421,-0.029374977573752403,0.012477642856538296,0.005243130959570408,0.032954420894384384,-0.04537324979901314,-0.020871693268418312,0.011536568403244019,-0.006747169885784388,0.02851792611181736,0.020720450207591057,-0.020770864561200142,0.012805338948965073,-0.008524289354681969,-0.009108259342610836,0.002040745923295617,0.007016048766672611,-0.012830546125769615,0.020720450207591057,-0.023459650576114655,0.007251317147165537,0.03159322589635849,-0.010805554687976837,-0.006180004216730595,-0.016603248193860054,0.03855045512318611,-0.018552616238594055,-0.005990949459373951,0.009259503334760666,0.003947052638977766,-0.02944219671189785,-0.01616632007062435,-0.007070664316415787,-0.0039029396139085293,-0.01615791767835617,-0.023543674498796463,0.05031388998031616,-0.004415489267557859,-0.01242722850292921,-0.009293113835155964,-0.007394158747047186,0.05713668465614319,0.014645475894212723,0.0026950868777930737,-0.046852078288793564,-0.03253429755568504,0.02829946205019951,0.032651934772729874,0.0026026598643511534,-0.029627051204442978,-0.002852632896974683,-0.0184013731777668,0.018687056377530098,-0.01160378847271204,0.026518143713474274,-0.018132494762539864,-0.024652797728776932,0.013006998226046562,0.01375481579452753,0.051154136657714844,-0.012670899741351604,0.011687812395393848,0.03441644832491875,-0.0019861299078911543,-0.012469240464270115,-0.021594304591417313,0.0007798526785336435,-0.031240321695804596,0.009856077842414379,-0.012922973372042179,-0.011981898918747902,0.004646556917577982,-0.03861767426133156,-0.0672532394528389,0.009814065881073475,-0.004176019225269556,0.02063642628490925,-0.009646016173064709,-0.07192499935626984,-0.00017750183178577572,0.028484316542744637,0.016006672754883766,0.019443277269601822,0.023846162483096123,-0.0003505398635752499,-0.04097036272287369,0.02564428746700287,-0.008906600996851921,0.014998379163444042,0.01828373782336712,0.00493224011734128,0.04231475666165352,0.0019346649060025811,0.012317996472120285,0.04792759567499161,-0.02616523951292038,-0.036332208663225174,-0.03626498952507973,0.0088393809273839,-0.005180112551897764,-0.04275168105959892,-0.010116553865373135,-0.013990084640681744,0.052397698163986206,0.020619619637727737,-0.003978561609983444,-0.0009851877111941576,-0.001916809706017375,-0.014393402263522148,0.029895929619669914,0.02290508709847927,-0.009898089803755283,-0.02493848092854023,-0.028501121327280998,-0.006709359120577574,-0.0035815457813441753,0.008360440842807293,-0.035424742847681046,0.021493475884199142,0.02157749980688095,0.014174939133226871,0.007721854839473963,-0.018787885084748268,-0.006927822716534138,-0.003276956733316183,0.011855862103402615,-0.031223516911268234,0.02248496562242508,-0.03670191764831543,0.03740772232413292,0.0027013886719942093,-0.029795099049806595,0.002590056275948882,0.021745549514889717,-0.013695999048650265,-0.004684367682784796,-0.013124631717801094,-0.02882041409611702,0.03117310255765915,-0.02976148948073387,-0.007860494777560234,-0.01779639534652233,0.014435415156185627,-0.018149299547076225,0.007537000812590122,0.011234080418944359,0.019661741331219673,-0.00034581345971673727,0.02423267625272274,-0.02043476700782776,0.023056332021951675,-0.023140355944633484,0.01125088520348072,0.02339242957532406,-0.007944519631564617,0.0012792735360562801,-0.00230017164722085,-0.005188514944165945,0.03935709223151207,0.0201322790235281,0.009772052988409996,0.021510280668735504,-0.007621025200933218,-0.03196293115615845,0.003999567590653896,0.022266501560807228,-0.013301083818078041,-0.009612406603991985,-0.006352254655212164,0.0043230620212852955,-0.023123551160097122,0.02524097077548504,-0.005159106571227312,-0.012040715664625168,0.006448883097618818,-0.013536352664232254,-0.024787237867712975,-0.022871477529406548,-0.026635777205228806,-0.01175503246486187,0.023846162483096123,-0.010645908303558826,-0.00970483385026455,-0.0045961420983076096,-0.0007073815213516355,-0.00595733942463994,-0.028366683050990105,0.026434117928147316,-0.03181168809533119,0.02596358023583889,0.023661307990550995,-0.033794667571783066,0.043289437890052795,-0.004068888258188963,0.01922481320798397,-0.01981298439204693,-0.0012803238350898027,-0.03209737315773964,-0.006906816735863686,0.032248616218566895,0.027139924466609955,0.008188190869987011,-0.014872342348098755,-0.0035500365775078535,-0.02270342968404293,0.020485181361436844,-0.009234296157956123,0.13692638278007507,-0.026820631697773933,0.0002397325006313622,0.00936033297330141,-0.023678112775087357,-0.016628455370664597,-0.00169939617626369,0.014284171164035797,-0.004827209282666445,-0.014132926240563393,-0.008255410008132458,-0.008915003389120102,-0.005301948171108961,0.007364750374108553,-0.01900634914636612,-0.023795748129487038,0.011133250780403614,-0.015023586340248585,0.02924053743481636,0.014342987909913063,0.0011574379168450832,-0.040432605892419815,-0.009167077019810677,-0.0007047557737678289,0.030215222388505936,-0.022938698530197144,0.001888451399281621,-0.0019934820011258125,0.014721098355948925,0.0018874011002480984,0.019476886838674545,-0.005696863401681185,-0.004192824009805918,0.003041688119992614,0.0002948736073449254,0.02230011112987995,0.00028515825397334993,-0.0264845322817564,-0.00013207606389187276,-0.04201226681470871,-0.00818398967385292,0.025089725852012634,-0.018787885084748268,-0.0023400832433253527,0.011444141156971455,-0.002688785083591938,0.0013244367437437177,-0.013326290994882584,-0.01769556663930416,-0.00026086991420015693,-0.04833091050386429,-0.007373152766376734,-0.021728744730353355,-0.0010613348567858338,-0.012830546125769615,-0.012746522203087807,-0.016115905717015266,0.029156513512134552,0.04970891401171684,0.007772269193083048,0.0122675821185112,-0.015158025547862053,-0.01257007010281086,-0.02813141420483589,-0.026602167636156082,-0.015687379986047745,-0.03673552721738815,0.019695350900292397,0.01426736544817686,0.011486154049634933,-0.009805663488805294,-0.01257847249507904,-0.013015400618314743,-0.03814713656902313,0.003808412002399564,0.0047179777175188065,0.011007213965058327,-0.019594520330429077,0.00475158728659153,0.047692324966192245,0.0034387039486318827,-0.00862931925803423,0.028685975819826126,0.002663577673956752,-0.0006874257232993841,-0.07595817744731903,-0.024266285821795464,-0.01872066594660282,-0.014863939955830574,-0.0431549996137619,0.0077386596240103245,-0.0014158133417367935,0.03811352699995041,0.04621349275112152,-0.0002654650015756488,0.023594088852405548,-0.011460945941507816,-0.0017235532868653536,0.021510280668735504,0.02594677545130253,0.01007454190403223,-0.03549196198582649,-0.01512441597878933,-0.023862967267632484,-0.005545619409531355,0.00331056653521955,-0.009293113835155964,0.010402237065136433,-0.006121187470853329,-0.006184205878525972,-0.011360117234289646,0.02656855806708336,0.03656747564673424,0.0014095115475356579,0.004318860825151205,0.016628455370664597,0.07400880753993988,0.037878260016441345,0.008704941719770432,-0.006932023912668228,0.0010744637111201882,-0.002713992493227124,0.020787669345736504,-0.034920595586299896,-0.016846919432282448,0.01861983723938465,-0.013309486210346222,0.028484316542744637,-0.0049070329405367374,-0.008864588104188442,0.001595415873453021,-0.015720989555120468,0.005331356544047594,-0.012645692564547062,0.013578364625573158,0.052801016718149185,0.018787885084748268,-0.01002412661910057,0.016729284077882767,-0.006738767493516207,-0.002137374132871628,0.00781428162008524,0.0058733150362968445,0.00029014720348641276,0.004457501694560051,0.0037264879792928696,0.0034429053775966167,-0.009940102696418762,0.008247007615864277,0.0025039310567080975,-0.03962596878409386,0.008856185711920261,0.0020785569213330746,-0.017325859516859055,-0.041743386536836624,-0.023946991190314293,0.01697295531630516,0.022921891883015633,0.0022602600511163473,0.004709575325250626,-0.0035059235524386168,-0.015309270471334457,-0.007024451158940792,0.010082944296300411,0.019039958715438843,0.006805987097322941,-0.01169621478766203,0.0070286523550748825,0.001254066126421094,-0.00646568788215518,-0.01819971390068531,-0.016115905717015266,0.007272323593497276,0.00966282095760107,-0.01715780980885029,-0.006566517520695925,0.007284927181899548,0.01809888519346714,-0.004129805602133274,0.002606861060485244,-0.014553049579262733,-0.018989544361829758,0.006705157924443483,0.02618204429745674,-0.003965958021581173,0.04167616739869118,0.008755356073379517,-0.01900634914636612,-0.012603679671883583,0.006919420324265957,0.006297638639807701,0.0050876853056252,-0.009385540150105953,-0.01576300337910652,-0.009444357827305794,0.03014800325036049,-0.01932564191520214,-0.07017728686332703,0.007898306474089622,0.008856185711920261,-0.010931591503322124,0.02085488848388195,-0.013401913456618786,0.008713344112038612,0.06963953375816345,-0.00043167604599148035,0.0045121172443032265,0.013401913456618786,0.026938265189528465,0.04029816761612892,0.0025501446798443794,-0.0027728097047656775,0.01952730119228363,-0.0191239845007658,-0.007994933985173702,0.024770433083176613,0.009125064127147198,0.031929321587085724,-0.0105366762727499,0.005562424194067717,0.008196593262255192,-0.014300975948572159,0.01676289364695549,-0.0262660700827837,-0.04611266404390335,-0.0006107533117756248,-0.013813633471727371,0.025072921067476273,-0.014359792694449425,-0.005709466990083456,-0.012889363802969456,-0.01635117456316948,0.002879940904676914,-0.024888066574931145,0.02063642628490925,-0.006432077847421169,-0.022148866206407547,-0.03197973594069481,-0.007049658335745335,0.04234836623072624,0.012301191687583923,-0.006658944301307201,-0.03135795518755913,-0.02935817278921604,-0.01236000843346119,-0.016720881685614586,0.02073725499212742,-0.006524505093693733,-0.019460082054138184,-0.001738257589749992,0.046381544321775436,0.028265852481126785,-0.00951157696545124,-0.04678485915064812,-0.028988463804125786,0.024182260036468506,-0.028652366250753403,-0.02073725499212742,0.0020081864204257727,0.00044611774501390755,-0.00007365275814663619,-0.008898197673261166,0.010360225103795528,-0.032265421003103256,-0.0013380907475948334,0.02206484228372574,0.007621025200933218,-0.0010849668178707361,0.004470105282962322,-0.001126979012042284,0.020569205284118652,-0.0006522404146380723,0.006516102701425552,0.009293113835155964,-0.0068858107551932335,0.0031803285237401724,0.022316915914416313,0.017149407416582108,-0.010839165188372135,-0.015863832086324692,-0.0008890845929272473,-0.00406678719446063,-0.006293437443673611,-0.0274928268045187,0.0024472144432365894,0.017141005024313927,0.03414757177233696,0.02105654776096344,0.001881099189631641,0.014695891179144382,0.007087469566613436,-0.001183695625513792,-0.031929321587085724,-0.00011061042459914461,0.006083376239985228,0.03559279069304466,0.005138100124895573,-0.02177915908396244,0.006654743105173111,0.023325210437178612,0.00028647115686908364,-0.0018002255819737911,0.00863772165030241,-0.03518947586417198,0.007423567585647106,0.034298814833164215,-0.02871958538889885,0.044196903705596924,0.023459650576114655,-0.0034155973698943853,0.033777862787246704,0.001543950755149126,-0.004738983698189259,-0.018031664192676544,-0.007852092385292053,0.03784465044736862,-0.011477751657366753,0.013679194264113903,-0.001199450227431953,0.044533003121614456,0.026148434728384018,-0.016191527247428894,-0.025190554559230804,-0.033979520201683044,0.03161003068089485,0.03186210244894028,0.025728311389684677,0.03996206820011139,0.051456622779369354,-0.017426688224077225,0.007188298739492893,-0.02495528571307659,0.05001140385866165,-0.025896361097693443,-0.02514014020562172,-0.013880852609872818,-0.048498962074518204,-0.00904104020446539,-0.025089725852012634,-0.01169621478766203,-0.016183124855160713,0.03335773944854736,0.003598350565880537,0.018636642023921013,-0.0032517495565116405,0.03381147235631943,0.005852308589965105,-0.003153020516037941,-0.0027749103028327227,0.05774166062474251,-0.026820631697773933,-0.009410747326910496,-0.03851684555411339,0.017426688224077225,0.02475362829864025,-0.02258579432964325,-0.003982762806117535,-0.017325859516859055,0.0019021054031327367,-0.011410531587898731,0.008200794458389282,-0.033794667571783066,-0.010494664311408997,0.012032313272356987,-0.024787237867712975,-0.0063186450861394405,0.01518323365598917,-0.007759665604680777,-0.04204587638378143,-0.014368195086717606,0.009965309873223305,-0.03989484906196594,0.022737039253115654,-0.034718938171863556,0.004470105282962322,-0.006528706289827824,-0.00024590303655713797,0.014805123209953308,-0.03186210244894028,-0.031946126371622086,0.009410747326910496,-0.04147450998425484,0.008499081246554852,0.02371172420680523,0.023577284067869186,0.017846811562776566,-0.0027160930912941694,0.024400724098086357,0.018149299547076225],"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",["84"],{"previousNode":"15","previousNodeOutput":0,"previousNodeRun":0},["85"],{"previousNode":"17","previousNodeOutput":0,"previousNodeRun":0},{"message":"86","location":"87"},["88"],{"previousNode":"16","previousNodeOutput":0,"previousNodeRun":0},{},["89"],["90"],["91"],"To split the contents of ‘data’ into separate items for easier processing, add a ‘Split Out’ node after this one","outputPane",["92"],{"json":"93","pairedItem":"94"},{"json":"95","pairedItem":"96"},{"json":"97","pairedItem":"98"},{"json":"93","pairedItem":"99"},{"model":"100","data":"101","object":"102","usage":"103"},{"item":0},{"headers":"104","params":"105","query":"106","body":"107","webhookUrl":"108","executionMode":"109"},{"item":0},{"headers":"110","params":"111","query":"112","body":"113","webhookUrl":"108","executionMode":"109","myNewField":1},{"item":0},{"item":0},"text-embedding-3-small",["114"],"list",{"completion_tokens":0,"prompt_tokens":2,"total_tokens":2,"completion_tokens_details":null,"prompt_tokens_details":null},{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"132","user":"133"},"http://localhost:5678/webhook-test/ever","test",{"host":"115","connection":"116","content-length":"117","sec-ch-ua-platform":"118","user-agent":"119","sec-ch-ua":"120","content-type":"121","sec-ch-ua-mobile":"122","accept":"123","sec-gpc":"124","accept-language":"125","origin":"126","sec-fetch-site":"127","sec-fetch-mode":"128","sec-fetch-dest":"129","referer":"130","accept-encoding":"131"},{},{},{"message":"132","user":"133"},{"embedding":"73","index":0,"object":"134"},"localhost:5678","keep-alive","263","\\"Windows\\"","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36","\\"Chromium\\";v=\\"142\\", \\"Brave\\";v=\\"142\\", \\"Not_A Brand\\";v=\\"99\\"","multipart/form-data; boundary=----WebKitFormBoundary1961SypDH3ijQn7D","?0","*/*","1","es-ES,es;q=0.6","http://localhost:5050","same-site","cors","empty","http://localhost:5050/","gzip, deflate, br, zstd",",AO","session_1764846651458_012qvnrh7","embedding"]
162	{"id":"aGurSLzad9QHqXSa","name":"Sistema_Consultas","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764874239602,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764874239603,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764874239629,"executionTime":1080,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764874239605,"executionIndex":1,"source":"32","hints":"33","executionTime":1106,"executionStatus":"26","data":"34"},{"startTime":1764874240712,"executionIndex":3,"source":"35","hints":"36","executionTime":3,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":30,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","user-agent":"80","accept":"81","accept-language":"82","accept-encoding":"83","referer":"84","content-type":"85","content-length":"86","origin":"87","connection":"88","priority":"89"},{},{},{"message":"90","user":"91"},"http://10.10.0.100:5678/webhook-test/ever","test",{"generations":"92"},{"completionTokens":62,"promptTokens":35,"totalTokens":97},["93"],{"openai_api_key":"94","model":"95","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"96","model_kwargs":"97"},"{\\n  \\"response\\": \\"La ISO 9001 es una norma internacional que establece los requisitos para un sistema de gestión de la calidad en una organización. Su objetivo principal es garantizar que la organización pueda cumplir con las expectativas y necesidades de sus clientes, mejorando continuamente sus procesos y productos o servicios.\\"\\n}","10.10.0.100:5678","Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0","*/*","es-AR,es;q=0.8,en-US;q=0.5,en;q=0.3","gzip, deflate","http://10.10.0.100:5050/","multipart/form-data; boundary=----geckoformboundary3a43141cc4f5f217880fb6b62c31636c","323","http://10.10.0.100:5050","keep-alive","u=0","que es la iso 9001","session_1764874127689_p0hebhhh9",["98"],"Human: json\\nque es la iso 9001 \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"99","id":"100"},"gpt-4.1-nano",{"baseURL":"101","fetchOptions":"102","defaultHeaders":"103"},{"response_format":"104"},["105"],"secret",["106"],"https://api.mammouth.ai/v1",{},{"Authorization":"107"},{"type":"108"},{"text":"78","generationInfo":"109"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"110"},"stop"]
156	{"id":"zZvLu1SxlyGtLzaY","name":"cv_format","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"62b38b22-8248-449b-832a-cbc043148bb3","name":"Webhook","webhookId":"9bda02e7-0323-4a10-8638-0b01ee647967"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","lastNodeExecuted":"4","error":"6","pinData":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Webhook",{"Webhook":"14"},{"message":"15","stack":"16"},{},{},["17"],{},{},{},{"version":1,"establishedAt":1764852930482,"source":"18"},["19"],"No Respond to Webhook node found in the workflow","WorkflowConfigurationError: No Respond to Webhook node found in the workflow\\n    at checkResponseModeConfiguration (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Webhook/utils.ts:159:9)\\n    at Webhook.webhook (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Webhook/Webhook.node.ts:212:34)\\n    at WebhookService.runWebhook (/usr/local/lib/node_modules/n8n/src/webhooks/webhook.service.ts:385:21)\\n    at Object.executeWebhook (/usr/local/lib/node_modules/n8n/src/webhooks/webhook-helpers.ts:458:60)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at /usr/local/lib/node_modules/n8n/src/webhooks/test-webhooks.ts:126:25",{"node":"20","data":"21","source":null},"manual",{"startTime":1764852930484,"executionIndex":0,"source":"22","hints":"23","executionTime":1,"executionStatus":"24","error":"25"},{"parameters":"26","type":"27","typeVersion":2.1,"position":"28","id":"29","name":"4","webhookId":"30"},{"main":"31"},[],[],"error",{"message":"15","stack":"16"},{"multipleMethods":false,"httpMethod":"32","path":"33","authentication":"34","responseMode":"35","webhookNotice":"36","options":"37"},"n8n-nodes-base.webhook",[0,0],"62b38b22-8248-449b-832a-cbc043148bb3","9bda02e7-0323-4a10-8638-0b01ee647967",["38"],"POST","ever","none","responseNode","",{"allowedOrigins":"39"},["40"],"*",{"json":"41","pairedItem":"42"},{},{"item":0}]
157	{"id":"zZvLu1SxlyGtLzaY","name":"cv_format","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"62b38b22-8248-449b-832a-cbc043148bb3","name":"Webhook","webhookId":"9bda02e7-0323-4a10-8638-0b01ee647967"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","lastNodeExecuted":"4","error":"6","pinData":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Webhook",{"Webhook":"14"},{"message":"15","stack":"16"},{},{},["17"],{},{},{},{"version":1,"establishedAt":1764852976623,"source":"18"},["19"],"No Respond to Webhook node found in the workflow","WorkflowConfigurationError: No Respond to Webhook node found in the workflow\\n    at checkResponseModeConfiguration (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Webhook/utils.ts:159:9)\\n    at Webhook.webhook (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Webhook/Webhook.node.ts:212:34)\\n    at WebhookService.runWebhook (/usr/local/lib/node_modules/n8n/src/webhooks/webhook.service.ts:385:21)\\n    at Object.executeWebhook (/usr/local/lib/node_modules/n8n/src/webhooks/webhook-helpers.ts:458:60)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at /usr/local/lib/node_modules/n8n/src/webhooks/test-webhooks.ts:126:25",{"node":"20","data":"21","source":null},"manual",{"startTime":1764852976624,"executionIndex":0,"source":"22","hints":"23","executionTime":1,"executionStatus":"24","error":"25"},{"parameters":"26","type":"27","typeVersion":2.1,"position":"28","id":"29","name":"4","webhookId":"30"},{"main":"31"},[],[],"error",{"message":"15","stack":"16"},{"multipleMethods":false,"httpMethod":"32","path":"33","authentication":"34","responseMode":"35","webhookNotice":"36","options":"37"},"n8n-nodes-base.webhook",[0,0],"62b38b22-8248-449b-832a-cbc043148bb3","9bda02e7-0323-4a10-8638-0b01ee647967",["38"],"POST","ever","none","responseNode","",{"allowedOrigins":"39"},["40"],"*",{"json":"41","pairedItem":"42"},{},{"item":0}]
158	{"id":"zZvLu1SxlyGtLzaY","name":"cv_format","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"62b38b22-8248-449b-832a-cbc043148bb3","name":"Webhook","webhookId":"9bda02e7-0323-4a10-8638-0b01ee647967"}],"connections":{},"settings":{"executionOrder":"v1"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","lastNodeExecuted":"4","error":"6","pinData":"7"},{"contextData":"8","nodeExecutionStack":"9","metadata":"10","waitingExecution":"11","waitingExecutionSource":"12","runtimeData":"13"},"Webhook",{"Webhook":"14"},{"message":"15","stack":"16"},{},{},["17"],{},{},{},{"version":1,"establishedAt":1764852988204,"source":"18"},["19"],"No Respond to Webhook node found in the workflow","WorkflowConfigurationError: No Respond to Webhook node found in the workflow\\n    at checkResponseModeConfiguration (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Webhook/utils.ts:159:9)\\n    at Webhook.webhook (/usr/local/lib/node_modules/n8n/node_modules/.pnpm/n8n-nodes-base@file+packages+nodes-base_@aws-sdk+credential-providers@3.808.0_asn1.js@5_8da18263ca0574b0db58d4fefd8173ce/node_modules/n8n-nodes-base/nodes/Webhook/Webhook.node.ts:212:34)\\n    at WebhookService.runWebhook (/usr/local/lib/node_modules/n8n/src/webhooks/webhook.service.ts:385:21)\\n    at Object.executeWebhook (/usr/local/lib/node_modules/n8n/src/webhooks/webhook-helpers.ts:458:60)\\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at /usr/local/lib/node_modules/n8n/src/webhooks/test-webhooks.ts:126:25",{"node":"20","data":"21","source":null},"manual",{"startTime":1764852988207,"executionIndex":0,"source":"22","hints":"23","executionTime":3,"executionStatus":"24","error":"25"},{"parameters":"26","type":"27","typeVersion":2.1,"position":"28","id":"29","name":"4","webhookId":"30"},{"main":"31"},[],[],"error",{"message":"15","stack":"16"},{"multipleMethods":false,"httpMethod":"32","path":"33","authentication":"34","responseMode":"35","webhookNotice":"36","options":"37"},"n8n-nodes-base.webhook",[0,0],"62b38b22-8248-449b-832a-cbc043148bb3","9bda02e7-0323-4a10-8638-0b01ee647967",["38"],"POST","ever","none","responseNode","",{"allowedOrigins":"39"},["40"],"*",{"json":"41","pairedItem":"42"},{},{"item":0}]
159	{"id":"aGurSLzad9QHqXSa","name":"Sistema_Consultas","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{"destinationNode":"4"},{"runData":"5","pinData":"6","lastNodeExecuted":"4"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},"Webhook",{"Webhook":"13"},{},{},[],{},{},{},{"version":1,"establishedAt":1764874173154,"source":"14"},["15"],"manual",{"startTime":1764874173163,"executionIndex":0,"source":"16","hints":"17","executionTime":3,"executionStatus":"18","data":"19"},[],[],"success",{"main":"20"},["21"],["22"],{"json":"23","pairedItem":"24"},{"headers":"25","params":"26","query":"27","body":"28","webhookUrl":"29","executionMode":"30"},{"item":0},{"host":"31","user-agent":"32","accept":"33","accept-language":"34","accept-encoding":"35","referer":"36","content-type":"37","content-length":"38","origin":"39","connection":"40","priority":"41"},{},{},{"message":"42","user":"43"},"http://10.10.0.100:5678/webhook-test/ever","test","10.10.0.100:5678","Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0","*/*","es-AR,es;q=0.8,en-US;q=0.5,en;q=0.3","gzip, deflate","http://10.10.0.100:5050/","multipart/form-data; boundary=----geckoformboundary7f06a99f6e621ea514cb003a0517465d","309","http://10.10.0.100:5050","keep-alive","u=0","OSPA","session_1764874127689_p0hebhhh9"]
160	{"id":"aGurSLzad9QHqXSa","name":"Sistema_Consultas","active":false,"nodes":[{"parameters":{"multipleMethods":false,"httpMethod":"POST","path":"ever","authentication":"none","responseMode":"responseNode","webhookNotice":"","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"aiAgentStarterCallout":"","promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"notice":"","needsFallback":false,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"notice":"","model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"enableResponseOutput":false,"generalNotice":"","respondWith":"json","webhookNotice":"","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"mode":"runOnceForAllItems","language":"javaScript","jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n","notice":""},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}],"connections":{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"},"staticData":{},"pinData":{}}	[{"startData":"1","resultData":"2","executionData":"3"},{},{"runData":"4","pinData":"5","lastNodeExecuted":"6"},{"contextData":"7","nodeExecutionStack":"8","metadata":"9","waitingExecution":"10","waitingExecutionSource":"11","runtimeData":"12"},{"Webhook":"13","OpenAI Chat Model":"14","AI Agent":"15","Respond to Webhook":"16"},{},"Respond to Webhook",{},[],{"OpenAI Chat Model":"17"},{},{},{"version":1,"establishedAt":1764874189502,"source":"18"},["19"],["20"],["21"],["22"],["23"],"manual",{"startTime":1764874189503,"executionIndex":0,"source":"24","hints":"25","executionTime":1,"executionStatus":"26","data":"27"},{"startTime":1764874191303,"executionTime":1759,"executionIndex":2,"executionStatus":"26","source":"28","data":"29","inputOverride":"30","metadata":"31"},{"startTime":1764874189506,"executionIndex":1,"source":"32","hints":"33","executionTime":3561,"executionStatus":"26","data":"34"},{"startTime":1764874193069,"executionIndex":3,"source":"35","hints":"36","executionTime":22,"executionStatus":"26","data":"37"},{"subRun":"38"},[],[],"success",{"main":"39"},["40"],{"ai_languageModel":"41"},{"ai_languageModel":"42"},{"subRun":"38"},["43"],[],{"main":"44"},["45"],[],{"main":"46"},["47"],["48"],{"previousNode":"49","previousNodeRun":0},["50"],["51"],{"previousNode":"52"},["53"],{"previousNode":"49"},["54"],{"node":"55","runIndex":0},["56"],"AI Agent",["57"],["58"],"Webhook",["59"],["60"],"OpenAI Chat Model",{"json":"61","pairedItem":"62"},{"json":"63"},{"json":"64"},{"json":"65","pairedItem":"66"},{"json":"65","pairedItem":"67"},{"headers":"68","params":"69","query":"70","body":"71","webhookUrl":"72","executionMode":"73"},{"item":0},{"response":"74","tokenUsage":"75"},{"messages":"76","estimatedTokens":27,"options":"77"},{"output":"78"},{"item":0},{"item":0},{"host":"79","user-agent":"80","accept":"81","accept-language":"82","accept-encoding":"83","referer":"84","content-type":"85","content-length":"86","origin":"87","connection":"88","priority":"89"},{},{},{"message":"90","user":"91"},"http://10.10.0.100:5678/webhook-test/ever","test",{"generations":"92"},{"completionTokens":13,"promptTokens":32,"totalTokens":45},["93"],{"openai_api_key":"94","model":"95","temperature":0.4,"top_p":0.3,"timeout":60000,"max_retries":2,"configuration":"96","model_kwargs":"97"},"{\\n  \\"response\\": \\"ESTAS AHI\\"\\n}","10.10.0.100:5678","Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0","*/*","es-AR,es;q=0.8,en-US;q=0.5,en;q=0.3","gzip, deflate","http://10.10.0.100:5050/","multipart/form-data; boundary=----geckoformboundary170f61908452912590827b2b1149876a","314","http://10.10.0.100:5050","keep-alive","u=0","ESTAS AHI","session_1764874127689_p0hebhhh9",["98"],"Human: json\\nESTAS AHI \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n",{"lc":1,"type":"99","id":"100"},"gpt-4.1-nano",{"baseURL":"101","fetchOptions":"102","defaultHeaders":"103"},{"response_format":"104"},["105"],"secret",["106"],"https://api.mammouth.ai/v1",{},{"Authorization":"107"},{"type":"108"},{"text":"78","generationInfo":"109"},"OPENAI_API_KEY","Bearer sk-cgOP97ddcHyM5alqeV7ieA","json_object",{"finish_reason":"110"},"stop"]
\.


--
-- Data for Name: execution_entity; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.execution_entity (id, finished, mode, "retryOf", "retrySuccessId", "startedAt", "stoppedAt", "waitTill", status, "workflowId", "deletedAt", "createdAt") FROM stdin;
1	t	manual	\N	\N	2025-12-02 14:38:57.965+00	2025-12-02 14:38:58.003+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 14:38:57.91+00
20	f	manual	\N	\N	2025-12-02 18:42:27.85+00	2025-12-02 18:42:27.864+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:42:27.839+00
39	t	manual	\N	\N	2025-12-02 19:16:29.355+00	2025-12-02 19:16:32.175+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:16:29.34+00
61	t	manual	\N	\N	2025-12-03 10:34:09.502+00	2025-12-03 10:34:11.38+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 10:34:09.464+00
2	t	manual	\N	\N	2025-12-02 14:45:44.955+00	2025-12-02 14:45:44.967+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 14:45:44.933+00
21	f	manual	\N	\N	2025-12-02 18:43:20.484+00	2025-12-02 18:43:20.498+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:43:20.474+00
3	t	manual	\N	\N	2025-12-02 14:46:58.329+00	2025-12-02 14:46:58.336+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 14:46:58.308+00
40	t	manual	\N	\N	2025-12-02 19:17:28.031+00	2025-12-02 19:17:31.191+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:17:28.009+00
22	t	manual	\N	\N	2025-12-02 18:43:37.682+00	2025-12-02 18:43:40.562+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 18:43:37.671+00
4	t	manual	\N	\N	2025-12-02 14:47:28.582+00	2025-12-02 14:47:28.591+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 14:47:28.564+00
62	t	manual	\N	\N	2025-12-03 15:02:51.756+00	2025-12-03 15:02:51.807+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:02:51.638+00
41	t	manual	\N	\N	2025-12-02 19:17:54.829+00	2025-12-02 19:17:58.254+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:17:54.813+00
5	t	manual	\N	\N	2025-12-02 15:26:23.494+00	2025-12-02 15:26:23.554+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 15:26:23.384+00
23	f	manual	\N	\N	2025-12-02 18:48:55.38+00	2025-12-02 18:48:55.388+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:48:55.359+00
6	t	manual	\N	\N	2025-12-02 18:14:16.032+00	2025-12-02 18:14:16.052+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 18:14:15.914+00
63	t	manual	\N	\N	2025-12-03 15:03:11.838+00	2025-12-03 15:03:11.844+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:03:11.824+00
24	t	manual	\N	\N	2025-12-02 18:50:10.098+00	2025-12-02 18:50:10.101+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 18:50:10.082+00
42	f	manual	\N	\N	2025-12-02 19:44:52.074+00	2025-12-02 19:44:52.604+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 19:44:52.054+00
7	t	manual	\N	\N	2025-12-02 18:14:58.834+00	2025-12-02 18:14:58.84+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 18:14:58.788+00
25	f	manual	\N	\N	2025-12-02 18:50:21.583+00	2025-12-02 18:50:22.366+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:50:21.563+00
8	f	manual	\N	\N	2025-12-02 18:15:51.36+00	2025-12-02 18:15:51.509+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:15:51.349+00
43	t	manual	\N	\N	2025-12-02 19:47:25.602+00	2025-12-02 19:47:26.736+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:47:25.58+00
64	t	manual	\N	\N	2025-12-03 15:04:01.114+00	2025-12-03 15:04:05.084+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:04:01.094+00
9	t	manual	\N	\N	2025-12-02 18:19:03.004+00	2025-12-02 18:19:03.049+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 18:19:02.945+00
26	f	manual	\N	\N	2025-12-02 18:59:01.437+00	2025-12-02 18:59:01.865+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:59:01.423+00
10	f	manual	\N	\N	2025-12-02 18:31:22.415+00	2025-12-02 18:31:24.881+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:31:22.291+00
44	f	manual	\N	\N	2025-12-02 19:48:09.665+00	2025-12-02 19:48:10.858+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 19:48:09.656+00
27	t	manual	\N	\N	2025-12-02 18:59:37.539+00	2025-12-02 18:59:40.51+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 18:59:37.515+00
11	f	manual	\N	\N	2025-12-02 18:32:07.288+00	2025-12-02 18:32:08.424+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:32:07.276+00
65	t	manual	\N	\N	2025-12-03 15:06:22.426+00	2025-12-03 15:06:22.445+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:06:22.402+00
28	t	manual	\N	\N	2025-12-02 19:00:12.286+00	2025-12-02 19:00:15.525+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:00:12.271+00
12	f	manual	\N	\N	2025-12-02 18:33:37.306+00	2025-12-02 18:33:37.834+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:33:37.294+00
45	t	manual	\N	\N	2025-12-02 19:48:45.222+00	2025-12-02 19:48:46.725+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:48:45.211+00
13	f	manual	\N	\N	2025-12-02 18:34:05.031+00	2025-12-02 18:34:05.654+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:34:05.018+00
29	t	manual	\N	\N	2025-12-02 19:01:18.818+00	2025-12-02 19:01:21.464+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:01:18.8+00
66	t	manual	\N	\N	2025-12-03 15:06:52.137+00	2025-12-03 15:06:57.478+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:06:52.119+00
46	t	manual	\N	\N	2025-12-02 19:48:50.137+00	2025-12-02 19:48:50.155+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:48:50.13+00
14	f	manual	\N	\N	2025-12-02 18:34:59.952+00	2025-12-02 18:35:00.489+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:34:59.943+00
30	t	manual	\N	\N	2025-12-02 19:06:55.718+00	2025-12-02 19:06:58.444+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:06:55.687+00
15	f	manual	\N	\N	2025-12-02 18:38:07.274+00	2025-12-02 18:38:08.405+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:38:07.257+00
47	t	manual	\N	\N	2025-12-02 19:50:32.865+00	2025-12-02 19:50:34.406+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:50:32.854+00
31	t	manual	\N	\N	2025-12-02 19:07:26.328+00	2025-12-02 19:07:30.948+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:07:26.311+00
16	f	manual	\N	\N	2025-12-02 18:38:38.111+00	2025-12-02 18:38:38.676+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:38:38.101+00
67	t	manual	\N	\N	2025-12-03 15:07:52.154+00	2025-12-03 15:07:53.231+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:07:52.131+00
17	f	manual	\N	\N	2025-12-02 18:39:24.451+00	2025-12-02 18:39:25.818+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:39:24.427+00
32	t	manual	\N	\N	2025-12-02 19:08:31.881+00	2025-12-02 19:08:34.483+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:08:31.862+00
48	t	manual	\N	\N	2025-12-02 19:55:20.827+00	2025-12-02 19:55:20.916+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:55:20.789+00
18	f	manual	\N	\N	2025-12-02 18:41:23.031+00	2025-12-02 18:41:23.642+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:41:22.989+00
68	t	manual	\N	\N	2025-12-03 15:08:57.623+00	2025-12-03 15:09:19.458+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:08:57.608+00
33	t	manual	\N	\N	2025-12-02 19:09:14.556+00	2025-12-02 19:09:17.649+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:09:14.54+00
19	f	manual	\N	\N	2025-12-02 18:41:31.453+00	2025-12-02 18:41:31.976+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 18:41:31.44+00
49	t	manual	\N	\N	2025-12-02 19:55:26.9+00	2025-12-02 19:55:28.551+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:55:26.885+00
34	f	manual	\N	\N	2025-12-02 19:11:46.136+00	2025-12-02 19:11:47.251+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 19:11:46.107+00
69	t	manual	\N	\N	2025-12-03 15:10:06.989+00	2025-12-03 15:10:08.643+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:10:06.963+00
50	f	manual	\N	\N	2025-12-02 19:56:57.843+00	2025-12-02 19:57:00.198+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 19:56:57.797+00
35	f	manual	\N	\N	2025-12-02 19:12:21.032+00	2025-12-02 19:12:21.668+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 19:12:21.008+00
36	f	manual	\N	\N	2025-12-02 19:15:03.4+00	2025-12-02 19:15:22.502+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 19:15:03.368+00
51	t	manual	\N	\N	2025-12-02 19:58:42.112+00	2025-12-02 19:58:43.958+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:58:42.101+00
70	f	manual	\N	\N	2025-12-03 15:13:09.8+00	2025-12-03 15:13:10.12+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-03 15:13:09.784+00
37	f	manual	\N	\N	2025-12-02 19:15:44.443+00	2025-12-02 19:15:45.12+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-02 19:15:44.424+00
52	t	manual	\N	\N	2025-12-02 20:03:36.669+00	2025-12-02 20:03:36.696+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 20:03:36.651+00
38	t	manual	\N	\N	2025-12-02 19:15:57.158+00	2025-12-02 19:15:59.763+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 19:15:57.119+00
71	t	manual	\N	\N	2025-12-03 15:19:26.943+00	2025-12-03 15:19:30.633+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:19:26.898+00
53	t	manual	\N	\N	2025-12-02 20:03:39.742+00	2025-12-02 20:03:41.675+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-02 20:03:39.718+00
72	t	manual	\N	\N	2025-12-03 15:21:00.265+00	2025-12-03 15:21:01.998+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:21:00.222+00
54	t	manual	\N	\N	2025-12-03 10:10:44.045+00	2025-12-03 10:10:46.412+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 10:10:43.916+00
55	t	manual	\N	\N	2025-12-03 10:27:04.257+00	2025-12-03 10:27:04.644+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 10:27:04.172+00
73	t	manual	\N	\N	2025-12-03 15:23:51.579+00	2025-12-03 15:23:53.334+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:23:51.566+00
56	t	manual	\N	\N	2025-12-03 10:27:48.327+00	2025-12-03 10:27:48.367+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 10:27:48.302+00
74	t	manual	\N	\N	2025-12-03 15:26:21.844+00	2025-12-03 15:26:34.197+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:26:21.82+00
57	t	manual	\N	\N	2025-12-03 10:30:04.617+00	2025-12-03 10:30:06.912+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 10:30:04.599+00
58	t	manual	\N	\N	2025-12-03 10:31:35.674+00	2025-12-03 10:31:37.709+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 10:31:35.647+00
59	f	manual	\N	\N	2025-12-03 10:32:37.572+00	2025-12-03 10:32:39.407+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-03 10:32:37.542+00
60	t	manual	\N	\N	2025-12-03 10:32:52.366+00	2025-12-03 10:32:54.324+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 10:32:52.331+00
75	t	manual	\N	\N	2025-12-03 15:26:49.297+00	2025-12-03 15:26:50.348+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:26:49.266+00
83	t	manual	\N	\N	2025-12-03 15:42:12.847+00	2025-12-03 15:42:14.708+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:42:12.832+00
110	t	manual	\N	\N	2025-12-03 19:02:44.487+00	2025-12-03 19:02:44.493+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:02:44.443+00
76	t	manual	\N	\N	2025-12-03 15:27:08.496+00	2025-12-03 15:28:07.63+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:27:08.476+00
84	t	manual	\N	\N	2025-12-03 15:42:38.838+00	2025-12-03 15:42:40.53+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:42:38.807+00
77	t	manual	\N	\N	2025-12-03 15:29:03.216+00	2025-12-03 15:29:05.948+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:29:03.195+00
111	t	manual	\N	\N	2025-12-03 19:08:29.155+00	2025-12-03 19:08:29.186+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:08:29.064+00
85	t	manual	\N	\N	2025-12-03 15:43:42.162+00	2025-12-03 15:43:43.164+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:43:42.14+00
78	t	manual	\N	\N	2025-12-03 15:30:38.897+00	2025-12-03 15:30:40.633+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:30:38.871+00
112	t	manual	\N	\N	2025-12-03 19:08:52.084+00	2025-12-03 19:08:52.093+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:08:52.066+00
79	t	manual	\N	\N	2025-12-03 15:31:53.515+00	2025-12-03 15:32:23.7+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:31:53.485+00
86	t	manual	\N	\N	2025-12-03 15:48:10.711+00	2025-12-03 15:48:13.899+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:48:10.663+00
80	t	manual	\N	\N	2025-12-03 15:34:40.046+00	2025-12-03 15:35:01.316+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:34:39.943+00
87	t	manual	\N	\N	2025-12-03 15:49:59.123+00	2025-12-03 15:50:00.885+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:49:59.109+00
113	f	manual	\N	\N	2025-12-03 19:09:07.781+00	2025-12-03 19:09:07.882+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:09:07.767+00
81	t	manual	\N	\N	2025-12-03 15:35:29.057+00	2025-12-03 15:35:30.258+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:35:29.032+00
88	t	manual	\N	\N	2025-12-03 15:50:06.388+00	2025-12-03 15:50:06.394+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:50:06.377+00
82	t	manual	\N	\N	2025-12-03 15:35:41.442+00	2025-12-03 15:35:42.749+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:35:41.432+00
114	t	manual	\N	\N	2025-12-03 19:15:35.328+00	2025-12-03 19:15:35.414+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:15:35.303+00
89	t	manual	\N	\N	2025-12-03 15:50:19.594+00	2025-12-03 15:50:21.075+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:50:19.578+00
115	t	manual	\N	\N	2025-12-03 19:15:48.954+00	2025-12-03 19:15:49.158+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:15:48.933+00
90	t	manual	\N	\N	2025-12-03 15:51:53.597+00	2025-12-03 15:51:55.298+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:51:53.576+00
91	t	manual	\N	\N	2025-12-03 15:52:29.676+00	2025-12-03 15:53:33.737+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:52:29.658+00
116	f	manual	\N	\N	2025-12-03 19:15:52.917+00	2025-12-03 19:15:53.186+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:15:52.907+00
92	t	manual	\N	\N	2025-12-03 15:55:27.053+00	2025-12-03 15:55:29.05+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:55:27.035+00
117	t	manual	\N	\N	2025-12-03 19:17:55.785+00	2025-12-03 19:17:55.8+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:17:55.77+00
93	t	manual	\N	\N	2025-12-03 15:58:16.639+00	2025-12-03 15:58:32.1+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 15:58:16.623+00
118	t	manual	\N	\N	2025-12-03 19:18:00.805+00	2025-12-03 19:18:00.941+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:18:00.785+00
94	t	manual	\N	\N	2025-12-03 16:01:18.892+00	2025-12-03 16:01:44.323+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 16:01:18.867+00
95	t	manual	\N	\N	2025-12-03 16:06:55.991+00	2025-12-03 16:07:00.965+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 16:06:55.938+00
119	f	manual	\N	\N	2025-12-03 19:18:03.653+00	2025-12-03 19:18:03.684+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:18:03.638+00
96	t	manual	\N	\N	2025-12-03 16:09:33.805+00	2025-12-03 16:09:55.878+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 16:09:33.779+00
120	t	manual	\N	\N	2025-12-03 19:19:58.625+00	2025-12-03 19:19:59.866+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:19:58.6+00
97	t	manual	\N	\N	2025-12-03 16:20:05.954+00	2025-12-03 16:20:53.604+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 16:20:05.883+00
121	f	manual	\N	\N	2025-12-03 19:20:07.329+00	2025-12-03 19:20:07.384+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:20:07.312+00
98	t	manual	\N	\N	2025-12-03 16:23:24.472+00	2025-12-03 16:23:27.49+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 16:23:24.408+00
99	t	manual	\N	\N	2025-12-03 16:25:31.105+00	2025-12-03 16:25:33.829+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 16:25:31.06+00
122	f	manual	\N	\N	2025-12-03 19:20:24.866+00	2025-12-03 19:20:26.024+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:20:24.847+00
100	t	manual	\N	\N	2025-12-03 16:32:03.337+00	2025-12-03 16:32:27.06+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 16:32:03.281+00
123	t	manual	\N	\N	2025-12-03 19:22:49.466+00	2025-12-03 19:22:49.613+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:22:49.432+00
101	t	manual	\N	\N	2025-12-03 17:49:52.32+00	2025-12-03 17:50:14.516+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-03 17:49:52.249+00
124	f	manual	\N	\N	2025-12-03 19:24:50.36+00	2025-12-03 19:24:51.94+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:24:50.344+00
102	f	manual	\N	\N	2025-12-03 18:26:16.137+00	2025-12-03 18:26:16.363+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 18:26:16.097+00
103	t	manual	\N	\N	2025-12-03 18:26:44.584+00	2025-12-03 18:26:44.628+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 18:26:44.503+00
125	f	manual	\N	\N	2025-12-03 19:25:13.303+00	2025-12-03 19:25:15.745+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:25:13.219+00
104	f	manual	\N	\N	2025-12-03 18:26:50.022+00	2025-12-03 18:26:55.505+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 18:26:50.008+00
126	t	manual	\N	\N	2025-12-03 19:46:19.876+00	2025-12-03 19:46:20.978+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:46:19.83+00
105	t	manual	\N	\N	2025-12-03 18:28:34.484+00	2025-12-03 18:28:34.491+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 18:28:34.463+00
127	f	manual	\N	\N	2025-12-03 19:46:38.128+00	2025-12-03 19:46:38.229+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:46:38.113+00
106	t	manual	\N	\N	2025-12-03 18:28:49.448+00	2025-12-03 18:28:49.499+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 18:28:49.412+00
107	t	manual	\N	\N	2025-12-03 18:28:53.918+00	2025-12-03 18:28:57.511+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 18:28:53.887+00
128	f	manual	\N	\N	2025-12-03 19:49:52.563+00	2025-12-03 19:49:52.637+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:49:52.505+00
108	f	manual	\N	\N	2025-12-03 18:29:04.311+00	2025-12-03 18:29:04.387+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 18:29:04.305+00
129	t	manual	\N	\N	2025-12-03 19:50:32.832+00	2025-12-03 19:50:32.864+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-03 19:50:32.805+00
109	f	manual	\N	\N	2025-12-03 18:29:08.781+00	2025-12-03 18:29:08.842+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 18:29:08.744+00
130	f	manual	\N	\N	2025-12-03 19:50:38.091+00	2025-12-03 19:50:38.124+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:50:38.063+00
131	f	manual	\N	\N	2025-12-03 19:59:09.343+00	2025-12-03 19:59:09.537+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:59:09.251+00
132	f	manual	\N	\N	2025-12-03 19:59:44.286+00	2025-12-03 19:59:45.453+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-03 19:59:44.266+00
133	t	manual	\N	\N	2025-12-04 11:12:30.876+00	2025-12-04 11:12:30.893+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-04 11:12:30.816+00
134	t	manual	\N	\N	2025-12-04 11:12:38.586+00	2025-12-04 11:12:38.617+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-04 11:12:38.576+00
135	t	manual	\N	\N	2025-12-04 11:12:42.559+00	2025-12-04 11:12:42.729+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-04 11:12:42.536+00
136	t	manual	\N	\N	2025-12-04 11:12:49.273+00	2025-12-04 11:12:50.422+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-04 11:12:49.258+00
137	f	manual	\N	\N	2025-12-04 11:22:41.543+00	2025-12-04 11:22:42.902+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:22:41.52+00
138	f	manual	\N	\N	2025-12-04 11:22:51.262+00	2025-12-04 11:22:52.472+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:22:51.251+00
139	f	manual	\N	\N	2025-12-04 11:37:14.992+00	2025-12-04 11:37:15.168+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:37:14.887+00
140	f	manual	\N	\N	2025-12-04 11:37:36.897+00	2025-12-04 11:37:36.914+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:37:36.888+00
141	f	manual	\N	\N	2025-12-04 11:37:43.464+00	2025-12-04 11:37:43.48+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:37:43.453+00
142	f	manual	\N	\N	2025-12-04 11:37:52.265+00	2025-12-04 11:37:52.275+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:37:52.258+00
143	f	manual	\N	\N	2025-12-04 11:39:21.349+00	2025-12-04 11:39:22.478+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:39:21.332+00
144	f	manual	\N	\N	2025-12-04 11:41:46.573+00	2025-12-04 11:41:47.832+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:41:46.56+00
145	t	manual	\N	\N	2025-12-04 11:42:12.268+00	2025-12-04 11:42:13.076+00	\N	success	e7jupm7IudExE7xe	\N	2025-12-04 11:42:12.255+00
146	f	manual	\N	\N	2025-12-04 11:42:25.207+00	2025-12-04 11:42:25.262+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:42:25.187+00
149	f	manual	\N	\N	2025-12-04 11:51:49.86+00	2025-12-04 11:51:49.894+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:51:49.848+00
147	f	manual	\N	\N	2025-12-04 11:46:59.506+00	2025-12-04 11:46:59.657+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:46:59.429+00
148	f	manual	\N	\N	2025-12-04 11:49:30.548+00	2025-12-04 11:49:30.581+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:49:30.539+00
150	f	manual	\N	\N	2025-12-04 11:51:57.832+00	2025-12-04 11:51:57.848+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:51:57.814+00
151	f	manual	\N	\N	2025-12-04 11:52:47.251+00	2025-12-04 11:52:47.293+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:52:47.244+00
152	f	manual	\N	\N	2025-12-04 11:55:39.512+00	2025-12-04 11:55:39.549+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:55:39.5+00
153	f	manual	\N	\N	2025-12-04 11:55:40.006+00	2025-12-04 11:55:40.044+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:55:39.96+00
154	f	manual	\N	\N	2025-12-04 11:57:56.676+00	2025-12-04 11:57:56.696+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 11:57:56.669+00
155	f	manual	\N	\N	2025-12-04 12:20:44.677+00	2025-12-04 12:20:44.782+00	\N	error	e7jupm7IudExE7xe	\N	2025-12-04 12:20:44.631+00
156	f	manual	\N	\N	2025-12-04 12:55:30.48+00	2025-12-04 12:55:30.486+00	\N	error	zZvLu1SxlyGtLzaY	\N	2025-12-04 12:55:30.447+00
157	f	manual	\N	\N	2025-12-04 12:56:16.618+00	2025-12-04 12:56:16.627+00	\N	error	zZvLu1SxlyGtLzaY	\N	2025-12-04 12:56:16.598+00
158	f	manual	\N	\N	2025-12-04 12:56:28.2+00	2025-12-04 12:56:28.212+00	\N	error	zZvLu1SxlyGtLzaY	\N	2025-12-04 12:56:28.179+00
159	t	manual	\N	\N	2025-12-04 18:49:33.139+00	2025-12-04 18:49:33.168+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-04 18:49:33.058+00
160	t	manual	\N	\N	2025-12-04 18:49:49.498+00	2025-12-04 18:49:53.093+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-04 18:49:49.48+00
161	t	manual	\N	\N	2025-12-04 18:50:20.514+00	2025-12-04 18:50:22.019+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-04 18:50:20.494+00
162	t	manual	\N	\N	2025-12-04 18:50:39.6+00	2025-12-04 18:50:40.716+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-04 18:50:39.587+00
163	f	webhook	\N	\N	2025-12-04 18:54:02.29+00	2025-12-04 18:54:04.706+00	\N	error	aGurSLzad9QHqXSa	\N	2025-12-04 18:54:02.275+00
164	t	webhook	\N	\N	2025-12-04 18:55:05.003+00	2025-12-04 18:55:08.046+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-04 18:55:04.99+00
165	t	webhook	\N	\N	2025-12-04 18:57:33.831+00	2025-12-04 18:57:36.918+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-04 18:57:33.805+00
166	t	webhook	\N	\N	2025-12-04 19:04:57.257+00	2025-12-04 19:04:59.476+00	\N	success	aGurSLzad9QHqXSa	\N	2025-12-04 19:04:57.239+00
\.


--
-- Data for Name: execution_metadata; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.execution_metadata (id, "executionId", key, value) FROM stdin;
\.


--
-- Data for Name: folder; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.folder (id, name, "parentFolderId", "projectId", "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: folder_tag; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.folder_tag ("folderId", "tagId") FROM stdin;
\.


--
-- Data for Name: insights_by_period; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.insights_by_period (id, "metaId", type, value, "periodUnit", "periodStart") FROM stdin;
\.


--
-- Data for Name: insights_metadata; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.insights_metadata ("metaId", "workflowId", "projectId", "workflowName", "projectName") FROM stdin;
1	aGurSLzad9QHqXSa	mEvZadYDcs0VIgbp	Sistema_Consultas	pablo cabral <sistema@everwear.com.ar>
\.


--
-- Data for Name: insights_raw; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.insights_raw (id, "metaId", type, value, "timestamp") FROM stdin;
1	1	3	1	2025-12-04 18:54:05+00
2	1	1	2413	2025-12-04 18:54:05+00
3	1	2	1	2025-12-04 18:55:08+00
4	1	1	3039	2025-12-04 18:55:08+00
5	1	0	1	2025-12-04 18:55:08+00
6	1	2	1	2025-12-04 18:57:37+00
7	1	1	3085	2025-12-04 18:57:37+00
8	1	0	1	2025-12-04 18:57:37+00
9	1	2	1	2025-12-04 19:04:59+00
10	1	1	2216	2025-12-04 19:04:59+00
11	1	0	1	2025-12-04 19:04:59+00
\.


--
-- Data for Name: installed_nodes; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.installed_nodes (name, type, "latestVersion", package) FROM stdin;
\.


--
-- Data for Name: installed_packages; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.installed_packages ("packageName", "installedVersion", "authorName", "authorEmail", "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: invalid_auth_token; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.invalid_auth_token (token, "expiresAt") FROM stdin;
\.


--
-- Data for Name: migrations; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.migrations (id, "timestamp", name) FROM stdin;
1	1587669153312	InitialMigration1587669153312
2	1589476000887	WebhookModel1589476000887
3	1594828256133	CreateIndexStoppedAt1594828256133
4	1607431743768	MakeStoppedAtNullable1607431743768
5	1611144599516	AddWebhookId1611144599516
6	1617270242566	CreateTagEntity1617270242566
7	1620824779533	UniqueWorkflowNames1620824779533
8	1626176912946	AddwaitTill1626176912946
9	1630419189837	UpdateWorkflowCredentials1630419189837
10	1644422880309	AddExecutionEntityIndexes1644422880309
11	1646834195327	IncreaseTypeVarcharLimit1646834195327
12	1646992772331	CreateUserManagement1646992772331
13	1648740597343	LowerCaseUserEmail1648740597343
14	1652254514002	CommunityNodes1652254514002
15	1652367743993	AddUserSettings1652367743993
16	1652905585850	AddAPIKeyColumn1652905585850
17	1654090467022	IntroducePinData1654090467022
18	1658932090381	AddNodeIds1658932090381
19	1659902242948	AddJsonKeyPinData1659902242948
20	1660062385367	CreateCredentialsUserRole1660062385367
21	1663755770893	CreateWorkflowsEditorRole1663755770893
22	1664196174001	WorkflowStatistics1664196174001
23	1665484192212	CreateCredentialUsageTable1665484192212
24	1665754637025	RemoveCredentialUsageTable1665754637025
25	1669739707126	AddWorkflowVersionIdColumn1669739707126
26	1669823906995	AddTriggerCountColumn1669823906995
27	1671535397530	MessageEventBusDestinations1671535397530
28	1671726148421	RemoveWorkflowDataLoadedFlag1671726148421
29	1673268682475	DeleteExecutionsWithWorkflows1673268682475
30	1674138566000	AddStatusToExecutions1674138566000
31	1674509946020	CreateLdapEntities1674509946020
32	1675940580449	PurgeInvalidWorkflowConnections1675940580449
33	1676996103000	MigrateExecutionStatus1676996103000
34	1677236854063	UpdateRunningExecutionStatus1677236854063
35	1677501636754	CreateVariables1677501636754
36	1679416281778	CreateExecutionMetadataTable1679416281778
37	1681134145996	AddUserActivatedProperty1681134145996
38	1681134145997	RemoveSkipOwnerSetup1681134145997
39	1690000000000	MigrateIntegerKeysToString1690000000000
40	1690000000020	SeparateExecutionData1690000000020
41	1690000000030	RemoveResetPasswordColumns1690000000030
42	1690000000030	AddMfaColumns1690000000030
43	1690787606731	AddMissingPrimaryKeyOnExecutionData1690787606731
44	1691088862123	CreateWorkflowNameIndex1691088862123
45	1692967111175	CreateWorkflowHistoryTable1692967111175
46	1693491613982	ExecutionSoftDelete1693491613982
47	1693554410387	DisallowOrphanExecutions1693554410387
48	1694091729095	MigrateToTimestampTz1694091729095
49	1695128658538	AddWorkflowMetadata1695128658538
50	1695829275184	ModifyWorkflowHistoryNodesAndConnections1695829275184
51	1700571993961	AddGlobalAdminRole1700571993961
52	1705429061930	DropRoleMapping1705429061930
53	1711018413374	RemoveFailedExecutionStatus1711018413374
54	1711390882123	MoveSshKeysToDatabase1711390882123
55	1712044305787	RemoveNodesAccess1712044305787
56	1714133768519	CreateProject1714133768519
57	1714133768521	MakeExecutionStatusNonNullable1714133768521
58	1717498465931	AddActivatedAtUserSetting1717498465931
59	1720101653148	AddConstraintToExecutionMetadata1720101653148
60	1721377157740	FixExecutionMetadataSequence1721377157740
61	1723627610222	CreateInvalidAuthTokenTable1723627610222
62	1723796243146	RefactorExecutionIndices1723796243146
63	1724753530828	CreateAnnotationTables1724753530828
64	1724951148974	AddApiKeysTable1724951148974
65	1726606152711	CreateProcessedDataTable1726606152711
66	1727427440136	SeparateExecutionCreationFromStart1727427440136
67	1728659839644	AddMissingPrimaryKeyOnAnnotationTagMapping1728659839644
68	1729607673464	UpdateProcessedDataValueColumnToText1729607673464
69	1729607673469	AddProjectIcons1729607673469
70	1730386903556	CreateTestDefinitionTable1730386903556
71	1731404028106	AddDescriptionToTestDefinition1731404028106
72	1731582748663	MigrateTestDefinitionKeyToString1731582748663
73	1732271325258	CreateTestMetricTable1732271325258
74	1732549866705	CreateTestRun1732549866705
75	1733133775640	AddMockedNodesColumnToTestDefinition1733133775640
76	1734479635324	AddManagedColumnToCredentialsTable1734479635324
77	1736172058779	AddStatsColumnsToTestRun1736172058779
78	1736947513045	CreateTestCaseExecutionTable1736947513045
79	1737715421462	AddErrorColumnsToTestRuns1737715421462
80	1738709609940	CreateFolderTable1738709609940
81	1739549398681	CreateAnalyticsTables1739549398681
82	1740445074052	UpdateParentFolderIdColumn1740445074052
83	1741167584277	RenameAnalyticsToInsights1741167584277
84	1742918400000	AddScopesColumnToApiKeys1742918400000
85	1745322634000	ClearEvaluation1745322634000
86	1745587087521	AddWorkflowStatisticsRootCount1745587087521
87	1745934666076	AddWorkflowArchivedColumn1745934666076
88	1745934666077	DropRoleTable1745934666077
89	1747824239000	AddProjectDescriptionColumn1747824239000
90	1750252139166	AddLastActiveAtColumnToUser1750252139166
91	1750252139166	AddScopeTables1750252139166
92	1750252139167	AddRolesTables1750252139167
93	1750252139168	LinkRoleToUserTable1750252139168
94	1750252139170	RemoveOldRoleColumn1750252139170
95	1752669793000	AddInputsOutputsToTestCaseExecution1752669793000
96	1753953244168	LinkRoleToProjectRelationTable1753953244168
97	1754475614601	CreateDataStoreTables1754475614601
98	1754475614602	ReplaceDataStoreTablesWithDataTables1754475614602
99	1756906557570	AddTimestampsToRoleAndRoleIndexes1756906557570
100	1758731786132	AddAudienceColumnToApiKeys1758731786132
101	1758794506893	AddProjectIdToVariableTable1758794506893
102	1759399811000	ChangeValueTypesForInsights1759399811000
103	1760019379982	CreateChatHubTables1760019379982
104	1760020000000	CreateChatHubAgentTable1760020000000
105	1760020838000	UniqueRoleNames1760020838000
106	1760116750277	CreateOAuthEntities1760116750277
107	1760314000000	CreateWorkflowDependencyTable1760314000000
108	1760965142113	DropUnusedChatHubColumns1760965142113
109	1761047826451	AddWorkflowVersionColumn1761047826451
110	1761655473000	ChangeDependencyInfoToJson1761655473000
111	1761830340990	AddToolsColumnToChatHubTables1761830340990
112	1762177736257	AddWorkflowDescriptionColumn1762177736257
113	1762763704614	BackfillMissingWorkflowHistoryRecords1762763704614
114	1762771264000	ChangeDefaultForIdInUserTable1762771264000
115	1762847206508	AddWorkflowHistoryAutoSaveFields1762847206508
116	1763572724000	ChangeOAuthStateColumnToUnboundedVarchar1763572724000
\.


--
-- Data for Name: oauth_access_tokens; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.oauth_access_tokens (token, "clientId", "userId") FROM stdin;
\.


--
-- Data for Name: oauth_authorization_codes; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.oauth_authorization_codes (code, "clientId", "userId", "redirectUri", "codeChallenge", "codeChallengeMethod", "expiresAt", state, used, "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: oauth_clients; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.oauth_clients (id, name, "redirectUris", "grantTypes", "clientSecret", "clientSecretExpiresAt", "tokenEndpointAuthMethod", "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: oauth_refresh_tokens; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.oauth_refresh_tokens (token, "clientId", "userId", "expiresAt", "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: oauth_user_consents; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.oauth_user_consents (id, "userId", "clientId", "grantedAt") FROM stdin;
\.


--
-- Data for Name: processed_data; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.processed_data ("workflowId", context, "createdAt", "updatedAt", value) FROM stdin;
\.


--
-- Data for Name: project; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.project (id, name, type, "createdAt", "updatedAt", icon, description) FROM stdin;
mEvZadYDcs0VIgbp	pablo cabral <sistema@everwear.com.ar>	personal	2025-12-02 14:37:30.818+00	2025-12-02 14:37:57.69+00	\N	\N
\.


--
-- Data for Name: project_relation; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.project_relation ("projectId", "userId", role, "createdAt", "updatedAt") FROM stdin;
mEvZadYDcs0VIgbp	2b15051f-dee3-494f-91b5-2ede498cb491	project:personalOwner	2025-12-02 14:37:30.818+00	2025-12-02 14:37:30.818+00
\.


--
-- Data for Name: role; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.role (slug, "displayName", description, "roleType", "systemRole", "createdAt", "updatedAt") FROM stdin;
global:owner	Owner	Owner	global	t	2025-12-02 14:37:32.662+00	2025-12-02 14:37:33.628+00
global:admin	Admin	Admin	global	t	2025-12-02 14:37:32.662+00	2025-12-02 14:37:33.628+00
global:member	Member	Member	global	t	2025-12-02 14:37:32.662+00	2025-12-02 14:37:33.628+00
project:admin	Project Admin	Full control of settings, members, workflows, credentials and executions	project	t	2025-12-02 14:37:32.662+00	2025-12-02 14:37:33.656+00
project:personalOwner	Project Owner	Project Owner	project	t	2025-12-02 14:37:32.662+00	2025-12-02 14:37:33.656+00
project:editor	Project Editor	Create, edit, and delete workflows, credentials, and executions	project	t	2025-12-02 14:37:32.662+00	2025-12-02 14:37:33.656+00
project:viewer	Project Viewer	Read-only access to workflows, credentials, and executions	project	t	2025-12-02 14:37:32.662+00	2025-12-02 14:37:33.656+00
credential:owner	Credential Owner	Credential Owner	credential	t	2025-12-02 14:37:33.673+00	2025-12-02 14:37:33.673+00
credential:user	Credential User	Credential User	credential	t	2025-12-02 14:37:33.673+00	2025-12-02 14:37:33.673+00
workflow:owner	Workflow Owner	Workflow Owner	workflow	t	2025-12-02 14:37:33.68+00	2025-12-02 14:37:33.68+00
workflow:editor	Workflow Editor	Workflow Editor	workflow	t	2025-12-02 14:37:33.68+00	2025-12-02 14:37:33.68+00
\.


--
-- Data for Name: role_scope; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.role_scope ("roleSlug", "scopeSlug") FROM stdin;
global:owner	annotationTag:create
global:owner	annotationTag:read
global:owner	annotationTag:update
global:owner	annotationTag:delete
global:owner	annotationTag:list
global:owner	auditLogs:manage
global:owner	banner:dismiss
global:owner	community:register
global:owner	communityPackage:install
global:owner	communityPackage:uninstall
global:owner	communityPackage:update
global:owner	communityPackage:list
global:owner	credential:share
global:owner	credential:move
global:owner	credential:create
global:owner	credential:read
global:owner	credential:update
global:owner	credential:delete
global:owner	credential:list
global:owner	externalSecretsProvider:sync
global:owner	externalSecretsProvider:create
global:owner	externalSecretsProvider:read
global:owner	externalSecretsProvider:update
global:owner	externalSecretsProvider:delete
global:owner	externalSecretsProvider:list
global:owner	externalSecret:list
global:owner	externalSecret:use
global:owner	eventBusDestination:test
global:owner	eventBusDestination:create
global:owner	eventBusDestination:read
global:owner	eventBusDestination:update
global:owner	eventBusDestination:delete
global:owner	eventBusDestination:list
global:owner	ldap:sync
global:owner	ldap:manage
global:owner	license:manage
global:owner	logStreaming:manage
global:owner	orchestration:read
global:owner	project:create
global:owner	project:read
global:owner	project:update
global:owner	project:delete
global:owner	project:list
global:owner	saml:manage
global:owner	securityAudit:generate
global:owner	sourceControl:pull
global:owner	sourceControl:push
global:owner	sourceControl:manage
global:owner	tag:create
global:owner	tag:read
global:owner	tag:update
global:owner	tag:delete
global:owner	tag:list
global:owner	user:resetPassword
global:owner	user:changeRole
global:owner	user:enforceMfa
global:owner	user:create
global:owner	user:read
global:owner	user:update
global:owner	user:delete
global:owner	user:list
global:owner	variable:create
global:owner	variable:read
global:owner	variable:update
global:owner	variable:delete
global:owner	variable:list
global:owner	projectVariable:create
global:owner	projectVariable:read
global:owner	projectVariable:update
global:owner	projectVariable:delete
global:owner	projectVariable:list
global:owner	workersView:manage
global:owner	workflow:share
global:owner	workflow:execute
global:owner	workflow:move
global:owner	workflow:create
global:owner	workflow:read
global:owner	workflow:update
global:owner	workflow:delete
global:owner	workflow:list
global:owner	folder:create
global:owner	folder:read
global:owner	folder:update
global:owner	folder:delete
global:owner	folder:list
global:owner	folder:move
global:owner	insights:list
global:owner	oidc:manage
global:owner	provisioning:manage
global:owner	dataTable:create
global:owner	dataTable:read
global:owner	dataTable:update
global:owner	dataTable:delete
global:owner	dataTable:list
global:owner	dataTable:readRow
global:owner	dataTable:writeRow
global:owner	dataTable:listProject
global:owner	role:manage
global:owner	mcp:manage
global:owner	mcp:oauth
global:owner	mcpApiKey:create
global:owner	mcpApiKey:rotate
global:owner	chatHub:manage
global:owner	chatHub:message
global:owner	chatHubAgent:create
global:owner	chatHubAgent:read
global:owner	chatHubAgent:update
global:owner	chatHubAgent:delete
global:owner	chatHubAgent:list
global:owner	breakingChanges:list
global:admin	annotationTag:create
global:admin	annotationTag:read
global:admin	annotationTag:update
global:admin	annotationTag:delete
global:admin	annotationTag:list
global:admin	auditLogs:manage
global:admin	banner:dismiss
global:admin	community:register
global:admin	communityPackage:install
global:admin	communityPackage:uninstall
global:admin	communityPackage:update
global:admin	communityPackage:list
global:admin	credential:share
global:admin	credential:move
global:admin	credential:create
global:admin	credential:read
global:admin	credential:update
global:admin	credential:delete
global:admin	credential:list
global:admin	externalSecretsProvider:sync
global:admin	externalSecretsProvider:create
global:admin	externalSecretsProvider:read
global:admin	externalSecretsProvider:update
global:admin	externalSecretsProvider:delete
global:admin	externalSecretsProvider:list
global:admin	externalSecret:list
global:admin	externalSecret:use
global:admin	eventBusDestination:test
global:admin	eventBusDestination:create
global:admin	eventBusDestination:read
global:admin	eventBusDestination:update
global:admin	eventBusDestination:delete
global:admin	eventBusDestination:list
global:admin	ldap:sync
global:admin	ldap:manage
global:admin	license:manage
global:admin	logStreaming:manage
global:admin	orchestration:read
global:admin	project:create
global:admin	project:read
global:admin	project:update
global:admin	project:delete
global:admin	project:list
global:admin	saml:manage
global:admin	securityAudit:generate
global:admin	sourceControl:pull
global:admin	sourceControl:push
global:admin	sourceControl:manage
global:admin	tag:create
global:admin	tag:read
global:admin	tag:update
global:admin	tag:delete
global:admin	tag:list
global:admin	user:resetPassword
global:admin	user:changeRole
global:admin	user:enforceMfa
global:admin	user:create
global:admin	user:read
global:admin	user:update
global:admin	user:delete
global:admin	user:list
global:admin	variable:create
global:admin	variable:read
global:admin	variable:update
global:admin	variable:delete
global:admin	variable:list
global:admin	projectVariable:create
global:admin	projectVariable:read
global:admin	projectVariable:update
global:admin	projectVariable:delete
global:admin	projectVariable:list
global:admin	workersView:manage
global:admin	workflow:share
global:admin	workflow:execute
global:admin	workflow:move
global:admin	workflow:create
global:admin	workflow:read
global:admin	workflow:update
global:admin	workflow:delete
global:admin	workflow:list
global:admin	folder:create
global:admin	folder:read
global:admin	folder:update
global:admin	folder:delete
global:admin	folder:list
global:admin	folder:move
global:admin	insights:list
global:admin	oidc:manage
global:admin	provisioning:manage
global:admin	dataTable:create
global:admin	dataTable:read
global:admin	dataTable:update
global:admin	dataTable:delete
global:admin	dataTable:list
global:admin	dataTable:readRow
global:admin	dataTable:writeRow
global:admin	dataTable:listProject
global:admin	role:manage
global:admin	mcp:manage
global:admin	mcp:oauth
global:admin	mcpApiKey:create
global:admin	mcpApiKey:rotate
global:admin	chatHub:manage
global:admin	chatHub:message
global:admin	chatHubAgent:create
global:admin	chatHubAgent:read
global:admin	chatHubAgent:update
global:admin	chatHubAgent:delete
global:admin	chatHubAgent:list
global:admin	breakingChanges:list
global:member	annotationTag:create
global:member	annotationTag:read
global:member	annotationTag:update
global:member	annotationTag:delete
global:member	annotationTag:list
global:member	eventBusDestination:test
global:member	eventBusDestination:list
global:member	tag:create
global:member	tag:read
global:member	tag:update
global:member	tag:list
global:member	user:list
global:member	variable:read
global:member	variable:list
global:member	dataTable:list
global:member	mcp:oauth
global:member	mcpApiKey:create
global:member	mcpApiKey:rotate
global:member	chatHub:message
global:member	chatHubAgent:create
global:member	chatHubAgent:read
global:member	chatHubAgent:update
global:member	chatHubAgent:delete
global:member	chatHubAgent:list
project:admin	credential:share
project:admin	credential:move
project:admin	credential:create
project:admin	credential:read
project:admin	credential:update
project:admin	credential:delete
project:admin	credential:list
project:admin	project:read
project:admin	project:update
project:admin	project:delete
project:admin	project:list
project:admin	sourceControl:push
project:admin	projectVariable:create
project:admin	projectVariable:read
project:admin	projectVariable:update
project:admin	projectVariable:delete
project:admin	projectVariable:list
project:admin	workflow:execute
project:admin	workflow:move
project:admin	workflow:create
project:admin	workflow:read
project:admin	workflow:update
project:admin	workflow:delete
project:admin	workflow:list
project:admin	folder:create
project:admin	folder:read
project:admin	folder:update
project:admin	folder:delete
project:admin	folder:list
project:admin	folder:move
project:admin	dataTable:create
project:admin	dataTable:read
project:admin	dataTable:update
project:admin	dataTable:delete
project:admin	dataTable:readRow
project:admin	dataTable:writeRow
project:admin	dataTable:listProject
project:personalOwner	credential:share
project:personalOwner	credential:move
project:personalOwner	credential:create
project:personalOwner	credential:read
project:personalOwner	credential:update
project:personalOwner	credential:delete
project:personalOwner	credential:list
project:personalOwner	project:read
project:personalOwner	project:list
project:personalOwner	workflow:share
project:personalOwner	workflow:execute
project:personalOwner	workflow:move
project:personalOwner	workflow:create
project:personalOwner	workflow:read
project:personalOwner	workflow:update
project:personalOwner	workflow:delete
project:personalOwner	workflow:list
project:personalOwner	folder:create
project:personalOwner	folder:read
project:personalOwner	folder:update
project:personalOwner	folder:delete
project:personalOwner	folder:list
project:personalOwner	folder:move
project:personalOwner	dataTable:create
project:personalOwner	dataTable:read
project:personalOwner	dataTable:update
project:personalOwner	dataTable:delete
project:personalOwner	dataTable:readRow
project:personalOwner	dataTable:writeRow
project:personalOwner	dataTable:listProject
project:editor	credential:create
project:editor	credential:read
project:editor	credential:update
project:editor	credential:delete
project:editor	credential:list
project:editor	project:read
project:editor	project:list
project:editor	projectVariable:create
project:editor	projectVariable:read
project:editor	projectVariable:update
project:editor	projectVariable:delete
project:editor	projectVariable:list
project:editor	workflow:execute
project:editor	workflow:create
project:editor	workflow:read
project:editor	workflow:update
project:editor	workflow:delete
project:editor	workflow:list
project:editor	folder:create
project:editor	folder:read
project:editor	folder:update
project:editor	folder:delete
project:editor	folder:list
project:editor	dataTable:create
project:editor	dataTable:read
project:editor	dataTable:update
project:editor	dataTable:delete
project:editor	dataTable:readRow
project:editor	dataTable:writeRow
project:editor	dataTable:listProject
project:viewer	credential:read
project:viewer	credential:list
project:viewer	project:read
project:viewer	project:list
project:viewer	projectVariable:read
project:viewer	projectVariable:list
project:viewer	workflow:read
project:viewer	workflow:list
project:viewer	folder:read
project:viewer	folder:list
project:viewer	dataTable:read
project:viewer	dataTable:readRow
project:viewer	dataTable:listProject
credential:owner	credential:share
credential:owner	credential:move
credential:owner	credential:read
credential:owner	credential:update
credential:owner	credential:delete
credential:user	credential:read
workflow:owner	workflow:share
workflow:owner	workflow:execute
workflow:owner	workflow:move
workflow:owner	workflow:read
workflow:owner	workflow:update
workflow:owner	workflow:delete
workflow:editor	workflow:execute
workflow:editor	workflow:read
workflow:editor	workflow:update
\.


--
-- Data for Name: scope; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.scope (slug, "displayName", description) FROM stdin;
annotationTag:create	Create Annotation Tag	Allows creating new annotation tags.
annotationTag:read	annotationTag:read	\N
annotationTag:update	annotationTag:update	\N
annotationTag:delete	annotationTag:delete	\N
annotationTag:list	annotationTag:list	\N
annotationTag:*	annotationTag:*	\N
auditLogs:manage	auditLogs:manage	\N
auditLogs:*	auditLogs:*	\N
banner:dismiss	banner:dismiss	\N
banner:*	banner:*	\N
community:register	community:register	\N
community:*	community:*	\N
communityPackage:install	communityPackage:install	\N
communityPackage:uninstall	communityPackage:uninstall	\N
communityPackage:update	communityPackage:update	\N
communityPackage:list	communityPackage:list	\N
communityPackage:manage	communityPackage:manage	\N
communityPackage:*	communityPackage:*	\N
credential:share	credential:share	\N
credential:move	credential:move	\N
credential:create	credential:create	\N
credential:read	credential:read	\N
credential:update	credential:update	\N
credential:delete	credential:delete	\N
credential:list	credential:list	\N
credential:*	credential:*	\N
externalSecretsProvider:sync	externalSecretsProvider:sync	\N
externalSecretsProvider:create	externalSecretsProvider:create	\N
externalSecretsProvider:read	externalSecretsProvider:read	\N
externalSecretsProvider:update	externalSecretsProvider:update	\N
externalSecretsProvider:delete	externalSecretsProvider:delete	\N
externalSecretsProvider:list	externalSecretsProvider:list	\N
externalSecretsProvider:*	externalSecretsProvider:*	\N
externalSecret:list	externalSecret:list	\N
externalSecret:use	externalSecret:use	\N
externalSecret:*	externalSecret:*	\N
eventBusDestination:test	eventBusDestination:test	\N
eventBusDestination:create	eventBusDestination:create	\N
eventBusDestination:read	eventBusDestination:read	\N
eventBusDestination:update	eventBusDestination:update	\N
eventBusDestination:delete	eventBusDestination:delete	\N
eventBusDestination:list	eventBusDestination:list	\N
eventBusDestination:*	eventBusDestination:*	\N
ldap:sync	ldap:sync	\N
ldap:manage	ldap:manage	\N
ldap:*	ldap:*	\N
license:manage	license:manage	\N
license:*	license:*	\N
logStreaming:manage	logStreaming:manage	\N
logStreaming:*	logStreaming:*	\N
orchestration:read	orchestration:read	\N
orchestration:list	orchestration:list	\N
orchestration:*	orchestration:*	\N
project:create	project:create	\N
project:read	project:read	\N
project:update	project:update	\N
project:delete	project:delete	\N
project:list	project:list	\N
project:*	project:*	\N
saml:manage	saml:manage	\N
saml:*	saml:*	\N
securityAudit:generate	securityAudit:generate	\N
securityAudit:*	securityAudit:*	\N
sourceControl:pull	sourceControl:pull	\N
sourceControl:push	sourceControl:push	\N
sourceControl:manage	sourceControl:manage	\N
sourceControl:*	sourceControl:*	\N
tag:create	tag:create	\N
tag:read	tag:read	\N
tag:update	tag:update	\N
tag:delete	tag:delete	\N
tag:list	tag:list	\N
tag:*	tag:*	\N
user:resetPassword	user:resetPassword	\N
user:changeRole	user:changeRole	\N
user:enforceMfa	user:enforceMfa	\N
user:create	user:create	\N
user:read	user:read	\N
user:update	user:update	\N
user:delete	user:delete	\N
user:list	user:list	\N
user:*	user:*	\N
variable:create	variable:create	\N
variable:read	variable:read	\N
variable:update	variable:update	\N
variable:delete	variable:delete	\N
variable:list	variable:list	\N
variable:*	variable:*	\N
projectVariable:create	projectVariable:create	\N
projectVariable:read	projectVariable:read	\N
projectVariable:update	projectVariable:update	\N
projectVariable:delete	projectVariable:delete	\N
projectVariable:list	projectVariable:list	\N
projectVariable:*	projectVariable:*	\N
workersView:manage	workersView:manage	\N
workersView:*	workersView:*	\N
workflow:share	workflow:share	\N
workflow:execute	workflow:execute	\N
workflow:move	workflow:move	\N
workflow:activate	workflow:activate	\N
workflow:deactivate	workflow:deactivate	\N
workflow:create	workflow:create	\N
workflow:read	workflow:read	\N
workflow:update	workflow:update	\N
workflow:delete	workflow:delete	\N
workflow:list	workflow:list	\N
workflow:*	workflow:*	\N
folder:create	folder:create	\N
folder:read	folder:read	\N
folder:update	folder:update	\N
folder:delete	folder:delete	\N
folder:list	folder:list	\N
folder:move	folder:move	\N
folder:*	folder:*	\N
insights:list	insights:list	\N
insights:*	insights:*	\N
oidc:manage	oidc:manage	\N
oidc:*	oidc:*	\N
provisioning:manage	provisioning:manage	\N
provisioning:*	provisioning:*	\N
dataTable:create	dataTable:create	\N
dataTable:read	dataTable:read	\N
dataTable:update	dataTable:update	\N
dataTable:delete	dataTable:delete	\N
dataTable:list	dataTable:list	\N
dataTable:readRow	dataTable:readRow	\N
dataTable:writeRow	dataTable:writeRow	\N
dataTable:listProject	dataTable:listProject	\N
dataTable:*	dataTable:*	\N
execution:delete	execution:delete	\N
execution:read	execution:read	\N
execution:retry	execution:retry	\N
execution:list	execution:list	\N
execution:get	execution:get	\N
execution:*	execution:*	\N
workflowTags:update	workflowTags:update	\N
workflowTags:list	workflowTags:list	\N
workflowTags:*	workflowTags:*	\N
role:manage	role:manage	\N
role:*	role:*	\N
mcp:manage	mcp:manage	\N
mcp:oauth	mcp:oauth	\N
mcp:*	mcp:*	\N
mcpApiKey:create	mcpApiKey:create	\N
mcpApiKey:rotate	mcpApiKey:rotate	\N
mcpApiKey:*	mcpApiKey:*	\N
chatHub:manage	chatHub:manage	\N
chatHub:message	chatHub:message	\N
chatHub:*	chatHub:*	\N
chatHubAgent:create	chatHubAgent:create	\N
chatHubAgent:read	chatHubAgent:read	\N
chatHubAgent:update	chatHubAgent:update	\N
chatHubAgent:delete	chatHubAgent:delete	\N
chatHubAgent:list	chatHubAgent:list	\N
chatHubAgent:*	chatHubAgent:*	\N
breakingChanges:list	breakingChanges:list	\N
breakingChanges:*	breakingChanges:*	\N
*	*	\N
\.


--
-- Data for Name: settings; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.settings (key, value, "loadOnStartup") FROM stdin;
ui.banners.dismissed	["V1"]	t
features.ldap	{"loginEnabled":false,"loginLabel":"","connectionUrl":"","allowUnauthorizedCerts":false,"connectionSecurity":"none","connectionPort":389,"baseDn":"","bindingAdminDn":"","bindingAdminPassword":"","firstNameAttribute":"","lastNameAttribute":"","emailAttribute":"","loginIdAttribute":"","ldapIdAttribute":"","userFilter":"","synchronizationEnabled":false,"synchronizationInterval":60,"searchPageSize":0,"searchTimeout":60,"enforceEmailUniqueness":true}	t
userManagement.authenticationMethod	email	t
features.sourceControl.sshKeys	{"encryptedPrivateKey":"U2FsdGVkX1+Ma0e/M/sICb4KGZGVr47lSECxxkJvQwAc1Kh2L6vZUzF7I2kKxp+7c9YUREFSUmTYTfr5zhFwPozMwtGV6F0kSMFE8yH+WC3MMRvZ6vjeAhKim75Snt7TWpnR6pis03ZKpoqbEXmHPGegTYJa1K9xkaj2cCuShsteuTlGKf8i2WIPeB64peldLsytsAdWgZ6ZocfdHDrQWZQDsjS6nw8X5QBS+02ofTHkLjT+ONYiHv+k6qiGzXAy4OugKFQ3smhyE7/ZhuRowPXm3bG+ilFPCpkX9QYq5edigYkG2UtO0OKENfQuwbt/OC5t/aPRvUOcvZJG0jxFNvDuKeETKpr6ZdKeo9dzhu5tC0/KneLhDvAUIift8b4jyU3G5y37wJwyb+siUwaHZfRHbZhDrQCuU58UBKG9y9tVlkeMti8lh8JspvONi+/uKQcNNQMeAECGJZA7KgxaieIQUn/MdtyDDQ7jg7Tpsr7PhXSGQt+BU1y4KAxwBIwTeg0R8wDf32pItTH91uKwgefn/t63qmBs9QMB40jlVtB6WFGZecsQfILMlVhzbghd","publicKey":"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKxEBdDijnLMO1GpdPp4rfAR9FFxGoB+R+Wqf50+O46O n8n deploy key"}	t
features.sourceControl	{"branchName":"main","connectionType":"ssh","keyGeneratorType":"ed25519"}	t
userManagement.isInstanceOwnerSetUp	true	t
\.


--
-- Data for Name: shared_credentials; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.shared_credentials ("credentialsId", "projectId", role, "createdAt", "updatedAt") FROM stdin;
7D2TxcTctnD2ZM7F	mEvZadYDcs0VIgbp	credential:owner	2025-12-02 18:31:03.163+00	2025-12-02 18:31:03.163+00
Yz9zqfekGs09gP8P	mEvZadYDcs0VIgbp	credential:owner	2025-12-02 18:43:17.698+00	2025-12-02 18:43:17.698+00
MheAYMt9zGq5h1to	mEvZadYDcs0VIgbp	credential:owner	2025-12-03 18:19:19.33+00	2025-12-03 18:19:19.33+00
\.


--
-- Data for Name: shared_workflow; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.shared_workflow ("workflowId", "projectId", role, "createdAt", "updatedAt") FROM stdin;
aGurSLzad9QHqXSa	mEvZadYDcs0VIgbp	workflow:owner	2025-12-02 14:38:36.709+00	2025-12-02 14:38:36.709+00
bPXUua9aY2xXVMhF	mEvZadYDcs0VIgbp	workflow:owner	2025-12-03 18:18:13.466+00	2025-12-03 18:18:13.466+00
e7jupm7IudExE7xe	mEvZadYDcs0VIgbp	workflow:owner	2025-12-03 18:18:15.743+00	2025-12-03 18:18:15.743+00
zZvLu1SxlyGtLzaY	mEvZadYDcs0VIgbp	workflow:owner	2025-12-04 12:54:29.485+00	2025-12-04 12:54:29.485+00
\.


--
-- Data for Name: tag_entity; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.tag_entity (name, "createdAt", "updatedAt", id) FROM stdin;
\.


--
-- Data for Name: test_case_execution; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.test_case_execution (id, "testRunId", "executionId", status, "runAt", "completedAt", "errorCode", "errorDetails", metrics, "createdAt", "updatedAt", inputs, outputs) FROM stdin;
\.


--
-- Data for Name: test_run; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.test_run (id, "workflowId", status, "errorCode", "errorDetails", "runAt", "completedAt", metrics, "createdAt", "updatedAt") FROM stdin;
\.


--
-- Data for Name: user; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public."user" (id, email, "firstName", "lastName", password, "personalizationAnswers", "createdAt", "updatedAt", settings, disabled, "mfaEnabled", "mfaSecret", "mfaRecoveryCodes", "lastActiveAt", "roleSlug") FROM stdin;
2b15051f-dee3-494f-91b5-2ede498cb491	sistema@everwear.com.ar	pablo	cabral	$2a$10$G6x1Sdt//pX0F.bFnrYdGOVqdiUN.DUlxiJL35F1Of3/LjzPnA2XK	{"version":"v4","personalization_survey_submitted_at":"2025-12-02T14:38:00.352Z","personalization_survey_n8n_version":"1.121.3"}	2025-12-02 14:37:29.48+00	2025-12-04 18:55:08.068+00	{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"aGurSLzad9QHqXSa","userActivatedAt":1764874505007}	f	f	\N	\N	2025-12-04	global:owner
\.


--
-- Data for Name: user_api_keys; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.user_api_keys (id, "userId", label, "apiKey", "createdAt", "updatedAt", scopes, audience) FROM stdin;
\.


--
-- Data for Name: variables; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.variables (key, type, value, id, "projectId") FROM stdin;
\.


--
-- Data for Name: webhook_entity; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.webhook_entity ("webhookPath", method, node, "webhookId", "pathLength", "workflowId") FROM stdin;
\.


--
-- Data for Name: workflow_dependency; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.workflow_dependency (id, "workflowId", "workflowVersionId", "dependencyType", "dependencyKey", "dependencyInfo", "indexVersionId", "createdAt") FROM stdin;
\.


--
-- Data for Name: workflow_entity; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.workflow_entity (name, active, nodes, connections, "createdAt", "updatedAt", settings, "staticData", "pinData", "versionId", "triggerCount", id, meta, "parentFolderId", "isArchived", "versionCounter", description) FROM stdin;
RAG - Sistema de Consultas	f	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"lastNode","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();"},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"specifyBody":"json","jsonBody":"={{\\n  {\\n    vectors: $json.data[0].embedding,\\n    size: 5,\\n    with_payload: true\\n  }\\n}}","options":{}},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{}]},"options":{}},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };"},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};"},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"method":"POST","url":"https://api.mammouth.ai/v1/embeddings","sendHeaders":true,"headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}]	{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}}	2025-12-03 18:18:15.743+00	2025-12-04 12:41:45.024+00	{"executionOrder":"v1"}	\N	{}	0125e7fb-8531-45a0-88e4-c8dac8bafff2	0	e7jupm7IudExE7xe	{"templateCredsSetupCompleted":true}	\N	f	6	\N
RAG - Sistema de Consultas (Corregido)	f	[{"parameters":{},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };"},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};"},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304]},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"path":"evet","responseMode":"lastNode","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{}},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{}},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}]	{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}}	2025-12-03 18:18:13.466+00	2025-12-03 18:18:13.466+00	{"executionOrder":"v1"}	\N	{}	d511cc8b-74f4-47ce-b9cb-31e0a4871f2a	0	bPXUua9aY2xXVMhF	\N	\N	f	1	\N
cv_format	f	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"62b38b22-8248-449b-832a-cbc043148bb3","name":"Webhook","webhookId":"9bda02e7-0323-4a10-8638-0b01ee647967"}]	{}	2025-12-04 12:54:29.485+00	2025-12-04 12:56:11.524+00	{"executionOrder":"v1"}	\N	{}	dc021f42-f9e5-4ae1-9811-820701d8b60d	0	zZvLu1SxlyGtLzaY	\N	\N	f	3	\N
Sistema_Consultas	f	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}]	{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}}	2025-12-02 14:38:36.709+00	2025-12-04 19:11:47.599+00	{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false,"timeSavedPerExecution":1,"errorWorkflow":"aGurSLzad9QHqXSa"}	\N	{}	1d479d3b-00ab-4e24-9fa7-c2fcdc3833f5	1	aGurSLzad9QHqXSa	{"templateCredsSetupCompleted":true}	\N	f	37	
\.


--
-- Data for Name: workflow_history; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.workflow_history ("versionId", "workflowId", authors, "createdAt", "updatedAt", nodes, connections, name, autosaved, description) FROM stdin;
d6d195a0-3820-4ed7-b1a2-afa2b057308b	e7jupm7IudExE7xe	pablo cabral	2025-12-03 18:59:50.529+00	2025-12-03 18:59:50.529+00	[{"parameters":{"path":"chat","responseMode":"lastNode","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"bodyParameters":{"parameters":[{}]},"options":{}},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{}]},"options":{}},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };"},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};"},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}]	{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}}	\N	f	\N
24ddac8e-c111-4de6-8ce1-92477c26d28d	aGurSLzad9QHqXSa	pablo cabral	2025-12-03 18:08:36.14+00	2025-12-03 18:08:36.14+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}]	{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}}	\N	f	\N
d511cc8b-74f4-47ce-b9cb-31e0a4871f2a	bPXUua9aY2xXVMhF	pablo cabral	2025-12-03 18:18:13.524+00	2025-12-03 18:18:13.524+00	[{"parameters":{},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };"},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};"},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304]},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"path":"evet","responseMode":"lastNode","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{}},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{}},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}]	{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}}	\N	f	\N
ecec9cb6-b9c9-4e08-8ed7-0b3429756bae	e7jupm7IudExE7xe	pablo cabral	2025-12-03 18:18:15.793+00	2025-12-03 18:18:15.793+00	[{"parameters":{},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };"},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};"},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304]},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"path":"evet","responseMode":"lastNode","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{}},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{}},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}]	{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}}	\N	f	\N
a46c3a62-dec1-4cdf-a9de-44ee4f8cf675	e7jupm7IudExE7xe	pablo cabral	2025-12-03 18:25:12.861+00	2025-12-03 18:25:12.861+00	[{"parameters":{},"id":"75f4ff61-7fc1-439a-b995-455dd623ef93","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[384,304]},{"parameters":{"operation":"embedding","requestOptions":{}},"id":"307a7429-bfab-44ff-ae86-142a08864189","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[608,304],"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"893471ae-88c7-4ceb-a189-a7bb3226464d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1040,304]},{"parameters":{"jsCode":"// Procesar resultados de búsqueda\\nconst query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos1'].json;\\nconst puestosRaw = $node['Qdrant - Buscar Puestos1'].json;\\n\\n// Parsear resultados de Qdrant\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query: query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload.structured_data?.habilidades || [],\\n    experiencia: c.payload.structured_data?.experiencia_años || 0,\\n    snippet: c.payload.original_chunk?.substring(0, 300) || ''\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload.structured_data?.requisitos || [],\\n    snippet: p.payload.original_chunk?.substring(0, 300) || ''\\n  }))\\n};\\n\\nreturn { json: contexto };"},"id":"6de5e5b1-2b37-432e-b6bd-f5125f5d940f","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[1264,304]},{"parameters":{"resource":"chat","operation":"create","requestOptions":{}},"id":"1db9c010-104e-4d05-9055-dc44592dac89","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1488,304],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"// Parsear y estructurar respuesta final\\nconst rawResponse = $input.item.json.choices[0].message.content;\\nconst query = $node['Extraer Query'].json.query;\\nconst tokensUsed = $input.item.json.usage.total_tokens;\\n\\n// Intentar extraer JSON de la respuesta\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query: query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview'\\n    }\\n  }\\n};"},"id":"06a5652e-6087-450c-acf0-71c66548859d","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[1696,304]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"025abcc7-99a3-43ac-9ed0-27ba1308d448","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[1920,304],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"5e1093b2-387a-4307-b17f-3491c03d2840","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[2144,304]},{"parameters":{"path":"ever","responseMode":"lastNode","options":{}},"id":"b25cc826-d6b3-48c8-92d8-f8e9badb7d9e","name":"Webhook - Chat1","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[160,304],"webhookId":"0a4acd7b-5f06-42fd-9fb4-d9e22ef3b25d"},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"bodyParameters":{"parameters":[{"name":"vector","value":"={{ $json.data[0].embedding }}"},{"name":"limit","value":"5"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{}},"id":"c94ab818-1d18-4eeb-94a6-0a1b1d0d3e93","name":"Qdrant - Buscar Candidatos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{"name":"vector","value":"={{ $node['OpenAI - Generar Embedding'].json.data[0].embedding }}"},{"name":"limit","value":"3"},{"name":"score_threshold","value":"0.7"},{"name":"with_payload","value":"true"}]},"options":{}},"id":"19460c59-9c1f-4605-a302-7080babde4c7","name":"Qdrant - Buscar Puestos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[816,416]}]	{"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos1","type":"main","index":0},{"node":"Qdrant - Buscar Puestos1","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook - Chat1":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Qdrant - Buscar Candidatos1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos1":{"main":[[{"node":"Merge","type":"main","index":1}]]}}	\N	f	\N
e01f90b7-7158-4f28-926a-effa1f9bae2b	e7jupm7IudExE7xe	pablo cabral	2025-12-03 19:00:49.228+00	2025-12-03 19:00:49.228+00	[{"parameters":{"path":"ever","responseMode":"lastNode","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"operation":"embedding","requestOptions":{}},"id":"c9ae8670-ad2b-4060-8cdc-4452b0f9471a","name":"OpenAI - Generar Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-1600,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"bodyParameters":{"parameters":[{}]},"options":{}},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{}]},"options":{}},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };"},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};"},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]}]	{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"OpenAI - Generar Embedding","type":"main","index":0}]]},"OpenAI - Generar Embedding":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0},{"node":"Qdrant - Buscar Puestos","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]}}	\N	f	\N
a9815c47-ef5e-416a-a410-231741b7cb52	e7jupm7IudExE7xe	pablo cabral	2025-12-04 12:41:22.58+00	2025-12-04 12:41:22.58+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"lastNode","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();"},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"specifyBody":"json","jsonBody":"={{\\n  {\\n    vectors: $json.data[0].embedding,\\n    size: 5,\\n    with_payload: true\\n  }\\n}}","options":{}},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{}]},"options":{}},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };"},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};"},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"method":"POST","url":"https://api.mammouth.ai/v1/embeddings","sendHeaders":true,"headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}]	{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}}	\N	f	\N
0125e7fb-8531-45a0-88e4-c8dac8bafff2	e7jupm7IudExE7xe	pablo cabral	2025-12-04 12:41:45.029+00	2025-12-04 12:41:45.029+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"lastNode","options":{"allowedOrigins":"*"}},"id":"3d4e6ffd-f0db-419a-9e43-ff9832ed4c55","name":"Webhook - Chat","type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2048,-96],"webhookId":"bf002015-f2c2-4034-b85f-fbf69d3cffb0"},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nfor (const item of $input.all()) {\\n  item.json.myNewField = 1;\\n}\\n\\nreturn $input.all();"},"id":"c32769b5-42d9-4ed7-8b18-316495da8709","name":"Extraer Query","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1824,-96]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/candidatos/points/search","sendBody":true,"specifyBody":"json","jsonBody":"={{\\n  {\\n    vectors: $json.data[0].embedding,\\n    size: 5,\\n    with_payload: true\\n  }\\n}}","options":{}},"id":"2001a88c-f095-4449-8664-7b8353481b4a","name":"Qdrant - Buscar Candidatos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,-208]},{"parameters":{"method":"POST","url":"http://qdrant:6333/collections/puestos/points/search","sendBody":true,"bodyParameters":{"parameters":[{}]},"options":{}},"id":"64b3c225-1461-4f83-8a9a-c1ef6f386a72","name":"Qdrant - Buscar Puestos","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1392,0]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"95f46919-2988-47f4-b442-0b0b4c7aa116","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[-1168,-96]},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst candidatosRaw = $node['Qdrant - Buscar Candidatos'].json || {};\\nconst puestosRaw = $node['Qdrant - Buscar Puestos'].json || {};\\n\\nconst candidatos = candidatosRaw.result || [];\\nconst puestos = puestosRaw.result || [];\\n\\nconst contexto = {\\n  query,\\n  candidatos_relevantes: candidatos.map(c => ({\\n    score: c.score,\\n    nombre: c.payload?.structured_data?.nombre || 'N/A',\\n    habilidades: c.payload?.structured_data?.habilidades || [],\\n    experiencia: c.payload?.structured_data?.experiencia_anios || c.payload?.structured_data?.experiencia_años || 0,\\n    snippet: (c.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  puestos_relevantes: puestos.map(p => ({\\n    score: p.score,\\n    titulo: p.payload?.structured_data?.titulo_puesto || 'N/A',\\n    requisitos: p.payload?.structured_data?.requisitos || [],\\n    snippet: (p.payload?.original_chunk || '').slice(0, 300),\\n  })),\\n  sin_resultados: candidatos.length === 0 && puestos.length === 0,\\n};\\n\\nreturn { json: contexto };"},"id":"528a7484-de25-4ed5-bec3-70143c856237","name":"Construir Contexto RAG","type":"n8n-nodes-base.code","typeVersion":2,"position":[-944,-96]},{"parameters":{"operation":"completion","requestOptions":{}},"id":"545365c1-4791-4934-99c1-141a9ac210ca","name":"OpenAI - Generar Respuesta","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[-720,-96],"credentials":{"openAiApi":{"id":"Yz9zqfekGs09gP8P","name":"OpenAi account 2"}}},{"parameters":{"jsCode":"const query = $node['Extraer Query'].json.query;\\nconst rawResponse = $node['OpenAI - Generar Respuesta'].json.choices[0].text;\\nconst tokensUsed = $node['OpenAI - Generar Respuesta'].json.usage?.total_tokens || null;\\n\\nlet parsedData;\\ntry {\\n  const jsonMatch = rawResponse.match(/```json\\\\n([\\\\s\\\\S]*?)\\\\n```/);\\n  parsedData = jsonMatch ? JSON.parse(jsonMatch[1]) : JSON.parse(rawResponse);\\n} catch (error) {\\n  parsedData = {\\n    respuesta: rawResponse,\\n    error: 'No se pudo parsear como JSON',\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    success: true,\\n    query,\\n    response: parsedData,\\n    metadata: {\\n      timestamp: new Date().toISOString(),\\n      tokens_used: tokensUsed,\\n      model: 'gpt-4-turbo-preview',\\n    },\\n  },\\n};"},"id":"320c1cc3-4d9a-4ad9-b989-907053d0848f","name":"Formatear Respuesta","type":"n8n-nodes-base.code","typeVersion":2,"position":[-512,-96]},{"parameters":{"operation":"executeQuery","query":"=INSERT INTO chat_logs (query, response, tokens_used, created_at)\\nVALUES (\\n  $1::text,\\n  $2::jsonb,\\n  $3::integer,\\n  NOW()\\n) RETURNING id","options":{}},"id":"ac933a48-eee5-42c3-9a70-770c3b9bbf70","name":"PostgreSQL - Guardar Log","type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[-288,-96],"credentials":{"postgres":{"id":"MheAYMt9zGq5h1to","name":"Postgres account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"id":"1ddd04b8-f121-48dd-8271-2b264f3a6a67","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-64,-96]},{"parameters":{"method":"POST","url":"https://api.mammouth.ai/v1/embeddings","sendHeaders":true,"headerParameters":{"parameters":[{"name":"=Content-Type","value":"=application/json"},{"name":"Authorization","value":"=Bearer sk-cgOP97ddcHyM5alqeV7ieA"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"model","value":"=text-embedding-3-small"},{"name":"input","value":"={{ $json.body.message }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-1616,-96],"id":"7375640d-f95b-4963-8c07-483a4d1132f9","name":"HTTP Request"}]	{"Webhook - Chat":{"main":[[{"node":"Extraer Query","type":"main","index":0}]]},"Extraer Query":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Qdrant - Buscar Candidatos":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Qdrant - Buscar Puestos":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Construir Contexto RAG","type":"main","index":0}]]},"Construir Contexto RAG":{"main":[[{"node":"OpenAI - Generar Respuesta","type":"main","index":0}]]},"OpenAI - Generar Respuesta":{"main":[[{"node":"Formatear Respuesta","type":"main","index":0}]]},"Formatear Respuesta":{"main":[[{"node":"PostgreSQL - Guardar Log","type":"main","index":0}]]},"PostgreSQL - Guardar Log":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Qdrant - Buscar Candidatos","type":"main","index":0}]]}}	\N	f	\N
336ba2f6-6cf6-49f9-99d4-dd3ff1d9fe08	aGurSLzad9QHqXSa	pablo cabral	2025-12-04 12:42:10.389+00	2025-12-04 12:42:10.389+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}]	{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}}	\N	f	\N
595cf6c6-0359-4e0e-a03f-2ff80ae3e3d6	aGurSLzad9QHqXSa	pablo cabral	2025-12-04 12:42:15.435+00	2025-12-04 12:42:15.435+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"promptType":"define","text":"=json\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}]	{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}}	\N	f	\N
76d4b346-57c1-47c8-a99f-204514ccbaf6	zZvLu1SxlyGtLzaY	pablo cabral	2025-12-04 12:54:29.523+00	2025-12-04 12:54:29.523+00	[{"parameters":{"httpMethod":"POST","path":"ever","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"62b38b22-8248-449b-832a-cbc043148bb3","name":"Webhook","webhookId":"9bda02e7-0323-4a10-8638-0b01ee647967"}]	{}	\N	f	\N
68b665d7-e04b-42c4-96d6-eeadb00b5c85	zZvLu1SxlyGtLzaY	pablo cabral	2025-12-04 12:55:03.892+00	2025-12-04 12:55:03.892+00	[{"parameters":{"httpMethod":"POST","path":"ever","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"62b38b22-8248-449b-832a-cbc043148bb3","name":"Webhook","webhookId":"9bda02e7-0323-4a10-8638-0b01ee647967"}]	{}	\N	f	\N
dc021f42-f9e5-4ae1-9811-820701d8b60d	zZvLu1SxlyGtLzaY	pablo cabral	2025-12-04 12:56:11.535+00	2025-12-04 12:56:11.535+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"62b38b22-8248-449b-832a-cbc043148bb3","name":"Webhook","webhookId":"9bda02e7-0323-4a10-8638-0b01ee647967"}]	{}	\N	f	\N
063e6ab6-6e88-49c1-a81b-410800337f4c	aGurSLzad9QHqXSa	pablo cabral	2025-12-04 18:53:49.978+00	2025-12-04 18:53:49.978+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\n\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}]	{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}}	\N	f	\N
2cd42f8d-11ef-4176-aed9-90742d958877	aGurSLzad9QHqXSa	pablo cabral	2025-12-04 18:54:58.633+00	2025-12-04 18:54:58.633+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}]	{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}}	\N	f	\N
e3937903-6a8f-4021-a83e-edfbcdb66317	aGurSLzad9QHqXSa	pablo cabral	2025-12-04 19:09:55.558+00	2025-12-04 19:09:55.558+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}]	{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}}	\N	f	\N
1d479d3b-00ab-4e24-9fa7-c2fcdc3833f5	aGurSLzad9QHqXSa	pablo cabral	2025-12-04 19:11:47.605+00	2025-12-04 19:11:47.605+00	[{"parameters":{"httpMethod":"POST","path":"ever","responseMode":"responseNode","options":{"allowedOrigins":"*"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"191a918b-cc83-4b79-a6d8-ab3b8aa7cf44","name":"Webhook","webhookId":"3beefed2-81a6-4097-a2d6-93ee50a2a862"},{"parameters":{"promptType":"define","text":"=Eres un empleado del área de calidad y estaras a cargo de redactar procedimientos e instructivos a partir de la implementacion de iso 9001\\njson:\\n{{ $json.body.message }} \\n\\nlas respuestas deben estar solo dentro de la llave response, no generen nuevas llaves\\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3,"position":[416,0],"id":"d02c1622-0182-4b4d-90ee-c3772dd7f4db","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-nano","mode":"list","cachedResultName":"gpt-4.1-nano"},"responsesApiEnabled":false,"options":{"responseFormat":"json_object","temperature":0.4,"topP":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[288,208],"id":"9fe20951-31df-4e8f-82ca-e01008c5a8cb","name":"OpenAI Chat Model","notesInFlow":false,"credentials":{"openAiApi":{"id":"7D2TxcTctnD2ZM7F","name":"OpenAi account"}}},{"parameters":{"respondWith":"json","responseBody":"={{ $json.output }}\\n\\n","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[768,0],"id":"c6ec314c-e6a3-423e-90fd-5c9533ea4b08","name":"Respond to Webhook"},{"parameters":{"jsCode":"// ═══════════════════════════════════════════════════════════\\n// 📦 Format Response - Production Version\\n// ═══════════════════════════════════════════════════════════\\n\\nconst agentOutput = $input.item.json;\\n\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📥 1. EXTRAER DATOS DEL WEBHOOK ORIGINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst webhookData = $('Webhook').item.json.body;\\nconst originalMessage = webhookData.message || '';\\nconst userId = webhookData.user || 'anonymous';\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🔄 2. EXTRAER RESPUESTA DEL AGENT\\n// ═══════════════════════════════════════════════════════════\\n\\nlet responseText = '';\\n\\nif (agentOutput.output) {\\n  responseText = agentOutput.output;\\n  console.log('✅ Found: agentOutput.output');\\n} else if (agentOutput.text) {\\n  responseText = agentOutput.text;\\n  console.log('✅ Found: agentOutput.text');\\n} else if (agentOutput.response?.generations?.[0]?.[0]?.text) {\\n  responseText = agentOutput.response.generations[0][0].text;\\n  console.log('✅ Found: nested response.generations');\\n} else {\\n  responseText = JSON.stringify(agentOutput);\\n  console.warn('⚠️ Fallback: using full JSON');\\n}\\n\\nconsole.log('\\\\n📝 Raw Response Text:', responseText);\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🧹 3. LIMPIAR RESPUESTA (remover markdown si existe)\\n// ═══════════════════════════════════════════════════════════\\n\\nlet cleanedText = responseText.trim();\\n\\n// ═══════════════════════════════════════════════════════════\\n// 📊 4. PARSEAR JSON\\n// ═══════════════════════════════════════════════════════════\\n\\nlet parsedJson = null;\\nlet finalResponse = '';\\nlet sentiment = 'neutral';\\nlet confidence = null;\\n\\ntry {\\n  // Si ya es objeto, usarlo directamente\\n  if (typeof cleanedText === 'object') {\\n    parsedJson = cleanedText;\\n  } else {\\n    // Intentar parsear como JSON\\n    parsedJson = JSON.parse(cleanedText);\\n  }\\n  \\n  \\n  // Extraer campos\\n  finalResponse = parsedJson.response || parsedJson.output || parsedJson.text || cleanedText;\\n  sentiment = parsedJson.sentiment || 'neutral';\\n  confidence = parsedJson.confidence || null;\\n  \\n} catch (error) {\\n  console.error('❌ JSON Parse Error:', error.message);\\n  \\n  // Fallback: usar texto plano\\n  finalResponse = cleanedText;\\n  sentiment = 'unknown';\\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 💰 5. EXTRAER TOKEN USAGE (para monitoreo de costos)\\n// ═══════════════════════════════════════════════════════════\\n\\nconst tokenUsage = agentOutput.tokenUsage || \\n                   agentOutput.response?.tokenUsage || \\n                   null;\\n\\nlet costEstimate = null;\\n\\nif (tokenUsage) {\\n  // Costos de gpt-4o-mini: $0.15/1M input, $0.60/1M output\\n  costEstimate = {\\n    inputTokens: tokenUsage.promptTokens || 0,\\n    outputTokens: tokenUsage.completionTokens || 0,\\n    totalTokens: tokenUsage.totalTokens || 0,\\n    estimatedCostUSD: (\\n      (tokenUsage.promptTokens || 0) * 0.00000015 +\\n      (tokenUsage.completionTokens || 0) * 0.0000006\\n    ).toFixed(8)\\n  };\\n  \\n}\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🎯 6. CONSTRUIR RESPUESTA FINAL\\n// ═══════════════════════════════════════════════════════════\\n\\nconst timestamp = new Date().toISOString();\\nconst conversationId = `conv_${userId}_${Date.now()}`; // 🆕 Para futuro tracking\\n\\nconst output = {\\n  // ✅ Respuesta principal\\n  response: finalResponse,\\n  \\n  // 👤 Datos del usuario\\n  userId: userId,\\n  \\n  // 🕒 Metadata temporal\\n  timestamp: timestamp,\\n  conversationId: conversationId,\\n  \\n  // 📊 Análisis de sentimiento\\n  sentiment: sentiment,\\n  confidence: confidence,\\n  \\n  // 🔍 Datos originales (útil para debugging)\\n  original: {\\n    message: originalMessage,\\n    timestamp: timestamp\\n  },\\n  \\n  // 💰 Datos de uso (opcional, comentar si no necesitas)\\n  usage: costEstimate\\n};\\n\\n// ═══════════════════════════════════════════════════════════\\n// 🚀 7. RETORNAR\\n// ═══════════════════════════════════════════════════════════\\n\\nreturn [{\\n  json: output\\n}];\\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[176,-320],"id":"02b8a5aa-539f-439b-915c-c8ca6fe8bdbe","name":"Code in JavaScript"}]	{"Webhook":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Code in JavaScript":{"main":[[]]}}	\N	f	\N
\.


--
-- Data for Name: workflow_statistics; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.workflow_statistics (count, "latestEvent", name, "workflowId", "rootCount") FROM stdin;
1	2025-12-02 14:38:57.912+00	data_loaded	aGurSLzad9QHqXSa	1
25	2025-12-03 15:13:10.179+00	manual_error	aGurSLzad9QHqXSa	0
20	2025-12-04 11:42:13.095+00	manual_success	e7jupm7IudExE7xe	0
34	2025-12-04 12:20:44.822+00	manual_error	e7jupm7IudExE7xe	0
1	2025-12-03 18:26:16.09+00	data_loaded	e7jupm7IudExE7xe	1
3	2025-12-04 12:56:28.25+00	manual_error	zZvLu1SxlyGtLzaY	0
80	2025-12-04 18:50:40.733+00	manual_success	aGurSLzad9QHqXSa	0
1	2025-12-04 18:54:04.72+00	production_error	aGurSLzad9QHqXSa	1
3	2025-12-04 19:04:59.484+00	production_success	aGurSLzad9QHqXSa	3
\.


--
-- Data for Name: workflows_tags; Type: TABLE DATA; Schema: public; Owner: n8n
--

COPY public.workflows_tags ("workflowId", "tagId") FROM stdin;
\.


--
-- Name: auth_provider_sync_history_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.auth_provider_sync_history_id_seq', 1, false);


--
-- Name: execution_annotations_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.execution_annotations_id_seq', 1, false);


--
-- Name: execution_entity_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.execution_entity_id_seq', 166, true);


--
-- Name: execution_metadata_temp_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.execution_metadata_temp_id_seq', 1, false);


--
-- Name: insights_by_period_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.insights_by_period_id_seq', 1, false);


--
-- Name: insights_metadata_metaId_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public."insights_metadata_metaId_seq"', 1, true);


--
-- Name: insights_raw_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.insights_raw_id_seq', 11, true);


--
-- Name: migrations_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.migrations_id_seq', 116, true);


--
-- Name: oauth_user_consents_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.oauth_user_consents_id_seq', 1, false);


--
-- Name: workflow_dependency_id_seq; Type: SEQUENCE SET; Schema: public; Owner: n8n
--

SELECT pg_catalog.setval('public.workflow_dependency_id_seq', 1, false);


--
-- Name: test_run PK_011c050f566e9db509a0fadb9b9; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.test_run
    ADD CONSTRAINT "PK_011c050f566e9db509a0fadb9b9" PRIMARY KEY (id);


--
-- Name: installed_packages PK_08cc9197c39b028c1e9beca225940576fd1a5804; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.installed_packages
    ADD CONSTRAINT "PK_08cc9197c39b028c1e9beca225940576fd1a5804" PRIMARY KEY ("packageName");


--
-- Name: execution_metadata PK_17a0b6284f8d626aae88e1c16e4; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_metadata
    ADD CONSTRAINT "PK_17a0b6284f8d626aae88e1c16e4" PRIMARY KEY (id);


--
-- Name: project_relation PK_1caaa312a5d7184a003be0f0cb6; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.project_relation
    ADD CONSTRAINT "PK_1caaa312a5d7184a003be0f0cb6" PRIMARY KEY ("projectId", "userId");


--
-- Name: chat_hub_sessions PK_1eafef1273c70e4464fec703412; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_sessions
    ADD CONSTRAINT "PK_1eafef1273c70e4464fec703412" PRIMARY KEY (id);


--
-- Name: folder_tag PK_27e4e00852f6b06a925a4d83a3e; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.folder_tag
    ADD CONSTRAINT "PK_27e4e00852f6b06a925a4d83a3e" PRIMARY KEY ("folderId", "tagId");


--
-- Name: role PK_35c9b140caaf6da09cfabb0d675; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.role
    ADD CONSTRAINT "PK_35c9b140caaf6da09cfabb0d675" PRIMARY KEY (slug);


--
-- Name: project PK_4d68b1358bb5b766d3e78f32f57; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.project
    ADD CONSTRAINT "PK_4d68b1358bb5b766d3e78f32f57" PRIMARY KEY (id);


--
-- Name: workflow_dependency PK_52325e34cd7a2f0f67b0f3cad65; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflow_dependency
    ADD CONSTRAINT "PK_52325e34cd7a2f0f67b0f3cad65" PRIMARY KEY (id);


--
-- Name: invalid_auth_token PK_5779069b7235b256d91f7af1a15; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.invalid_auth_token
    ADD CONSTRAINT "PK_5779069b7235b256d91f7af1a15" PRIMARY KEY (token);


--
-- Name: shared_workflow PK_5ba87620386b847201c9531c58f; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.shared_workflow
    ADD CONSTRAINT "PK_5ba87620386b847201c9531c58f" PRIMARY KEY ("workflowId", "projectId");


--
-- Name: folder PK_6278a41a706740c94c02e288df8; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.folder
    ADD CONSTRAINT "PK_6278a41a706740c94c02e288df8" PRIMARY KEY (id);


--
-- Name: data_table_column PK_673cb121ee4a8a5e27850c72c51; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.data_table_column
    ADD CONSTRAINT "PK_673cb121ee4a8a5e27850c72c51" PRIMARY KEY (id);


--
-- Name: annotation_tag_entity PK_69dfa041592c30bbc0d4b84aa00; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.annotation_tag_entity
    ADD CONSTRAINT "PK_69dfa041592c30bbc0d4b84aa00" PRIMARY KEY (id);


--
-- Name: oauth_refresh_tokens PK_74abaed0b30711b6532598b0392; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_refresh_tokens
    ADD CONSTRAINT "PK_74abaed0b30711b6532598b0392" PRIMARY KEY (token);


--
-- Name: chat_hub_messages PK_7704a5add6baed43eef835f0bfb; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_messages
    ADD CONSTRAINT "PK_7704a5add6baed43eef835f0bfb" PRIMARY KEY (id);


--
-- Name: execution_annotations PK_7afcf93ffa20c4252869a7c6a23; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_annotations
    ADD CONSTRAINT "PK_7afcf93ffa20c4252869a7c6a23" PRIMARY KEY (id);


--
-- Name: oauth_user_consents PK_85b9ada746802c8993103470f05; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_user_consents
    ADD CONSTRAINT "PK_85b9ada746802c8993103470f05" PRIMARY KEY (id);


--
-- Name: migrations PK_8c82d7f526340ab734260ea46be; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.migrations
    ADD CONSTRAINT "PK_8c82d7f526340ab734260ea46be" PRIMARY KEY (id);


--
-- Name: installed_nodes PK_8ebd28194e4f792f96b5933423fc439df97d9689; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.installed_nodes
    ADD CONSTRAINT "PK_8ebd28194e4f792f96b5933423fc439df97d9689" PRIMARY KEY (name);


--
-- Name: shared_credentials PK_8ef3a59796a228913f251779cff; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.shared_credentials
    ADD CONSTRAINT "PK_8ef3a59796a228913f251779cff" PRIMARY KEY ("credentialsId", "projectId");


--
-- Name: test_case_execution PK_90c121f77a78a6580e94b794bce; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.test_case_execution
    ADD CONSTRAINT "PK_90c121f77a78a6580e94b794bce" PRIMARY KEY (id);


--
-- Name: user_api_keys PK_978fa5caa3468f463dac9d92e69; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.user_api_keys
    ADD CONSTRAINT "PK_978fa5caa3468f463dac9d92e69" PRIMARY KEY (id);


--
-- Name: execution_annotation_tags PK_979ec03d31294cca484be65d11f; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_annotation_tags
    ADD CONSTRAINT "PK_979ec03d31294cca484be65d11f" PRIMARY KEY ("annotationId", "tagId");


--
-- Name: webhook_entity PK_b21ace2e13596ccd87dc9bf4ea6; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.webhook_entity
    ADD CONSTRAINT "PK_b21ace2e13596ccd87dc9bf4ea6" PRIMARY KEY ("webhookPath", method);


--
-- Name: insights_by_period PK_b606942249b90cc39b0265f0575; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.insights_by_period
    ADD CONSTRAINT "PK_b606942249b90cc39b0265f0575" PRIMARY KEY (id);


--
-- Name: workflow_history PK_b6572dd6173e4cd06fe79937b58; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflow_history
    ADD CONSTRAINT "PK_b6572dd6173e4cd06fe79937b58" PRIMARY KEY ("versionId");


--
-- Name: scope PK_bfc45df0481abd7f355d6187da1; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.scope
    ADD CONSTRAINT "PK_bfc45df0481abd7f355d6187da1" PRIMARY KEY (slug);


--
-- Name: oauth_clients PK_c4759172d3431bae6f04e678e0d; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_clients
    ADD CONSTRAINT "PK_c4759172d3431bae6f04e678e0d" PRIMARY KEY (id);


--
-- Name: processed_data PK_ca04b9d8dc72de268fe07a65773; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.processed_data
    ADD CONSTRAINT "PK_ca04b9d8dc72de268fe07a65773" PRIMARY KEY ("workflowId", context);


--
-- Name: settings PK_dc0fe14e6d9943f268e7b119f69ab8bd; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.settings
    ADD CONSTRAINT "PK_dc0fe14e6d9943f268e7b119f69ab8bd" PRIMARY KEY (key);


--
-- Name: oauth_access_tokens PK_dcd71f96a5d5f4bf79e67d322bf; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_access_tokens
    ADD CONSTRAINT "PK_dcd71f96a5d5f4bf79e67d322bf" PRIMARY KEY (token);


--
-- Name: data_table PK_e226d0001b9e6097cbfe70617cb; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.data_table
    ADD CONSTRAINT "PK_e226d0001b9e6097cbfe70617cb" PRIMARY KEY (id);


--
-- Name: user PK_ea8f538c94b6e352418254ed6474a81f; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT "PK_ea8f538c94b6e352418254ed6474a81f" PRIMARY KEY (id);


--
-- Name: insights_raw PK_ec15125755151e3a7e00e00014f; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.insights_raw
    ADD CONSTRAINT "PK_ec15125755151e3a7e00e00014f" PRIMARY KEY (id);


--
-- Name: chat_hub_agents PK_f39a3b36bbdf0e2979ddb21cf78; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_agents
    ADD CONSTRAINT "PK_f39a3b36bbdf0e2979ddb21cf78" PRIMARY KEY (id);


--
-- Name: insights_metadata PK_f448a94c35218b6208ce20cf5a1; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.insights_metadata
    ADD CONSTRAINT "PK_f448a94c35218b6208ce20cf5a1" PRIMARY KEY ("metaId");


--
-- Name: oauth_authorization_codes PK_fb91ab932cfbd694061501cc20f; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_authorization_codes
    ADD CONSTRAINT "PK_fb91ab932cfbd694061501cc20f" PRIMARY KEY (code);


--
-- Name: role_scope PK_role_scope; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.role_scope
    ADD CONSTRAINT "PK_role_scope" PRIMARY KEY ("roleSlug", "scopeSlug");


--
-- Name: oauth_user_consents UQ_083721d99ce8db4033e2958ebb4; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_user_consents
    ADD CONSTRAINT "UQ_083721d99ce8db4033e2958ebb4" UNIQUE ("userId", "clientId");


--
-- Name: data_table_column UQ_8082ec4890f892f0bc77473a123; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.data_table_column
    ADD CONSTRAINT "UQ_8082ec4890f892f0bc77473a123" UNIQUE ("dataTableId", name);


--
-- Name: data_table UQ_b23096ef747281ac944d28e8b0d; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.data_table
    ADD CONSTRAINT "UQ_b23096ef747281ac944d28e8b0d" UNIQUE ("projectId", name);


--
-- Name: user UQ_e12875dfb3b1d92d7d7c5377e2; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT "UQ_e12875dfb3b1d92d7d7c5377e2" UNIQUE (email);


--
-- Name: auth_identity auth_identity_pkey; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.auth_identity
    ADD CONSTRAINT auth_identity_pkey PRIMARY KEY ("providerId", "providerType");


--
-- Name: auth_provider_sync_history auth_provider_sync_history_pkey; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.auth_provider_sync_history
    ADD CONSTRAINT auth_provider_sync_history_pkey PRIMARY KEY (id);


--
-- Name: credentials_entity credentials_entity_pkey; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.credentials_entity
    ADD CONSTRAINT credentials_entity_pkey PRIMARY KEY (id);


--
-- Name: event_destinations event_destinations_pkey; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.event_destinations
    ADD CONSTRAINT event_destinations_pkey PRIMARY KEY (id);


--
-- Name: execution_data execution_data_pkey; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_data
    ADD CONSTRAINT execution_data_pkey PRIMARY KEY ("executionId");


--
-- Name: execution_entity pk_e3e63bbf986767844bbe1166d4e; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_entity
    ADD CONSTRAINT pk_e3e63bbf986767844bbe1166d4e PRIMARY KEY (id);


--
-- Name: workflow_statistics pk_workflow_statistics; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflow_statistics
    ADD CONSTRAINT pk_workflow_statistics PRIMARY KEY ("workflowId", name);


--
-- Name: workflows_tags pk_workflows_tags; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflows_tags
    ADD CONSTRAINT pk_workflows_tags PRIMARY KEY ("workflowId", "tagId");


--
-- Name: tag_entity tag_entity_pkey; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.tag_entity
    ADD CONSTRAINT tag_entity_pkey PRIMARY KEY (id);


--
-- Name: variables variables_pkey; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.variables
    ADD CONSTRAINT variables_pkey PRIMARY KEY (id);


--
-- Name: workflow_entity workflow_entity_pkey; Type: CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflow_entity
    ADD CONSTRAINT workflow_entity_pkey PRIMARY KEY (id);


--
-- Name: IDX_14f68deffaf858465715995508; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_14f68deffaf858465715995508" ON public.folder USING btree ("projectId", id);


--
-- Name: IDX_1d8ab99d5861c9388d2dc1cf73; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_1d8ab99d5861c9388d2dc1cf73" ON public.insights_metadata USING btree ("workflowId");


--
-- Name: IDX_1e31657f5fe46816c34be7c1b4; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_1e31657f5fe46816c34be7c1b4" ON public.workflow_history USING btree ("workflowId");


--
-- Name: IDX_1ef35bac35d20bdae979d917a3; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_1ef35bac35d20bdae979d917a3" ON public.user_api_keys USING btree ("apiKey");


--
-- Name: IDX_5f0643f6717905a05164090dde; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_5f0643f6717905a05164090dde" ON public.project_relation USING btree ("userId");


--
-- Name: IDX_60b6a84299eeb3f671dfec7693; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_60b6a84299eeb3f671dfec7693" ON public.insights_by_period USING btree ("periodStart", type, "periodUnit", "metaId");


--
-- Name: IDX_61448d56d61802b5dfde5cdb00; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_61448d56d61802b5dfde5cdb00" ON public.project_relation USING btree ("projectId");


--
-- Name: IDX_63d7bbae72c767cf162d459fcc; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_63d7bbae72c767cf162d459fcc" ON public.user_api_keys USING btree ("userId", label);


--
-- Name: IDX_8e4b4774db42f1e6dda3452b2a; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_8e4b4774db42f1e6dda3452b2a" ON public.test_case_execution USING btree ("testRunId");


--
-- Name: IDX_97f863fa83c4786f1956508496; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_97f863fa83c4786f1956508496" ON public.execution_annotations USING btree ("executionId");


--
-- Name: IDX_UniqueRoleDisplayName; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_UniqueRoleDisplayName" ON public.role USING btree ("displayName");


--
-- Name: IDX_a3697779b366e131b2bbdae297; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_a3697779b366e131b2bbdae297" ON public.execution_annotation_tags USING btree ("tagId");


--
-- Name: IDX_a4ff2d9b9628ea988fa9e7d0bf; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_a4ff2d9b9628ea988fa9e7d0bf" ON public.workflow_dependency USING btree ("workflowId");


--
-- Name: IDX_ae51b54c4bb430cf92f48b623f; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_ae51b54c4bb430cf92f48b623f" ON public.annotation_tag_entity USING btree (name);


--
-- Name: IDX_c1519757391996eb06064f0e7c; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_c1519757391996eb06064f0e7c" ON public.execution_annotation_tags USING btree ("annotationId");


--
-- Name: IDX_cec8eea3bf49551482ccb4933e; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX "IDX_cec8eea3bf49551482ccb4933e" ON public.execution_metadata USING btree ("executionId", key);


--
-- Name: IDX_d6870d3b6e4c185d33926f423c; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_d6870d3b6e4c185d33926f423c" ON public.test_run USING btree ("workflowId");


--
-- Name: IDX_e48a201071ab85d9d09119d640; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_e48a201071ab85d9d09119d640" ON public.workflow_dependency USING btree ("dependencyKey");


--
-- Name: IDX_e7fe1cfda990c14a445937d0b9; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_e7fe1cfda990c14a445937d0b9" ON public.workflow_dependency USING btree ("dependencyType");


--
-- Name: IDX_execution_entity_deletedAt; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_execution_entity_deletedAt" ON public.execution_entity USING btree ("deletedAt");


--
-- Name: IDX_role_scope_scopeSlug; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_role_scope_scopeSlug" ON public.role_scope USING btree ("scopeSlug");


--
-- Name: IDX_workflow_entity_name; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX "IDX_workflow_entity_name" ON public.workflow_entity USING btree (name);


--
-- Name: idx_07fde106c0b471d8cc80a64fc8; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX idx_07fde106c0b471d8cc80a64fc8 ON public.credentials_entity USING btree (type);


--
-- Name: idx_16f4436789e804e3e1c9eeb240; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX idx_16f4436789e804e3e1c9eeb240 ON public.webhook_entity USING btree ("webhookId", method, "pathLength");


--
-- Name: idx_812eb05f7451ca757fb98444ce; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX idx_812eb05f7451ca757fb98444ce ON public.tag_entity USING btree (name);


--
-- Name: idx_execution_entity_stopped_at_status_deleted_at; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX idx_execution_entity_stopped_at_status_deleted_at ON public.execution_entity USING btree ("stoppedAt", status, "deletedAt") WHERE (("stoppedAt" IS NOT NULL) AND ("deletedAt" IS NULL));


--
-- Name: idx_execution_entity_wait_till_status_deleted_at; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX idx_execution_entity_wait_till_status_deleted_at ON public.execution_entity USING btree ("waitTill", status, "deletedAt") WHERE (("waitTill" IS NOT NULL) AND ("deletedAt" IS NULL));


--
-- Name: idx_execution_entity_workflow_id_started_at; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX idx_execution_entity_workflow_id_started_at ON public.execution_entity USING btree ("workflowId", "startedAt") WHERE (("startedAt" IS NOT NULL) AND ("deletedAt" IS NULL));


--
-- Name: idx_workflows_tags_workflow_id; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX idx_workflows_tags_workflow_id ON public.workflows_tags USING btree ("workflowId");


--
-- Name: pk_credentials_entity_id; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX pk_credentials_entity_id ON public.credentials_entity USING btree (id);


--
-- Name: pk_tag_entity_id; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX pk_tag_entity_id ON public.tag_entity USING btree (id);


--
-- Name: pk_workflow_entity_id; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX pk_workflow_entity_id ON public.workflow_entity USING btree (id);


--
-- Name: project_relation_role_idx; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX project_relation_role_idx ON public.project_relation USING btree (role);


--
-- Name: project_relation_role_project_idx; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX project_relation_role_project_idx ON public.project_relation USING btree ("projectId", role);


--
-- Name: user_role_idx; Type: INDEX; Schema: public; Owner: n8n
--

CREATE INDEX user_role_idx ON public."user" USING btree ("roleSlug");


--
-- Name: variables_global_key_unique; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX variables_global_key_unique ON public.variables USING btree (key) WHERE ("projectId" IS NULL);


--
-- Name: variables_project_key_unique; Type: INDEX; Schema: public; Owner: n8n
--

CREATE UNIQUE INDEX variables_project_key_unique ON public.variables USING btree ("projectId", key) WHERE ("projectId" IS NOT NULL);


--
-- Name: workflow_entity workflow_version_increment; Type: TRIGGER; Schema: public; Owner: n8n
--

CREATE TRIGGER workflow_version_increment BEFORE UPDATE ON public.workflow_entity FOR EACH ROW EXECUTE FUNCTION public.increment_workflow_version();


--
-- Name: processed_data FK_06a69a7032c97a763c2c7599464; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.processed_data
    ADD CONSTRAINT "FK_06a69a7032c97a763c2c7599464" FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- Name: insights_metadata FK_1d8ab99d5861c9388d2dc1cf733; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.insights_metadata
    ADD CONSTRAINT "FK_1d8ab99d5861c9388d2dc1cf733" FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE SET NULL;


--
-- Name: workflow_history FK_1e31657f5fe46816c34be7c1b4b; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflow_history
    ADD CONSTRAINT "FK_1e31657f5fe46816c34be7c1b4b" FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- Name: chat_hub_messages FK_1f4998c8a7dec9e00a9ab15550e; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_messages
    ADD CONSTRAINT "FK_1f4998c8a7dec9e00a9ab15550e" FOREIGN KEY ("revisionOfMessageId") REFERENCES public.chat_hub_messages(id) ON DELETE CASCADE;


--
-- Name: oauth_user_consents FK_21e6c3c2d78a097478fae6aaefa; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_user_consents
    ADD CONSTRAINT "FK_21e6c3c2d78a097478fae6aaefa" FOREIGN KEY ("userId") REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- Name: insights_metadata FK_2375a1eda085adb16b24615b69c; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.insights_metadata
    ADD CONSTRAINT "FK_2375a1eda085adb16b24615b69c" FOREIGN KEY ("projectId") REFERENCES public.project(id) ON DELETE SET NULL;


--
-- Name: chat_hub_messages FK_25c9736e7f769f3a005eef4b372; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_messages
    ADD CONSTRAINT "FK_25c9736e7f769f3a005eef4b372" FOREIGN KEY ("retryOfMessageId") REFERENCES public.chat_hub_messages(id) ON DELETE CASCADE;


--
-- Name: execution_metadata FK_31d0b4c93fb85ced26f6005cda3; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_metadata
    ADD CONSTRAINT "FK_31d0b4c93fb85ced26f6005cda3" FOREIGN KEY ("executionId") REFERENCES public.execution_entity(id) ON DELETE CASCADE;


--
-- Name: shared_credentials FK_416f66fc846c7c442970c094ccf; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.shared_credentials
    ADD CONSTRAINT "FK_416f66fc846c7c442970c094ccf" FOREIGN KEY ("credentialsId") REFERENCES public.credentials_entity(id) ON DELETE CASCADE;


--
-- Name: variables FK_42f6c766f9f9d2edcc15bdd6e9b; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.variables
    ADD CONSTRAINT "FK_42f6c766f9f9d2edcc15bdd6e9b" FOREIGN KEY ("projectId") REFERENCES public.project(id) ON DELETE CASCADE;


--
-- Name: chat_hub_agents FK_441ba2caba11e077ce3fbfa2cd8; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_agents
    ADD CONSTRAINT "FK_441ba2caba11e077ce3fbfa2cd8" FOREIGN KEY ("ownerId") REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- Name: project_relation FK_5f0643f6717905a05164090dde7; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.project_relation
    ADD CONSTRAINT "FK_5f0643f6717905a05164090dde7" FOREIGN KEY ("userId") REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- Name: project_relation FK_61448d56d61802b5dfde5cdb002; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.project_relation
    ADD CONSTRAINT "FK_61448d56d61802b5dfde5cdb002" FOREIGN KEY ("projectId") REFERENCES public.project(id) ON DELETE CASCADE;


--
-- Name: insights_by_period FK_6414cfed98daabbfdd61a1cfbc0; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.insights_by_period
    ADD CONSTRAINT "FK_6414cfed98daabbfdd61a1cfbc0" FOREIGN KEY ("metaId") REFERENCES public.insights_metadata("metaId") ON DELETE CASCADE;


--
-- Name: oauth_authorization_codes FK_64d965bd072ea24fb6da55468cd; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_authorization_codes
    ADD CONSTRAINT "FK_64d965bd072ea24fb6da55468cd" FOREIGN KEY ("clientId") REFERENCES public.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: chat_hub_messages FK_6afb260449dd7a9b85355d4e0c9; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_messages
    ADD CONSTRAINT "FK_6afb260449dd7a9b85355d4e0c9" FOREIGN KEY ("executionId") REFERENCES public.execution_entity(id) ON DELETE SET NULL;


--
-- Name: insights_raw FK_6e2e33741adef2a7c5d66befa4e; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.insights_raw
    ADD CONSTRAINT "FK_6e2e33741adef2a7c5d66befa4e" FOREIGN KEY ("metaId") REFERENCES public.insights_metadata("metaId") ON DELETE CASCADE;


--
-- Name: oauth_access_tokens FK_7234a36d8e49a1fa85095328845; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_access_tokens
    ADD CONSTRAINT "FK_7234a36d8e49a1fa85095328845" FOREIGN KEY ("userId") REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- Name: installed_nodes FK_73f857fc5dce682cef8a99c11dbddbc969618951; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.installed_nodes
    ADD CONSTRAINT "FK_73f857fc5dce682cef8a99c11dbddbc969618951" FOREIGN KEY (package) REFERENCES public.installed_packages("packageName") ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: oauth_access_tokens FK_78b26968132b7e5e45b75876481; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_access_tokens
    ADD CONSTRAINT "FK_78b26968132b7e5e45b75876481" FOREIGN KEY ("clientId") REFERENCES public.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: chat_hub_sessions FK_7bc13b4c7e6afbfaf9be326c189; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_sessions
    ADD CONSTRAINT "FK_7bc13b4c7e6afbfaf9be326c189" FOREIGN KEY ("credentialId") REFERENCES public.credentials_entity(id) ON DELETE SET NULL;


--
-- Name: folder FK_804ea52f6729e3940498bd54d78; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.folder
    ADD CONSTRAINT "FK_804ea52f6729e3940498bd54d78" FOREIGN KEY ("parentFolderId") REFERENCES public.folder(id) ON DELETE CASCADE;


--
-- Name: shared_credentials FK_812c2852270da1247756e77f5a4; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.shared_credentials
    ADD CONSTRAINT "FK_812c2852270da1247756e77f5a4" FOREIGN KEY ("projectId") REFERENCES public.project(id) ON DELETE CASCADE;


--
-- Name: test_case_execution FK_8e4b4774db42f1e6dda3452b2af; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.test_case_execution
    ADD CONSTRAINT "FK_8e4b4774db42f1e6dda3452b2af" FOREIGN KEY ("testRunId") REFERENCES public.test_run(id) ON DELETE CASCADE;


--
-- Name: data_table_column FK_930b6e8faaf88294cef23484160; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.data_table_column
    ADD CONSTRAINT "FK_930b6e8faaf88294cef23484160" FOREIGN KEY ("dataTableId") REFERENCES public.data_table(id) ON DELETE CASCADE;


--
-- Name: folder_tag FK_94a60854e06f2897b2e0d39edba; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.folder_tag
    ADD CONSTRAINT "FK_94a60854e06f2897b2e0d39edba" FOREIGN KEY ("folderId") REFERENCES public.folder(id) ON DELETE CASCADE;


--
-- Name: execution_annotations FK_97f863fa83c4786f19565084960; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_annotations
    ADD CONSTRAINT "FK_97f863fa83c4786f19565084960" FOREIGN KEY ("executionId") REFERENCES public.execution_entity(id) ON DELETE CASCADE;


--
-- Name: chat_hub_agents FK_9c61ad497dcbae499c96a6a78ba; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_agents
    ADD CONSTRAINT "FK_9c61ad497dcbae499c96a6a78ba" FOREIGN KEY ("credentialId") REFERENCES public.credentials_entity(id) ON DELETE SET NULL;


--
-- Name: chat_hub_sessions FK_9f9293d9f552496c40e0d1a8f80; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_sessions
    ADD CONSTRAINT "FK_9f9293d9f552496c40e0d1a8f80" FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE SET NULL;


--
-- Name: execution_annotation_tags FK_a3697779b366e131b2bbdae2976; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_annotation_tags
    ADD CONSTRAINT "FK_a3697779b366e131b2bbdae2976" FOREIGN KEY ("tagId") REFERENCES public.annotation_tag_entity(id) ON DELETE CASCADE;


--
-- Name: shared_workflow FK_a45ea5f27bcfdc21af9b4188560; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.shared_workflow
    ADD CONSTRAINT "FK_a45ea5f27bcfdc21af9b4188560" FOREIGN KEY ("projectId") REFERENCES public.project(id) ON DELETE CASCADE;


--
-- Name: workflow_dependency FK_a4ff2d9b9628ea988fa9e7d0bf8; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflow_dependency
    ADD CONSTRAINT "FK_a4ff2d9b9628ea988fa9e7d0bf8" FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- Name: oauth_user_consents FK_a651acea2f6c97f8c4514935486; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_user_consents
    ADD CONSTRAINT "FK_a651acea2f6c97f8c4514935486" FOREIGN KEY ("clientId") REFERENCES public.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: oauth_refresh_tokens FK_a699f3ed9fd0c1b19bc2608ac53; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_refresh_tokens
    ADD CONSTRAINT "FK_a699f3ed9fd0c1b19bc2608ac53" FOREIGN KEY ("userId") REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- Name: folder FK_a8260b0b36939c6247f385b8221; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.folder
    ADD CONSTRAINT "FK_a8260b0b36939c6247f385b8221" FOREIGN KEY ("projectId") REFERENCES public.project(id) ON DELETE CASCADE;


--
-- Name: oauth_authorization_codes FK_aa8d3560484944c19bdf79ffa16; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_authorization_codes
    ADD CONSTRAINT "FK_aa8d3560484944c19bdf79ffa16" FOREIGN KEY ("userId") REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- Name: chat_hub_messages FK_acf8926098f063cdbbad8497fd1; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_messages
    ADD CONSTRAINT "FK_acf8926098f063cdbbad8497fd1" FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE SET NULL;


--
-- Name: oauth_refresh_tokens FK_b388696ce4d8be7ffbe8d3e4b69; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.oauth_refresh_tokens
    ADD CONSTRAINT "FK_b388696ce4d8be7ffbe8d3e4b69" FOREIGN KEY ("clientId") REFERENCES public.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: execution_annotation_tags FK_c1519757391996eb06064f0e7c8; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_annotation_tags
    ADD CONSTRAINT "FK_c1519757391996eb06064f0e7c8" FOREIGN KEY ("annotationId") REFERENCES public.execution_annotations(id) ON DELETE CASCADE;


--
-- Name: data_table FK_c2a794257dee48af7c9abf681de; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.data_table
    ADD CONSTRAINT "FK_c2a794257dee48af7c9abf681de" FOREIGN KEY ("projectId") REFERENCES public.project(id) ON DELETE CASCADE;


--
-- Name: project_relation FK_c6b99592dc96b0d836d7a21db91; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.project_relation
    ADD CONSTRAINT "FK_c6b99592dc96b0d836d7a21db91" FOREIGN KEY (role) REFERENCES public.role(slug);


--
-- Name: test_run FK_d6870d3b6e4c185d33926f423c8; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.test_run
    ADD CONSTRAINT "FK_d6870d3b6e4c185d33926f423c8" FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- Name: shared_workflow FK_daa206a04983d47d0a9c34649ce; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.shared_workflow
    ADD CONSTRAINT "FK_daa206a04983d47d0a9c34649ce" FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- Name: folder_tag FK_dc88164176283de80af47621746; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.folder_tag
    ADD CONSTRAINT "FK_dc88164176283de80af47621746" FOREIGN KEY ("tagId") REFERENCES public.tag_entity(id) ON DELETE CASCADE;


--
-- Name: user_api_keys FK_e131705cbbc8fb589889b02d457; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.user_api_keys
    ADD CONSTRAINT "FK_e131705cbbc8fb589889b02d457" FOREIGN KEY ("userId") REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- Name: chat_hub_messages FK_e22538eb50a71a17954cd7e076c; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_messages
    ADD CONSTRAINT "FK_e22538eb50a71a17954cd7e076c" FOREIGN KEY ("sessionId") REFERENCES public.chat_hub_sessions(id) ON DELETE CASCADE;


--
-- Name: test_case_execution FK_e48965fac35d0f5b9e7f51d8c44; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.test_case_execution
    ADD CONSTRAINT "FK_e48965fac35d0f5b9e7f51d8c44" FOREIGN KEY ("executionId") REFERENCES public.execution_entity(id) ON DELETE SET NULL;


--
-- Name: chat_hub_messages FK_e5d1fa722c5a8d38ac204746662; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_messages
    ADD CONSTRAINT "FK_e5d1fa722c5a8d38ac204746662" FOREIGN KEY ("previousMessageId") REFERENCES public.chat_hub_messages(id) ON DELETE CASCADE;


--
-- Name: chat_hub_sessions FK_e9ecf8ede7d989fcd18790fe36a; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.chat_hub_sessions
    ADD CONSTRAINT "FK_e9ecf8ede7d989fcd18790fe36a" FOREIGN KEY ("ownerId") REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- Name: user FK_eaea92ee7bfb9c1b6cd01505d56; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT "FK_eaea92ee7bfb9c1b6cd01505d56" FOREIGN KEY ("roleSlug") REFERENCES public.role(slug);


--
-- Name: role_scope FK_role; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.role_scope
    ADD CONSTRAINT "FK_role" FOREIGN KEY ("roleSlug") REFERENCES public.role(slug) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: role_scope FK_scope; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.role_scope
    ADD CONSTRAINT "FK_scope" FOREIGN KEY ("scopeSlug") REFERENCES public.scope(slug) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: auth_identity auth_identity_userId_fkey; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.auth_identity
    ADD CONSTRAINT "auth_identity_userId_fkey" FOREIGN KEY ("userId") REFERENCES public."user"(id);


--
-- Name: execution_data execution_data_fk; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_data
    ADD CONSTRAINT execution_data_fk FOREIGN KEY ("executionId") REFERENCES public.execution_entity(id) ON DELETE CASCADE;


--
-- Name: execution_entity fk_execution_entity_workflow_id; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.execution_entity
    ADD CONSTRAINT fk_execution_entity_workflow_id FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- Name: webhook_entity fk_webhook_entity_workflow_id; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.webhook_entity
    ADD CONSTRAINT fk_webhook_entity_workflow_id FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- Name: workflow_entity fk_workflow_parent_folder; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflow_entity
    ADD CONSTRAINT fk_workflow_parent_folder FOREIGN KEY ("parentFolderId") REFERENCES public.folder(id) ON DELETE CASCADE;


--
-- Name: workflow_statistics fk_workflow_statistics_workflow_id; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflow_statistics
    ADD CONSTRAINT fk_workflow_statistics_workflow_id FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- Name: workflows_tags fk_workflows_tags_tag_id; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflows_tags
    ADD CONSTRAINT fk_workflows_tags_tag_id FOREIGN KEY ("tagId") REFERENCES public.tag_entity(id) ON DELETE CASCADE;


--
-- Name: workflows_tags fk_workflows_tags_workflow_id; Type: FK CONSTRAINT; Schema: public; Owner: n8n
--

ALTER TABLE ONLY public.workflows_tags
    ADD CONSTRAINT fk_workflows_tags_workflow_id FOREIGN KEY ("workflowId") REFERENCES public.workflow_entity(id) ON DELETE CASCADE;


--
-- PostgreSQL database dump complete
--

\unrestrict y9GYyt16N3z6K3SeNZvyqxufifJnge72mRDNun7qI8bBGwmfiLDFBliM3Djkrlq

